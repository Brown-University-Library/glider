!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(t){return t&&DataView.prototype.isPrototypeOf(t)},i=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1};h.prototype.append=function(t,e){t=a(t),e=u(e);var n=this.map[t];this.map[t]=n?n+","+e:e},h.prototype.delete=function(t){delete this.map[a(t)]},h.prototype.get=function(t){return t=a(t),this.has(t)?this.map[t]:null},h.prototype.has=function(t){return this.map.hasOwnProperty(a(t))},h.prototype.set=function(t,e){this.map[a(t)]=u(e)},h.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},h.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),c(t)},h.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),c(t)},h.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),c(t)},e.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},y.call(m.prototype),y.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},v.error=function(){var t=new v(null,{status:0,statusText:""});return t.type="error",t};var s=[301,302,303,307,308];v.redirect=function(t,e){if(-1===s.indexOf(e))throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})},t.Headers=h,t.Request=m,t.Response=v,t.fetch=function(t,n){return new Promise(function(r,i){var o=new m(t,n),s=new XMLHttpRequest;s.onload=function(){var t,e,n={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",e=new h,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;r(new v(i,n))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&e.blob&&(s.responseType="blob"),o.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}function a(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function u(t){return"string"!=typeof t&&(t=String(t)),t}function c(t){var n={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e.iterable&&(n[Symbol.iterator]=function(){return n}),n}function h(t){this.map={},t instanceof h?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function l(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function f(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function p(t){var e=new FileReader,n=f(e);return e.readAsArrayBuffer(t),n}function d(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&r(t))this._bodyArrayBuffer=d(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!i(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},e.blob&&(this.blob=function(){var t=l(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?l(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var t,e,n,r=l(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=f(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},e.formData&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}function m(t,e){var n,r,i=(e=e||{}).body;if(t instanceof m){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new h(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new h(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),o.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function g(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function v(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new h(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=setTimeout;function r(){}function i(t){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function o(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,i._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void a(e.promise,t)}s(e.promise,r)}else(1===t._state?s:a)(e.promise,t._value)})):t._deferreds.push(e)}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof i)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void c((r=n,o=e,function(){r.apply(o,arguments)}),t)}t._state=1,t._value=e,u(t)}catch(e){a(t,e)}var r,o}function a(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&i._immediateFn(function(){t._handled||i._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)o(t,t._deferreds[e]);t._deferreds=null}function c(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,a(e,t))})}catch(t){if(n)return;n=!0,a(e,t)}}i.prototype.catch=function(t){return this.then(null,t)},i.prototype.then=function(t,e){var n=new this.constructor(r);return o(this,new function(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(t,e,n)),n},i.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})},i.all=function(t){return new i(function(e,n){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){o(t,e)},n)}r[t]=s,0==--i&&e(r)}catch(t){n(t)}}for(var s=0;s<r.length;s++)o(s,r[s])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(t){return new i(function(e,n){n(t)})},i.race=function(t){return new i(function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)})},i._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){n(t,0)},i._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var h=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();h.Promise||(h.Promise=i);var l=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),f=e(function(t){var e=t.exports={version:"2.5.5"};"number"==typeof __e&&(__e=e)}),p=(f.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),d=function(t){if(!p(t))throw TypeError(t+" is not an object!");return t},y=function(t){try{return!!t()}catch(t){return!0}},m=!y(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),g=l.document,v=p(g)&&p(g.createElement),b=function(t){return v?g.createElement(t):{}},_=!m&&!y(function(){return 7!=Object.defineProperty(b("div"),"a",{get:function(){return 7}}).a}),w=function(t,e){if(!p(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!p(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!p(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!p(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},E=Object.defineProperty,T={f:m?Object.defineProperty:function(t,e,n){if(d(t),e=w(e,!0),d(n),_)try{return E(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},S=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},I=m?function(t,e,n){return T.f(t,e,S(1,n))}:function(t,e,n){return t[e]=n,t},C={}.hasOwnProperty,N=function(t,e){return C.call(t,e)},D=0,A=Math.random(),R=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++D+A).toString(36))},k=e(function(t){var e=R("src"),n=Function.toString,r=(""+n).split("toString");f.inspectSource=function(t){return n.call(t)},(t.exports=function(t,n,i,o){var s="function"==typeof i;s&&(N(i,"name")||I(i,"name",n)),t[n]!==i&&(s&&(N(i,e)||I(i,e,t[n]?""+t[n]:r.join(String(n)))),t===l?t[n]=i:o?t[n]?t[n]=i:I(t,n,i):(delete t[n],I(t,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||n.call(this)})}),O=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},P=function(t,e,n){var r,i,o,s,a=t&P.F,u=t&P.G,c=t&P.S,h=t&P.P,p=t&P.B,d=u?l:c?l[e]||(l[e]={}):(l[e]||{}).prototype,y=u?f:f[e]||(f[e]={}),m=y.prototype||(y.prototype={});for(r in u&&(n=e),n)o=((i=!a&&d&&void 0!==d[r])?d:n)[r],s=p&&i?O(o,l):h&&"function"==typeof o?O(Function.call,o):o,d&&k(d,r,o,t&P.U),y[r]!=o&&I(y,r,s),h&&m[r]!=o&&(m[r]=o)};l.core=f,P.F=1,P.G=2,P.S=4,P.P=8,P.B=16,P.W=32,P.U=64,P.R=128;var L=P,M={}.toString,x=function(t){return M.call(t).slice(8,-1)},F=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==x(t)?t.split(""):Object(t)},U=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},q=function(t){return Object(U(t))},B=Math.ceil,V=Math.floor,W=function(t){return isNaN(t=+t)?0:(t>0?V:B)(t)},j=Math.min,K=function(t){return t>0?j(W(t),9007199254740991):0},Q=Array.isArray||function(t){return"Array"==x(t)},H=l["__core-js_shared__"]||(l["__core-js_shared__"]={}),G=function(t){return H[t]||(H[t]={})},z=e(function(t){var e=G("wks"),n=l.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:R)("Symbol."+t))}).store=e}),Y=z("species"),X=function(t,e){return new(function(t){var e;return Q(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!Q(e.prototype)||(e=void 0),p(e)&&null===(e=e[Y])&&(e=void 0)),void 0===e?Array:e}(t))(e)},J=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,s=6==t,a=5==t||s,u=e||X;return function(e,c,h){for(var l,f,p=q(e),d=F(p),y=O(c,h,3),m=K(d.length),g=0,v=n?u(e,m):r?u(e,0):void 0;m>g;g++)if((a||g in d)&&(f=y(l=d[g],g,p),t))if(n)v[g]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return g;case 2:v.push(l)}else if(o)return!1;return s?-1:i||o?o:v}},$=z("unscopables"),Z=Array.prototype;void 0==Z[$]&&I(Z,$,{});var tt=function(t){Z[$][t]=!0},et=J(5),nt=!0;"find"in[]&&Array(1).find(function(){nt=!1}),L(L.P+L.F*nt,"Array",{find:function(t){return et(this,t,arguments.length>1?arguments[1]:void 0)}}),tt("find");f.Array.find;var rt=J(6),it=!0;"findIndex"in[]&&Array(1).findIndex(function(){it=!1}),L(L.P+L.F*it,"Array",{findIndex:function(t){return rt(this,t,arguments.length>1?arguments[1]:void 0)}}),tt("findIndex");f.Array.findIndex;var ot,st=function(t){return F(U(t))},at=Math.max,ut=Math.min,ct=G("keys"),ht=function(t){return ct[t]||(ct[t]=R(t))},lt=(ot=!1,function(t,e,n){var r,i=st(t),o=K(i.length),s=function(t,e){return(t=W(t))<0?at(t+e,0):ut(t,e)}(n,o);if(ot&&e!=e){for(;o>s;)if((r=i[s++])!=r)return!0}else for(;o>s;s++)if((ot||s in i)&&i[s]===e)return ot||s||0;return!ot&&-1}),ft=ht("IE_PROTO"),pt=function(t,e){var n,r=st(t),i=0,o=[];for(n in r)n!=ft&&N(r,n)&&o.push(n);for(;e.length>i;)N(r,n=e[i++])&&(~lt(o,n)||o.push(n));return o},dt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),yt=Object.keys||function(t){return pt(t,dt)},mt={f:Object.getOwnPropertySymbols},gt={f:{}.propertyIsEnumerable},vt=Object.assign,bt=!vt||y(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=vt({},t)[n]||Object.keys(vt({},e)).join("")!=r})?function(t,e){for(var n=q(t),r=arguments.length,i=1,o=mt.f,s=gt.f;r>i;)for(var a,u=F(arguments[i++]),c=o?yt(u).concat(o(u)):yt(u),h=c.length,l=0;h>l;)s.call(u,a=c[l++])&&(n[a]=u[a]);return n}:vt;L(L.S+L.F,"Object",{assign:bt});f.Object.assign;var _t=z("match"),wt=function(t,e,n){if(p(r=e)&&(void 0!==(i=r[_t])?i:"RegExp"==x(r)))throw TypeError("String#"+n+" doesn't accept regex!");var r,i;return String(U(t))},Et=z("match"),Tt="".startsWith;L(L.P+L.F*function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[Et]=!1,!"/./"[t](e)}catch(t){}}return!0}("startsWith"),"String",{startsWith:function(t){var e=wt(this,t,"startsWith"),n=K(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return Tt?Tt.call(e,r,n):e.slice(n,n+r.length)===r}});f.String.startsWith;L(L.P,"String",{repeat:function(t){var e=String(U(this)),n="",r=W(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});f.String.repeat;var St=e(function(t){var e=R("meta"),n=T.f,r=0,i=Object.isExtensible||function(){return!0},o=!y(function(){return i(Object.preventExtensions({}))}),s=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},a=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!p(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!N(t,e)){if(!i(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!N(t,e)){if(!i(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return o&&a.NEED&&i(t)&&!N(t,e)&&s(t),t}}}),It=(St.KEY,St.NEED,St.fastKey,St.getWeak,St.onFreeze,T.f),Ct=z("toStringTag"),Nt=function(t,e,n){t&&!N(t=n?t:t.prototype,Ct)&&It(t,Ct,{configurable:!0,value:e})},Dt={f:z},At=T.f,Rt=function(t){var e=f.Symbol||(f.Symbol=l.Symbol||{});"_"==t.charAt(0)||t in e||At(e,t,{value:Dt.f(t)})},kt=m?Object.defineProperties:function(t,e){d(t);for(var n,r=yt(e),i=r.length,o=0;i>o;)T.f(t,n=r[o++],e[n]);return t},Ot=l.document,Pt=Ot&&Ot.documentElement,Lt=ht("IE_PROTO"),Mt=function(){},xt=function(){var t,e=b("iframe"),n=dt.length;for(e.style.display="none",Pt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),xt=t.F;n--;)delete xt.prototype[dt[n]];return xt()},Ft=Object.create||function(t,e){var n;return null!==t?(Mt.prototype=d(t),n=new Mt,Mt.prototype=null,n[Lt]=t):n=xt(),void 0===e?n:kt(n,e)},Ut=dt.concat("length","prototype"),qt={f:Object.getOwnPropertyNames||function(t){return pt(t,Ut)}},Bt=qt.f,Vt={}.toString,Wt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],jt={f:function(t){return Wt&&"[object Window]"==Vt.call(t)?function(t){try{return Bt(t)}catch(t){return Wt.slice()}}(t):Bt(st(t))}},Kt=Object.getOwnPropertyDescriptor,Qt={f:m?Kt:function(t,e){if(t=st(t),e=w(e,!0),_)try{return Kt(t,e)}catch(t){}if(N(t,e))return S(!gt.f.call(t,e),t[e])}},Ht=St.KEY,Gt=Qt.f,zt=T.f,Yt=jt.f,Xt=l.Symbol,Jt=l.JSON,$t=Jt&&Jt.stringify,Zt=z("_hidden"),te=z("toPrimitive"),ee={}.propertyIsEnumerable,ne=G("symbol-registry"),re=G("symbols"),ie=G("op-symbols"),oe=Object.prototype,se="function"==typeof Xt,ae=l.QObject,ue=!ae||!ae.prototype||!ae.prototype.findChild,ce=m&&y(function(){return 7!=Ft(zt({},"a",{get:function(){return zt(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=Gt(oe,e);r&&delete oe[e],zt(t,e,n),r&&t!==oe&&zt(oe,e,r)}:zt,he=function(t){var e=re[t]=Ft(Xt.prototype);return e._k=t,e},le=se&&"symbol"==typeof Xt.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof Xt},fe=function(t,e,n){return t===oe&&fe(ie,e,n),d(t),e=w(e,!0),d(n),N(re,e)?(n.enumerable?(N(t,Zt)&&t[Zt][e]&&(t[Zt][e]=!1),n=Ft(n,{enumerable:S(0,!1)})):(N(t,Zt)||zt(t,Zt,S(1,{})),t[Zt][e]=!0),ce(t,e,n)):zt(t,e,n)},pe=function(t,e){d(t);for(var n,r=function(t){var e=yt(t),n=mt.f;if(n)for(var r,i=n(t),o=gt.f,s=0;i.length>s;)o.call(t,r=i[s++])&&e.push(r);return e}(e=st(e)),i=0,o=r.length;o>i;)fe(t,n=r[i++],e[n]);return t},de=function(t){var e=ee.call(this,t=w(t,!0));return!(this===oe&&N(re,t)&&!N(ie,t))&&(!(e||!N(this,t)||!N(re,t)||N(this,Zt)&&this[Zt][t])||e)},ye=function(t,e){if(t=st(t),e=w(e,!0),t!==oe||!N(re,e)||N(ie,e)){var n=Gt(t,e);return!n||!N(re,e)||N(t,Zt)&&t[Zt][e]||(n.enumerable=!0),n}},me=function(t){for(var e,n=Yt(st(t)),r=[],i=0;n.length>i;)N(re,e=n[i++])||e==Zt||e==Ht||r.push(e);return r},ge=function(t){for(var e,n=t===oe,r=Yt(n?ie:st(t)),i=[],o=0;r.length>o;)!N(re,e=r[o++])||n&&!N(oe,e)||i.push(re[e]);return i};se||(k((Xt=function(){if(this instanceof Xt)throw TypeError("Symbol is not a constructor!");var t=R(arguments.length>0?arguments[0]:void 0),e=function(n){this===oe&&e.call(ie,n),N(this,Zt)&&N(this[Zt],t)&&(this[Zt][t]=!1),ce(this,t,S(1,n))};return m&&ue&&ce(oe,t,{configurable:!0,set:e}),he(t)}).prototype,"toString",function(){return this._k}),Qt.f=ye,T.f=fe,qt.f=jt.f=me,gt.f=de,mt.f=ge,m&&k(oe,"propertyIsEnumerable",de,!0),Dt.f=function(t){return he(z(t))}),L(L.G+L.W+L.F*!se,{Symbol:Xt});for(var ve="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),be=0;ve.length>be;)z(ve[be++]);for(var _e=yt(z.store),we=0;_e.length>we;)Rt(_e[we++]);L(L.S+L.F*!se,"Symbol",{for:function(t){return N(ne,t+="")?ne[t]:ne[t]=Xt(t)},keyFor:function(t){if(!le(t))throw TypeError(t+" is not a symbol!");for(var e in ne)if(ne[e]===t)return e},useSetter:function(){ue=!0},useSimple:function(){ue=!1}}),L(L.S+L.F*!se,"Object",{create:function(t,e){return void 0===e?Ft(t):pe(Ft(t),e)},defineProperty:fe,defineProperties:pe,getOwnPropertyDescriptor:ye,getOwnPropertyNames:me,getOwnPropertySymbols:ge}),Jt&&L(L.S+L.F*(!se||y(function(){var t=Xt();return"[null]"!=$t([t])||"{}"!=$t({a:t})||"{}"!=$t(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(p(e)||void 0!==t)&&!le(t))return Q(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!le(e))return e}),r[1]=e,$t.apply(Jt,r)}}),Xt.prototype[te]||I(Xt.prototype,te,Xt.prototype.valueOf),Nt(Xt,"Symbol"),Nt(Math,"Math",!0),Nt(l.JSON,"JSON",!0);var Ee=z("toStringTag"),Te="Arguments"==x(function(){return arguments}()),Se={};Se[z("toStringTag")]="z",Se+""!="[object z]"&&k(Object.prototype,"toString",function(){return"[object "+(void 0===(t=this)?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Ee))?n:Te?x(e):"Object"==(r=x(e))&&"function"==typeof e.callee?"Arguments":r)+"]";var t,e,n,r},!0),Rt("asyncIterator"),Rt("observable");f.Symbol;var Ie={},Ce={};I(Ce,z("iterator"),function(){return this});var Ne,De=function(t,e,n){t.prototype=Ft(Ce,{next:S(1,n)}),Nt(t,e+" Iterator")},Ae=ht("IE_PROTO"),Re=Object.prototype,ke=Object.getPrototypeOf||function(t){return t=q(t),N(t,Ae)?t[Ae]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Re:null},Oe=z("iterator"),Pe=!([].keys&&"next"in[].keys()),Le=function(){return this},Me=function(t,e,n,r,i,o,s){De(n,e,r);var a,u,c,h=function(t){if(!Pe&&t in d)return d[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},l=e+" Iterator",f="values"==i,p=!1,d=t.prototype,y=d[Oe]||d["@@iterator"]||i&&d[i],m=y||h(i),g=i?f?h("entries"):m:void 0,v="Array"==e&&d.entries||y;if(v&&(c=ke(v.call(new t)))!==Object.prototype&&c.next&&(Nt(c,l,!0),"function"!=typeof c[Oe]&&I(c,Oe,Le)),f&&y&&"values"!==y.name&&(p=!0,m=function(){return y.call(this)}),(Pe||p||!d[Oe])&&I(d,Oe,m),Ie[e]=m,Ie[l]=Le,i)if(a={values:f?m:h("values"),keys:o?m:h("keys"),entries:g},s)for(u in a)u in d||k(d,u,a[u]);else L(L.P+L.F*(Pe||p),e,a);return a},xe=(Ne=!0,function(t,e){var n,r,i=String(U(t)),o=W(e),s=i.length;return o<0||o>=s?Ne?"":void 0:(n=i.charCodeAt(o))<55296||n>56319||o+1===s||(r=i.charCodeAt(o+1))<56320||r>57343?Ne?i.charAt(o):n:Ne?i.slice(o,o+2):r-56320+(n-55296<<10)+65536});Me(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=xe(e,n),this._i+=t.length,{value:t,done:!1})});var Fe=function(t,e){return{value:e,done:!!t}},Ue=Me(Array,"Array",function(t,e){this._t=st(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,Fe(1)):Fe(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");Ie.Arguments=Ie.Array,tt("keys"),tt("values"),tt("entries");for(var qe=z("iterator"),Be=z("toStringTag"),Ve=Ie.Array,We={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},je=yt(We),Ke=0;Ke<je.length;Ke++){var Qe,He=je[Ke],Ge=We[He],ze=l[He],Ye=ze&&ze.prototype;if(Ye&&(Ye[qe]||I(Ye,qe,Ve),Ye[Be]||I(Ye,Be,He),Ie[He]=Ve,Ge))for(Qe in Ue)Ye[Qe]||k(Ye,Qe,Ue[Qe],!0)}Dt.f("iterator");var Xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function Je(t,e){function n(){this.constructor=t}Xe(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var $e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};function Ze(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})}function tn(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var en=!1,nn=!1,rn="${JSCORE_VERSION}",on=function(t,e){if(!t)throw sn(e)},sn=function(t){return new Error("Firebase Database ("+rn+") INTERNAL ASSERT FAILED: "+t)},an=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},un={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|a>>4,f=(15&a)<<2|c>>6,p=63&c;u||(p=64,s||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(an(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var c=o<<2|s>>4;if(r.push(c),64!=a){var h=s<<4&240|a>>2;if(r.push(h),64!=u){var l=a<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},cn=function(t){try{return un.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function hn(t){return ln(void 0,t)}function ln(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=ln(t[n],e[n]));return t}function fn(t,e,n){t[e]=n}var pn=function(){function t(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},t}(),dn=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")},yn=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},mn=function(){return!0===en||!0===nn},gn="FirebaseError",vn=Error.captureStackTrace,bn=function(){return function(t,e){if(this.code=t,this.message=e,vn)vn(this,_n.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=gn,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}}}();bn.prototype=Object.create(Error.prototype),bn.prototype.constructor=bn,bn.prototype.name=gn;var _n=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,e){void 0===e&&(e={});var n,r=this.errors[t],i=this.service+"/"+t;n=void 0===r?"Error":r.replace(this.pattern,function(t,n){var r=e[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var o=new bn(i,n);for(var s in e)e.hasOwnProperty(s)&&"_"!==s.slice(-1)&&(o[s]=e[s]);return o},t}();function wn(t){return JSON.parse(t)}function En(t){return JSON.stringify(t)}var Tn=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=wn(cn(o[0])||""),n=wn(cn(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},Sn=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},In=function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},Cn=function(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])},Nn=function(t){return e={},Cn(t,function(t,n){e[t]=n}),e;var e},Dn=function(t){for(var e in t)return!1;return!0},An=function(t){var e=0;for(var n in t)e++;return e},Rn=function(t,e,n){var r={};for(var i in t)r[i]=e.call(n,t[i],i,t);return r},kn=function(t,e,n){for(var r in t)if(e.call(n,t[r],r,t))return r},On=function(t){for(var e in t)return e},Pn=function(t){function e(){var e=t.call(this)||this;e.chain_=[],e.buf_=[],e.W_=[],e.pad_=[],e.inbuf_=0,e.total_=0,e.blockSize=64,e.pad_[0]=128;for(var n=1;n<e.blockSize;++n)e.pad_[n]=0;return e.reset(),e}return Je(e,t),e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=h^u&(c^h),s=1518500249):(o=u^c^h,s=1859775393):r<60?(o=u&c|h&(u|c),s=2400959708):(o=u^c^h,s=3395469782);i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},e.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0==o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},e.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},e}(function(){return function(){this.blockSize=-1}}());function Ln(t,e){var n=new Mn(t,e);return n.subscribe.bind(n)}var Mn=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=xn),void 0===r.error&&(r.error=xn),void 0===r.complete&&(r.complete=xn);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function xn(){}var Fn=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function Un(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function qn(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Un(t,e,r)+"must be a valid function.")}function Bn(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Un(t,e,r)+"must be a valid context object.")}var Vn=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e},Wn=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},jn="[DEFAULT]",Kn=[],Qn=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled||!1,this.options_=hn(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){Kn.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){Kn=Kn.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed_(),this._automaticDataCollectionEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);var e=[];return Object.keys(t.services_).forEach(function(n){Object.keys(t.services_[n]).forEach(function(r){e.push(t.services_[n][r])})}),Promise.all(e.map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=jn),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==jn?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;ln(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(Kn.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),Kn=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&Hn("app-deleted",{name:this.name_})},t}();function Hn(t,e){throw zn.create(t,e)}Qn.prototype.name&&Qn.prototype.options||Qn.prototype.delete||console.log("dc");var Gn,zn=new _n("app","Firebase",{"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."}),Yn=function t(){var e={},n={},r={},i={__esModule:!0,initializeApp:function(t,n){if(void 0===n&&(n={}),"object"!=typeof n||null===n){var r=n;n={name:r}}var o=n;void 0===o.name&&(o.name=jn);var s=o.name;"string"==typeof s&&s||Hn("bad-app-name",{name:s+""}),Wn(e,s)&&Hn("duplicate-app",{name:s});var u=new Qn(t,o,i);return e[s]=u,a(u,"create"),u},app:o,apps:null,Promise:Promise,SDK_VERSION:"5.8.2",INTERNAL:{registerService:function(t,e,a,u,c){n[t]&&Hn("duplicate-service",{name:t}),n[t]=e,u&&(r[t]=u,s().forEach(function(t){u("create",t)}));var h=function(e){return void 0===e&&(e=o()),"function"!=typeof e[t]&&Hn("invalid-app-argument",{name:t}),e[t]()};return void 0!==a&&ln(h,a),i[t]=h,Qn.prototype[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,t).apply(this,c?e:[])},h},createFirebaseNamespace:t,extendNamespace:function(t){ln(i,t)},createSubscribe:Ln,ErrorFactory:_n,removeApp:function(t){a(e[t],"delete"),delete e[t]},factories:n,useAsService:u,Promise:Promise,deepExtend:ln}};function o(t){return Wn(e,t=t||jn)||Hn("no-app",{name:t}),e[t]}function s(){return Object.keys(e).map(function(t){return e[t]})}function a(t,e){Object.keys(n).forEach(function(n){var i=u(t,n);null!==i&&r[i]&&r[i](e,t)})}function u(t,e){if("serverAuth"===e)return null;var n=e;return t.options,n}return fn(i,"default",i),Object.defineProperty(i,"apps",{get:s}),fn(o,"App",Qn),i}();(function(){var t,e=e||{},n=this;function r(t){return"string"==typeof t}function i(t){return"boolean"==typeof t}function o(){}function s(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function a(t){return null===t}function u(t){return"array"==s(t)}function c(t){var e=s(t);return"array"==e||"object"==e&&"number"==typeof t.length}function h(t){return"function"==s(t)}function l(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var f="closure_uid_"+(1e9*Math.random()>>>0),p=0;function d(t,e,n){return t.call.apply(t.bind,arguments)}function y(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function m(t,e,n){return(m=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?d:y).apply(null,arguments)}function g(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var v=Date.now||function(){return+new Date};function b(t,e){function n(){}n.prototype=e.prototype,t.ob=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ed=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function _(t){t.prototype.then=t.prototype.then,t.prototype.$goog_Thenable=!0}function w(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function E(t){if(Error.captureStackTrace)Error.captureStackTrace(this,E);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function T(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");E.call(this,n+t[r])}function S(t,e){throw new T("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function I(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function C(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function N(){this.b=this.a=null}b(E,Error),E.prototype.name="CustomError",b(T,E),T.prototype.name="AssertionError",I.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var D=new I(function(){return new R},function(t){t.reset()});function A(){var t=ft,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function R(){this.next=this.b=this.a=null}N.prototype.add=function(t,e){var n=D.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},R.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},R.prototype.reset=function(){this.next=this.b=this.a=null};var k=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(r(t))return r(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},O=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var i=t.length,o=r(t)?t.split(""):t,s=0;s<i;s++)s in o&&e.call(n,o[s],s,t)};var P=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=Array(n),o=r(t)?t.split(""):t,s=0;s<n;s++)s in o&&(i[s]=e.call(void 0,o[s],s,t));return i},L=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=r(t)?t.split(""):t,o=0;o<n;o++)if(o in i&&e.call(void 0,i[o],o,t))return!0;return!1};function M(t,e){return 0<=k(t,e)}function x(t,e){var n;return(n=0<=(e=k(t,e)))&&Array.prototype.splice.call(t,e,1),n}function F(t,e){!function(t,e){var n=t.length,i=r(t)?t.split(""):t;for(--n;0<=n;--n)n in i&&e.call(void 0,i[n],n,t)}(t,function(n,r){e.call(void 0,n,r,t)&&1==Array.prototype.splice.call(t,r,1).length&&0})}function U(t){return Array.prototype.concat.apply([],arguments)}function q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function B(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}var V=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function W(t){return X.test(t)?(-1!=t.indexOf("&")&&(t=t.replace(K,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(Q,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(H,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(G,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(z,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(Y,"&#0;")),t):t}var j,K=/&/g,Q=/</g,H=/>/g,G=/"/g,z=/'/g,Y=/\x00/g,X=/[\x00&<>"']/;function J(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:t>e?1:0}t:{var Z=n.navigator;if(Z){var tt=Z.userAgent;if(tt){j=tt;break t}}j=""}function et(t){return J(j,t)}function nt(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function rt(t){for(var e in t)return!1;return!0}function it(t){var e,n={};for(e in t)n[e]=t[e];return n}var ot,st,at="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ut(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<at.length;o++)n=at[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ct(t){n.setTimeout(function(){throw t},0)}function ht(t,e){st||function(){if(n.Promise&&n.Promise.resolve){var t=n.Promise.resolve(void 0);st=function(){t.then(pt)}}else st=function(){var t=pt;!h(n.setImmediate)||n.Window&&n.Window.prototype&&!et("Edge")&&n.Window.prototype.setImmediate==n.setImmediate?(ot||(ot=function(){var t=n.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!et("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=m(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0!==t&&!et("Trident")&&!et("MSIE")){var e=new t,r={},i=r;return e.port1.onmessage=function(){if(void 0!==r.next){var t=(r=r.next).wb;r.wb=null,t()}},function(t){i.next={wb:t},i=i.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){n.setTimeout(t,0)}}()),ot(t)):n.setImmediate(t)}}(),lt||(st(),lt=!0),ft.add(t,e)}var lt=!1,ft=new N;function pt(){for(var t;t=A();){try{t.a.call(t.b)}catch(t){ct(t)}C(D,t)}lt=!1}function dt(t,e){if(this.a=yt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=o)try{var n=this;t.call(e,function(t){Nt(n,mt,t)},function(t){if(!(t instanceof Lt))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}Nt(n,gt,t)})}catch(t){Nt(this,gt,t)}}var yt=0,mt=2,gt=3;function vt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}vt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var bt=new I(function(){return new vt},function(t){t.reset()});function _t(t,e,n){var r=bt.get();return r.g=t,r.b=e,r.f=n,r}function wt(t){if(t instanceof dt)return t;var e=new dt(o);return Nt(e,mt,t),e}function Et(t){return new dt(function(e,n){n(t)})}function Tt(t,e,n){Dt(t,e,n,null)||ht(g(e,t))}function St(t){return new dt(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Db:!0,value:o}:{Db:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Tt(t[o],g(i,o,!0),g(i,o,!1));else e(r)})}function It(t,e){t.b||t.a!=mt&&t.a!=gt||At(t),t.f?t.f.next=e:t.b=e,t.f=e}function Ct(t,e,n,r){var i=_t(null,null,null);return i.a=new dt(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(t){o(t)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof Lt?o(e):t(i)}catch(t){o(t)}}:o}),i.a.c=t,It(t,i),i.a}function Nt(t,e,n){t.a==yt&&(t===n&&(e=gt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,Dt(n,t.Nc,t.Oc,t)||(t.i=n,t.a=e,t.c=null,At(t),e!=gt||n instanceof Lt||function(t,e){t.g=!0,ht(function(){t.g&&Pt.call(null,e)})}(t,n)))}function Dt(t,e,n,r){if(t instanceof dt)return It(t,_t(e||o,n||null,r)),!0;if(w(t))return t.then(e,n,r),!0;if(l(t))try{var i=t.then;if(h(i))return function(t,e,n,r,i){function o(t){s||(s=!0,r.call(i,t))}var s=!1;try{e.call(t,function(t){s||(s=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function At(t){t.h||(t.h=!0,ht(t.Yb,t))}function Rt(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function kt(t,e,n,r){if(n==gt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,Ot(e,n,r);else try{e.c?e.g.call(e.f):Ot(e,n,r)}catch(t){Pt.call(null,t)}C(bt,e)}function Ot(t,e,n){e==mt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}dt.prototype.then=function(t,e,n){return Ct(this,h(t)?t:null,h(e)?e:null,n)},_(dt),(t=dt.prototype).ia=function(t,e){return(t=_t(t,t,e)).c=!0,It(this,t),this},t.s=function(t,e){return Ct(this,null,t,e)},t.cancel=function(t){this.a==yt&&ht(function(){!function t(e,n){if(e.a==yt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,s=null,a=r.b;a&&(a.c||(i++,a.a==e&&(o=a),!(o&&1<i)));a=a.next)o||(s=a);o&&(r.a==yt&&1==i?t(r,n):(s?((i=s).next==r.f&&(r.f=i),i.next=i.next.next):Rt(r),kt(r,o,gt,n)))}e.c=null}else Nt(e,gt,n)}(this,new Lt(t))},this)},t.Nc=function(t){this.a=yt,Nt(this,mt,t)},t.Oc=function(t){this.a=yt,Nt(this,gt,t)},t.Yb=function(){for(var t;t=Rt(this);)kt(this,t,this.a,this.i);this.h=!1};var Pt=ct;function Lt(t){E.call(this,t)}function Mt(){0!=xt&&(Ft[this[f]||(this[f]=++p)]=this),this.qa=this.qa,this.ja=this.ja}b(Lt,E),Lt.prototype.name="cancel";var xt=0,Ft={};function Ut(t){if(!t.qa&&(t.qa=!0,t.va(),0!=xt)){var e=t[f]||(t[f]=++p);if(0!=xt&&t.ja&&0<t.ja.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Ft[e]}}function qt(t){return qt[" "](t),t}Mt.prototype.qa=!1,Mt.prototype.va=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},qt[" "]=o;var Bt,Vt,Wt=et("Opera"),jt=et("Trident")||et("MSIE"),Kt=et("Edge"),Qt=Kt||jt,Ht=et("Gecko")&&!(J(j.toLowerCase(),"webkit")&&!et("Edge"))&&!(et("Trident")||et("MSIE"))&&!et("Edge"),Gt=J(j.toLowerCase(),"webkit")&&!et("Edge");function zt(){var t=n.document;return t?t.documentMode:void 0}t:{var Yt="",Xt=(Vt=j,Ht?/rv:([^\);]+)(\)|;)/.exec(Vt):Kt?/Edge\/([\d\.]+)/.exec(Vt):jt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Vt):Gt?/WebKit\/(\S+)/.exec(Vt):Wt?/(?:Version)[ \/]?(\S+)/.exec(Vt):void 0);if(Xt&&(Yt=Xt?Xt[1]:""),jt){var Jt=zt();if(null!=Jt&&Jt>parseFloat(Yt)){Bt=String(Jt);break t}}Bt=Yt}var $t,Zt={};function te(t){return function(t,e){var n=Zt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=V(String(Bt)).split("."),r=V(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=$(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||$(0==s[2].length,0==a[2].length)||$(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var ee=n.document;$t=ee&&jt?zt()||("CSS1Compat"==ee.compatMode?parseInt(Bt,10):5):void 0;var ne=Object.freeze||function(t){return t},re=!jt||9<=Number($t),ie=jt&&!te("9"),oe=function(){if(!n.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});return n.addEventListener("test",o,e),n.removeEventListener("test",o,e),t}();function se(t,e){this.type=t,this.b=this.target=e,this.Kb=!0}function ae(t,e){if(se.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,i=t.changedTouches?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Ht){t:{try{qt(e.nodeName);var o=!0;break t}catch(t){}o=!1}o||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,null===i?(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=r(t.pointerType)?t.pointerType:ue[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}se.prototype.preventDefault=function(){this.Kb=!1},b(ae,se);var ue=ne({2:"touch",3:"pen",4:"mouse"});ae.prototype.preventDefault=function(){ae.ob.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ie)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},ae.prototype.f=function(){return this.a};var ce="closure_listenable_"+(1e6*Math.random()|0),he=0;function le(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.La=null}function fe(t){this.src=t,this.a={},this.b=0}function pe(t,e){var n=e.type;n in t.a&&x(t.a[n],e)&&(le(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function de(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.La==r)return i}return-1}fe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=de(t,e,r,i);return-1<s?(e=t[s],n||(e.Ia=!1)):((e=new function(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.La=i,this.key=++he,this.oa=this.Ia=!1}(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var ye="closure_lm_"+(1e6*Math.random()|0),me={};function ge(t,e,n,r,i){if(r&&r.once)be(t,e,n,r,i);else if(u(e))for(var o=0;o<e.length;o++)ge(t,e[o],n,r,i);else n=De(n),t&&t[ce]?Re(t,e,n,l(r)?!!r.capture:!!r,i):ve(t,e,n,!1,r,i)}function ve(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=l(i)?!!i.capture:!!i,a=Ce(t);if(a||(t[ye]=a=new fe(t)),!(n=a.add(e,n,r,s,o)).proxy)if(r=function(){var t=Ie,e=re?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)oe||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ee(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function be(t,e,n,r,i){if(u(e))for(var o=0;o<e.length;o++)be(t,e[o],n,r,i);else n=De(n),t&&t[ce]?ke(t,e,n,l(r)?!!r.capture:!!r,i):ve(t,e,n,!0,r,i)}function _e(t,e,n,r,i){if(u(e))for(var o=0;o<e.length;o++)_e(t,e[o],n,r,i);else r=l(r)?!!r.capture:!!r,n=De(n),t&&t[ce]?(t=t.l,(e=String(e).toString())in t.a&&(-1<(n=de(o=t.a[e],n,r,i))&&(le(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=Ce(t))&&(e=t.a[e.toString()],t=-1,e&&(t=de(e,n,r,i)),(n=-1<t?e[t]:null)&&we(n))}function we(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[ce])pe(e.l,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ee(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ce(e))?(pe(n,t),0==n.b&&(n.src=null,e[ye]=null)):le(t)}}}function Ee(t){return t in me?me[t]:me[t]="on"+t}function Te(t,e,n,r){var i=!0;if((t=Ce(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Se(o,r),i=i&&!1!==o)}return i}function Se(t,e){var n=t.listener,r=t.La||t.src;return t.Ia&&we(t),n.call(r,e)}function Ie(t,e){if(t.oa)return!0;if(!re){if(!e)t:{e=["window","event"];for(var r=n,i=0;i<e.length;i++)if(null==(r=r[e[i]])){e=null;break t}e=r}if(e=new ae(i=e,this),r=!0,!(0>i.keyCode||void 0!=i.returnValue)){t:{var o=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(t){o=!0}(o||void 0==i.returnValue)&&(i.returnValue=!0)}for(i=[],o=e.b;o;o=o.parentNode)i.push(o);for(t=t.type,o=i.length-1;0<=o;o--){e.b=i[o];var s=Te(i[o],t,!0,e);r=r&&s}for(o=0;o<i.length;o++)e.b=i[o],s=Te(i[o],t,!1,e),r=r&&s}return r}return Se(t,new ae(e,this))}function Ce(t){return(t=t[ye])instanceof fe?t:null}var Ne="__closure_events_fn_"+(1e9*Math.random()>>>0);function De(t){return h(t)?t:(t[Ne]||(t[Ne]=function(e){return t.handleEvent(e)}),t[Ne])}function Ae(){Mt.call(this),this.l=new fe(this),this.Rb=this,this.Va=null}function Re(t,e,n,r,i){t.l.add(String(e),n,!1,r,i)}function ke(t,e,n,r,i){t.l.add(String(e),n,!0,r,i)}function Oe(t,e,n,r){if(!(e=t.l.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.oa&&s.capture==n){var a=s.listener,u=s.La||s.src;s.Ia&&pe(t.l,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Kb}function Pe(t,e,r){if(h(t))r&&(t=m(t,r));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=m(t.handleEvent,t)}return 2147483647<Number(e)?-1:n.setTimeout(t,e||0)}function Le(t){var e=null;return new dt(function(n,r){-1==(e=Pe(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw n.clearTimeout(e),t})}function Me(t){if(t.S&&"function"==typeof t.S)return t.S();if(r(t))return t.split("");if(c(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}function xe(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(c(t)||r(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var i in e=[],n=0,t)e[n++]=i;return e}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Fe)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ue(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)qe(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}b(Ae,Mt),Ae.prototype[ce]=!0,Ae.prototype.addEventListener=function(t,e,n,r){ge(this,t,e,n,r)},Ae.prototype.removeEventListener=function(t,e,n,r){_e(this,t,e,n,r)},Ae.prototype.dispatchEvent=function(t){var e,n=this.Va;if(n)for(e=[];n;n=n.Va)e.push(n);n=this.Rb;var i=t.type||t;if(r(t))t=new se(t,n);else if(t instanceof se)t.target=t.target||n;else{var o=t;ut(t=new se(i,n),o)}if(o=!0,e)for(var s=e.length-1;0<=s;s--){var a=t.b=e[s];o=Oe(a,i,!0,t)&&o}if(o=Oe(a=t.b=n,i,!0,t)&&o,o=Oe(a,i,!1,t)&&o,e)for(s=0;s<e.length;s++)o=Oe(a=t.b=e[s],i,!1,t)&&o;return o},Ae.prototype.va=function(){if(Ae.ob.va.call(this),this.l){var t,e=this.l;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)le(n[r]);delete e.a[t],e.b--}}this.Va=null},(t=Fe.prototype).S=function(){Ue(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return Ue(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return qe(this.b,t)?this.b[t]:e},t.set=function(t,e){qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Be=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ve(t,e){if(this.b=this.l=this.c="",this.i=null,this.h=this.g="",this.f=!1,t instanceof Ve){this.f=void 0!==e?e:t.f,We(this,t.c),this.l=t.l,this.b=t.b,je(this,t.i),this.g=t.g,e=t.a;var n=new rn;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Ke(this,n),this.h=t.h}else t&&(n=String(t).match(Be))?(this.f=!!e,We(this,n[1]||"",!0),this.l=Ye(n[2]||""),this.b=Ye(n[3]||"",!0),je(this,n[4]),this.g=Ye(n[5]||"",!0),Ke(this,n[6]||"",!0),this.h=Ye(n[7]||"")):(this.f=!!e,this.a=new rn(null,this.f))}function We(t,e,n){t.c=n?Ye(e,!0):e,t.c&&(t.c=t.c.replace(/:$/,""))}function je(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Ke(t,e,n){e instanceof rn?(t.a=e,function(t,e){e&&!t.f&&(on(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(an(this,e),cn(this,n,t))},t)),t.f=e}(t.a,t.f)):(n||(e=Xe(e,en)),t.a=new rn(e,t.f))}function Qe(t,e,n){t.a.set(e,n)}function He(t,e){return t.a.get(e)}function Ge(t){return t instanceof Ve?new Ve(t):new Ve(t,void 0)}function ze(t,e){var n=new Ve(null,void 0);return We(n,"https"),t&&(n.b=t),e&&(n.g=e),n}function Ye(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Xe(t,e,n){return r(t)?(t=encodeURI(t).replace(e,Je),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Je(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ve.prototype.toString=function(){var t=[],e=this.c;e&&t.push(Xe(e,$e,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.l)&&t.push(Xe(e,$e,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.g)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Xe(n,"/"==n.charAt(0)?tn:Ze,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.h)&&t.push("#",Xe(n,nn)),t.join("")};var $e=/[#\/\?@]/g,Ze=/[#\?:]/g,tn=/[#\?]/g,en=/[#\?@]/g,nn=/#/g;function rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function on(t){t.a||(t.a=new Fe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function sn(t){var e=xe(t);if(void 0===e)throw Error("Keys are undefined");var n=new rn(null,void 0);t=Me(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];u(o)?cn(n,i,o):n.add(i,o)}return n}function an(t,e){on(t),e=hn(t,e),qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,qe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ue(t)))}function un(t,e){return on(t),e=hn(t,e),qe(t.a.b,e)}function cn(t,e,n){an(t,e),0<n.length&&(t.c=null,t.a.set(hn(t,e),q(n)),t.b+=n.length)}function hn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=rn.prototype).add=function(t,e){on(this),this.c=null,t=hn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){on(this),this.a.forEach(function(n,r){O(n,function(n){t.call(e,n,r,this)},this)},this)},t.U=function(){on(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){on(this);var e=[];if(r(t))un(this,t)&&(e=U(e,this.a.get(hn(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=U(e,t[n])}return e},t.set=function(t,e){return on(this),this.c=null,un(this,t=hn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return 0<(t=t?this.S(t):[]).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var ln=!jt||9<=Number($t);function fn(){this.a="",this.b=dn}function pn(t){return t instanceof fn&&t.constructor===fn&&t.b===dn?t.a:(S("expected object of type Const, got '"+t+"'"),"type_error:Const")}fn.prototype.na=!0,fn.prototype.ma=function(){return this.a},fn.prototype.toString=function(){return"Const{"+this.a+"}"};var dn={};function yn(t){var e=new fn;return e.a=t,e}function mn(){this.a="",this.b=wn}function gn(t){return t instanceof mn&&t.constructor===mn&&t.b===wn?t.a:(S("expected object of type TrustedResourceUrl, got '"+t+"' of type "+s(t)),"type_error:TrustedResourceUrl")}function vn(t,e){var n=pn(t);if(!_n.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return function(t){var e=new mn;return e.a=t,e}(t=n.replace(bn,function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof fn?pn(t):encodeURIComponent(String(t))}))}yn(""),mn.prototype.na=!0,mn.prototype.ma=function(){return this.a},mn.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var bn=/%{(\w+)}/g,_n=/^(?:https:)?\/\/[0-9a-z.:[\]-]+\/|^\/[^\/\\]|^about:blank#/i,wn={};function En(){this.a="",this.b=Cn}function Tn(t){return t instanceof En&&t.constructor===En&&t.b===Cn?t.a:(S("expected object of type SafeUrl, got '"+t+"' of type "+s(t)),"type_error:SafeUrl")}En.prototype.na=!0,En.prototype.ma=function(){return this.a},En.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Sn=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function In(t){return t instanceof En?t:(t=t.na?t.ma():String(t),Sn.test(t)||(t="about:invalid#zClosurez"),Nn(t))}var Cn={};function Nn(t){var e=new En;return e.a=t,e}function Dn(){this.a="",this.b=An}Nn("about:blank"),Dn.prototype.na=!0,Dn.prototype.ma=function(){return this.a},Dn.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var An={};function Rn(t){var e=new Dn;return e.a=t,e}function kn(t){var e=document;return r(t)?e.getElementById(t):t}function On(t,e){nt(e,function(e,n){e&&e.na&&(e=e.ma()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:Pn.hasOwnProperty(n)?t.setAttribute(Pn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}Rn("<!DOCTYPE html>"),Rn(""),Rn("<br>");var Pn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Ln(t,e,n){var i=arguments,o=document,s=String(i[0]),a=i[1];if(!ln&&a&&(a.name||a.type)){if(s=["<",s],a.name&&s.push(' name="',W(a.name),'"'),a.type){s.push(' type="',W(a.type),'"');var h={};ut(h,a),delete h.type,a=h}s.push(">"),s=s.join("")}return s=o.createElement(s),a&&(r(a)?s.className=a:u(a)?s.className=a.join(" "):On(s,a)),2<i.length&&function(t,e,n){function i(n){n&&e.appendChild(r(n)?t.createTextNode(n):n)}for(var o=2;o<n.length;o++){var s=n[o];!c(s)||l(s)&&0<s.nodeType?i(s):O(Mn(s)?q(s):s,i)}}(o,s,i),s}function Mn(t){if(t&&"number"==typeof t.length){if(l(t))return"function"==typeof t.item||"string"==typeof t.item;if(h(t))return"function"==typeof t.item}return!1}function xn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(u(n)){var i=n;n=i.length,r.push("[");for(var o="",s=0;s<n;s++)r.push(o),t(e,i[s],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(s=n[i])&&(r.push(o),qn(i,r),r.push(":"),t(e,s,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":qn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new function(){},t,e),e.join("")}var Fn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Un=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function qn(t,e){e.push('"',t.replace(Un,function(t){var e=Fn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Fn[t]=e),e}),'"')}function Bn(){var t=sr();return jt&&!!$t&&11==$t||/Edge\/\d+/.test(t)}function Vn(){return n.window&&n.window.location.href||self&&self.location&&self.location.href||""}function Wn(t,e){e=e||n.window;var r="about:blank";t&&(r=Tn(In(t))),e.location.href=r}function jn(t){return!!((t=(t||sr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Kn(t){t=t||n.window;try{t.close()}catch(t){}}function Qn(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=sr().toLowerCase(),r&&(e.target=r,J(n,"crios/")&&(e.target="_blank")),rr(sr())==er&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof En?n:In(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((et("iPhone")&&!et("iPod")&&!et("iPad")||et("iPad")||et("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(a=r.document.createElement("A"),e instanceof En||e instanceof En||(e=e.na?e.ma():String(e),Sn.test(e)||(e="about:invalid#zClosurez"),e=Nn(e)),a.href=Tn(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=Tn(e),a&&(Qt&&J(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,yn("b/12014412, meta tag with sanitized URL"),t=Rn(t='<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+W(t)+'">'),a.document.write(function(t){return t instanceof Dn&&t.constructor===Dn&&t.b===An?t.a:(S("expected object of type SafeHtml, got '"+t+"' of type "+s(t)),"type_error:SafeHtml")}(t)),a.document.close())):(a=r.open(Tn(e),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var Hn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Gn=/^[^@]+@[^@]+$/;function zn(){var t=null;return new dt(function(e){"complete"==n.document.readyState?e():(t=function(){e()},be(window,"load",t))}).s(function(e){throw _e(window,"load",t),e})}function Xn(t){return t=t||sr(),!("file:"!==lr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function Jn(){var t=n.window;try{return!(!t||t==t.top)}catch(t){return!1}}function $n(){return"object"!=typeof n.window&&"function"==typeof n.importScripts}function Zn(){return Yn.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Yn.INTERNAL.hasOwnProperty("node")?"Node":$n()?"Worker":"Browser"}function tr(){var t=Zn();return"ReactNative"===t||"Node"===t}var er="Firefox",nr="Chrome";function rr(t){var e=t.toLowerCase();return J(e,"opera/")||J(e,"opr/")||J(e,"opios/")?"Opera":J(e,"iemobile")?"IEMobile":J(e,"msie")||J(e,"trident/")?"IE":J(e,"edge/")?"Edge":J(e,"firefox/")?er:J(e,"silk/")?"Silk":J(e,"blackberry")?"Blackberry":J(e,"webos")?"Webos":!J(e,"safari/")||J(e,"chrome/")||J(e,"crios/")||J(e,"android")?!J(e,"chrome/")&&!J(e,"crios/")||J(e,"edge/")?J(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":nr:"Safari"}var ir={Uc:"FirebaseCore-web",Wc:"FirebaseUI-web"};function or(t,e){e=e||[];var n,r=[],i={};for(n in ir)i[ir[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=Zn())?r=rr(i=sr()):"Worker"===r&&(r=rr(i=sr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function sr(){return n.navigator&&n.navigator.userAgent||""}function ar(t,e){t=t.split("."),e=e||n;for(var r=0;r<t.length&&"object"==typeof e&&null!=e;r++)e=e[t[r]];return r!=t.length&&(e=void 0),e}function ur(){try{var t=n.localStorage,e=mr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Bn()||!!n.indexedDB}catch(t){return $n()&&!!n.indexedDB}return!1}function cr(){return(hr()||"chrome-extension:"===lr()||Xn())&&!tr()&&ur()&&!$n()}function hr(){return"http:"===lr()||"https:"===lr()}function lr(){return n.location&&n.location.protocol||null}function fr(t){return!jn(t=t||sr())&&rr(t)!=er}function pr(t){return void 0===t?null:xn(t)}function dr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function yr(t){if(null!==t)return JSON.parse(t)}function mr(t){return t||Math.floor(1e9*Math.random()).toString()}function gr(t){return"Safari"!=rr(t=t||sr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function vr(){var t=n.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var r=0;r<t.CP.length;r++)t.CP[r]=null}function br(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=sr(),e=Zn(),this.b=jn(t)||"ReactNative"===e}function _r(){var t=n.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function wr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Er(){return!(!ar("fireauth.oauthhelper",n)&&!ar("fireauth.iframe",n))}br.prototype.get=function(){var t=n.navigator;return!t||"boolean"!=typeof t.onLine||!hr()&&"chrome-extension:"!==lr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Tr,Sr={};function Ir(t){Sr[t]||(Sr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Cr={};Object.defineProperty(Cr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Cr,"abcd",{configurable:!0,enumerable:!0,value:2}),Tr=2==Cr.abcd}catch(Vt){Tr=!1}function Nr(t,e,n){Tr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Dr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Nr(t,n,e[n])}function Ar(t){var e={};return Dr(e,t),e}function Rr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Nr(e,n,Rr(t[n]));return e}var kr="EMAIL_SIGNIN",Or="email",Pr="newEmail",Lr="requestType",Mr="email",xr="fromEmail",Fr="data",Ur="operation";function qr(t,e){this.code=Vr+t,this.message=e||Wr[t]||""}function Br(t){var e=t&&t.code;return e?new qr(e.substring(Vr.length),t.message):null}b(qr,Error),qr.prototype.C=function(){return{code:this.code,message:this.message}},qr.prototype.toJSON=function(){return this.C()};var Vr="auth/",Wr={"argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function jr(t){var e=t[zr];if(void 0===e)throw new qr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new qr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Kr];if(n&&"object"==typeof n){e=n[Jr];var r=n[Yr];if(n=n[Xr],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new qr("argument-error",Yr+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new qr("argument-error",Xr+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new qr("argument-error",Jr+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new qr("missing-android-pkg-name")}}else if(void 0!==n)throw new qr("argument-error",Kr+" property must be a non null object when specified.");if(this.f=null,(e=t[Gr])&&"object"==typeof e){if("string"==typeof(e=e[$r])&&e.length)this.f=e;else if(void 0!==e)throw new qr("argument-error",$r+" property must be a non empty string when specified.")}else if(void 0!==e)throw new qr("argument-error",Gr+" property must be a non null object when specified.");if(void 0!==(e=t[Hr])&&"boolean"!=typeof e)throw new qr("argument-error",Hr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Qr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new qr("argument-error",Qr+" property must be a non empty string when specified.");this.i=t||null}var Kr="android",Qr="dynamicLinkDomain",Hr="handleCodeInApp",Gr="iOS",zr="url",Yr="installApp",Xr="minimumVersion",Jr="packageName",$r="bundleId";function Zr(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var ti=null,ei=null;function ni(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=ei[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!ti){ti={},ei={};for(var t=0;65>t;t++)ti[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),ei[ti[t]]=t,62<=t&&(ei["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),s=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|o>>4),64!=s&&(e(o<<4&240|s>>2),64!=a&&e(s<<6&192|a))}}(t,function(t){e+=String.fromCharCode(t)}),e}function ri(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function ii(t){return(t=oi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new ri(t):null}function oi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(ni(t))}catch(t){}return null}ri.prototype.f=function(){return this.b};var si,ai={$c:{ab:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},bd:{ab:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},cd:{ab:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function ui(t){for(var e in ai)if(ai[e].id===t)return{firebaseEndpoint:(t=ai[e]).ab,secureTokenEndpoint:t.ib};return null}si=ui("__EID__")?"__EID__":void 0;var ci="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),hi=["client_id","response_type","scope","redirect_uri","state"],li={Vc:{Ma:"locale",Ba:500,Aa:600,Na:"facebook.com",hb:hi},Xc:{Ma:null,Ba:500,Aa:620,Na:"github.com",hb:hi},Yc:{Ma:"hl",Ba:515,Aa:680,Na:"google.com",hb:hi},dd:{Ma:"lang",Ba:485,Aa:705,Na:"twitter.com",hb:ci}};function fi(t){for(var e in li)if(li[e].Na==t)return li[e];return null}function pi(t){var e={};e["facebook.com"]=vi,e["google.com"]=_i,e["github.com"]=bi,e["twitter.com"]=wi;var n=t&&t[yi];try{if(n)return e[n]?new e[n](t):new gi(t);if(void 0!==t[di])return new mi(t)}catch(t){}return null}var di="idToken",yi="providerId";function mi(t){var e=t[yi];if(!e&&t[di]){var n=ii(t[di]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Nr(this,"providerId",e),Nr(this,"isNewUser",n)}function gi(t){mi.call(this,t),Nr(this,"profile",Rr((t=yr(t.rawUserInfo||"{}"))||{}))}function vi(t){if(gi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function bi(t){if(gi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Nr(this,"username",this.profile&&this.profile.login||null)}function _i(t){if(gi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function wi(t){if(gi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Nr(this,"username",t.screenName||null)}function Ei(t){var e=Ge(t),n=He(e,"link"),r=He(Ge(n),"link");return He(Ge(e=He(e,"deep_link_id")),"link")||e||r||n||t}function Ti(t,e){return t.then(function(t){if(t[os]){var n=ii(t[os]);if(!n||e!=n.c)throw new qr("user-mismatch");return t}throw new qr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Vr+"user-not-found"?new qr("user-mismatch"):t})}function Si(t,e){if(!e)throw new qr("internal-error","failed to construct a credential");this.a=e,Nr(this,"providerId",t),Nr(this,"signInMethod",t)}function Ii(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Ci(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Nr(this,"idToken",e.idToken),e.accessToken&&Nr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Nr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new qr("internal-error","failed to construct a credential");Nr(this,"accessToken",e.oauthToken),Nr(this,"secret",e.oauthTokenSecret)}Nr(this,"providerId",t),Nr(this,"signInMethod",n)}function Ni(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:sn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Di(t,e){this.Dc=e||[],Dr(this,{providerId:t,isOAuthProvider:!0}),this.yb={},this.cb=(fi(t)||{}).Ma||null,this.$a=null}function Ai(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new qr("argument-error",'SAML provider IDs must be prefixed with "saml."');Di.call(this,t,[])}function Ri(t){Di.call(this,t,hi),this.a=[]}function ki(){Ri.call(this,"facebook.com")}function Oi(t){if(!t)throw new qr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return l(t)&&(e=t.accessToken),(new ki).credential(null,e)}function Pi(){Ri.call(this,"github.com")}function Li(t){if(!t)throw new qr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return l(t)&&(e=t.accessToken),(new Pi).credential(null,e)}function Mi(){Ri.call(this,"google.com"),this.ua("profile")}function xi(t,e){var n=t;return l(t)&&(n=t.idToken,e=t.accessToken),(new Mi).credential(n,e)}function Fi(){Di.call(this,"twitter.com",ci)}function Ui(t,e){var n=t;if(l(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new qr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Ci("twitter.com",n,"twitter.com")}function qi(t,e,n){this.a=t,this.c=e,Nr(this,"providerId","password"),Nr(this,"signInMethod",n===Bi.EMAIL_LINK_SIGN_IN_METHOD?Bi.EMAIL_LINK_SIGN_IN_METHOD:Bi.EMAIL_PASSWORD_SIGN_IN_METHOD)}function Bi(){Dr(this,{providerId:"password",isOAuthProvider:!1})}function Vi(t,e){if(!(e=Wi(e)))throw new qr("argument-error","Invalid email link!");return new qi(t,e,Bi.EMAIL_LINK_SIGN_IN_METHOD)}function Wi(t){var e=He((t=new function(t){this.a=Ge(t)}(t=Ei(t))).a,"oobCode")||null;return"signIn"===(He(t.a,"mode")||null)&&e?e:null}function ji(t){if(!(t.Ta&&t.Sa||t.Fa&&t.$))throw new qr("internal-error");this.a=t,Nr(this,"providerId","phone"),Nr(this,"signInMethod","phone")}function Ki(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Ta,code:t.a.Sa}}function Qi(t){try{this.a=t||Yn.auth()}catch(t){throw new qr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Dr(this,{providerId:"phone",isOAuthProvider:!1})}function Hi(t,e){if(!t)throw new qr("missing-verification-id");if(!e)throw new qr("missing-verification-code");return new ji({Ta:t,Sa:e})}function Gi(t){if(t.temporaryProof&&t.phoneNumber)return new ji({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,s=t&&t.pendingToken;try{switch(e){case"google.com":return xi(o,n);case"facebook.com":return Oi(n);case"github.com":return Li(n);case"twitter.com":return Ui(n,r);default:return n||r||o||s?s?0==e.indexOf("saml.")?new Si(e,s):new Ci(e,{pendingToken:s,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Ri(e).credential(o,n,i):null}}catch(t){return null}}function zi(t){if(!t.isOAuthProvider)throw new qr("invalid-oauth-provider")}function Yi(t,e,n,r,i,o){if(this.b=t,this.c=e||null,this.f=n||null,this.g=r||null,this.h=o||null,this.a=i||null,!this.f&&!this.a)throw new qr("invalid-auth-event");if(this.f&&this.a)throw new qr("invalid-auth-event");if(this.f&&!this.g)throw new qr("invalid-auth-event")}function Xi(t){return(t=t||{}).type?new Yi(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Br(t.error),t.postBody):null}function Ji(){this.b=null,this.a=[]}b(gi,mi),b(vi,gi),b(bi,gi),b(_i,gi),b(wi,gi),Si.prototype.la=function(t){return Ts(t,Ii(this))},Si.prototype.b=function(t,e){var n=Ii(this);return n.idToken=e,Ss(t,n)},Si.prototype.f=function(t,e){return Ti(Is(t,Ii(this)),e)},Si.prototype.C=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Ci.prototype.la=function(t){return Ts(t,Ni(this))},Ci.prototype.b=function(t,e){var n=Ni(this);return n.idToken=e,Ss(t,n)},Ci.prototype.f=function(t,e){return Ti(Is(t,Ni(this)),e)},Ci.prototype.C=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Di.prototype.Da=function(t){return this.yb=it(t),this},b(Ai,Di),b(Ri,Di),Ri.prototype.ua=function(t){return M(this.a,t)||this.a.push(t),this},Ri.prototype.Eb=function(){return q(this.a)},Ri.prototype.credential=function(t,e,n){if(!t&&!e)throw new qr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Ci(this.providerId,{idToken:t||null,accessToken:e||null,nonce:n||null},this.providerId)},b(ki,Ri),Nr(ki,"PROVIDER_ID","facebook.com"),Nr(ki,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),b(Pi,Ri),Nr(Pi,"PROVIDER_ID","github.com"),Nr(Pi,"GITHUB_SIGN_IN_METHOD","github.com"),b(Mi,Ri),Nr(Mi,"PROVIDER_ID","google.com"),Nr(Mi,"GOOGLE_SIGN_IN_METHOD","google.com"),b(Fi,Di),Nr(Fi,"PROVIDER_ID","twitter.com"),Nr(Fi,"TWITTER_SIGN_IN_METHOD","twitter.com"),qi.prototype.la=function(t){return this.signInMethod==Bi.EMAIL_LINK_SIGN_IN_METHOD?ta(t,Ps,{email:this.a,oobCode:this.c}):ta(t,Xs,{email:this.a,password:this.c})},qi.prototype.b=function(t,e){return this.signInMethod==Bi.EMAIL_LINK_SIGN_IN_METHOD?ta(t,Ls,{idToken:e,email:this.a,oobCode:this.c}):ta(t,Ks,{idToken:e,email:this.a,password:this.c})},qi.prototype.f=function(t,e){return Ti(this.la(t),e)},qi.prototype.C=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Dr(Bi,{PROVIDER_ID:"password"}),Dr(Bi,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Dr(Bi,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),ji.prototype.la=function(t){return t.Ua(Ki(this))},ji.prototype.b=function(t,e){var n=Ki(this);return n.idToken=e,ta(t,$s,n)},ji.prototype.f=function(t,e){var n=Ki(this);return n.operation="REAUTH",Ti(t=ta(t,Zs,n),e)},ji.prototype.C=function(){var t={providerId:"phone"};return this.a.Ta&&(t.verificationId=this.a.Ta),this.a.Sa&&(t.verificationCode=this.a.Sa),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},Qi.prototype.Ua=function(t,e){var n=this.a.b;return wt(e.verify()).then(function(i){if(!r(i))throw new qr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return ta(t,Ws,e)}(n,{phoneNumber:t,recaptchaToken:i}).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new qr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Dr(Qi,{PROVIDER_ID:"phone"}),Dr(Qi,{PHONE_SIGN_IN_METHOD:"phone"}),Yi.prototype.C=function(){return{type:this.b,eventId:this.c,urlResponse:this.f,sessionId:this.g,postBody:this.h,error:this.a&&this.a.C()}};var $i,Zi=null;function to(t){var e="unauthorized-domain",n=void 0,r=Ge(t);t=r.b,"chrome-extension"==(r=r.c)?n=B("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=B("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",qr.call(this,e,n)}function eo(t,e,n){qr.call(this,t,n),(t=e||{}).zb&&Nr(this,"email",t.zb),t.$&&Nr(this,"phoneNumber",t.$),t.credential&&Nr(this,"credential",t.credential)}function no(t){if(t.code){var e=t.code||"";0==e.indexOf(Vr)&&(e=e.substring(Vr.length));var n={credential:Gi(t)};if(t.email)n.zb=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new qr(e,t.message||void 0);return new eo(e,n,t.message)}return null}function ro(){}function io(t){return t.c||(t.c=t.b())}function oo(){}function so(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function ao(){}function uo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseText="",this.status=-1,this.statusText="",this.a.onload=m(this.ec,this),this.a.onerror=m(this.Fb,this),this.a.onprogress=m(this.fc,this),this.a.ontimeout=m(this.ic,this)}function co(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function ho(t,e,n){this.reset(t,e,n,void 0,void 0)}function lo(t){this.f=t,this.b=this.c=this.a=null}function fo(t,e){this.name=t,this.value=e}Ji.prototype.subscribe=function(t){var e=this;this.a.push(t),this.b||(this.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=ar("universalLinks.subscribe",n))&&t(null,this.b))},Ji.prototype.unsubscribe=function(t){F(this.a,function(e){return e==t})},b(to,qr),b(eo,qr),eo.prototype.C=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.C();return e&&ut(t,e),t},eo.prototype.toJSON=function(){return this.C()},ro.prototype.c=null,b(oo,ro),oo.prototype.a=function(){var t=so(this);return t?new ActiveXObject(t):new XMLHttpRequest},oo.prototype.b=function(){var t={};return so(this)&&(t[0]=!0,t[1]=!0),t},$i=new oo,b(ao,ro),ao.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new uo;throw Error("Unsupported browser")},ao.prototype.b=function(){return{}},(t=uo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.ec=function(){this.status=200,this.responseText=this.a.responseText,co(this,4)},t.Fb=function(){this.status=500,this.responseText="",co(this,4)},t.ic=function(){this.Fb()},t.fc=function(){this.status=200,co(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},ho.prototype.a=null,ho.prototype.reset=function(t,e,n,r,i){delete this.a},fo.prototype.toString=function(){return this.name};var po=new fo("SEVERE",1e3),yo=new fo("WARNING",900),mo=new fo("CONFIG",700),go=new fo("FINE",500);lo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(S("Root logger has no level set."),null)}(this).value)for(h(e)&&(e=e()),t=new ho(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var vo={},bo=null;function _o(t){var e;if(bo||(bo=new lo(""),vo[""]=bo,bo.c=mo),!(e=vo[t])){e=new lo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=_o(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,vo[t]=e}return e}function wo(t,e){t&&t.log(go,e,void 0)}function Eo(t){this.f=t}function To(t){Ae.call(this),this.i=t,this.readyState=So,this.status=0,this.responseText=this.statusText="",this.onreadystatechange=null,this.g=new Headers,this.b=null,this.h="GET",this.c="",this.a=!1,this.f=_o("goog.net.FetchXmlHttp")}b(Eo,ro),Eo.prototype.a=function(){return new To(this.f)},Eo.prototype.b=function(t){return function(){return t}}({}),b(To,Ae);var So=0;function Io(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Co(t){Ae.call(this),this.headers=new Fe,this.D=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.m="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=No,this.v=this.O=!1}(t=To.prototype).open=function(t,e){if(this.readyState!=So)throw this.abort(),Error("Error reopening a connection");this.h=t,this.c=e,this.readyState=1,Io(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.g,method:this.h,credentials:void 0,cache:void 0};t&&(e.body=t),this.i.fetch(new Request(this.c,e)).then(this.hc.bind(this),this.Gb.bind(this))},t.abort=function(){this.responseText="",this.g=new Headers,this.status=0,1<=this.readyState&&this.a&&4!=this.readyState&&(this.readyState=4,this.a=!1,Io(this)),this.readyState=So},t.hc=function(t){this.a&&(this.b||(this.b=t.headers,this.readyState=2,Io(this)),this.a&&(this.readyState=3,Io(this),this.a&&t.text().then(this.gc.bind(this,t),this.Gb.bind(this))))},t.gc=function(t,e){this.a&&(this.status=t.status,this.statusText=t.statusText,this.responseText=e,this.readyState=4,Io(this))},t.Gb=function(t){var e=this.f;e&&e.log(yo,"Failed to fetch url "+this.c,t instanceof Error?t:Error(t)),this.a&&(this.readyState=4,Io(this))},t.setRequestHeader=function(t,e){this.g.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.f)&&t.log(yo,"Attempting to get response header but no headers have been received for url: "+this.c,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.f;return t&&t.log(yo,"Attempting to get all response headers but no headers have been received for url: "+this.c,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},b(Co,Ae);var No="";Co.prototype.b=_o("goog.net.XhrIo");var Do=/^https?$/i,Ao=["POST","PUT"];function Ro(t,e,i,o,s){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.m+"; newUri="+e);i=i?i.toUpperCase():"GET",t.m=e,t.h="",t.N=i,t.G=!1,t.c=!0,t.a=t.D?t.D.a():$i.a(),t.w=t.D?io(t.D):io($i),t.a.onreadystatechange=m(t.Jb,t);try{wo(t.b,qo(t,"Opening Xhr")),t.I=!0,t.a.open(i,String(e),!0),t.I=!1}catch(e){return wo(t.b,qo(t,"Error opening Xhr: "+e.message)),void Oo(t,e)}e=o||"";var a=new Fe(t.headers);s&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(c(t)||r(t))O(t,e,void 0);else for(var n=xe(t),i=Me(t),o=i.length,s=0;s<o;s++)e.call(void 0,i[s],n&&n[s],t)}(s,function(t,e){a.set(e,t)}),s=function(t){t:{for(var e=ko,n=t.length,i=r(t)?t.split(""):t,o=0;o<n;o++)if(o in i&&e.call(void 0,i[o],o,t)){e=o;break t}e=-1}return 0>e?null:r(t)?t.charAt(e):t[e]}(a.U()),o=n.FormData&&e instanceof n.FormData,!M(Ao,i)||s||o||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.o&&(t.a.responseType=t.o),"withCredentials"in t.a&&t.a.withCredentials!==t.O&&(t.a.withCredentials=t.O);try{xo(t),0<t.g&&(t.v=function(t){return jt&&te(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),wo(t.b,qo(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=m(t.Ga,t)):t.u=Pe(t.Ga,t.g,t)),wo(t.b,qo(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){wo(t.b,qo(t,"Send error: "+e.message)),Oo(t,e)}}function ko(t){return"content-type"==t.toLowerCase()}function Oo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Po(t),Mo(t)}function Po(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Lo(t){if(t.c&&void 0!==e)if(t.w[1]&&4==Fo(t)&&2==Uo(t))wo(t.b,qo(t,"Local request error detected and ignored"));else if(t.i&&4==Fo(t))Pe(t.Jb,0,t);else if(t.dispatchEvent("readystatechange"),4==Fo(t)){wo(t.b,qo(t,"Request complete")),t.c=!1;try{var r,i=Uo(t);t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break t;default:o=!1}if(!(r=o)){var s;if(s=0===i){var a=String(t.m).match(Be)[1]||null;if(!a&&n.self&&n.self.location){var u=n.self.location.protocol;a=u.substr(0,u.length-1)}s=!Do.test(a?a.toLowerCase():"")}r=s}if(r)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<Fo(t)?t.a.statusText:""}catch(e){wo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+Uo(t)+"]",Po(t)}}finally{Mo(t)}}}function Mo(t,e){if(t.a){xo(t);var n=t.a,r=t.w[0]?o:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(po,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function xo(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(n.clearTimeout(t.u),t.u=null)}function Fo(t){return t.a?t.a.readyState:0}function Uo(t){try{return 2<Fo(t)?t.a.status:-1}catch(t){return-1}}function qo(t,e){return e+" ["+t.N+" "+t.m+" "+Uo(t)+"]"}function Bo(t,e){this.g=[],this.v=t,this.u=e||null,this.f=this.a=!1,this.c=void 0,this.m=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function Vo(t,e,n){t.a=!0,t.c=n,t.f=!e,Qo(t)}function Wo(t){if(t.a){if(!t.m)throw new Ho(t);t.m=!1}}function jo(t,e,n,r){t.g.push([e,n,r]),t.a&&Qo(t)}function Ko(t){return L(t.g,function(t){return h(t[1])})}function Qo(t){if(t.h&&t.a&&Ko(t)){var e=t.h,r=Yo[e];r&&(n.clearTimeout(r.a),delete Yo[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var i=r=!1;t.g.length&&!t.i;){var o=t.g.shift(),s=o[0],a=o[1];if(o=o[2],s=t.f?a:s)try{var u=s.call(o||t.u,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(w(e)||"function"==typeof n.Promise&&e instanceof n.Promise)&&(i=!0,t.i=!0)}catch(n){e=n,t.f=!0,Ko(t)||(r=!0)}}t.c=e,i&&(u=m(t.o,t,!0),i=m(t.o,t,!1),e instanceof Bo?(jo(e,u,i),e.w=!0):e.then(u,i)),r&&(e=new zo(e),Yo[e.a]=e,t.h=e.a)}function Ho(){E.call(this)}function Go(){E.call(this)}function zo(t){this.a=n.setTimeout(m(this.c,this),0),this.b=t}(t=Co.prototype).Ga=function(){void 0!==e&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",wo(this.b,qo(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(wo(this.b,qo(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Mo(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Mo(this,!0)),Co.ob.va.call(this)},t.Jb=function(){this.qa||(this.I||this.i||this.f?Lo(this):this.wc())},t.wc=function(){Lo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case No:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(po,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return wo(this.b,"Can not get response: "+t.message),null}},Bo.prototype.cancel=function(t){if(this.a)this.c instanceof Bo&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.v?this.v.call(this.u,this):this.m=!0,this.a||(t=new Go(this),Wo(this),Vo(this,!1,t))}},Bo.prototype.o=function(t,e){this.i=!1,Vo(this,t,e)},Bo.prototype.D=function(){Wo(this),Vo(this,!0,null)},Bo.prototype.then=function(t,e,n){var r,i,o=new dt(function(t,e){r=t,i=e});return jo(this,r,function(t){t instanceof Go?o.cancel():i(t)}),o.then(t,e,n)},_(Bo),b(Ho,E),Ho.prototype.message="Deferred has already fired",Ho.prototype.name="AlreadyCalledError",b(Go,E),Go.prototype.message="Deferred was canceled",Go.prototype.name="CanceledError",zo.prototype.c=function(){throw delete Yo[this.a],this.b};var Yo={};function Xo(t){var e={},n=e.document||document,r=gn(t),i=document.createElement("SCRIPT"),o={Lb:i,Ga:void 0},s=new Bo(Jo,o),a=null,u=null!=e.timeout?e.timeout:5e3;return 0<u&&(a=window.setTimeout(function(){$o(i,!0);var t=new es(ts,"Timeout reached for loading script "+r);Wo(s),Vo(s,!1,t)},u),o.Ga=a),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||($o(i,e.fd||!1,a),s.D())},i.onerror=function(){$o(i,!0,a);var t=new es(Zo,"Error while loading script "+r);Wo(s),Vo(s,!1,t)},ut(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),On(i,o),i.src=gn(t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function Jo(){if(this&&this.Lb){var t=this.Lb;t&&"SCRIPT"==t.tagName&&$o(t,!0,this.Ga)}}function $o(t,e,r){null!=r&&n.clearTimeout(r),t.onload=o,t.onerror=o,t.onreadystatechange=o,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Zo=0,ts=1;function es(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),E.call(this,n),this.code=t}function ns(t){this.f=t}function rs(t,e,r){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.l=t.secureTokenTimeout||ss,this.f=it(t.secureTokenHeaders||as),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||us,this.a=it(t.firebaseHeaders||cs),r&&(this.a["X-Client-Version"]=r,this.f["X-Client-Version"]=r),r="Node"==Zn(),!(r=n.XMLHttpRequest||r&&Yn.INTERNAL.node&&Yn.INTERNAL.node.XMLHttpRequest)&&!$n())throw new qr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,$n()?this.c=new Eo(self):tr()?this.c=new ns(r):this.c=new ao}b(es,E),b(ns,ro),ns.prototype.a=function(){return new this.f},ns.prototype.b=function(){return{}};var is,os="idToken",ss=new br(3e4,6e4),as={"Content-Type":"application/x-www-form-urlencoded"},us=new br(3e4,6e4),cs={"Content-Type":"application/json"};function hs(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function ls(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function fs(t,e,r,i,o,s,a){(function(){var t=sr();return!((t=rr(t)!=nr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||jt&&$t&&!(9<$t))})()||$n()?t=m(t.o,t):(is||(is=new dt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{n[ds]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var r=vn(ps,{onload:ds});!function(t,e){jo(t,null,e,void 0)}(Xo(r),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)})),t=m(t.m,t)),t(e,r,i,o,s,a)}rs.prototype.o=function(t,e,r,i,o,s){if($n()&&(void 0===n.fetch||void 0===n.Headers||void 0===n.Request))throw new qr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Co(this.c);if(s){a.g=Math.max(0,s);var u=setTimeout(function(){a.dispatchEvent("timeout")},s)}Re(a,"complete",function(){u&&clearTimeout(u);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return wo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)}),ke(a,"ready",function(){u&&clearTimeout(u),Ut(this)}),ke(a,"timeout",function(){u&&clearTimeout(u),Ut(this),e&&e(null)}),Ro(a,t,r,i,o)};var ps=yn("https://apis.google.com/js/client.js?onload=%{onload}"),ds="__fcb"+Math.floor(1e6*Math.random()).toString();function ys(t){if(!r(t=t.email)||!Gn.test(t))throw new qr("invalid-email")}function ms(t){"email"in t&&ys(t)}function gs(t){if(!t[os])throw new qr("internal-error")}function vs(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new qr("internal-error")}else{if(!t.sessionInfo)throw new qr("missing-verification-id");if(!t.code)throw new qr("missing-verification-code")}}rs.prototype.m=function(t,e,n,r,i){var o=this;is.then(function(){window.gapi.client.setApiKey(o.b);var s=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(s),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},rs.prototype.Qa=function(){return ta(this,Qs,{})},rs.prototype.pb=function(t,e){return ta(this,js,{idToken:t,email:e})},rs.prototype.qb=function(t,e){return ta(this,Ks,{idToken:t,password:e})};var bs={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function _s(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new qr("internal-error")}function ws(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(un(t=new rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Es(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=no(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=no(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=no(t)):t.errorMessage&&(e=ea(t.errorMessage)),e)throw e;if(!t[os])throw new qr("internal-error")}function Ts(t,e){return e.returnIdpCredential=!0,ta(t,Hs,e)}function Ss(t,e){return e.returnIdpCredential=!0,ta(t,zs,e)}function Is(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,ta(t,Gs,e)}function Cs(t){if(!t.oobCode)throw new qr("invalid-action-code")}(t=rs.prototype).rb=function(t,e){var n={idToken:t},r=[];return nt(bs,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),ta(this,js,n)},t.kb=function(t,e){return ut(t={requestType:"PASSWORD_RESET",email:t},e),ta(this,Us,t)},t.lb=function(t,e){return ut(t={requestType:"EMAIL_SIGNIN",email:t},e),ta(this,xs,t)},t.jb=function(t,e){return ut(t={requestType:"VERIFY_EMAIL",idToken:t},e),ta(this,Fs,t)},t.Ua=function(t){return ta(this,Js,t)},t.Za=function(t,e){return ta(this,Vs,{oobCode:t,newPassword:e})},t.Ja=function(t){return ta(this,Ds,{oobCode:t})},t.Wa=function(t){return ta(this,Ns,{oobCode:t})};var Ns={endpoint:"setAccountInfo",B:Cs,da:"email"},Ds={endpoint:"resetPassword",B:Cs,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new qr("internal-error")}},As={endpoint:"signupNewUser",B:function(t){if(ys(t),!t.password)throw new qr("weak-password")},J:gs,R:!0},Rs={endpoint:"createAuthUri"},ks={endpoint:"deleteAccount",T:["idToken"]},Os={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],B:function(t){if(!u(t.deleteProvider))throw new qr("internal-error")}},Ps={endpoint:"emailLinkSignin",T:["email","oobCode"],B:ys,J:gs,R:!0},Ls={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],B:ys,J:gs,R:!0},Ms={endpoint:"getAccountInfo"},xs={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new qr("internal-error");ys(t)},da:"email"},Fs={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],B:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new qr("internal-error")},da:"email"},Us={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("PASSWORD_RESET"!=t.requestType)throw new qr("internal-error");ys(t)},da:"email"},qs={ub:!0,endpoint:"getProjectConfig",Ib:"GET"},Bs={ub:!0,endpoint:"getRecaptchaParam",Ib:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new qr("internal-error")}},Vs={endpoint:"resetPassword",B:Cs,da:"email"},Ws={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},js={endpoint:"setAccountInfo",T:["idToken"],B:ms,R:!0},Ks={endpoint:"setAccountInfo",T:["idToken"],B:function(t){if(ms(t),!t.password)throw new qr("weak-password")},J:gs,R:!0},Qs={endpoint:"signupNewUser",J:gs,R:!0},Hs={endpoint:"verifyAssertion",B:_s,Oa:ws,J:Es,R:!0},Gs={endpoint:"verifyAssertion",B:_s,Oa:ws,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new qr("user-not-found");if(t.errorMessage)throw ea(t.errorMessage);if(!t[os])throw new qr("internal-error")},R:!0},zs={endpoint:"verifyAssertion",B:function(t){if(_s(t),!t.idToken)throw new qr("internal-error")},Oa:ws,J:Es,R:!0},Ys={endpoint:"verifyCustomToken",B:function(t){if(!t.token)throw new qr("invalid-custom-token")},J:gs,R:!0},Xs={endpoint:"verifyPassword",B:function(t){if(ys(t),!t.password)throw new qr("wrong-password")},J:gs,R:!0},Js={endpoint:"verifyPhoneNumber",B:vs,J:gs},$s={endpoint:"verifyPhoneNumber",B:function(t){if(!t.idToken)throw new qr("internal-error");vs(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",no(t);gs(t)}},Zs={Xb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",B:vs,J:gs};function ta(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(void 0===r||null===r||""===r)return!1}return!0}(n,e.T))return Et(new qr("internal-error"));var r,i=e.Ib||"POST";return wt(n).then(e.B).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,n,r,i,o){var s=Ge(t.g+e);Qe(s,"key",t.b),o&&Qe(s,"cb",v().toString());var a="GET"==n;if(a)for(var u in r)r.hasOwnProperty(u)&&Qe(s,u,r[u]);return new dt(function(e,o){fs(t,s.toString(),function(t){t?t.error?o(na(t,i||{})):e(t):o(new qr("network-request-failed"))},n,a?void 0:xn(dr(r)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Xb,e.ub||!1)}).then(function(t){return r=t,e.Oa?e.Oa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new qr("internal-error");return r[e.da]})}function ea(t){return na({error:{errors:[{message:t}],code:400,message:t}})}function na(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new qr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",ut(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new qr(r[i],e);return!e&&t&&(e=pr(t)),new qr("internal-error",e)}function ra(t){this.b=t,this.a=null,this.fb=function(t){return(aa||(aa=new dt(function(t,e){function r(){vr(),ar("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){vr(),e(Error("Network Error"))},timeout:oa.get()})}if(ar("gapi.iframes.Iframe"))t();else if(ar("gapi.load"))r();else{var i="__iframefcb"+Math.floor(1e6*Math.random()).toString();n[i]=function(){ar("gapi.load")?r():e(Error("Network Error"))},wt(Xo(i=vn(ia,{onload:i}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw aa=null,t}))).then(function(){return new dt(function(e,n){ar("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:ar("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},sa.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})})}(this)}var ia=yn("https://apis.google.com/js/api.js?onload=%{onload}"),oa=new br(3e4,6e4),sa=new br(5e3,15e3),aa=null;function ua(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=ze(this.i,"/__/auth/iframe"),Qe(this.a,"apiKey",this.g),Qe(this.a,"appName",this.h),this.b=null,this.c=[]}function ca(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.l=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function ha(t){try{return Yn.app(t).auth().ya()}catch(t){return[]}}function la(t,e,n,r,i){this.m=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.l=this.a=null}function fa(t){var e=Vn();return function(t){return ta(t,qs,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=Ge(e),r=n.c;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],s=n,a=r;if(0==o.indexOf("chrome-extension://")?s=Ge(o).b==s&&"chrome-extension"==a:"http"!=a&&"https"!=a?s=!1:Hn.test(o)?s=s==o:(o=o.split(".").join("\\."),s=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(s)),s){t=!0;break t}}t=!1}if(!t)throw new to(Vn())})}function pa(t){return t.l?t.l:(t.l=zn().then(function(){if(!t.u){var e=t.c,n=t.h,r=ha(t.b),i=new ua(t.m,t.f,t.b);i.f=e,i.b=n,i.c=q(r||[]),t.u=i.toString()}t.i=new ra(t.u),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.fb.then(function(){t.a.register("authEvent",e,ar("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.i,function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=Xi(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",wt(n)}return n.status="ERROR",wt(n)})}(t)}),t.l)}function da(t){return t.o||(t.v=t.c?or(t.c,ha(t.b)):null,t.o=new rs(t.f,ui(t.h),t.v)),t.o}function ya(t,e,n,r,i,o,s,a,u,c){return(t=new ca(t,e,n,r,i)).i=o,t.g=s,t.h=a,t.b=it(u||null),t.f=c,t.toString()}function ma(t){if(this.a=t||Yn.INTERNAL.reactNative&&Yn.INTERNAL.reactNative.AsyncStorage,!this.a)throw new qr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function ga(t){this.b=t,this.a={},this.c=m(this.f,this)}ua.prototype.toString=function(){return this.f?Qe(this.a,"v",this.f):an(this.a.a,"v"),this.b?Qe(this.a,"eid",this.b):an(this.a.a,"eid"),this.c.length?Qe(this.a,"fw",this.c.join(",")):an(this.a.a,"fw"),this.a.toString()},ca.prototype.toString=function(){var t=ze(this.o,"/__/auth/handler");if(Qe(t,"apiKey",this.m),Qe(t,"appName",this.c),Qe(t,"authType",this.l),this.a.isOAuthProvider){var e=this.a;try{var n=Yn.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.$a=n,Qe(t,"providerId",this.a.providerId),n=dr((e=this.a).yb))n[r]=n[r].toString();r=e.Dc,n=it(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.cb&&e.$a&&!n[e.cb]&&(n[e.cb]=e.$a),rt(n)||Qe(t,"customParameters",pr(n))}if("function"==typeof this.a.Eb&&((e=this.a.Eb()).length&&Qe(t,"scopes",e.join(","))),this.i?Qe(t,"redirectUrl",this.i):an(t.a,"redirectUrl"),this.g?Qe(t,"eventId",this.g):an(t.a,"eventId"),this.h?Qe(t,"v",this.h):an(t.a,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!He(t,s)&&Qe(t,s,this.b[s]);return this.f?Qe(t,"eid",this.f):an(t.a,"eid"),(s=ha(this.c)).length&&Qe(t,"fw",s.join(",")),t.toString()},(t=la.prototype).Ea=function(t,e,n){var r=new qr("popup-closed-by-user"),i=new qr("web-storage-unsupported"),o=this,s=!1;return this.ga().then(function(){(function(t){var e={type:"webStorageSupport"};return pa(t).then(function(){return function(t,e){return t.fb.then(function(){return new dt(function(n){t.a.send(e.type,e,n,ar("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&Kn(t),e(i),s=!0)})}).s(function(){}).then(function(){if(!s)return function(t){return new dt(function(e){return function n(){Le(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!s)return Le(n).then(function(){e(r)})})},t.Mb=function(){var t=sr();return!fr(t)&&!gr(t)},t.Hb=function(){return!1},t.Cb=function(t,e,n,r,i,o,s){if(!t)return Et(new qr("popup-blocked"));if(s&&!fr())return this.ga().s(function(e){Kn(t),i(e)}),r(),wt();this.a||(this.a=fa(da(this)));var a=this;return this.a.then(function(){var e=a.ga().s(function(e){throw Kn(t),i(e),e});return r(),e}).then(function(){(zi(n),s)||Wn(ya(a.m,a.f,a.b,e,n,null,o,a.c,void 0,a.h),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(a.a=null),t})},t.Ca=function(t,e,n){this.a||(this.a=fa(da(this)));var r=this;return this.a.then(function(){zi(e),Wn(ya(r.m,r.f,r.b,t,e,Vn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ga=function(){var t=this;return pa(this).then(function(){return t.i.fb}).s(function(){throw t.a=null,new qr("network-request-failed")})},t.Qb=function(){return!0},t.wa=function(t){this.g.push(t)},t.Ka=function(t){F(this.g,function(e){return e==t})},(t=ma.prototype).get=function(t){return wt(this.a.getItem(t)).then(function(t){return t&&yr(t)})},t.set=function(t,e){return wt(this.a.setItem(t,pr(e)))},t.P=function(t){return wt(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var va,ba=[];function _a(t){this.a=t}function wa(t){this.c=t,this.b=!1,this.a=[]}function Ea(t,e,n,r){var i,o,s,a,u=n||{},c=null;if(t.b)return Et(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new dt(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),s=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(s),a=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(a),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(s),clearTimeout(a),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return Ta(t,c),e}).s(function(e){throw Ta(t,c),e})}function Ta(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),F(t.a,function(t){return t==e})}}function Sa(){if(!Na())throw new qr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.m=n.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.u=!1,this.h=null;var t=this;$n()&&self?(this.l=function(){var t=$n()?self:null;if(O(ba,function(n){n.b==t&&(e=n)}),!e){var e=new ga(t);ba.push(e)}return e}(),this.l.subscribe("keyChanged",function(e,n){return Oa(t).then(function(e){return 0<e.length&&O(t.a,function(t){t(e)}),{keyProcessed:M(e,n.key)}})}),this.l.subscribe("ping",function(){return wt(["keyChanged"])})):function(){var t=n.navigator;return t&&t.serviceWorker?wt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):wt(null)}().then(function(e){(t.h=e)&&(t.g=new wa(new _a(e)),Ea(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&M(e[0].value,"keyChanged")&&(t.u=!0)}).s(function(){}))})}function Ia(t){return new dt(function(e,n){var r=t.m.open("firebaseLocalStorageDb",1);r.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},r.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(r):function(t){return new dt(function(e,n){var r=t.m.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}})}(t).then(function(){return Ia(t)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function Ca(t){return t.o||(t.o=Ia(t)),t.o}function Na(){try{return!!n.indexedDB}catch(t){return!1}}function Da(t){return t.objectStore("firebaseLocalStorage")}function Aa(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Ra(t){return new dt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function ka(t,e){return t.g&&t.h&&function(){var t=n.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Ea(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):wt()}function Oa(t){return Ca(t).then(function(t){var e=Da(Aa(t,!1));return e.getAll?Ra(e.getAll()):new dt(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function Pa(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function La(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=wt().then(function(){if(Na()){var t=mr(),r="__sak"+t;return va||(va=new Sa),(n=va).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.P(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.Y(function(t){O(e.a,function(e){e(t)})}),t})}function Ma(){this.a={},this.type="inMemory"}function xa(){if(!function(){var t="Node"==Zn();if(!(t=Fa()||t&&Yn.INTERNAL.node&&Yn.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==Zn())throw new qr("internal-error","The LocalStorage compatibility library was not found.");throw new qr("web-storage-unsupported")}this.a=Fa()||Yn.INTERNAL.node.localStorage,this.type="localStorage"}function Fa(){try{var t=n.localStorage,e=mr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Ua(){this.type="nullStorage"}function qa(){if(!function(){var t="Node"==Zn();if(!(t=Ba()||t&&Yn.INTERNAL.node&&Yn.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==Zn())throw new qr("internal-error","The SessionStorage compatibility library was not found.");throw new qr("web-storage-unsupported")}this.a=Ba()||Yn.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Ba(){try{var t=n.sessionStorage,e=mr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}ga.prototype.f=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];O(r,function(e){i.push(wt().then(function(){return e(t.origin,t.data.data)}))}),St(i).then(function(r){var i=[];O(r,function(t){i.push({fulfilled:t.Db,value:t.value,reason:t.reason?t.reason.message:void 0})}),O(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},ga.prototype.subscribe=function(t,e){rt(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},ga.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(F(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],rt(this.a)&&this.b.removeEventListener("message",this.c)},_a.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},wa.prototype.close=function(){for(;0<this.a.length;)Ta(this,this.a[0]);this.b=!0},(t=Sa.prototype).set=function(t,e){var n,r=!1,i=this;return Ca(this).then(function(e){return Ra((e=Da(Aa(n=e,!0))).get(t))}).then(function(o){var s=Da(Aa(n,!0));return o?(o.value=e,Ra(s.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,Ra(s.add(o)))}).then(function(){return i.c[t]=e,ka(i,t)}).ia(function(){r&&i.b--})},t.get=function(t){return Ca(this).then(function(e){return Ra(Da(Aa(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.P=function(t){var e=!1,n=this;return Ca(this).then(function(r){return e=!0,n.b++,Ra(Da(Aa(r,!0)).delete(t))}).then(function(){return delete n.c[t],ka(n,t)}).ia(function(){e&&n.b--})},t.Y=function(t){0==this.a.length&&function(t){Pa(t),function e(){t.f=setTimeout(function(){t.i=Oa(t).then(function(e){0<e.length&&O(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ca=function(t){F(this.a,function(e){return e==t}),0==this.a.length&&Pa(this)},(t=La.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.P=function(t){return this.b.then(function(e){return e.P(t)})},t.Y=function(t){this.a.push(t)},t.ca=function(t){F(this.a,function(e){return e==t})},(t=Ma.prototype).get=function(t){return wt(this.a[t])},t.set=function(t,e){return this.a[t]=e,wt()},t.P=function(t){return delete this.a[t],wt()},t.Y=function(){},t.ca=function(){},(t=xa.prototype).get=function(t){var e=this;return wt().then(function(){return yr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return wt().then(function(){var r=pr(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return wt().then(function(){e.a.removeItem(t)})},t.Y=function(t){n.window&&ge(n.window,"storage",t)},t.ca=function(t){n.window&&_e(n.window,"storage",t)},(t=Ua.prototype).get=function(){return wt(null)},t.set=function(){return wt()},t.P=function(){return wt()},t.Y=function(){},t.ca=function(){},(t=qa.prototype).get=function(t){var e=this;return wt().then(function(){return yr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return wt().then(function(){var r=pr(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return wt().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var Va,Wa,ja={A:xa,Ra:qa},Ka={A:xa,Ra:qa},Qa={A:ma,Ra:Ua},Ha={A:xa,Ra:Ua},Ga={Zc:"local",NONE:"none",ad:"session"};function za(){var t=!(gr(sr())||!Jn()),e=fr(),r=ur();this.o=t,this.h=e,this.l=r,this.a={},Va||(Va=new function(){var t={};t.Browser=ja,t.Node=Ka,t.ReactNative=Qa,t.Worker=Ha,this.a=t[Zn()]}),t=Va;try{this.g=!Bn()&&Er()||!n.indexedDB?new t.a.A:new La($n()?new Ma:new t.a.A)}catch(t){this.g=new Ma,this.h=!0}try{this.i=new t.a.Ra}catch(t){this.i=new Ma}this.m=new Ma,this.f=m(this.Pb,this),this.b={}}function Ya(){return Wa||(Wa=new za),Wa}function Xa(t,e){switch(e){case"session":return t.i;case"none":return t.m;default:return t.g}}function Ja(t,e){return"firebase:"+t.name+(e?":"+e:"")}function $a(t,e,n){return n=Ja(e,n),"local"==e.A&&(t.b[n]=null),Xa(t,e.A).P(n)}function Za(t){t.c&&(clearInterval(t.c),t.c=null)}(t=za.prototype).get=function(t,e){return Xa(this,t.A).get(Ja(t,e))},t.set=function(t,e,n){var r=Ja(t,n),i=this,o=Xa(this,t.A);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.A&&(i.b[r]=e)})},t.addListener=function(t,e,r){t=Ja(t,e),this.l&&(this.b[t]=n.localStorage.getItem(t)),rt(this.a)&&(Xa(this,"local").Y(this.f),this.h||(Bn()||!Er())&&n.indexedDB||!this.l||function(t){Za(t),t.c=setInterval(function(){for(var e in t.a){var r=n.localStorage.getItem(e),i=t.b[e];r!=i&&(t.b[e]=r,r=new ae({type:"storage",key:e,target:window,oldValue:i,newValue:r,a:!0}),t.Pb(r))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(r)},t.removeListener=function(t,e,n){t=Ja(t,e),this.a[t]&&(F(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),rt(this.a)&&(Xa(this,"local").ca(this.f),Za(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var r in this.a){var i=this.b[r];void 0===i&&(i=null);var o=n.localStorage.getItem(r);o!==i&&(this.b[r]=o,this.Xa(r))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Xa(this,"local").ca(this.f):Za(this),this.o)if(r=n.localStorage.getItem(e),(i=t.a.newValue)!==r)null!==i?n.localStorage.setItem(e,i):n.localStorage.removeItem(e);else if(this.b[e]===i&&void 0===t.a.a)return;var s=this;r=function(){void 0===t.a.a&&s.b[e]===n.localStorage.getItem(e)||(s.b[e]=n.localStorage.getItem(e),s.Xa(e))},jt&&$t&&10==$t&&n.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(r,10):r()}}else O(t,m(this.Xa,this))},t.Xa=function(t){this.a[t]&&O(this.a[t],function(t){t()})};var tu,eu={name:"authEvent",A:"local"};function nu(t,e){this.b=ru,this.f=n.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=n.Int32Array?new Int32Array(64):Array(64),void 0!==tu||(tu=n.Int32Array?new Int32Array(hu):hu),this.reset()}b(nu,function(){this.b=-1});for(var ru=64,iu=ru-1,ou=[],su=0;su<iu;su++)ou[su]=0;var au=U(128,ou);function uu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,s=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+s|0}r=0|t.a[0],i=0|t.a[1];var a=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&a^i&a)|0;s=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((s=(s=c&h^~c&l)+(0|tu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+s|0,u=a,a=i,i=r,r=s+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+a|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function cu(t,e,n){void 0===n&&(n=e.length);var i=0,o=t.c;if(r(e))for(;i<n;)t.f[o++]=e.charCodeAt(i++),o==t.b&&(uu(t),o=0);else{if(!c(e))throw Error("message must be string or array");for(;i<n;){var s=e[i++];if(!("number"==typeof s&&0<=s&&255>=s&&s==(0|s)))throw Error("message must be a byte array");t.f[o++]=s,o==t.b&&(uu(t),o=0)}}t.c=o,t.g+=n}nu.prototype.reset=function(){this.g=this.c=0,this.a=n.Int32Array?new Int32Array(this.h):q(this.h)};var hu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function lu(){nu.call(this,8,fu)}b(lu,nu);var fu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function pu(t,e,n,r,i){this.m=t,this.i=e,this.l=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new function(){this.a=Ya()},this.g=new function(t){this.a=t,this.b=Ya()}(this.h),this.f=null,this.b=[],this.a=this.c=null}function du(t){return new qr("invalid-cordova-configuration",t)}function yu(t){var e=new lu;cu(e,t),t=[];var n=8*e.g;56>e.c?cu(e,au,56-e.c):cu(e,au,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(uu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return P(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function mu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function gu(t){return t.f||(t.f=t.ga().then(function(){return new dt(function(e){t.wa(function n(r){return e(r),t.Ka(n),!1}),function(t){function e(e){i=!0,o&&o.cancel(),vu(t).then(function(n){var i=r;if(n&&e&&e.url){var o=null;-1!=(i=Ei(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=yr(He(o=Ge(i),"firebaseError")||null))?Br(o):null)?new Yi(n.b,n.c,null,null,o):new Yi(n.b,n.c,i,n.g)),i=o||r}mu(t,i)})}var r=new Yi("unknown",null,null,null,new qr("no-auth-event")),i=!1,o=Le(500).then(function(){return vu(t).then(function(){i||mu(t,r)})}),s=n.handleOpenURL;n.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(ar("BuildInfo.packageName",n).toLowerCase()+"://")&&e({url:t}),"function"==typeof s)try{s(t)}catch(t){console.error(t)}},Zi||(Zi=new Ji),Zi.subscribe(e)}(t)})})),t.f}function vu(t){var e=null;return function(t){return t.b.get(eu,t.a).then(function(t){return Xi(t)})}(t.g).then(function(n){return e=n,$a((n=t.g).b,eu,n.a)}).then(function(){return e})}(t=pu.prototype).ga=function(){return this.za?this.za:this.za=(Xn(void 0)?zn().then(function(){return new dt(function(t,e){var r=n.document,i=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);r.addEventListener("deviceready",function(){clearTimeout(i),t()},!1)})}):Et(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof ar("universalLinks.subscribe",n))throw du("cordova-universal-links-plugin-fix is not installed");if(void 0===ar("BuildInfo.packageName",n))throw du("cordova-plugin-buildinfo is not installed");if("function"!=typeof ar("cordova.plugins.browsertab.openUrl",n))throw du("cordova-plugin-browsertab is not installed");if("function"!=typeof ar("cordova.InAppBrowser.open",n))throw du("cordova-plugin-inappbrowser is not installed")},function(){throw new qr("cordova-not-ready")})},t.Ea=function(t,e){return e(new qr("operation-not-supported-in-this-environment")),wt()},t.Cb=function(){return Et(new qr("operation-not-supported-in-this-environment"))},t.Qb=function(){return!1},t.Mb=function(){return!0},t.Hb=function(){return!0},t.Ca=function(t,e,r){if(this.c)return Et(new qr("redirect-operation-pending"));var i=this,o=n.document,s=null,a=null,u=null,c=null;return this.c=wt().then(function(){return zi(e),gu(i)}).then(function(){return function(t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),s=new Yi(e,i,null,o,new qr("no-auth-event")),a=ar("BuildInfo.packageName",n);if("string"!=typeof a)throw new qr("invalid-cordova-configuration");var u=ar("BuildInfo.displayName",n),c={};if(sr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=a;else{if(!sr().toLowerCase().match(/android/))return Et(new qr("operation-not-supported-in-this-environment"));c.apn=a}u&&(c.appDisplayName=u),o=yu(o),c.sessionId=o;var h=ya(t.m,t.i,t.l,e,r,null,i,t.o,c,t.u);return t.ga().then(function(){var e=t.h;return t.v.a.set(eu,s.C(),e)}).then(function(){var e=ar("cordova.plugins.browsertab.isAvailable",n);if("function"!=typeof e)throw new qr("invalid-cordova-configuration");var r=null;e(function(e){if(e){if("function"!=typeof(r=ar("cordova.plugins.browsertab.openUrl",n)))throw new qr("invalid-cordova-configuration");r(h)}else{if("function"!=typeof(r=ar("cordova.InAppBrowser.open",n)))throw new qr("invalid-cordova-configuration");e=!(!(e=sr()).match(/(iPad|iPhone|iPod).*OS 7_\d/i)&&!e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)),t.a=r(h,e?"_blank":"_system","location=yes")}})})}(i,t,e,r)}).then(function(){return new dt(function(t,e){a=function(){var e=ar("cordova.plugins.browsertab.close",n);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.wa(a),u=function(){s||(s=Le(2e3).then(function(){e(new qr("redirect-cancelled-by-user"))}))},c=function(){_r()&&u()},o.addEventListener("resume",u,!1),sr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return vu(i).then(function(){throw t})})}).ia(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),s&&s.cancel(),a&&i.Ka(a),i.c=null})},t.wa=function(t){this.b.push(t),gu(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new Yi("unknown",null,null,null,new qr("no-auth-event")),t(e))})},t.Ka=function(t){F(this.b,function(e){return e==t})};var bu={name:"pendingRedirect",A:"session"};function _u(t){return $a(t.b,bu,t.a)}function wu(t,e,n){this.u=t,this.l=e,this.m=n,this.h=[],this.f=!1,this.i=m(this.bb,this),this.b=new ku,this.o=new Mu,this.g=new function(t){this.a=t,this.b=Ya()}(this.l+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.o,this.c.linkViaPopup=this.o,this.c.reauthViaPopup=this.o,this.a=Eu(this.u,this.l,this.m,si)}function Eu(t,e,n,r){var i=Yn.SDK_VERSION||null;return Xn()?new pu(t,e,n,i,r):new la(t,e,n,i,r)}function Tu(t){t.f||(t.f=!0,t.a.wa(t.i));var e=t.a;return t.a.ga().s(function(n){throw t.a==e&&t.reset(),n})}function Su(t){t.a.Mb()&&Tu(t).s(function(e){var n=new Yi("unknown",null,null,null,new qr("operation-not-supported-in-this-environment"));Du(e)&&t.bb(n)}),t.a.Hb()||Ou(t.b)}(t=wu.prototype).reset=function(){this.f=!1,this.a.Ka(this.i),this.a=Eu(this.u,this.l,this.m)},t.Ya=function(){this.b.Ya()},t.subscribe=function(t){if(M(this.h,t)||this.h.push(t),!this.f){var e=this;(function(t){return t.b.get(bu,t.a).then(function(t){return"pending"==t})})(this.g).then(function(t){t?_u(e.g).then(function(){Tu(e).s(function(t){var n=new Yi("unknown",null,null,null,new qr("operation-not-supported-in-this-environment"));Du(t)&&e.bb(n)})}):Su(e)}).s(function(){Su(e)})}},t.unsubscribe=function(t){F(this.h,function(e){return e==t})},t.bb=function(t){if(!t)throw new qr("invalid-auth-event");for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.vb(t.b,t.c)){(e=this.c[t.b])&&e.h(t,r),e=!0;break}}return Ou(this.b),e};var Iu=new br(2e3,1e4),Cu=new br(3e4,6e4);function Nu(t,e,n,r,i,o){return t.a.Cb(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.i))},function(){t.reset()},i,o)}function Du(t){return!(!t||"auth/cordova-not-ready"!=t.code)}wu.prototype.fa=function(){return this.b.fa()},wu.prototype.Ca=function(t,e,n){var r,i=this;return function(t){return t.b.set(bu,"pending",t.a)}(this.g).then(function(){return i.a.Ca(t,e,n).s(function(t){if(Du(t))throw new qr("operation-not-supported-in-this-environment");return r=t,_u(i.g).then(function(){throw r})}).then(function(){return i.a.Qb()?new dt(function(){}):_u(i.g).then(function(){return i.fa()}).then(function(){}).s(function(){})})})},wu.prototype.Ea=function(t,e,n,r){return this.a.Ea(n,function(n){t.ha(e,null,n,r)},Iu.get())};var Au={};function Ru(t,e,n){var r=e+":"+n;return Au[r]||(Au[r]=new wu(t,e,n)),Au[r]}function ku(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Ou(t){t.g||(t.g=!0,Lu(t,!1,null,null))}function Pu(t,e){if(t.b=function(){return wt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Lu(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Et(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):Pu(t,n):Pu(t,{user:null}),t.f=[],t.c=[]}function Mu(){}function xu(){this.sb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.sb},set:function(t){this.sb=t},enumerable:!1})}function Fu(t,e){this.a=e,Nr(this,"verificationId",t)}function Uu(t,e,n,r){return new Qi(t).Ua(e,n).then(function(t){return new Fu(t,r)})}function qu(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Bu(t){this.f=t,this.b=this.a=null,this.c=0}function Vu(t,e){var n=e[os],r=e.refreshToken;e=Wu(e.expiresIn),t.b=n,t.c=e,t.a=r}function Wu(t){return v()+1e3*parseInt(t,10)}function ju(t,e){return function(t,e){return new dt(function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?fs(t,t.i+"?key="+encodeURIComponent(t.b),function(t){t?t.error?r(na(t)):t.access_token&&t.refresh_token?n(t):r(new qr("internal-error")):r(new qr("network-request-failed"))},"POST",sn(e).toString(),t.f,t.l.get()):r(new qr("internal-error"))})}(t.f,e).then(function(e){return t.b=e.access_token,t.c=Wu(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}function Ku(t,e){this.a=t||null,this.b=e||null,Dr(this,{lastSignInTime:wr(e||null),creationTime:wr(t||null)})}function Qu(t,e){for(var n in se.call(this,t),e)this[n]=e[n]}function Hu(t,e,n){this.G=[],this.m=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=Yn.SDK_VERSION?or(Yn.SDK_VERSION):null,this.b=new rs(this.m,ui(si),t),this.h=new Bu(this.b),Zu(this,e[os]),Vu(this.h,e),Nr(this,"refreshToken",this.h.a),nc(this,n||{}),Ae.call(this),this.I=!1,this.u&&cr()&&(this.a=Ru(this.u,this.m,this.o)),this.N=[],this.i=null,this.w=function(t){return new qu(function(){return t.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.h.c-v()-3e5;return 0<e?e:0})}(this),this.V=m(this.Ha,this);var r=this;this.ka=null,this.ta=function(t){r.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){zu(r,t.c)},this.W=null}function Gu(t,e){t.X&&_e(t.X,"languageCodeChanged",t.ta),(t.X=e)&&ge(e,"languageCodeChanged",t.ta)}function zu(t,e){t.O=e,ls(t.b,Yn.SDK_VERSION?or(Yn.SDK_VERSION,t.O):null)}function Yu(t,e){t.W&&_e(t.W,"frameworkChanged",t.sa),(t.W=e)&&ge(e,"frameworkChanged",t.sa)}function Xu(t){try{return Yn.app(t.o).auth()}catch(e){throw new qr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.o+"'!")}}function Ju(t){t.D||t.w.b||(t.w.start(),_e(t,"tokenChanged",t.V),ge(t,"tokenChanged",t.V))}function $u(t){_e(t,"tokenChanged",t.V),t.w.stop()}function Zu(t,e){t.ra=e,Nr(t,"_lat",e)}function tc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return St(e).then(function(){return t})}function ec(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function nc(t,e){Dr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new Ku(e.createdAt,e.lastLoginAt),providerData:[]})}function rc(){}function ic(t){return wt().then(function(){if(t.D)throw new qr("app-deleted")})}function oc(t){return P(t.providerData,function(t){return t.providerId})}function sc(t,e){e&&(ac(t,e.providerId),t.providerData.push(e))}function ac(t,e){F(t.providerData,function(t){return t.providerId==e})}function uc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Nr(t,e,n)}function cc(t,e){t!=e&&(Dr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,providerData:[]}),e.metadata?Nr(t,"metadata",function(t){return new Ku(t.a,t.b)}(e.metadata)):Nr(t,"metadata",new Ku),O(e.providerData,function(e){sc(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.h,e.h),Nr(t,"refreshToken",t.h.a))}function hc(t){return t.F().then(function(e){var n=t.isAnonymous;return function(t,e){return ta(t.b,Ms,{idToken:e}).then(m(t.xc,t))}(t,e).then(function(){return n||uc(t,"isAnonymous",!1),e})})}function lc(t,e){e[os]&&t.ra!=e[os]&&(Vu(t.h,e),t.dispatchEvent(new Qu("tokenChanged")),Zu(t,e[os]),uc(t,"refreshToken",t.h.a))}function fc(t,e){return hc(t).then(function(){if(M(oc(t),e))return tc(t).then(function(){throw new qr("provider-already-linked")})})}function pc(t,e,n){return Ar({user:t,credential:Gi(e),additionalUserInfo:e=pi(e),operationType:n})}function dc(t,e){return lc(t,e),t.reload().then(function(){return t})}function yc(t,e,n,r,i){if(!cr())return Et(new qr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Et(t.i);var o=fi(n.providerId),s=mr(t.uid+":::"),a=null;(!fr()||Jn())&&t.u&&n.isOAuthProvider&&(a=ya(t.u,t.m,t.o,e,n,null,s,Yn.SDK_VERSION||null));var u=Qn(a,o&&o.Ba,o&&o.Aa);return r=r().then(function(){if(gc(t),!i)return t.F().then(function(){})}).then(function(){return Nu(t.a,u,e,n,s,!!a)}).then(function(){return new dt(function(n,r){t.ha(e,null,new qr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=s,t.c=t.a.Ea(t,e,u,s)})}).then(function(t){return u&&Kn(u),t?Ar(t):null}).s(function(t){throw u&&Kn(u),t}),vc(t,r,i)}function mc(t,e,n,r,i){if(!cr())return Et(new qr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Et(t.i);var o=null,s=mr(t.uid+":::");return r=r().then(function(){if(gc(t),!i)return t.F().then(function(){})}).then(function(){return t.aa=s,tc(t)}).then(function(e){return t.ba&&(e=(e=t.ba).b.set(_c,t.C(),e.a)),e}).then(function(){return t.a.Ca(e,n,s)}).s(function(e){if(o=e,t.ba)return wc(t.ba);throw o}).then(function(){if(o)throw o}),vc(t,r,i)}function gc(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new qr("internal-error");throw new qr("auth-domain-config-required")}}function vc(t,e,n){var r=function(t,e,n){return t.i&&!n?(e.cancel(),Et(t.i)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.i||t.dispatchEvent(new Qu("userInvalidated")),t.i=e),e})}(t,e,n);return t.G.push(r),r.ia(function(){x(t.G,r)}),r}function bc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[os]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-v())/1e3;var r=new Hu(e,n,t);return t.providerData&&O(t.providerData,function(t){t&&sc(r,Ar(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}ku.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},ku.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.b,r=t.c,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(Lu(this,!0,null,t.a),wt()):e.xa(n,r)?function(t,e,n){n=n.xa(e.b,e.c);var r=e.f,i=e.g,o=e.h,s=!!e.b.match(/Redirect$/);n(r,i,o).then(function(e){Lu(t,s,e,null)}).s(function(e){Lu(t,s,null,e)})}(this,t,e):Et(new qr("invalid-auth-event")):(Lu(this,!1,null,null),wt())}else Et(new qr("invalid-auth-event"))},ku.prototype.Ya=function(){this.g&&!this.i&&Lu(this,!1,null,null)},ku.prototype.fa=function(){var t=this;return new dt(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new qr("timeout");t.a&&t.a.cancel(),t.a=Le(Cu.get()).then(function(){t.b||(t.g=!0,Lu(t,!0,null,e))})}(t))})},Mu.prototype.h=function(t,e){if(t){var n=t.b,r=t.c;t.a?(e.ha(t.b,null,t.a,t.c),wt()):e.xa(n,r)?function(t,e){var n=t.c,r=t.b;e.xa(r,n)(t.f,t.g,t.h).then(function(t){e.ha(r,t,null,n)}).s(function(t){e.ha(r,null,t,n)})}(t,e):Et(new qr("invalid-auth-event"))}else Et(new qr("invalid-auth-event"))},Fu.prototype.confirm=function(t){return t=Hi(this.verificationId,t),this.a(t)},qu.prototype.start=function(){this.a=this.c,function t(e,r){e.stop();e.b=Le(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,r)).then(function(){return t=n.document,e=null,_r()||!t?wt():new dt(function(n){e=function(){_r()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},qu.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Bu.prototype.C=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Bu.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Et(new qr("user-token-expired")):t||!this.b||v()>this.c-3e4?this.a?ju(this,{grant_type:"refresh_token",refresh_token:this.a}):wt(null):wt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},Ku.prototype.C=function(){return{lastLoginAt:this.b,createdAt:this.a}},b(Qu,se),b(Hu,Ae),Hu.prototype.pa=function(t){this.ka=t,hs(this.b,t)},Hu.prototype.ea=function(){return this.ka},Hu.prototype.ya=function(){return q(this.O)},Hu.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},Nr(Hu.prototype,"providerId","firebase"),(t=Hu.prototype).reload=function(){var t=this;return vc(this,ic(this).then(function(){return hc(t).then(function(){return tc(t)}).then(rc)}))},t.dc=function(t){return this.F(t).then(function(t){return new function(t){var e=oi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new qr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Dr(this,{token:t,expirationTime:wr(1e3*e.exp),authTime:wr(1e3*e.auth_time),issuedAtTime:wr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}(t)})},t.F=function(t){var e=this;return vc(this,ic(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new qr("internal-error");return t.accessToken!=e.ra&&(Zu(e,t.accessToken),e.dispatchEvent(new Qu("tokenChanged"))),uc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.xc=function(t){if(!(t=t.users)||!t.length)throw new qr("internal-error");nc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?P(t,function(t){return new function(t,e,n,r,i,o){Dr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)sc(this,e[n]);uc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.gb=function(t){var e=this,n=null;return vc(this,t.f(this.b,this.uid).then(function(t){return lc(e,t),n=pc(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},t.yc=function(t){return Ir("firebase.User.prototype.reauthenticateWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential instead."),this.gb(t).then(function(){})},t.eb=function(t){var e=this,n=null;return vc(this,fc(this,t.providerId).then(function(){return e.F()}).then(function(n){return t.b(e.b,n)}).then(function(t){return n=pc(e,t,"link"),dc(e,t)}).then(function(){return n}))},t.pc=function(t){return Ir("firebase.User.prototype.linkWithCredential is deprecated. Please use firebase.User.prototype.linkAndRetrieveDataWithCredential instead."),this.eb(t).then(function(t){return t.user})},t.qc=function(t,e){var n=this;return vc(this,fc(this,"phone").then(function(){return Uu(Xu(n),t,e,m(n.eb,n))}))},t.zc=function(t,e){var n=this;return vc(this,wt().then(function(){return Uu(Xu(n),t,e,m(n.gb,n))}),!0)},t.pb=function(t){var e=this;return vc(this,this.F().then(function(n){return e.b.pb(n,t)}).then(function(t){return lc(e,t),e.reload()}))},t.Rc=function(t){var e=this;return vc(this,this.F().then(function(n){return t.b(e.b,n)}).then(function(t){return lc(e,t),e.reload()}))},t.qb=function(t){var e=this;return vc(this,this.F().then(function(n){return e.b.qb(n,t)}).then(function(t){return lc(e,t),e.reload()}))},t.rb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return ic(this);var e=this;return vc(this,this.F().then(function(n){return e.b.rb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return lc(e,t),uc(e,"displayName",t.displayName||null),uc(e,"photoURL",t.photoUrl||null),O(e.providerData,function(t){"password"===t.providerId&&(Nr(t,"displayName",e.displayName),Nr(t,"photoURL",e.photoURL))}),tc(e)}).then(rc))},t.Pc=function(t){var e=this;return vc(this,hc(this).then(function(n){return M(oc(e),t)?function(t,e,n){return ta(t,Os,{idToken:e,deleteProvider:n})}(e.b,n,[t]).then(function(t){var n={};return O(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),O(oc(e),function(t){n[t]||ac(e,t)}),n[Qi.PROVIDER_ID]||Nr(e,"phoneNumber",null),tc(e)}):tc(e).then(function(){throw new qr("no-such-provider")})}))},t.delete=function(){var t=this;return vc(this,this.F().then(function(e){return ta(t.b,ks,{idToken:e})}).then(function(){t.dispatchEvent(new Qu("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");Gu(t,null),Yu(t,null),t.G=[],t.D=!0,$u(t),Nr(t,"refreshToken",null),t.a&&t.a.unsubscribe(t)})},t.vb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?m(this.Ab,this):"reauthViaPopup"==t&&e==(this.g||null)?m(this.Bb,this):"linkViaRedirect"==t&&(this.aa||null)==e?m(this.Ab,this):"reauthViaRedirect"==t&&(this.aa||null)==e?m(this.Bb,this):null},t.rc=function(t){var e=this;return yc(this,"linkViaPopup",t,function(){return fc(e,t.providerId).then(function(){return tc(e)})},!1)},t.Ac=function(t){return yc(this,"reauthViaPopup",t,function(){return wt()},!0)},t.sc=function(t){var e=this;return mc(this,"linkViaRedirect",t,function(){return fc(e,t.providerId)},!1)},t.Bc=function(t){return mc(this,"reauthViaRedirect",t,function(){return wt()},!0)},t.Ab=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return vc(this,this.F().then(function(i){return Ss(r.b,{requestUri:t,postBody:n,sessionId:e,idToken:i})}).then(function(t){return i=pc(r,t,"link"),dc(r,t)}).then(function(){return i}))},t.Bb=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return vc(this,wt().then(function(){return Ti(Is(r.b,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=pc(r,t,"reauthenticate"),lc(r,t),r.i=null,r.reload()}).then(function(){return i}),!0)},t.jb=function(t){var e=this,n=null;return vc(this,this.F().then(function(e){return n=e,void 0===t||rt(t)?{}:Zr(new jr(t))}).then(function(t){return e.b.jb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.C()},t.C=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.m,appName:this.o,authDomain:this.u,stsTokenManager:this.h.C(),redirectEventId:this.aa||null};return this.metadata&&ut(t,this.metadata.C()),O(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var _c={name:"redirectUser",A:"session"};function wc(t){return $a(t.b,_c,t.a)}function Ec(t){this.a=t,this.b=Ya(),this.c=null,this.f=function(t){var e=Ic("local"),r=Ic("session"),i=Ic("none");return function(t,e,r){var i=Ja(e,r),o=Xa(t,e.A);return t.get(e,r).then(function(s){var a=null;try{a=yr(n.localStorage.getItem(i))}catch(t){}if(a&&!s)return n.localStorage.removeItem(i),t.set(e,a,r);a&&s&&"localStorage"!=o.type&&n.localStorage.removeItem(i)})}(t.b,e,t.a).then(function(){return t.b.get(r,t.a)}).then(function(n){return n?r:t.b.get(i,t.a).then(function(n){return n?i:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(Sc,t.a).then(function(t){return t?Ic(t):e})})})}).then(function(e){return t.c=e,Tc(t,e.A)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener(Ic("local"),this.a,m(this.g,this))}function Tc(t,e){var n,r=[];for(n in Ga)Ga[n]!==e&&r.push($a(t.b,Ic(Ga[n]),t.a));return r.push($a(t.b,Sc,t.a)),function(t){return new dt(function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},s=function(t){n(t)},a=0;a<t.length;a++)Tt(t[a],g(o,a),s);else e(i)})}(r)}Ec.prototype.g=function(){var t=this,e=Ic("local");Ac(this,function(){return wt().then(function(){return t.c&&"local"!=t.c.A?t.b.get(e,t.a):null}).then(function(n){if(n)return Tc(t,"local").then(function(){t.c=e})})})};var Sc={name:"persistence",A:"session"};function Ic(t){return{name:"authUser",A:t}}function Cc(t,e){return Ac(t,function(){return t.b.set(t.c,e.C(),t.a)})}function Nc(t){return Ac(t,function(){return $a(t.b,t.c,t.a)})}function Dc(t,e){return Ac(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),bc(t||{})})})}function Ac(t,e){return t.f=t.f.then(e,e),t.f}function Rc(t){if(this.m=!1,Nr(this,"settings",new xu),Nr(this,"app",t),!Fc(this).options||!Fc(this).options.apiKey)throw new qr("invalid-api-key");t=Yn.SDK_VERSION?or(Yn.SDK_VERSION):null,this.b=new rs(Fc(this).options&&Fc(this).options.apiKey,ui(si),t),this.N=[],this.o=[],this.I=[],this.Tb=Yn.INTERNAL.createSubscribe(m(this.mc,this)),this.O=void 0,this.Ub=Yn.INTERNAL.createSubscribe(m(this.nc,this)),Mc(this,null),this.h=new Ec(Fc(this).options.apiKey+":"+Fc(this).name),this.w=new function(t){this.a=t,this.b=Ya()}(Fc(this).options.apiKey+":"+Fc(this).name),this.V=Vc(this,function(t){var e=Fc(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(_c,t.a).then(function(t){return t&&e&&(t.authDomain=e),bc(t||{})})}(t.w,Fc(t).options.authDomain).then(function(e){return(t.D=e)&&(e.ba=t.w),wc(t.w)});return Vc(t,e)}(t).then(function(){return Dc(t.h,e)}).then(function(e){return e?(e.ba=t.w,t.D&&(t.D.aa||null)==(e.aa||null)?e:e.reload().then(function(){return Cc(t.h,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:Nc(t.h)})):null}).then(function(e){Mc(t,e||null)});return Vc(t,n)}(this)),this.i=Vc(this,function(t){return t.V.then(function(){return t.fa()}).s(function(){}).then(function(){if(!t.m)return t.ka()}).s(function(){}).then(function(){if(!t.m){t.X=!0;var e=t.h;e.b.addListener(Ic("local"),e.a,t.ka)}})}(this)),this.X=!1,this.ka=m(this.Mc,this),this.Ha=m(this.Z,this),this.ra=m(this.bc,this),this.sa=m(this.jc,this),this.ta=m(this.kc,this),function(t){var e=Fc(t).options.authDomain,n=Fc(t).options.apiKey;e&&cr()&&(t.Sb=t.V.then(function(){if(!t.m){if(t.a=Ru(e,n,Fc(t).name),t.a.subscribe(t),Uc(t)&&ec(Uc(t)),t.D){ec(t.D);var r=t.D;r.pa(t.ea()),Gu(r,t),zu(r=t.D,t.G),Yu(r,t),t.D=null}return t.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=m(this.delete,this),this.INTERNAL.logFramework=m(this.tc,this),this.u=0,Ae.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),t.W=null}(this),this.G=[]}function kc(t){se.call(this,"languageCodeChanged"),this.g=t}function Oc(t){se.call(this,"frameworkChanged"),this.c=t}function Pc(t){return t.Sb||Et(new qr("auth-domain-config-required"))}function Lc(t,e){var n={};return n.apiKey=Fc(t).options.apiKey,n.authDomain=Fc(t).options.authDomain,n.appName=Fc(t).name,t.V.then(function(){return function(t,e,n,r){var i=new Hu(t,e);return n&&(i.ba=n),r&&zu(i,r),i.reload().then(function(){return i})}(n,e,t.w,t.ya())}).then(function(e){return Uc(t)&&e.uid==Uc(t).uid?(cc(Uc(t),e),t.Z(e)):(Mc(t,e),ec(e),t.Z(e))}).then(function(){Bc(t)})}function Mc(t,e){Uc(t)&&(function(t,e){F(t.N,function(t){return t==e})}(Uc(t),t.Ha),_e(Uc(t),"tokenChanged",t.ra),_e(Uc(t),"userDeleted",t.sa),_e(Uc(t),"userInvalidated",t.ta),$u(Uc(t))),e&&(e.N.push(t.Ha),ge(e,"tokenChanged",t.ra),ge(e,"userDeleted",t.sa),ge(e,"userInvalidated",t.ta),0<t.u&&Ju(e)),Nr(t,"currentUser",e),e&&(e.pa(t.ea()),Gu(e,t),zu(e,t.G),Yu(e,t))}function xc(t,e){var n=null,r=null;return Vc(t,e.then(function(e){return n=Gi(e),r=pi(e),Lc(t,e)}).then(function(){return Ar({user:Uc(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Fc(t){return t.app}function Uc(t){return t.currentUser}function qc(t){return Uc(t)&&Uc(t)._lat||null}function Bc(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](qc(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](qc(t))}}function Vc(t,e){return t.N.push(e),e.ia(function(){x(t.N,e)}),e}function Wc(){}function jc(){this.a={},this.b=1e12}Ec.prototype.mb=function(t){var e=null,n=this;return function(t){var e=new qr("invalid-persistence-type"),n=new qr("unsupported-persistence-type");t:{for(r in Ga)if(Ga[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(Zn()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!ur()&&"none"!==t)throw n}}(t),Ac(this,function(){return t!=n.c.A?n.b.get(n.c,n.a).then(function(r){return e=r,Tc(n,t)}).then(function(){if(n.c=Ic(t),e)return n.b.set(n.c,e,n.a)}):wt()})},b(Rc,Ae),b(kc,se),b(Oc,se),(t=Rc.prototype).mb=function(t){return Vc(this,t=this.h.mb(t))},t.pa=function(t){this.W===t||this.m||(this.W=t,hs(this.b,this.W),this.dispatchEvent(new kc(this.ea())))},t.ea=function(){return this.W},t.Sc=function(){var t=n.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.tc=function(t){this.G.push(t),ls(this.b,Yn.SDK_VERSION?or(Yn.SDK_VERSION,this.G):null),this.dispatchEvent(new Oc(this.G))},t.ya=function(){return q(this.G)},t.toJSON=function(){return{apiKey:Fc(this).options.apiKey,authDomain:Fc(this).options.authDomain,appName:Fc(this).name,currentUser:Uc(this)&&Uc(this).C()}},t.vb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?m(this.ac,this):null},t.ac=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.c&&(this.c.cancel(),this.c=null);var i=null,o=null,s=Ts(r.b,t).then(function(t){return i=Gi(t),o=pi(t),t});return Vc(this,t=r.V.then(function(){return s}).then(function(t){return Lc(r,t)}).then(function(){return Ar({user:Uc(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Kc=function(t){if(!cr())return Et(new qr("operation-not-supported-in-this-environment"));var e=this,n=fi(t.providerId),r=mr(),i=null;(!fr()||Jn())&&Fc(this).options.authDomain&&t.isOAuthProvider&&(i=ya(Fc(this).options.authDomain,Fc(this).options.apiKey,Fc(this).name,"signInViaPopup",t,null,r,Yn.SDK_VERSION||null));var o=Qn(i,n&&n.Ba,n&&n.Aa);return Vc(this,n=Pc(this).then(function(e){return Nu(e,o,"signInViaPopup",t,r,!!i)}).then(function(){return new dt(function(t,n){e.ha("signInViaPopup",null,new qr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.c=e.a.Ea(e,"signInViaPopup",o,r)})}).then(function(t){return o&&Kn(o),t?Ar(t):null}).s(function(t){throw o&&Kn(o),t}))},t.Lc=function(t){if(!cr())return Et(new qr("operation-not-supported-in-this-environment"));var e=this;return Vc(this,Pc(this).then(function(){return Ac(t=e.h,function(){return t.b.set(Sc,t.c.A,t.a)});var t}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},t.fa=function(){if(!cr())return Et(new qr("operation-not-supported-in-this-environment"));var t=this;return Vc(this,Pc(this).then(function(){return t.a.fa()}).then(function(t){return t?Ar(t):null}))},t.Qc=function(t){if(!t)return Et(new qr("null-user"));var e=this,n={};n.apiKey=Fc(this).options.apiKey,n.authDomain=Fc(this).options.authDomain,n.appName=Fc(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.m,authDomain:t.u,appName:t.o};var i=t.h,o={};return o[os]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-v())/1e3,e=new Hu(e,o),n&&(e.ba=n),r&&zu(e,r),cc(e,t),e}(t,n,e.w,e.ya());return Vc(this,this.i.then(function(){if(Fc(e).options.apiKey!=t.m)return r.reload()}).then(function(){return Uc(e)&&t.uid==Uc(e).uid?(cc(Uc(e),t),e.Z(t)):(Mc(e,r),ec(r),e.Z(r))}).then(function(){Bc(e)}))},t.nb=function(){var t=this;return Vc(this,this.i.then(function(){return Uc(t)?(Mc(t,null),Nc(t.h).then(function(){Bc(t)})):wt()}))},t.Mc=function(){var t=this;return Dc(this.h,Fc(this).options.authDomain).then(function(e){if(!t.m){var n;if(n=Uc(t)&&e){n=Uc(t).uid;var r=e.uid;n=void 0!==n&&null!==n&&""!==n&&void 0!==r&&null!==r&&""!==r&&n==r}if(n)return cc(Uc(t),e),Uc(t).F();(Uc(t)||e)&&(Mc(t,e),e&&(ec(e),e.ba=t.w),t.a&&t.a.subscribe(t),Bc(t))}})},t.Z=function(t){return Cc(this.h,t)},t.bc=function(){Bc(this),this.Z(Uc(this))},t.jc=function(){this.nb()},t.kc=function(){this.nb()},t.mc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Uc(e))})},t.nc=function(t){var e=this;!function(t,e){t.I.push(e),Vc(t,t.i.then(function(){!t.m&&M(t.I,e)&&t.O!==t.getUid()&&(t.O=t.getUid(),e(qc(t)))}))}(this,function(){t.next(Uc(e))})},t.vc=function(t,e,n){var r=this;return this.X&&Yn.Promise.resolve().then(function(){h(t)?t(Uc(r)):h(t.next)&&t.next(Uc(r))}),this.Tb(t,e,n)},t.uc=function(t,e,n){var r=this;return this.X&&Yn.Promise.resolve().then(function(){r.O=r.getUid(),h(t)?t(Uc(r)):h(t.next)&&t.next(Uc(r))}),this.Ub(t,e,n)},t.cc=function(t){var e=this;return Vc(this,this.i.then(function(){return Uc(e)?Uc(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Nb=function(t){var e=this;return this.i.then(function(){return xc(e,ta(e.b,Ys,{token:t}))}).then(function(t){var n=t.user;return uc(n,"isAnonymous",!1),e.Z(n),t})},t.Ec=function(t){return Ir("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCustomToken is deprecated. Please use firebase.auth.Auth.prototype.signInWithCustomToken instead."),this.Nb(t)},t.Fc=function(t,e){return Ir("firebase.auth.Auth.prototype.signInAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.signInWithEmailAndPassword instead."),this.Ob(t,e)},t.Ob=function(t,e){var n=this;return this.i.then(function(){return xc(n,ta(n.b,Xs,{email:t,password:e}))})},t.xb=function(t,e){var n=this;return this.i.then(function(){return xc(n,ta(n.b,As,{email:t,password:e}))})},t.Wb=function(t,e){return Ir("firebase.auth.Auth.prototype.createUserAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.createUserWithEmailAndPassword instead."),this.xb(t,e)},t.Hc=function(t){return Ir("firebase.auth.Auth.prototype.signInWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential instead."),this.Pa(t).then(function(t){return t.user})},t.Pa=function(t){var e=this;return this.i.then(function(){return xc(e,t.la(e.b))})},t.Qa=function(){var t=this;return this.i.then(function(){var e=Uc(t);return e&&e.isAnonymous?Ar({user:e,credential:null,additionalUserInfo:Ar({providerId:null,isNewUser:!1}),operationType:"signIn"}):xc(t,t.b.Qa()).then(function(e){var n=e.user;return uc(n,"isAnonymous",!0),t.Z(n),e})})},t.Gc=function(){return Ir("firebase.auth.Auth.prototype.signInAnonymouslyAndRetrieveData is deprecated. Please use firebase.auth.Auth.prototype.signInAnonymously instead."),this.Qa()},t.getUid=function(){return Uc(this)&&Uc(this).uid||null},t.Vb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&Uc(this)&&Ju(Uc(this))},t.Cc=function(t){var e=this;O(this.o,function(n){n==t&&e.u--}),0>this.u&&(this.u=0),0==this.u&&Uc(this)&&$u(Uc(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),Vc(this,this.i.then(function(){e.m||M(e.o,t)&&t(qc(e))}))},t.removeAuthTokenListener=function(t){F(this.o,function(e){return e==t})},t.delete=function(){this.m=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(Ic("local"),t.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Ya()),Yn.Promise.resolve()},t.Zb=function(t){return Ir("firebase.auth.Auth.prototype.fetchProvidersForEmail is deprecated. Please use firebase.auth.Auth.prototype.fetchSignInMethodsForEmail instead."),Vc(this,function(t,e){return ta(t,Rs,{identifier:e,continueUri:hr()?Vn():"http://localhost"}).then(function(t){return t.allProviders||[]})}(this.b,t))},t.$b=function(t){return Vc(this,function(t,e){return ta(t,Rs,{identifier:e,continueUri:hr()?Vn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.oc=function(t){return!!Wi(t)},t.lb=function(t,e){var n=this;return Vc(this,wt().then(function(){var t=new jr(e);if(!t.c)throw new qr("argument-error",Hr+" must be true when sending sign in link to email");return Zr(t)}).then(function(e){return n.b.lb(t,e)}).then(function(){}))},t.Tc=function(t){return this.Ja(t).then(function(t){return t.data.email})},t.Za=function(t,e){return Vc(this,this.b.Za(t,e).then(function(){}))},t.Ja=function(t){return Vc(this,this.b.Ja(t).then(function(t){return new function(t){var e={},n=t[Or],r=t[Pr];if(!(t=t[Lr])||t!=kr&&!n)throw Error("Invalid provider user info!");e[xr]=r||null,e[Mr]=n||null,Nr(this,Ur,t),Nr(this,Fr,Rr(e))}(t)}))},t.Wa=function(t){return Vc(this,this.b.Wa(t).then(function(){}))},t.kb=function(t,e){var n=this;return Vc(this,wt().then(function(){return void 0===e||rt(e)?{}:Zr(new jr(e))}).then(function(e){return n.b.kb(t,e)}).then(function(){}))},t.Jc=function(t,e){return Vc(this,Uu(this,t,e,m(this.Pa,this)))},t.Ic=function(t,e){var n=this;return Vc(this,wt().then(function(){var r=Vi(t,e||Vn());return n.Pa(r)}))},Wc.prototype.render=function(){},Wc.prototype.reset=function(){},Wc.prototype.getResponse=function(){},Wc.prototype.execute=function(){};var Kc=null;function Qc(t,e){return(e=Hc(e))&&t.a[e]||null}function Hc(t){return(t=void 0===t?1e12:t)?t.toString():null}function Gc(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=kn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():ge(this.f,"click",this.i)}function zc(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Yc(){}jc.prototype.render=function(t,e){return this.a[this.b.toString()]=new Gc(t,e),this.b++},jc.prototype.reset=function(t){var e=Qc(this,t);t=Hc(t),e&&t&&(e.delete(),delete this.a[t])},jc.prototype.getResponse=function(t){return(t=Qc(this,t))?t.getResponse():null},jc.prototype.execute=function(t){(t=Qc(this,t))&&t.execute()},Gc.prototype.getResponse=function(){return zc(this),this.b},Gc.prototype.execute=function(){zc(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(t){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()},6e4)},500))},Gc.prototype.delete=function(){zc(this),this.g=!0,clearTimeout(this.a),this.a=null,_e(this.f,"click",this.i)},Yc.prototype.g=function(){return Kc||(Kc=new jc),wt(Kc)},Yc.prototype.c=function(){};var Xc=null;function Jc(){this.b=n.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var $c=yn("https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Zc=new br(3e4,6e4);Jc.prototype.g=function(t){var e=this;return new dt(function(r,i){var o=setTimeout(function(){i(new qr("network-request-failed"))},Zc.get());!n.grecaptcha||t!==e.f&&!e.b?(n[e.a]=function(){if(n.grecaptcha){e.f=t;var s=n.grecaptcha.render;n.grecaptcha.render=function(t,n){return t=s(t,n),e.b++,t},clearTimeout(o),r(n.grecaptcha)}else clearTimeout(o),i(new qr("internal-error"));delete n[e.a]},wt(Xo(vn($c,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(o),i(new qr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(o),r(n.grecaptcha))})},Jc.prototype.c=function(){this.b--};var th=null;function eh(t,e,r,i,o,s,a){if(Nr(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.m=e,this.g=null,a?(Xc||(Xc=new Yc),a=Xc):(th||(th=new Jc),a=th),this.o=a,this.a=r||{theme:"light",type:"image"},this.h=[],this.a[ih])throw new qr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[oh],!n.document)throw new qr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!kn(e)||!this.i&&kn(e).hasChildNodes())throw new qr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new rs(t,s||null,o||null),this.v=i||function(){return null};var u=this;this.l=[];var c=this.a[nh];this.a[nh]=function(t){if(sh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=ar(c,n);"function"==typeof e&&e(t)}};var h=this.a[rh];this.a[rh]=function(){if(sh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=ar(h,n);"function"==typeof t&&t()}}}var nh="callback",rh="expired-callback",ih="sitekey",oh="size";function sh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function ah(t,e){return t.h.push(e),e.ia(function(){x(t.h,e)}),e}function uh(t){if(t.D)throw new qr("internal-error","RecaptchaVerifier instance has been destroyed.")}function ch(t,e,n){var r=!1;try{this.b=n||Yn.app()}catch(t){throw new qr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new qr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=Yn.SDK_VERSION?or(Yn.SDK_VERSION,o):null,eh.call(this,n,t,e,function(){try{var t=i.b.auth().ea()}catch(e){t=null}return t},o,ui(si),r)}function hh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,s=0;s<e.length;s++)if(e[s].optional)o=!0;else{if(o)throw new qr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],0>i||i>=lh.length)throw new qr("internal-error","Argument validator received an unsupported number of arguments.");n=lh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new qr("argument-error",t+" failed: "+r)}(t=eh.prototype).za=function(){var t=this;return this.f?this.f:this.f=ah(this,wt().then(function(){if(hr()&&!$n())return zn();throw new qr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.o.g(t.v())}).then(function(e){return t.g=e,ta(t.u,Bs,{})}).then(function(e){t.a[ih]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){uh(this);var t=this;return ah(this,this.za().then(function(){if(null===t.c){var e=t.m;if(!t.i){var n=kn(e);e=Ln("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){uh(this);var t=this;return ah(this,this.render().then(function(e){return new dt(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){F(t.l,function(t){return t==e})}(t,i),n(e))};t.l.push(i),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){uh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){uh(this),this.D=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=kn(this.m);for(var e;e=t.firstChild;)t.removeChild(e)}},b(ch,eh);var lh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function fh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:r}}function ph(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:i}}function dh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:l}}function yh(t,e){return{name:t||"",K:"a function",optional:!!e,M:h}}function mh(t,e){return{name:t||"",K:"null",optional:!!e,M:a}}function gh(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.la||!n)}}}function vh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&r(t.type)&&h(t.verify))}}}function bh(t,e,n,r){return{name:n||"",K:t.K+" or "+e.K,optional:!!r,M:function(n){return t.M(n)||e.M(n)}}}function _h(t,e){for(var n in e){var r=e[n].name;t[r]=Th(r,t[n],e[n].j)}}function wh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:g(function(t){return this[t]},n),set:g(function(t,e,n,r){hh(t,[n],[r],!0),this[e]=r},r,n,e[n].tb),enumerable:!0})}}function Eh(t,e,n,r){t[e]=Th(e,n,r)}function Th(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return hh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}_h(Rc.prototype,{Wa:{name:"applyActionCode",j:[fh("code")]},Ja:{name:"checkActionCode",j:[fh("code")]},Za:{name:"confirmPasswordReset",j:[fh("code"),fh("newPassword")]},xb:{name:"createUserWithEmailAndPassword",j:[fh("email"),fh("password")]},Wb:{name:"createUserAndRetrieveDataWithEmailAndPassword",j:[fh("email"),fh("password")]},Zb:{name:"fetchProvidersForEmail",j:[fh("email")]},$b:{name:"fetchSignInMethodsForEmail",j:[fh("email")]},fa:{name:"getRedirectResult",j:[]},oc:{name:"isSignInWithEmailLink",j:[fh("emailLink")]},uc:{name:"onAuthStateChanged",j:[bh(dh(),yh(),"nextOrObserver"),yh("opt_error",!0),yh("opt_completed",!0)]},vc:{name:"onIdTokenChanged",j:[bh(dh(),yh(),"nextOrObserver"),yh("opt_error",!0),yh("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[fh("email"),bh(dh("opt_actionCodeSettings",!0),mh(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[fh("email"),dh("actionCodeSettings")]},mb:{name:"setPersistence",j:[fh("persistence")]},Pa:{name:"signInAndRetrieveDataWithCredential",j:[gh()]},Qa:{name:"signInAnonymously",j:[]},Gc:{name:"signInAnonymouslyAndRetrieveData",j:[]},Hc:{name:"signInWithCredential",j:[gh()]},Nb:{name:"signInWithCustomToken",j:[fh("token")]},Ec:{name:"signInAndRetrieveDataWithCustomToken",j:[fh("token")]},Ob:{name:"signInWithEmailAndPassword",j:[fh("email"),fh("password")]},Ic:{name:"signInWithEmailLink",j:[fh("email"),fh("emailLink",!0)]},Fc:{name:"signInAndRetrieveDataWithEmailAndPassword",j:[fh("email"),fh("password")]},Jc:{name:"signInWithPhoneNumber",j:[fh("phoneNumber"),vh()]},Kc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Lc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Qc:{name:"updateCurrentUser",j:[bh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof Hu)}},mh(),"user")]},nb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[fh(null,!0)]},Sc:{name:"useDeviceLanguage",j:[]},Tc:{name:"verifyPasswordResetCode",j:[fh("code")]}}),wh(Rc.prototype,{lc:{name:"languageCode",tb:bh(fh(),mh(),"languageCode")}}),Rc.Persistence=Ga,Rc.Persistence.LOCAL="local",Rc.Persistence.SESSION="session",Rc.Persistence.NONE="none",_h(Hu.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[ph("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[ph("opt_forceRefresh",!0)]},eb:{name:"linkAndRetrieveDataWithCredential",j:[gh()]},pc:{name:"linkWithCredential",j:[gh()]},qc:{name:"linkWithPhoneNumber",j:[fh("phoneNumber"),vh()]},rc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},sc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},gb:{name:"reauthenticateAndRetrieveDataWithCredential",j:[gh()]},yc:{name:"reauthenticateWithCredential",j:[gh()]},zc:{name:"reauthenticateWithPhoneNumber",j:[fh("phoneNumber"),vh()]},Ac:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Bc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[bh(dh("opt_actionCodeSettings",!0),mh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[fh(null,!0)]},Pc:{name:"unlink",j:[fh("provider")]},pb:{name:"updateEmail",j:[fh("email")]},qb:{name:"updatePassword",j:[fh("password")]},Rc:{name:"updatePhoneNumber",j:[gh("phone")]},rb:{name:"updateProfile",j:[dh("profile")]}}),_h(jc.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),_h(Wc.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),_h(dt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),wh(xu.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",tb:ph("appVerificationDisabledForTesting")}}),_h(Fu.prototype,{confirm:{name:"confirm",j:[fh("verificationCode")]}}),Eh(Bi,"credential",function(t,e){return new qi(t,e)},[fh("email"),fh("password")]),_h(ki.prototype,{ua:{name:"addScope",j:[fh("scope")]},Da:{name:"setCustomParameters",j:[dh("customOAuthParameters")]}}),Eh(ki,"credential",Oi,[bh(fh(),dh(),"token")]),Eh(Bi,"credentialWithLink",Vi,[fh("email"),fh("emailLink")]),_h(Pi.prototype,{ua:{name:"addScope",j:[fh("scope")]},Da:{name:"setCustomParameters",j:[dh("customOAuthParameters")]}}),Eh(Pi,"credential",Li,[bh(fh(),dh(),"token")]),_h(Mi.prototype,{ua:{name:"addScope",j:[fh("scope")]},Da:{name:"setCustomParameters",j:[dh("customOAuthParameters")]}}),Eh(Mi,"credential",xi,[bh(fh(),bh(dh(),mh()),"idToken"),bh(fh(),mh(),"accessToken",!0)]),_h(Fi.prototype,{Da:{name:"setCustomParameters",j:[dh("customOAuthParameters")]}}),Eh(Fi,"credential",Ui,[bh(fh(),dh(),"token"),fh("secret",!0)]),_h(Ri.prototype,{ua:{name:"addScope",j:[fh("scope")]},credential:{name:"credential",j:[bh(fh(),mh(),"idToken",!0),bh(fh(),mh(),"accessToken",!0),bh(fh(),mh(),"nonce",!0)]},Da:{name:"setCustomParameters",j:[dh("customOAuthParameters")]}}),Eh(Qi,"credential",Hi,[fh("verificationId"),fh("verificationCode")]),_h(Qi.prototype,{Ua:{name:"verifyPhoneNumber",j:[fh("phoneNumber"),vh()]}}),_h(qr.prototype,{toJSON:{name:"toJSON",j:[fh(null,!0)]}}),_h(eo.prototype,{toJSON:{name:"toJSON",j:[fh(null,!0)]}}),_h(to.prototype,{toJSON:{name:"toJSON",j:[fh(null,!0)]}}),_h(ch.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===Yn||!Yn.INTERNAL||!Yn.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:Rc,Error:qr};Eh(t,"EmailAuthProvider",Bi,[]),Eh(t,"FacebookAuthProvider",ki,[]),Eh(t,"GithubAuthProvider",Pi,[]),Eh(t,"GoogleAuthProvider",Mi,[]),Eh(t,"TwitterAuthProvider",Fi,[]),Eh(t,"OAuthProvider",Ri,[fh("providerId")]),Eh(t,"SAMLAuthProvider",Ai,[fh("providerId")]),Eh(t,"PhoneAuthProvider",Qi,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof Rc)}}]),Eh(t,"RecaptchaVerifier",ch,[bh(fh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),dh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof Yn.app.App)}}]),Yn.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:m((t=new Rc(t)).getUid,t),getToken:m(t.cc,t),addAuthTokenListener:m(t.Vb,t),removeAuthTokenListener:m(t.Cc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),Yn.INTERNAL.extendNamespace({User:Hu})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(Gn||(Gn={}));var Xn=Gn.INFO,Jn=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Gn.DEBUG:case Gn.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Gn.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Gn.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Gn.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},$n=function(){function t(t){this.name=t,this._logLevel=Xn,this._logHandler=Jn}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Gn))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Gn.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Gn.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Gn.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Gn.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Gn.ERROR].concat(t))},t}(),Zn=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),En(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:wn(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),tr=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return Sn(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),er=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Zn(e)}}catch(t){}return new tr},nr=er("localStorage"),rr=er("sessionStorage"),ir=new $n("@firebase/database"),or=function(){var t=1;return function(){return t++}}(),sr=function(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;on(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e}(t),n=new Pn;n.update(e);var r=n.digest();return un.encodeByteArray(r)},ar=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=ar.apply(null,t[r]):"object"==typeof t[r]?n+=En(t[r]):n+=t[r],n+=" ";return n},ur=null,cr=!0,hr=function(t,e){on(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(ir.logLevel=Gn.VERBOSE,ur=ir.log.bind(ir),e&&rr.set("logging_enabled",!0)):"function"==typeof t?ur=t:(ur=null,rr.remove("logging_enabled"))},lr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===cr&&(cr=!1,null===ur&&!0===rr.get("logging_enabled")&&hr(!0)),ur){var n=ar.apply(null,t);ur(n)}},fr=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];lr.apply(void 0,[t].concat(e))}},pr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+ar.apply(void 0,t);ir.error(n)},dr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+ar.apply(void 0,t);throw ir.error(n),new Error(n)},yr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+ar.apply(void 0,t);ir.warn(n)},mr=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},gr="[MIN_NAME]",vr="[MAX_NAME]",br=function(t,e){if(t===e)return 0;if(t===gr||e===vr)return-1;if(e===gr||t===vr)return 1;var n=Nr(t),r=Nr(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},_r=function(t,e){return t===e?0:t<e?-1:1},wr=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+En(e))},Er=function(t){if("object"!=typeof t||null===t)return En(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=En(e[i]),r+=":",r+=Er(t[e[i]]);return r+="}"},Tr=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r},Sr=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;++n)e(n,t[n]);else Cn(t,function(t,n){return e(n,t)})},Ir=function(t){on(!mr(t),"Invalid JSON number");var e,n,r,i,o,s,a;for(0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074)))),s=[],o=52;o;o-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(e?1:0),s.reverse(),a=s.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(a.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()},Cr=new RegExp("^-?\\d{1,10}$"),Nr=function(t){if(Cr.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},Dr=function(t){try{t()}catch(t){setTimeout(function(){var e=t.stack||"";throw yr("Exception was thrown by user callback.",e),t},Math.floor(0))}},Ar=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Rr=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},kr=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=br(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),Or=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Vn(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Vn(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Vn(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),Pr="long_polling",Lr=function(){function t(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=nr.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&nr.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(on("string"==typeof t,"typeof type must == string"),on("object"==typeof e,"typeof params must == object"),"websocket"===t)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==Pr)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Cn(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var Mr,xr,Fr,Ur,qr,Br=function(t){var e=Vr(t),n=e.subdomain;"firebase"===e.domain&&dr(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||dr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&yr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Lr(e.host,e.secure,n,r),path:new kr(e.pathString)}},Vr=function(t){var e="",n="",r="",i="",o=!0,s="https",a=443;if("string"==typeof t){var u=t.indexOf("//");u>=0&&(s=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,h)));var l=function(t){var e={};"?"===t.charAt(0)&&(t=t.substring(1));for(var n=0,r=t.split("&");n<r.length;n++){var i=r[n];if(0!==i.length){var o=i.split("=");2===o.length?e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):yr("Invalid query segment '"+i+"' in query '"+t+"'")}}return e}(t.substring(Math.min(t.length,h)));(u=e.indexOf(":"))>=0?(o="https"===s||"wss"===s,a=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(n=f[1],r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(n="localhost"),""===r&&"ns"in l&&(r=l.ns)}return{host:e,port:a,domain:n,subdomain:r,secure:o,scheme:s,pathString:i}},Wr=/[\[\].#$\/\u0000-\u001F\u007F]/,jr=/[\[\].#$\u0000-\u001F\u007F]/,Kr=function(t){return"string"==typeof t&&0!==t.length&&!Wr.test(t)},Qr=function(t){return"string"==typeof t&&0!==t.length&&!jr.test(t)},Hr=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!mr(t)||t&&"object"==typeof t&&Sn(t,".sv")},Gr=function(t,e,n,r,i){i&&void 0===n||zr(Un(t,e,i),n,r)},zr=function(t,e,n){var r=n instanceof kr?new Or(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(mr(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>10485760/3&&Vn(e)>10485760)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(Cn(e,function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!Kr(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),zr(t,n,r),r.pop()}),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Yr=function(t,e,n,r,i){if(!i||void 0!==n){var o=Un(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var s=[];Cn(n,function(t,e){var n=new kr(t);if(zr(o,e,r.child(n)),".priority"===n.getBack()&&!Hr(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Kr(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(kr.comparePaths);var s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&s.contains(r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(o,s)}},Xr=function(t,e,n,r){if(!r||void 0!==n){if(mr(n))throw new Error(Un(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Hr(n))throw new Error(Un(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Jr=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Un(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},$r=function(t,e,n,r){if(!(r&&void 0===n||Kr(n)))throw new Error(Un(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Zr=function(t,e,n,r){if(!(r&&void 0===n||Qr(n)))throw new Error(Un(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ti=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},ei=function(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!Kr(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Qr(t)}(r))throw new Error(Un(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ni=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){Fn("OnDisconnect.cancel",0,1,arguments.length),qn("OnDisconnect.cancel",1,t,!0);var e=new pn;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){Fn("OnDisconnect.remove",0,1,arguments.length),ti("OnDisconnect.remove",this.path_),qn("OnDisconnect.remove",1,t,!0);var e=new pn;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){Fn("OnDisconnect.set",1,2,arguments.length),ti("OnDisconnect.set",this.path_),Gr("OnDisconnect.set",1,t,this.path_,!1),qn("OnDisconnect.set",2,e,!0);var n=new pn;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){Fn("OnDisconnect.setWithPriority",2,3,arguments.length),ti("OnDisconnect.setWithPriority",this.path_),Gr("OnDisconnect.setWithPriority",1,t,this.path_,!1),Xr("OnDisconnect.setWithPriority",2,e,!1),qn("OnDisconnect.setWithPriority",3,n,!0);var r=new pn;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(Fn("OnDisconnect.update",1,2,arguments.length),ti("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,yr("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Yr("OnDisconnect.update",1,t,this.path_,!1),qn("OnDisconnect.update",2,e,!0);var i=new pn;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),ri=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return Fn("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),ii=(Mr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",xr=0,Fr=[],function(t){var e,n=t===xr;xr=t;var r=new Array(8);for(e=7;e>=0;e--)r[e]=Mr.charAt(t%64),t=Math.floor(t/64);on(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;e>=0&&63===Fr[e];e--)Fr[e]=0;Fr[e]++}else for(e=0;e<12;e++)Fr[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Mr.charAt(Fr[e]);return on(20===i.length,"nextPushId: Length should be 20."),i}),oi=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),si=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new oi(gr,t),r=new oi(gr,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return oi.MIN},t}(),ai=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return Ur},set:function(t){Ur=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return br(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw sn("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return oi.MIN},e.prototype.maxPost=function(){return new oi(vr,Ur)},e.prototype.makePost=function(t,e){return on("string"==typeof t,"KeyIndex indexValue must always be a string."),new oi(t,Ur)},e.prototype.toString=function(){return".key"},e}(si),ui=new ai;var ci,hi,li,fi=function(t){return"number"==typeof t?"number:"+Ir(t):"string:"+t},pi=function(t){if(t.isLeafNode()){var e=t.val();on("string"==typeof e||"number"==typeof e||"object"==typeof e&&Sn(e,".sv"),"Priority must be a string or number.")}else on(t===qr||t.isEmpty(),"priority of unexpected type.");on(t===qr||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},di=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,on(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),pi(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return ci},set:function(t){ci=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(on(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+fi(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?Ir(this.value_):this.value_,this.lazyHash_=sr(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(on(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(n),o=t.VALUE_TYPE_ORDER.indexOf(r);return on(i>=0,"Unknown leaf type: "+n),on(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-i},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}();var yi,mi,gi=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?br(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return oi.MIN},e.prototype.maxPost=function(){return new oi(vr,new di("[PRIORITY-POST]",li))},e.prototype.makePost=function(t,e){var n=hi(t);return new oi(e,new di("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(si)),vi=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),bi=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:wi.EMPTY_NODE,this.right=null!=o?o:wi.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return wi.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return wi.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),_i=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new bi(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),wi=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,bi.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,bi.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new vi(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new vi(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new vi(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new vi(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new _i,t}(),Ei=Math.log(2),Ti=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Ei,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Si=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,s,a=r-e;if(0==a)return null;if(1==a)return o=t[e],s=n?n(o):o,new bi(s,o.node,bi.BLACK,null,null);var u=parseInt(a/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],s=n?n(o):o,new bi(s,o.node,bi.BLACK,c,h)},o=function(e){for(var r=null,o=null,s=t.length,a=function(e,r){var o=s-e,a=s;s-=e;var c=i(o+1,a),h=t[o],l=n?n(h):h;u(new bi(l,h.node,r,null,c))},u=function(t){r?(r.left=t,r=t):(o=t,r=t)},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?a(l,bi.BLACK):(a(l,bi.BLACK),a(l,bi.RED))}return o}(new Ti(t.length));return new wi(r||e,o)},Ii={},Ci=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return on(Ii&&gi,"ChildrenNode.ts has not been loaded"),yi=yi||new t({".priority":Ii},{".priority":gi})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=In(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e===Ii?null:e},t.prototype.hasIndex=function(t){return Sn(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){on(e!==ui,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],o=!1,s=n.getIterator(oi.Wrap),a=s.getNext();a;)o=o||e.isDefinedOn(a.node),i.push(a),a=s.getNext();r=o?Si(i,e.getCompare()):Ii;var u=e.toString(),c=Nn(this.indexSet_);c[u]=e;var h=Nn(this.indexes_);return h[u]=r,new t(h,c)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(Rn(this.indexes_,function(t,i){var o=In(r.indexSet_,i);if(on(o,"Missing index implementation for "+i),t===Ii){if(o.isDefinedOn(e.node)){for(var s=[],a=n.getIterator(oi.Wrap),u=a.getNext();u;)u.name!=e.name&&s.push(u),u=a.getNext();return s.push(e),Si(s,o.getCompare())}return Ii}var c=n.get(e.name),h=t;return c&&(h=h.remove(new oi(e.name,c))),h.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(Rn(this.indexes_,function(t){if(t===Ii)return t;var r=n.get(e.name);return r?t.remove(new oi(e.name,r)):t}),this.indexSet_)},t}();function Ni(t,e){return br(t.name,e.name)}function Di(t,e){return br(t,e)}var Ai=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&pi(this.priorityNode_),this.children_.isEmpty()&&on(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return mi||(mi=new t(new wi(Di),null,Ci.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||mi},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?mi:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(on(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r=new oi(e,n),i=void 0,o=void 0;return n.isEmpty()?(i=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),o=this.indexMap_.addToIndexes(r,this.children_)),new t(i,i.isEmpty()?mi:this.priorityNode_,o)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;on(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(gi,function(s,a){n[s]=a.val(e),r++,o&&t.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1}),!e&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+fi(this.getPriority().val())+":"),this.forEachChild(gi,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":sr(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new oi(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new oi(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new oi(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,oi.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,oi.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ri?-1:0},t.prototype.withIndex=function(e){if(e===ui||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===ui||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(gi),r=e.getIterator(gi),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===ui?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),Ri=new(function(t){function e(){return t.call(this,new wi(Di),Ai.EMPTY_NODE,Ci.Default)||this}return Je(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Ai.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Ai));Object.defineProperties(oi,{MIN:{value:new oi(gr,Ai.EMPTY_NODE)},MAX:{value:new oi(vr,Ri)}}),ai.__EMPTY_NODE=Ai.EMPTY_NODE,di.__childrenNodeConstructor=Ai,qr=Ri,function(t){li=t}(Ri);var ki=!0;function Oi(t,e){if(void 0===e&&(e=null),null===t)return Ai.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),on(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new di(t,Oi(e));if(t instanceof Array||!ki){var n=Ai.EMPTY_NODE,r=t;return Cn(r,function(t,e){if(Sn(r,t)&&"."!==t.substring(0,1)){var i=Oi(e);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}}),n.updatePriority(Oi(e))}var i=[],o=!1,s=t;if(Cn(s,function(t,e){if("string"!=typeof t||"."!==t.substring(0,1)){var n=Oi(s[t]);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),i.push(new oi(t,n)))}}),0==i.length)return Ai.EMPTY_NODE;var a=Si(i,Ni,function(t){return t.name},Di);if(o){var u=Si(i,gi.getCompare());return new Ai(a,Oi(e),new Ci({".priority":u},{".priority":gi}))}return new Ai(a,Oi(e),Ci.Default)}!function(t){hi=t}(Oi);var Pi,Li,Mi=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?br(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return oi.MIN},e.prototype.maxPost=function(){return oi.MAX},e.prototype.makePost=function(t,e){var n=Oi(t);return new oi(e,n)},e.prototype.toString=function(){return".value"},e}(si)),xi=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,on(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Je(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?br(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=Oi(t),r=Ai.EMPTY_NODE.updateChild(this.indexPath_,n);return new oi(e,r)},e.prototype.maxPost=function(){var t=Ai.EMPTY_NODE.updateChild(this.indexPath_,Ri);return new oi(vr,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(si),Fi=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return Fn("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return Fn("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return Fn("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return Fn("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){Fn("DataSnapshot.child",0,1,arguments.length),e=String(e),Zr("DataSnapshot.child",1,e,!1);var n=new kr(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,gi)},t.prototype.hasChild=function(t){Fn("DataSnapshot.hasChild",1,1,arguments.length),Zr("DataSnapshot.hasChild",1,t,!1);var e=new kr(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return Fn("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;return Fn("DataSnapshot.forEach",1,1,arguments.length),qn("DataSnapshot.forEach",1,e,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return e(new t(i,n.ref_.child(r),gi))})},t.prototype.hasChildren=function(){return Fn("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return Fn("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return Fn("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Ui=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+En(this.snapshot.exportVal())},t}(),qi=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Bi=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Ui("value",this,new Fi(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){on(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new qi(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Vi=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Sn(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new qi(this,t,e):null},t.prototype.createEvent=function(t,e){on(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Ui(t.type,this,new Fi(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){on(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var n=An(e.callbacks_);if(n===An(this.callbacks_)){if(1===n){var r=On(e.callbacks_),i=On(this.callbacks_);return!(i!==r||e.callbacks_[r]&&this.callbacks_[i]&&e.callbacks_[r]!==this.callbacks_[i])}return function(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&!e(n,t[n]))return!1;return!0}(this.callbacks_,function(t,n){return e.callbacks_[t]===n})}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Wi=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return on(Pi,"Reference.ts has not been loaded"),Pi},set:function(t){Pi=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===ui){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=gr)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=vr)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===gi){if(null!=e&&!Hr(e)||null!=n&&!Hr(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(on(t.getIndex()instanceof xi||t.getIndex()===Mi,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return Fn("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,i){Fn("Query.on",2,4,arguments.length),Jr("Query.on",1,e,!1),qn("Query.on",2,n,!1);var o=t.getCancelAndContextArgs_("Query.on",r,i);if("value"===e)this.onValueEvent(n,o.cancel,o.context);else{var s={};s[e]=n,this.onChildEvent(s,o.cancel,o.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new Bi(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new Vi(t,e,n);this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){Fn("Query.off",0,3,arguments.length),Jr("Query.off",1,t,!0),qn("Query.off",2,e,!0),Bn("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Bi(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Vi(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,i){var o=this;Fn("Query.once",1,4,arguments.length),Jr("Query.once",1,e,!1),qn("Query.once",2,n,!0);var s=t.getCancelAndContextArgs_("Query.once",r,i),a=!0,u=new pn;u.promise.catch(function(){});var c=function(t){a&&(a=!1,o.off(e,c),n&&n.bind(s.context)(t),u.resolve(t))};return this.on(e,c,function(t){o.off(e,c),s.cancel&&s.cancel.bind(s.context)(t),u.reject(t)}),u.promise},t.prototype.limitToFirst=function(e){if(Fn("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(Fn("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(Fn("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Zr("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new kr(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new xi(n),i=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){Fn("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(ui);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){Fn("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(gi);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){Fn("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Mi);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),Fn("Query.startAt",0,2,arguments.length),Gr("Query.startAt",1,e,this.path,!0),$r("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,n=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),Fn("Query.endAt",0,2,arguments.length),Gr("Query.endAt",1,e,this.path,!0),$r("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(Fn("Query.equalTo",1,2,arguments.length),Gr("Query.equalTo",1,t,this.path,!1),$r("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return Fn("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return Fn("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Er(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(Fn("Query.isEqual",1,1,arguments.length),!(e instanceof t)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var n=this.repo===e.repo,r=this.path.equals(e.path),i=this.queryIdentifier()===e.queryIdentifier();return n&&r&&i},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,qn(t,3,r.cancel,!0),r.context=n,Bn(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Un(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),ji=function(){function t(){this.set={}}return t.prototype.add=function(t,e){this.set[t]=null===e||e},t.prototype.contains=function(t){return Sn(this.set,t)},t.prototype.get=function(t){return this.contains(t)?this.set[t]:void 0},t.prototype.remove=function(t){delete this.set[t]},t.prototype.clear=function(){this.set={}},t.prototype.isEmpty=function(){return Dn(this.set)},t.prototype.count=function(){return An(this.set)},t.prototype.each=function(t){Cn(this.set,function(e,n){return t(e,n)})},t.prototype.keys=function(){var t=[];return Cn(this.set,function(e){t.push(e)}),t},t}(),Ki=function(){function t(){this.value_=null,this.children_=null}return t.prototype.find=function(t){if(null!=this.value_)return this.value_.getChild(t);if(t.isEmpty()||null==this.children_)return null;var e=t.getFront();return t=t.popFront(),this.children_.contains(e)?this.children_.get(e).find(t):null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value_=n,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(e,n);else{null==this.children_&&(this.children_=new ji);var r=e.getFront();this.children_.contains(r)||this.children_.add(r,new t);var i=this.children_.get(r);e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value_=null,this.children_=null,!0;if(null!==this.value_){if(this.value_.isLeafNode())return!1;var e=this.value_;this.value_=null;var n=this;return e.forEachChild(gi,function(t,e){n.remember(new kr(t),e)}),this.forget(t)}if(null!==this.children_){var r=t.getFront();if(t=t.popFront(),this.children_.contains(r))this.children_.get(r).forget(t)&&this.children_.remove(r);return!!this.children_.isEmpty()&&(this.children_=null,!0)}return!0},t.prototype.forEachTree=function(t,e){null!==this.value_?e(t,this.value_):this.forEachChild(function(n,r){var i=new kr(t.toString()+"/"+n);r.forEachTree(i,e)})},t.prototype.forEachChild=function(t){null!==this.children_&&this.children_.each(function(e,n){t(e,n)})},t}(),Qi=function(t,e){return t&&"object"==typeof t?(on(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},Hi=function(t,e){var n,r=t.getPriority().val(),i=Qi(r,e);if(t.isLeafNode()){var o=t,s=Qi(o.getValue(),e);return s!==o.getValue()||i!==o.getPriority().val()?new di(s,Oi(i)):t}var a=t;return n=a,i!==a.getPriority().val()&&(n=n.updatePriority(new di(i))),a.forEachChild(gi,function(t,r){var i=Hi(r,e);i!==r&&(n=n.updateImmediateChild(t,i))}),n};!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Li||(Li={}));var Gi,zi,Yi=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,on(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),Xi=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Li.ACK_USER_WRITE,this.source=Yi.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return on(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new kr(e));return new t(kr.Empty,n,this.revert)}return on(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),Ji=function(){return Gi||(Gi=new wi(_r)),Gi},$i=function(){function t(t,e){void 0===e&&(e=Ji()),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return Cn(e,function(t,e){n=n.set(new kr(t),e)}),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:kr.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=i?{path:new kr(n).child(i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r=e.getFront(),i=(this.children.get(r)||t.Empty).setTree(e.popFront(),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new t(this.value,o)},t.prototype.fold=function(t){return this.fold_(kr.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(t.child(r),e)}),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,kr.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,kr.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(kr.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(t.child(n),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},t.Empty=new t(null),t}(),Zi=function(){function t(t,e){this.source=t,this.path=e,this.type=Li.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,kr.Empty):new t(this.source,this.path.popFront())},t}(),to=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Li.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,kr.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),eo=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Li.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new kr(e));return n.isEmpty()?null:n.value?new to(this.source,kr.Empty,n.value):new t(this.source,kr.Empty,n)}return on(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),no=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),ro=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new no(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new no(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new no(Ai.EMPTY_NODE,!1,!1),new no(Ai.EMPTY_NODE,!1,!1)),t}(),io=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),oo=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,o){on(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=t.getImmediateChild(e);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(io.childRemovedChange(e,s)):on(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(io.childAddedChange(e,n)):o.trackChildChange(io.childChangedChange(e,n,s))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(gi,function(t,r){e.hasChild(t)||n.trackChildChange(io.childRemovedChange(t,r))}),e.isLeafNode()||e.forEachChild(gi,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(io.childChangedChange(e,r,i))}else n.trackChildChange(io.childAddedChange(e,r))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Ai.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),so=function(){function t(){this.changeMap_={}}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;on(e==io.CHILD_ADDED||e==io.CHILD_CHANGED||e==io.CHILD_REMOVED,"Only child changes supported for tracking"),on(".priority"!==n,"Only non-priority child changes can be tracked.");var r=In(this.changeMap_,n);if(r){var i=r.type;if(e==io.CHILD_ADDED&&i==io.CHILD_REMOVED)this.changeMap_[n]=io.childChangedChange(n,t.snapshotNode,r.snapshotNode);else if(e==io.CHILD_REMOVED&&i==io.CHILD_ADDED)delete this.changeMap_[n];else if(e==io.CHILD_REMOVED&&i==io.CHILD_CHANGED)this.changeMap_[n]=io.childRemovedChange(n,r.oldSnap);else if(e==io.CHILD_CHANGED&&i==io.CHILD_ADDED)this.changeMap_[n]=io.childAddedChange(n,t.snapshotNode);else{if(e!=io.CHILD_CHANGED||i!=io.CHILD_CHANGED)throw sn("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap_[n]=io.childChangedChange(n,t.snapshotNode,r.oldSnap)}}else this.changeMap_[n]=t},t.prototype.getChanges=function(){return function(t){var e=[],n=0;for(var r in t)e[n++]=t[r];return e}(this.changeMap_)},t}(),ao=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),uo=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new no(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),co=function(){return function(t,e){this.viewCache=t,this.changes=e}}(),ho=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){on(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),on(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,i){var o,s,a=new so;if(n.type===Li.OVERWRITE){var u=n;u.source.fromUser?o=this.applyUserOverwrite_(e,u.path,u.snap,r,i,a):(on(u.source.fromServer,"Unknown source."),s=u.source.tagged||e.getServerCache().isFiltered()&&!u.path.isEmpty(),o=this.applyServerOverwrite_(e,u.path,u.snap,r,i,s,a))}else if(n.type===Li.MERGE){var c=n;c.source.fromUser?o=this.applyUserMerge_(e,c.path,c.children,r,i,a):(on(c.source.fromServer,"Unknown source."),s=c.source.tagged||e.getServerCache().isFiltered(),o=this.applyServerMerge_(e,c.path,c.children,r,i,s,a))}else if(n.type===Li.ACK_USER_WRITE){var h=n;o=h.revert?this.revertUserWrite_(e,h.path,r,i,a):this.ackUserWrite_(e,h.path,h.affectedTree,r,i,a)}else{if(n.type!==Li.LISTEN_COMPLETE)throw sn("Unknown operation type: "+n.type);o=this.listenComplete_(e,n.path,r,a)}var l=a.getChanges();return t.maybeAddValueEvent_(e,o,l),new co(o,l)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(io.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var s=void 0,a=void 0;if(e.isEmpty())if(on(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof Ai?u:Ai.EMPTY_NODE,h=n.calcCompleteEventChildren(c);s=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());s=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){on(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();a=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,a);s=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){a=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),a);m=null!=g?o.getNode().getImmediateChild(f).updateChild(y,g):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());s=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(s,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,s){var a,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())a=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);a=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&e.getLength()>1)return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);a=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,ao,null)}var d=t.updateServerSnap(a,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new uo(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,s)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var s,a,u=t.getEventCache(),c=new uo(r,t,i);if(e.isEmpty())a=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),s=t.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)a=this.filter_.updatePriority(t.getEventCache().getNode(),n),s=t.updateEventSnap(a,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Ai.EMPTY_NODE}if(f.equals(p))s=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);s=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return s},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,o,s){var a=this,u=e;return r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())&&(u=a.applyUserOverwrite_(u,h,c,i,o,s))}),r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())||(u=a.applyUserOverwrite_(u,h,c,i,o,s))}),u},t.prototype.applyMerge_=function(t,e){return e.foreach(function(e,n){t=t.updateChild(e,n)}),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,s){var a=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:$i.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal(function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=a.applyMerge_(u,n);c=a.applyServerOverwrite_(c,new kr(e),l,r,i,o,s)}}),u.children.inorderTraversal(function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=a.applyMerge_(l,n);c=a.applyServerOverwrite_(c,new kr(e),f,r,i,o,s)}}),c},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var s=t.getServerCache().isFiltered(),a=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,a.getNode().getChild(e),r,i,s,o);if(e.isEmpty()){var u=$i.Empty;return a.getNode().forEachChild(ui,function(t,e){u=u.set(new kr(t),e)}),this.applyServerMerge_(t,e,u,r,i,s,o)}return t}var c=$i.Empty;return n.foreach(function(t,n){var r=e.child(t);a.isCompleteForPath(r)&&(c=c.set(t,a.getNode().getChild(r)))}),this.applyServerMerge_(t,e,c,r,i,s,o)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,ao,r)},t.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var s=new uo(n,t,r),a=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();on(h instanceof Ai,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(a,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=a.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(a,l,f,e.popFront(),s,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(a,l,Ai.EMPTY_NODE,e.popFront(),s,i):a).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(kr.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},t}(),lo=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===io.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(io.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,io.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,io.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,io.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,io.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,io.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,s=n.filter(function(t){return t.type===e});s.sort(this.compareChanges_.bind(this)),s.forEach(function(e){var n=o.materializeSingleChange_(e,i);r.forEach(function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type?t:(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_),t)},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw sn("Should only compare child_ events.");var n=new oi(t.childName,t.snapshotNode),r=new oi(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),fo=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new oo(n.getIndex()),i=n.getNodeFilter();this.processor_=new ho(i);var o=e.getServerCache(),s=e.getEventCache(),a=r.updateFullNode(Ai.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ai.EMPTY_NODE,s.getNode(),null),c=new no(a,o.isFullyInitialized(),r.filtersNodes()),h=new no(u,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=new ro(h,c),this.eventGenerator_=new lo(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){on(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)})}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===Li.MERGE&&null!==t.source.queryId&&(on(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),on(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),on(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(gi,function(t,e){n.push(io.childAddedChange(t,e))});return e.isFullyInitialized()&&n.push(io.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),po=function(){function t(){this.views_={}}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return on(zi,"Reference.ts has not been loaded"),zi},set:function(t){on(!zi,"__referenceConstructor has already been defined"),zi=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return Dn(this.views_)},t.prototype.applyOperation=function(t,e,n){var r=t.source.queryId;if(null!==r){var i=In(this.views_,r);return on(null!=i,"SyncTree gave us an op for an invalid query."),i.applyOperation(t,e,n)}var o=[];return Cn(this.views_,function(r,i){o=o.concat(i.applyOperation(t,e,n))}),o},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),s=In(this.views_,o);if(!s){var a=n.calcCompleteEventCache(i?r:null),u=!1;a?u=!0:r instanceof Ai?(a=n.calcCompleteEventChildren(r),u=!1):(a=Ai.EMPTY_NODE,u=!1);var c=new ro(new no(a,u,!1),new no(r,i,!1));s=new fo(t,c),this.views_[o]=s}return s.addEventRegistration(e),s.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var i=e.queryIdentifier(),o=[],s=[],a=this.hasCompleteView();if("default"===i){var u=this;Cn(this.views_,function(t,e){s=s.concat(e.removeEventRegistration(n,r)),e.isEmpty()&&(delete u.views_[t],e.getQuery().getQueryParams().loadsAllData()||o.push(e.getQuery()))})}else{var c=In(this.views_,i);c&&(s=s.concat(c.removeEventRegistration(n,r)),c.isEmpty()&&(delete this.views_[i],c.getQuery().getQueryParams().loadsAllData()||o.push(c.getQuery())))}return a&&!this.hasCompleteView()&&o.push(new t.__referenceConstructor(e.repo,e.path)),{removed:o,events:s}},t.prototype.getQueryViews=function(){var t=this;return Object.keys(this.views_).map(function(e){return t.views_[e]}).filter(function(t){return!t.getQuery().getQueryParams().loadsAllData()})},t.prototype.getCompleteServerCache=function(t){var e=null;return Cn(this.views_,function(n,r){e=e||r.getCompleteServerCache(t)}),e},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return In(this.views_,e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e,n;return(t=this.views_,(n=kn(t,function(t){return t.getQuery().getQueryParams().loadsAllData()},e))&&t[n])||null},t}(),yo=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new $i(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,s=kr.relativePath(i,e);return o=o.updateChild(s,n),new t(this.writeTree_.set(i,o))}var a=new $i(n);return new t(this.writeTree_.setTree(e,a))},t.prototype.addWrites=function(t,e){var n=this;return Cn(e,function(e,r){n=n.addWrite(t.child(e),r)}),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,$i.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(kr.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(gi,function(e,n){t.push(new oi(e,n))}):this.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new oi(e,n.value))}),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new $i(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(e){return t.applySubtreeWrite_(kr.Empty,this.writeTree_,e)},t.Empty=new t(new $i(null)),t.applySubtreeWrite_=function(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(on(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t.applySubtreeWrite_(e.child(n),o,r)}),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r},t}(),mo=function(){function t(){this.visibleWrites_=yo.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new go(t,this)},t.prototype.addOverwrite=function(t,e,n,r){on(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){on(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex(function(e){return e.writeId===t});on(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,s=this.allWrites_.length-1;i&&s>=0;){var a=this.allWrites_[s];a.visible&&(s>=n&&this.recordContainsPath_(a,r.path)?i=!1:r.path.contains(a.path)&&(o=!0)),s--}if(i){if(o)return this.resetTree_(),!0;if(r.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(r.path);else{var u=r.children;Cn(u,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})}return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(kr.Empty)){var s=t.layerTree_(this.allWrites_,function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);c=n||Ai.EMPTY_NODE;return s.apply(c)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var u=this.visibleWrites_.childCompoundWrite(e);if(u.isEmpty())return n;if(null!=n||u.hasCompleteWrite(kr.Empty)){var c=n||Ai.EMPTY_NODE;return u.apply(c)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=Ai.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(gi,function(t,e){n=n.updateImmediateChild(t,e)}),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(gi,function(t,e){var r=i.childCompoundWrite(new kr(t)).apply(e);n=n.updateImmediateChild(t,r)}),i.getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){on(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var s,a=this.visibleWrites_.childCompoundWrite(t),u=a.getCompleteNode(kr.Empty);if(null!=u)s=u;else{if(null==e)return[];s=a.apply(e)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?s.getReverseIteratorFrom(n,o):s.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},t.prototype.recordContainsPath_=function(t,e){return t.snap?t.path.contains(e):!!kn(t.children,function(n,r){return t.path.child(r).contains(e)})},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,kr.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=yo.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var s=o.path,a=void 0;if(o.snap)n.contains(s)?(a=kr.relativePath(n,s),r=r.addWrite(a,o.snap)):s.contains(n)&&(a=kr.relativePath(s,n),r=r.addWrite(kr.Empty,o.snap.getChild(a)));else{if(!o.children)throw sn("WriteRecord should have .snap or .children");if(n.contains(s))a=kr.relativePath(n,s),r=r.addWrites(a,o.children);else if(s.contains(n))if((a=kr.relativePath(s,n)).isEmpty())r=r.addWrites(kr.Empty,o.children);else{var u=In(o.children,a.getFront());if(u){var c=u.getChild(a.popFront());r=r.addWrite(kr.Empty,c)}}}}}return r},t}(),go=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),vo=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=$i.Empty,this.pendingWriteTree_=new mo,this.tagToQueryMap_={},this.queryToTagMap_={}}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new to(Yi.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=$i.fromObject(e);return this.applyOperationToSyncPoints_(new eo(Yi.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=$i.Empty;return null!=n.snap?r=r.set(kr.Empty,!0):Cn(n.children,function(t,e){r=r.set(new kr(t),e)}),this.applyOperationToSyncPoints_(new Xi(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new to(Yi.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=$i.fromObject(e);return this.applyOperationToSyncPoints_(new eo(Yi.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new Zi(Yi.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,u=kr.relativePath(s,e),c=new to(Yi.forServerTaggedQuery(a),u,n);return this.applyTaggedOperation_(s,c)}return[]},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var o=t.parseQueryKey_(i),s=o.path,a=o.queryId,u=kr.relativePath(s,e),c=$i.fromObject(n),h=new eo(Yi.forServerTaggedQuery(a),u,c);return this.applyTaggedOperation_(s,h)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),o=i.path,s=i.queryId,a=kr.relativePath(o,e),u=new Zi(Yi.forServerTaggedQuery(s),a);return this.applyTaggedOperation_(o,u)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=kr.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var s,a=this.syncPointTree_.get(r);(a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(kr.Empty)):(a=new po,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i)?s=!0:(s=!1,i=Ai.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(kr.Empty);n&&(i=i.updateImmediateChild(t,n))}));var u=a.viewExistsForQuery(e);if(!u&&!e.getQueryParams().loadsAllData()){var c=t.makeQueryKey_(e);on(!(c in this.queryToTagMap_),"View does not exist, but we have a tag");var h=t.getNextQueryTag_();this.queryToTagMap_[c]=h,this.tagToQueryMap_["_"+h]=c}var l=this.pendingWriteTree_.childWrites(r),f=a.addEventRegistration(e,n,l,i,s);if(!u&&!o){var p=a.viewForQuery(e);f=f.concat(this.setupListener_(e,p))}return f},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,s=this.syncPointTree_.get(o),a=[];if(s&&("default"===e.queryIdentifier()||s.viewExistsForQuery(e))){var u=s.removeEventRegistration(e,n,r);s.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var c=u.removed;a=u.events;var h=-1!==c.findIndex(function(t){return t.getQueryParams().loadsAllData()}),l=this.syncPointTree_.findOnPath(o,function(t,e){return e.hasCompleteView()});if(h&&!l){var f=this.syncPointTree_.subtree(o);if(!f.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(f),d=0;d<p.length;++d){var y=p[d],m=y.getQuery(),g=this.createListenerForView_(y);this.listenProvider_.startListening(t.queryForListening_(m),this.tagForQuery_(m),g.hashFn,g.onComplete)}}if(!l&&c.length>0&&!r)if(h){this.listenProvider_.stopListening(t.queryForListening_(e),null)}else c.forEach(function(e){var n=i.queryToTagMap_[t.makeQueryKey_(e)];i.listenProvider_.stopListening(t.queryForListening_(e),n)});this.removeTags_(c)}return a},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,function(e,n){var r=kr.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Cn(n,function(t,e){r=r.concat(e)}),r})},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap_[i];delete this.queryToTagMap_[i],delete this.tagToQueryMap_["_"+o]}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,i=this.tagForQuery_(e),o=this.createListenerForView_(n),s=this.listenProvider_.startListening(t.queryForListening_(e),i,o.hashFn,o.onComplete),a=this.syncPointTree_.subtree(r);if(i)on(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Cn(n,function(t,e){r=r.concat(e)}),r}),c=0;c<u.length;++c){var h=u[c];this.listenProvider_.stopListening(t.queryForListening_(h),this.tagForQuery_(h))}return s},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Ai.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return on(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new kr(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap_["_"+t]},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return In(this.queryToTagMap_,n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);on(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(kr.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(kr.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(kr.Empty));var o=[],s=t.path.getFront(),a=t.operationForChild(s),u=e.children.get(s);if(u&&a){var c=n?n.getImmediateChild(s):null,h=r.child(s);o=o.concat(this.applyOperationHelper_(a,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(kr.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(kr.Empty));var s=[];return e.children.inorderTraversal(function(e,o){var a=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(s=s.concat(i.applyOperationDescendantsHelper_(c,o,a,u)))}),o&&(s=s.concat(o.applyOperation(t,r,n))),s},t.nextQueryTag_=1,t}(),bo=function(){function t(){this.rootNode_=Ai.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),_o=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(lr("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',yr(t)},t}(),wo=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Sn(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return hn(this.counters_)},t}(),Eo=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new wo),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),To=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=Nn(t);return this.last_&&Cn(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},t}(),So=1e4,Io=3e4,Co=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new To(t);var n=So+(Io-So)*Math.random();Rr(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;Cn(e,function(e,i){i>0&&Sn(t.statsToReport_,e)&&(n[e]=i,r=!0)}),r&&this.server_.reportStats(n),Rr(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),No=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Do(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Do=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();ur&&lr("event: "+e.toString()),Dr(n)}}},t.prototype.getPath=function(){return this.path_},t}(),Ao=function(){function t(t){this.allowedEvents_=t,this.listeners_={},on(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=this.listeners_[t].slice(),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){on(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),Ro=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))},!1),r}return Je(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return on("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(Ao),ko=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||dn()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return Je(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return on("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(Ao),Oo=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&Dr(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},t}(),Po="pLPCommand",Lo="pRTLPCB",Mo=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=fr(t),this.stats_=Eo.getCollection(e),this.urlFn=function(t){return e.connectionURL(Pr,t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Oo(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(mn()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new xo(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1],o=t[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==r)n.id=i,n.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(i,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(r,i)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),!mn()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!mn()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=En(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n,r=(n=an(e),un.encodeByteArray(n,!0)),i=Tr(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!mn()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=En(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),xo=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new ji,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,mn())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=or(),window[Po+this.uniqueCallbackIdentifier]=e,window[Lo+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(t){lr("frame writing exception"),t.stack&&lr(t.stack),lr(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||lr("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var e=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0))),mn()&&this.myID){var n={disconn:"t"};n.id=this.myID,n.pw=this.myPW;var r=this.urlFn(n);t.nodeRestRequest(r)}var i=this.onDisconnect;i&&(this.onDisconnect=null,i())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e,1);var r=function(){n.outstandingRequests.remove(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},t.prototype.addTag=function(t,e){var n=this;mn()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){lr("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}},Math.floor(1))},t}(),Fo=null;"undefined"!=typeof MozWebSocket?Fo=MozWebSocket:"undefined"!=typeof WebSocket&&(Fo=WebSocket);var Uo=function(){function t(e,n,r,i){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=fr(this.connId),this.stats_=Eo.getCollection(n),this.connURL=t.connectionURL_(n,r,i)}return t.connectionURL_=function(t,e,n){var r={v:"5"};return!mn()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL("websocket",r)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,nr.set("previous_websocket_failure",!0);try{if(mn()){var r=nn?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+Yn.SDK_VERSION+"/"+process.platform+"/"+r}},o=process.env,s=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;s&&(i.proxy={origin:s}),this.mySock=new Fo(this.connURL,[],i)}else this.mySock=new Fo(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var a=t.message||t.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Fo&&!t.forceDisallow_},t.previouslyFailed=function(){return nr.isInMemoryStorage||!0===nr.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){nr.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=wn(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(on(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=En(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Tr(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),qo=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[Mo,Uo]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var n=Uo&&Uo.isAvailable(),r=n&&!Uo.previouslyFailed();if(e.webSocketOnly&&(n||yr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Uo];else{var i=this.transports_=[];Sr(t.ALL_TRANSPORTS,function(t,e){e&&e.isAvailable()&&i.push(e)})}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),Bo=function(){function t(t,e,n,r,i,o,s){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=s,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=fr("c:"+this.id+":"),this.transportManager_=new qo(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Rr(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=wr("t",t),n=wr("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=wr("t",t),n=wr("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=wr("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?pr("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):pr("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&yr("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Rr(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Rr(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(nr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Vo=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Wo=1e3,jo=3e5,Ko=function(t){function e(n,r,i,o,s,a){var u=t.call(this)||this;if(u.repoInfo_=n,u.onDataUpdate_=r,u.onConnectStatus_=i,u.onServerInfoUpdate_=o,u.authTokenProvider_=s,u.authOverride_=a,u.id=e.nextPersistentConnectionId_++,u.log_=fr("p:"+u.id+":"),u.interruptReasons_={},u.listens_={},u.outstandingPuts_=[],u.outstandingPutCount_=0,u.onDisconnectRequestQueue_=[],u.connected_=!1,u.reconnectDelay_=Wo,u.maxReconnectDelay_=jo,u.securityDebugCallback_=null,u.lastSessionId=null,u.establishConnectionTimer_=null,u.visible_=!1,u.requestCBHash_={},u.requestNumber_=0,u.realtime_=null,u.authToken_=null,u.forceTokenRefresh_=!1,u.invalidAuthTokenCount_=0,u.firstConnection_=!0,u.lastConnectionAttemptTime_=null,u.lastConnectionEstablishedTime_=null,a&&!mn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return u.scheduleConnect_(0),Ro.getInstance().on("visible",u.onVisible_,u),-1===n.host.indexOf("fblocal")&&ko.getInstance().on("online",u.onOnline_,u),u}return Je(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(En(i)),on(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},e.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens_[o]=this.listens_[o]||{},on(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),on(!this.listens_[o][i],"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:e,query:t,tag:n};this.listens_[o][i]=s,this.connected_&&this.sendListen_(s)},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var s={p:i};t.tag&&(s.q=r.queryObject(),s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,function(s){var a=s.d,u=s.s;e.warnOnListenWarnings_(a,r),(n.listens_[i]&&n.listens_[i][o])===t&&(n.log_("listen response",s),"ok"!==u&&n.removeListen_(i,o),t.onComplete&&t.onComplete(u,a))})},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Sn(t,"w")){var n=In(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();yr("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){var e;(t&&40===t.length||"object"==typeof(e=Tn(t).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t,e=this;if(this.connected_&&this.authToken_){var n=this.authToken_,r=(t=Tn(n).claims)&&"object"==typeof t&&t.hasOwnProperty("iat")?"auth":"gauth",i={cred:n};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(r,i,function(t){var r=t.s,i=t.d||"error";e.authToken_===n&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),on(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+En(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):pr("Unrecognized action received from server: "+En(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;on(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Wo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Wo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Wo),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,o=this,s=this.lastSessionId,a=!1,u=null,c=function(){u?u.close():(a=!0,r())};this.realtime_={close:c,sendRequest:function(t){on(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then(function(e){a?lr("getToken() completed but was canceled"):(lr("getToken() completed. Creating connection."),o.authToken_=e&&e.accessToken,u=new Bo(i,o.repoInfo_,t,n,r,function(t){yr(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},s))}).then(null,function(t){o.log_("Failed to get token: "+t),a||(nn&&yr(t),c())})}},e.prototype.interrupt=function(t){lr("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){lr("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Dn(this.interruptReasons_)&&(this.reconnectDelay_=Wo,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Er(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new kr(t).toString();return void 0!==this.listens_[r]?(n=this.listens_[r][e],delete this.listens_[r][e],0===An(this.listens_[r])&&delete this.listens_[r]):n=void 0,n},e.prototype.onAuthRevoked_=function(t,e){lr("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t=this;this.tryAuth(),Cn(this.listens_,function(e,n){Cn(n,function(e,n){t.sendListen_(n)})});for(var e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";nn?e="admin_node":en&&(e="node"),t["sdk."+e+"."+Yn.SDK_VERSION.replace(/\./g,"-")]=1,dn()?t["framework.cordova"]=1:yn()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=ko.getInstance().currentlyOnline();return Dn(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Vo),Qo=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=fr("p:rest:"),i.listens_={},i}return Je(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(on(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,i){var o=this,s=t.path.toString();this.log_("Listen called for "+s+" "+t.queryIdentifier());var a=e.getListenId_(t,r),u={};this.listens_[a]=u;var c=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",c,function(t,e){var n=e;(404===t&&(n=null,t=null),null===t&&o.onDataUpdate_(s,n,!1,r),In(o.listens_,a)===u)&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var o=i&&i.accessToken;o&&(e.auth=o);var s,a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+(s=[],Cn(e,function(t,e){Array.isArray(e)?e.forEach(function(e){s.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):s.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),s.length?"&"+s.join("&"):"");r.log_("Sending REST request for "+a);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+a+" received. status:",u.status,"response:",u.responseText);var t=null;if(u.status>=200&&u.status<300){try{t=wn(u.responseText)}catch(t){yr("Failed to parse JSON response for "+a+": "+u.responseText)}n(null,t)}else 401!==u.status&&404!==u.status&&yr("Got unsuccessful REST response for "+a+" Status: "+u.status),n(u.status);n=null}},u.open("GET",a,!0),u.send()})},e}(Vo),Ho=function(){function t(t,e,n){var r=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new No,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Ki,this.persistentConnection_=null;var i=new _o(n);if(this.stats_=Eo.getCollection(t),e||Ar())this.server_=new Qo(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(void 0!==o&&null!==o){if("object"!=typeof o)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{En(o)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Ko(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,o),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(t){r.server_.refreshAuthToken(t)}),this.statsReporter_=Eo.getOrCreateReporter(t,function(){return new Co(r.stats_,r.server_)}),this.transactions_init_(),this.infoData_=new bo,this.infoSyncTree_=new vo({startListening:function(t,e,n,i){var o=[],s=r.infoData_.getNode(t.path);return s.isEmpty()||(o=r.infoSyncTree_.applyServerOverwrite(t.path,s),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new vo({startListening:function(t,e,n,i){return r.server_.listen(t,n,e,function(e,n){var o=i(e,n);r.eventQueue_.raiseEventsForChangedPath(t.path,o)}),[]},stopListening:function(t,e){r.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new kr(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new kr(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var s=Rn(e,function(t){return Oi(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r)}else{var a=Oi(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,a,r)}else if(n){var u=Rn(e,function(t){return Oi(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Oi(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;o.length>0&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;Sr(t,function(t,n){e.updateInfo_(n,t)})},t.prototype.updateInfo_=function(t,e){var n=new kr("/.info/"+t),r=Oi(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),s=Oi(e,n),a=Hi(s,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,a,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),s.val(!0),function(e,n){var o="ok"===e;o||yr("set at "+t+" failed: "+e);var s=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,s),i.callOnCompleteCallback(r,e,n)});var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),s={};if(Cn(e,function(t,e){i=!1;var n=Oi(e);s[t]=Hi(n,o)}),i)lr("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var a=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,s,a);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,function(e,i){var o="ok"===e;o||yr("update at "+t+" failed: "+e);var s=r.serverSyncTree_.ackUserWrite(a,!o),u=s.length>0?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,s),r.callOnCompleteCallback(n,e,i)}),Cn(e,function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=[];(function(t,e){var n=new Ki;return t.forEachTree(new kr(""),function(t,r){n.remember(t,Hi(r,e))}),n})(this.onDisconnect_,e).forEachTree(kr.Empty,function(e,r){n=n.concat(t.serverSyncTree_.applyServerOverwrite(e,r));var i=t.abortTransactions_(e);t.rerunTransactions_(i)}),this.onDisconnect_=new Ki,this.eventQueue_.raiseEventsForChangedPath(kr.Empty,n)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)})},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Oi(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)})},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Oi(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)})},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(Dn(e))return lr("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(i,o){"ok"===i&&Cn(e,function(e,n){var i=Oi(n);r.onDisconnect_.remember(t.child(e),i)}),r.callOnCompleteCallback(n,i,o)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new To(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var n=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Cn(e,function(t,e){for(var r=t.length;r<n+2;r++)t+=" ";console.log(t+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),lr.apply(void 0,[n].concat(t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&Dr(function(){if("ok"==e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new ns(this))},enumerable:!0,configurable:!0}),t}(),Go=function(){function t(e){this.indexedFilter_=new oo(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new oi(e,n))||(n=Ai.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Ai.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Ai.EMPTY_NODE);var i=this;return e.forEachChild(gi,function(t,e){i.matches(new oi(t,e))||(r=r.updateImmediateChild(t,Ai.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),zo=function(){function t(t){this.rangedFilter_=new Go(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new oi(e,n))||(n=Ai.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Ai.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Ai.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Ai.EMPTY_NODE);var a=void 0,u=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();){s=i.getNext();!l&&c(a,s)<=0&&(l=!0),l&&o<this.limit_&&c(s,u)<=0?o++:r=r.updateImmediateChild(s.name,Ai.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(t,e){return s(e,t)}}else o=this.index_.getCompare();var a=t;on(a.numChildren()==this.limit_,"");var u=new oi(e,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(a.hasChild(e)){for(var l=a.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||a.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&p>=0)return null!=i&&i.trackChildChange(io.childChangedChange(e,n,l)),a.updateImmediateChild(e,n);null!=i&&i.trackChildChange(io.childRemovedChange(e,l));var d=a.updateImmediateChild(e,Ai.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(io.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&o(c,u)>=0?(null!=i&&(i.trackChildChange(io.childRemovedChange(c.name,c.node)),i.trackChildChange(io.childAddedChange(e,n))),a.updateImmediateChild(e,n).updateImmediateChild(c.name,Ai.EMPTY_NODE)):t},t}(),Yo=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=gi}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return on(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return on(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:gr},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return on(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return on(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:vr},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return on(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==gi&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==gi},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new oo(this.getIndex()):this.hasLimit()?new zo(this):new Go(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()?r:(this.index_===gi?e=n.PRIORITY_INDEX:this.index_===Mi?e=n.VALUE_INDEX:this.index_===ui?e=n.KEY_INDEX:(on(this.index_ instanceof xi,"Unrecognized index type!"),e=this.index_.toString()),r[n.ORDER_BY]=En(e),this.startSet_&&(r[n.START_AT]=En(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+En(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=En(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+En(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_),r)},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),Xo=function(t){function e(e,n){if(!(e instanceof Ho))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,Yo.DEFAULT,!1)||this}return Je(e,t),e.prototype.getKey=function(){return Fn("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return Fn("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof kr||(null===this.path.getFront()?function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Zr(t,e,n,r)}("Reference.child",1,t,!1):Zr("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){Fn("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){Fn("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){Fn("Reference.set",1,2,arguments.length),ti("Reference.set",this.path),Gr("Reference.set",1,t,this.path,!1),qn("Reference.set",2,e,!0);var n=new pn;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(Fn("Reference.update",1,2,arguments.length),ti("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,yr("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Yr("Reference.update",1,t,this.path,!1),qn("Reference.update",2,e,!0);var i=new pn;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,n){if(Fn("Reference.setWithPriority",2,3,arguments.length),ti("Reference.setWithPriority",this.path),Gr("Reference.setWithPriority",1,t,this.path,!1),Xr("Reference.setWithPriority",2,e,!1),qn("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new pn;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return Fn("Reference.remove",0,1,arguments.length),ti("Reference.remove",this.path),qn("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(Fn("Reference.transaction",1,3,arguments.length),ti("Reference.transaction",this.path),qn("Reference.transaction",1,t,!1),qn("Reference.transaction",2,e,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Un(t,e,r)+"must be a boolean.")}("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new pn;"function"==typeof e&&r.promise.catch(function(){});return this.repo.startTransaction(this.path,t,function(t,n,i){t?r.reject(t):r.resolve(new ri(n,i)),"function"==typeof e&&e(t,n,i)},n),r.promise},e.prototype.setPriority=function(t,e){Fn("Reference.setPriority",1,2,arguments.length),ti("Reference.setPriority",this.path),Xr("Reference.setPriority",1,t,!1),qn("Reference.setPriority",2,e,!0);var n=new pn;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){Fn("Reference.push",0,2,arguments.length),ti("Reference.push",this.path),Gr("Reference.push",1,t,this.path,!0),qn("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=ii(r),o=this.child(i),s=this.child(i);return n=null!=t?o.set(t,e).then(function(){return s}):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},e.prototype.onDisconnect=function(){return ti("Reference.onDisconnect",this.path),new ni(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}(Wi);Wi.__referenceConstructor=Xo,po.__referenceConstructor=Xo;var Jo,$o=function(){return function(){this.children={},this.childCount=0,this.value=null}}(),Zo=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new $o),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n,r=e instanceof kr?e:new kr(e),i=this;null!==(n=r.getFront());){i=new t(n,i,In(i.node_.children,n)||new $o),r=r.popFront()}return i},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){on(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;Cn(this.node_.children,function(r,i){e(new t(r,n,i))})},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,n)}),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},t.prototype.path=function(){return new kr(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Sn(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();!function(t){t[t.RUN=0]="RUN",t[t.SENT=1]="SENT",t[t.COMPLETED=2]="COMPLETED",t[t.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",t[t.NEEDS_ABORT=4]="NEEDS_ABORT"}(Jo||(Jo={})),Ho.MAX_TRANSACTION_RETRIES_=25,Ho.prototype.transactions_init_=function(){this.transactionQueueTree_=new Zo},Ho.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},o=new Xo(this,t);o.on("value",i);var s={path:t,update:e,onComplete:n,status:null,order:or(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=this.getLatestState_(t);s.currentInputSnapshot=a;var u=s.update(a.val());if(void 0===u){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var c=new Fi(s.currentInputSnapshot,new Xo(this,s.path),gi);s.onComplete(null,!1,c)}}else{zr("transaction failed: Data returned ",u,s.path),s.status=Jo.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(s),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&Sn(u,".priority"))f=In(u,".priority"),on(Hr(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||Ai.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=Oi(u,f),y=Hi(d,p);s.currentOutputSnapshotRaw=d,s.currentOutputSnapshotResolved=y,s.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Ho.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Ai.EMPTY_NODE},Ho.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);on(n.length>0,"Sending zero length transaction queue"),n.every(function(t){return t.status===Jo.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Ho.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map(function(t){return t.currentWriteId}),i=this.getLatestState_(t,r),o=i,s=i.hash(),a=0;a<e.length;a++){var u=e[a];on(u.status===Jo.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=Jo.SENT,u.retryCount++;var c=kr.relativePath(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),l=t;this.server_.put(l.toString(),h,function(r){n.log_("transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=0;s<e.length;s++){if(e[s].status=Jo.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[s].currentWriteId)),e[s].onComplete){var a=e[s].currentOutputSnapshotResolved,u=new Xo(n,e[s].path),c=new Fi(a,u,gi);o.push(e[s].onComplete.bind(null,null,!0,c))}e[s].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i);for(s=0;s<o.length;s++)Dr(o[s])}else{if("datastale"===r)for(s=0;s<e.length;s++)e[s].status===Jo.SENT_NEEDS_ABORT?e[s].status=Jo.NEEDS_ABORT:e[s].status=Jo.RUN;else{yr("transaction at "+l.toString()+" failed: "+r);for(s=0;s<e.length;s++)e[s].status=Jo.NEEDS_ABORT,e[s].abortReason=r}n.rerunTransactions_(t)}},s)},Ho.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Ho.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===Jo.RUN}).map(function(t){return t.currentWriteId}),s=0;s<t.length;s++){var a=t[s],u=kr.relativePath(e,a.path),c=!1,h=void 0;if(on(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===Jo.NEEDS_ABORT)c=!0,h=a.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===Jo.RUN)if(a.retryCount>=Ho.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var l=this.getLatestState_(a.path,o);a.currentInputSnapshot=l;var f=t[s].update(l.val());if(void 0!==f){zr("transaction failed: Data returned ",f,a.path);var p=Oi(f);"object"==typeof f&&null!=f&&Sn(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=a.currentWriteId,y=this.generateServerValues(),m=Hi(p,y);a.currentOutputSnapshotRaw=p,a.currentOutputSnapshotResolved=m,a.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(a.path,m,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[s].status=Jo.COMPLETED,n=t[s].unwatcher,setTimeout(n,Math.floor(0)),t[s].onComplete))if("nodata"===h){var g=new Xo(this,t[s].path),v=t[s].currentInputSnapshot,b=new Fi(v,g,gi);r.push(t[s].onComplete.bind(null,null,!1,b))}else r.push(t[s].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(s=0;s<r.length;s++)Dr(r[s]);this.sendReadyTransactions_()}},Ho.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Ho.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Ho.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Ho.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Jo.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(n.length>0?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Ho.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Ho.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===Jo.SENT_NEEDS_ABORT);else if(e[o].status===Jo.SENT)on(i===o-1,"All SENT items should be at beginning of queue."),i=o,e[o].status=Jo.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(on(e[o].status===Jo.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)Dr(n[o])}};var ts,es=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return ts||(ts=new t),ts},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var n=e||t.options.databaseURL;void 0===n&&dr("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var r=Br(n),i=r.repoInfo;return ei("Invalid Firebase Database URL",1,r),r.path.isEmpty()||dr("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=In(this.repos_,t.app.name);e&&In(e,t.repoInfo_.toURLString())===t||dr("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var n=In(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=In(n,t.toURLString());return r&&dr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Ho(t,this.useRestClient_,e),n[t.toURLString()]=r,r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),ns=function(){function t(t){this.repo_=t,t instanceof Ho||dr("Don't call new Database() directly - please use firebase.database()."),this.root_=new Xo(t,kr.Empty),this.INTERNAL=new rs(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),Fn("database.ref",0,1,arguments.length),t instanceof Xo?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Fn(e,1,1,arguments.length);var n=Br(t);ei(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&dr(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&dr("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){Fn("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){Fn("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),rs=function(){function t(t){this.database=t}return t.prototype.delete=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.database.checkDeleted_("delete"),es.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),is=Object.freeze({forceLongPolling:function(){Uo.forceDisallow(),Mo.forceAllow()},forceWebSockets:function(){Mo.forceDisallow()},isWebSocketsAvailable:function(){return Uo.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),os=Ko;Ko.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Ko.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var ss,as=Bo,us=Lr,cs=Object.freeze({DataConnection:os,RealTimeConnection:as,hijackHash:function(t){var e=Ko.prototype.put;return Ko.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Ko.prototype.put=e}},ConnectionTarget:us,queryIdentifier:function(t){return t.queryIdentifier()},listens:function(t){return t.repo.persistentConnection_.listens_},forceRestClient:function(t){es.getInstance().forceRestClient(t)}}),hs=ns.ServerValue;ss=Yn.INTERNAL.registerService("database",function(t,e,n){return es.getInstance().databaseFromApp(t,n)},{Reference:Xo,Query:Wi,Database:ns,enableLogging:hr,INTERNAL:is,ServerValue:hs,TEST_ACCESS:cs},null,!0),mn()&&(module.exports=ss);var ls,fs="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ps=ps||{},ds=fs;function ys(t){return"string"==typeof t}function ms(t,e){t=t.split("."),e=e||ds;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function gs(){}function vs(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function bs(t){return"array"==vs(t)}function _s(t){var e=vs(t);return"array"==e||"object"==e&&"number"==typeof t.length}function ws(t){return"function"==vs(t)}function Es(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Ts="closure_uid_"+(1e9*Math.random()>>>0),Ss=0;function Is(t,e,n){return t.call.apply(t.bind,arguments)}function Cs(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Ns(t,e,n){return(Ns=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Is:Cs).apply(null,arguments)}function Ds(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var As=Date.now||function(){return+new Date};function Rs(t,e){function n(){}n.prototype=e.prototype,t.L=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.mh=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function ks(t){if(Error.captureStackTrace)Error.captureStackTrace(this,ks);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function Os(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");ks.call(this,n+t[r])}function Ps(){0!=Ls&&(Ms[this[Ts]||(this[Ts]=++Ss)]=this),this.Ka=this.Ka,this.Qa=this.Qa}Rs(ks,Error),ks.prototype.name="CustomError",Rs(Os,ks),Os.prototype.name="AssertionError";var Ls=0,Ms={};Ps.prototype.Ka=!1,Ps.prototype.bb=function(){if(!this.Ka&&(this.Ka=!0,this.F(),0!=Ls)){var t=this[Ts]||(this[Ts]=++Ss);if(0!=Ls&&this.Qa&&0<this.Qa.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Ms[t]}},Ps.prototype.F=function(){if(this.Qa)for(;this.Qa.length;)this.Qa.shift()()};var xs=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(ys(t))return ys(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Fs=Array.prototype.lastIndexOf?function(t,e){return Array.prototype.lastIndexOf.call(t,e,t.length-1)}:function(t,e){var n=t.length-1;if(0>n&&(n=Math.max(0,t.length+n)),ys(t))return ys(e)&&1==e.length?t.lastIndexOf(e,n):-1;for(;0<=n;n--)if(n in t&&t[n]===e)return n;return-1},Us=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=ys(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)},qs=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=ys(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function Bs(t){if(!bs(t))for(var e=t.length-1;0<=e;e--)delete t[e];t.length=0}function Vs(t,e){var n;return(n=0<=(e=xs(t,e)))&&Array.prototype.splice.call(t,e,1),n}function Ws(t){return Array.prototype.concat.apply([],arguments)}function js(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Ks(t){return/^[\s\xa0]*$/.test(t)}var Qs,Hs=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Gs(t,e){return t<e?-1:t>e?1:0}t:{var zs=ds.navigator;if(zs){var Ys=zs.userAgent;if(Ys){Qs=Ys;break t}}Qs=""}function Xs(t){return-1!=Qs.indexOf(t)}function Js(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $s(t){var e,n=[],r=0;for(e in t)n[r++]=t[e];return n}function Zs(t){var e,n=[],r=0;for(e in t)n[r++]=e;return n}function ta(t){var e,n={};for(e in t)n[e]=t[e];return n}var ea="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function na(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ea.length;o++)n=ea[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ra(t){return ra[" "](t),t}ra[" "]=gs;var ia,oa,sa=Xs("Opera"),aa=Xs("Trident")||Xs("MSIE"),ua=Xs("Edge"),ca=ua||aa,ha=Xs("Gecko")&&!(-1!=Qs.toLowerCase().indexOf("webkit")&&!Xs("Edge"))&&!(Xs("Trident")||Xs("MSIE"))&&!Xs("Edge"),la=-1!=Qs.toLowerCase().indexOf("webkit")&&!Xs("Edge");function fa(){var t=ds.document;return t?t.documentMode:void 0}t:{var pa="",da=(oa=Qs,ha?/rv:([^\);]+)(\)|;)/.exec(oa):ua?/Edge\/([\d\.]+)/.exec(oa):aa?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(oa):la?/WebKit\/(\S+)/.exec(oa):sa?/(?:Version)[ \/]?(\S+)/.exec(oa):void 0);if(da&&(pa=da?da[1]:""),aa){var ya=fa();if(null!=ya&&ya>parseFloat(pa)){ia=String(ya);break t}}ia=pa}var ma,ga={};function va(t){return function(t,e){var n=ga;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=Hs(String(ia)).split("."),r=Hs(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=Gs(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||Gs(0==s[2].length,0==a[2].length)||Gs(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var ba=ds.document;ma=ba&&aa?fa()||("CSS1Compat"==ba.compatMode?parseInt(ia,10):5):void 0;var _a=Object.freeze||function(t){return t},wa=!aa||9<=Number(ma),Ea=aa&&!va("9"),Ta=function(){if(!ds.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ds.addEventListener("test",gs,e),ds.removeEventListener("test",gs,e)}catch(t){}return t}();function Sa(t,e){this.type=t,this.currentTarget=this.target=e,this.defaultPrevented=this.Ea=!1,this.Be=!0}function Ia(t,e){Sa.call(this,t?t.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.key="",this.charCode=this.keyCode=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.fb=null,t&&this.Kf(t,e)}Sa.prototype.stopPropagation=function(){this.Ea=!0},Sa.prototype.preventDefault=function(){this.defaultPrevented=!0,this.Be=!1},Rs(Ia,Sa);var Ca=_a({2:"touch",3:"pen",4:"mouse"});Ia.prototype.Kf=function(t,e){var n=this.type=t.type,r=t.changedTouches?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.currentTarget=e,e=t.relatedTarget){if(ha){t:{try{ra(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,null===r?(this.offsetX=la||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=la||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0):(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0),this.button=t.button,this.keyCode=t.keyCode||0,this.key=t.key||"",this.charCode=t.charCode||("keypress"==n?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=ys(t.pointerType)?t.pointerType:Ca[t.pointerType]||"",this.state=t.state,this.fb=t,t.defaultPrevented&&this.preventDefault()},Ia.prototype.stopPropagation=function(){Ia.L.stopPropagation.call(this),this.fb.stopPropagation?this.fb.stopPropagation():this.fb.cancelBubble=!0},Ia.prototype.preventDefault=function(){Ia.L.preventDefault.call(this);var t=this.fb;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Ea)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var Na="closure_listenable_"+(1e6*Math.random()|0);function Da(t){return!(!t||!t[Na])}var Aa=0;function Ra(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Ob=i,this.key=++Aa,this.Sa=this.Eb=!1}function ka(t){this.src=t,this.J={},this.xb=0}function Oa(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Sa&&o.listener==e&&o.capture==!!n&&o.Ob==r)return i}return-1}Ra.prototype.Vb=function(){this.Sa=!0,this.Ob=this.src=this.proxy=this.listener=null},(ls=ka.prototype).add=function(t,e,n,r,i){var o=t.toString();(t=this.J[o])||(t=this.J[o]=[],this.xb++);var s=Oa(t,e,r,i);return-1<s?(e=t[s],n||(e.Eb=!1)):((e=new Ra(e,this.src,o,!!r,i)).Eb=n,t.push(e)),e},ls.remove=function(t,e,n,r){if(!((t=t.toString())in this.J))return!1;var i=this.J[t];return-1<(e=Oa(i,e,n,r))&&(i[e].Vb(),Array.prototype.splice.call(i,e,1),0==i.length&&(delete this.J[t],this.xb--),!0)},ls.ye=function(t){var e=t.type;e in this.J&&Vs(this.J[e],t)&&(t.Vb(),0==this.J[e].length&&(delete this.J[e],this.xb--))},ls.pb=function(t){var e;for(e in t=t&&t.toString(),this.J)if(!t||e==t){for(var n=this.J[e],r=0;r<n.length;r++)n[r].Vb();delete this.J[e],this.xb--}},ls.jb=function(t,e,n,r){var i=-1;return(t=this.J[t.toString()])&&(i=Oa(t,e,n,r)),-1<i?t[i]:null};var Pa="closure_lm_"+(1e6*Math.random()|0),La={};function Ma(t,e,n,r,i){if(r&&r.once)return Fa(t,e,n,r,i);if(bs(e)){for(var o=0;o<e.length;o++)Ma(t,e[o],n,r,i);return null}return n=Qa(n),Da(t)?t.nb(e,n,Es(r)?!!r.capture:!!r,i):xa(t,e,n,!1,r,i)}function xa(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=Es(i)?!!i.capture:!!i,a=ja(t);if(a||(t[Pa]=a=new ka(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Wa,e=wa?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Ta||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(qa(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Fa(t,e,n,r,i){if(bs(e)){for(var o=0;o<e.length;o++)Fa(t,e[o],n,r,i);return null}return n=Qa(n),Da(t)?t.Oc(e,n,Es(r)?!!r.capture:!!r,i):xa(t,e,n,!0,r,i)}function Ua(t){if("number"!=typeof t&&t&&!t.Sa){var e=t.src;if(Da(e))e.Le(t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(qa(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ja(e))?(n.ye(t),0==n.xb&&(n.src=null,e[Pa]=null)):t.Vb()}}}function qa(t){return t in La?La[t]:La[t]="on"+t}function Ba(t,e,n,r){var i=!0;if((t=ja(t))&&(e=t.J[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.Sa&&(o=Va(o,r),i=i&&!1!==o)}return i}function Va(t,e){var n=t.listener,r=t.Ob||t.src;return t.Eb&&Ua(t),n.call(r,e)}function Wa(t,e){if(t.Sa)return!0;if(!wa){var n=e||ms("window.event");e=new Ia(n,this);var r=!0;if(!(0>n.keyCode||void 0!=n.returnValue)){t:{var i=!1;if(0==n.keyCode)try{n.keyCode=-1;break t}catch(t){i=!0}(i||void 0==n.returnValue)&&(n.returnValue=!0)}for(n=[],i=e.currentTarget;i;i=i.parentNode)n.push(i);for(t=t.type,i=n.length-1;!e.Ea&&0<=i;i--){e.currentTarget=n[i];var o=Ba(n[i],t,!0,e);r=r&&o}for(i=0;!e.Ea&&i<n.length;i++)e.currentTarget=n[i],o=Ba(n[i],t,!1,e),r=r&&o}return r}return Va(t,new Ia(e,this))}function ja(t){return(t=t[Pa])instanceof ka?t:null}var Ka="__closure_events_fn_"+(1e9*Math.random()>>>0);function Qa(t){return ws(t)?t:(t[Ka]||(t[Ka]=function(e){return t.handleEvent(e)}),t[Ka])}function Ha(){Ps.call(this),this.ka=new ka(this),this.Pe=this,this.Uc=null}Rs(Ha,Ps),Ha.prototype[Na]=!0,(ls=Ha.prototype).addEventListener=function(t,e,n,r){Ma(this,t,e,n,r)},ls.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(bs(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=Es(i)?!!i.capture:!!i,r=Qa(r),Da(e)?e.ed(n,r,i,o):e&&(e=ja(e))&&(n=e.jb(n,r,i,o))&&Ua(n)}(this,t,e,n,r)},ls.dispatchEvent=function(t){var e,n=this.Uc;if(n)for(e=[];n;n=n.Uc)e.push(n);n=this.Pe;var r=t.type||t;if(ys(t))t=new Sa(t,n);else if(t instanceof Sa)t.target=t.target||n;else{var i=t;na(t=new Sa(r,n),i)}if(i=!0,e)for(var o=e.length-1;!t.Ea&&0<=o;o--){var s=t.currentTarget=e[o];i=s.Lb(r,!0,t)&&i}if(t.Ea||(i=(s=t.currentTarget=n).Lb(r,!0,t)&&i,t.Ea||(i=s.Lb(r,!1,t)&&i)),e)for(o=0;!t.Ea&&o<e.length;o++)i=(s=t.currentTarget=e[o]).Lb(r,!1,t)&&i;return i},ls.F=function(){Ha.L.F.call(this),this.pg(),this.Uc=null},ls.nb=function(t,e,n,r){return this.ka.add(String(t),e,!1,n,r)},ls.Oc=function(t,e,n,r){return this.ka.add(String(t),e,!0,n,r)},ls.ed=function(t,e,n,r){this.ka.remove(String(t),e,n,r)},ls.Le=function(t){this.ka.ye(t)},ls.pg=function(){this.ka&&this.ka.pb(void 0)},ls.Lb=function(t,e,n){if(!(t=this.ka.J[String(t)]))return!0;t=t.concat();for(var r=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.Sa&&o.capture==e){var s=o.listener,a=o.Ob||o.src;o.Eb&&this.Le(o),r=!1!==s.call(a,n)&&r}}return r&&0!=n.Be},ls.jb=function(t,e,n,r){return this.ka.jb(String(t),e,n,r)};var Ga=ds.JSON.stringify;function za(t,e){this.Sf=100,this.ef=t,this.ug=e,this.Zb=0,this.Pb=null}function Ya(){this.lc=this.Va=null}za.prototype.get=function(){if(0<this.Zb){this.Zb--;var t=this.Pb;this.Pb=t.next,t.next=null}else t=this.ef();return t},za.prototype.put=function(t){this.ug(t),this.Zb<this.Sf&&(this.Zb++,t.next=this.Pb,this.Pb=t)};var Xa,Ja,$a=new za(function(){return new Za},function(t){t.reset()});function Za(){this.next=this.scope=this.Gc=null}function tu(t){ds.setTimeout(function(){throw t},0)}function eu(){if(ds.Promise&&ds.Promise.resolve){var t=ds.Promise.resolve(void 0);Ja=function(){t.then(iu)}}else Ja=function(){var t=iu;!ws(ds.setImmediate)||ds.Window&&ds.Window.prototype&&!Xs("Edge")&&ds.Window.prototype.setImmediate==ds.setImmediate?(Xa||(Xa=function(){var t=ds.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Xs("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=Ns(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0!==t&&!Xs("Trident")&&!Xs("MSIE")){var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).rd;n.rd=null,t()}},function(t){r.next={rd:t},r=r.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){ds.setTimeout(t,0)}}()),Xa(t)):ds.setImmediate(t)}}Ya.prototype.add=function(t,e){var n=this.Af();n.set(t,e),this.lc?this.lc.next=n:this.Va=n,this.lc=n},Ya.prototype.remove=function(){var t=null;return this.Va&&(t=this.Va,this.Va=this.Va.next,this.Va||(this.lc=null),t.next=null),t},Ya.prototype.wg=function(t){$a.put(t)},Ya.prototype.Af=function(){return $a.get()},Za.prototype.set=function(t,e){this.Gc=t,this.scope=e,this.next=null},Za.prototype.reset=function(){this.next=this.scope=this.Gc=null};var nu=!1,ru=new Ya;function iu(){for(var t;t=ru.remove();){try{t.Gc.call(t.scope)}catch(t){tu(t)}ru.wg(t)}nu=!1}function ou(t,e){Ha.call(this),this.Na=t||1,this.wb=e||ds,this.nd=Ns(this.Rg,this),this.ie=As()}function su(t,e,n){if(ws(t))n&&(t=Ns(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Ns(t.handleEvent,t)}return 2147483647<Number(e)?-1:ds.setTimeout(t,e||0)}function au(t,e,n){Ps.call(this),this.Uf=null!=n?Ns(t,n):t,this.Na=e,this.Xe=Ns(this.fg,this),this.qc=[]}function uu(t){Ps.call(this),this.i=t,this.o={}}Rs(ou,Ha),(ls=ou.prototype).enabled=!1,ls.B=null,ls.setInterval=function(t){this.Na=t,this.B&&this.enabled?(this.stop(),this.start()):this.B&&this.stop()},ls.Rg=function(){if(this.enabled){var t=As()-this.ie;0<t&&t<.8*this.Na?this.B=this.wb.setTimeout(this.nd,this.Na-t):(this.B&&(this.wb.clearTimeout(this.B),this.B=null),this.ff(),this.enabled&&(this.stop(),this.start()))}},ls.ff=function(){this.dispatchEvent("tick")},ls.start=function(){this.enabled=!0,this.B||(this.B=this.wb.setTimeout(this.nd,this.Na),this.ie=As())},ls.stop=function(){this.enabled=!1,this.B&&(this.wb.clearTimeout(this.B),this.B=null)},ls.F=function(){ou.L.F.call(this),this.stop(),delete this.wb},Rs(au,Ps),(ls=au.prototype).Ta=!1,ls.ob=0,ls.B=null,ls.mf=function(t){this.qc=arguments,this.B||this.ob?this.Ta=!0:this.Cc()},ls.stop=function(){this.B&&(ds.clearTimeout(this.B),this.B=null,this.Ta=!1,this.qc=[])},ls.pause=function(){this.ob++},ls.resume=function(){this.ob--,this.ob||!this.Ta||this.B||(this.Ta=!1,this.Cc())},ls.F=function(){au.L.F.call(this),this.stop()},ls.fg=function(){this.B=null,this.Ta&&!this.ob&&(this.Ta=!1,this.Cc())},ls.Cc=function(){this.B=su(this.Xe,this.Na),this.Uf.apply(null,this.qc)},Rs(uu,Ps);var cu=[];function hu(t,e,n){this.reset(t,e,n,void 0,void 0)}function lu(t){this.pe=t,this.Zd=this.uc=this.mb=this.$b=null}function fu(t,e){this.name=t,this.value=e}(ls=uu.prototype).nb=function(t,e,n,r){return this.Tf(t,e,n,r)},ls.Tf=function(t,e,n,r){bs(e)||(e&&(cu[0]=e.toString()),e=cu);for(var i=0;i<e.length;i++){var o=Ma(t,e[i],n||this.handleEvent,r||!1,this.i||this);if(!o)break;this.o[o.key]=o}return this},ls.Oc=function(t,e,n,r){return this.je(t,e,n,r)},ls.je=function(t,e,n,r,i){if(bs(e))for(var o=0;o<e.length;o++)this.je(t,e[o],n,r,i);else{if(!(t=Fa(t,e,n||this.handleEvent,r,i||this.i||this)))return this;this.o[t.key]=t}return this},ls.ed=function(t,e,n,r,i){if(bs(e))for(var o=0;o<e.length;o++)this.ed(t,e[o],n,r,i);else n=n||this.handleEvent,r=Es(r)?!!r.capture:!!r,i=i||this.i||this,n=Qa(n),r=!!r,(e=Da(t)?t.jb(e,n,r,i):t&&(t=ja(t))?t.jb(e,n,r,i):null)&&(Ua(e),delete this.o[e.key])},ls.pb=function(){Js(this.o,function(t,e){this.o.hasOwnProperty(e)&&Ua(t)},this),this.o={}},ls.F=function(){uu.L.F.call(this),this.pb()},ls.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},hu.prototype.Md=null,hu.prototype.reset=function(t,e,n,r,i){this.mb=t,delete this.Md},hu.prototype.Bg=function(t){this.Md=t},hu.prototype.Ge=function(t){this.mb=t},fu.prototype.toString=function(){return this.name};var pu=new fu("SEVERE",1e3),du=new fu("WARNING",900),yu=new fu("INFO",800),mu=new fu("CONFIG",700),gu=new fu("FINE",500);(ls=lu.prototype).getName=function(){return this.pe},ls.getParent=function(){return this.$b},ls.pf=function(){return this.uc||(this.uc={}),this.uc},ls.Ge=function(t){this.mb=t},ls.Qd=function(){return this.mb?this.mb:this.$b?this.$b.Qd():(function(t,e){throw new Os("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}("Root logger has no level set."),null)},ls.Pf=function(t){return t.value>=this.Qd().value},ls.log=function(t,e,n){this.Pf(t)&&(ws(e)&&(e=e()),this.gf(this.uf(t,e,n)))},ls.uf=function(t,e,n){return t=new hu(t,String(e),this.pe),n&&t.Bg(n),t},ls.ca=function(t,e){this.log(pu,t,e)},ls.T=function(t,e){this.log(du,t,e)},ls.info=function(t,e){this.log(yu,t,e)},ls.lf=function(t){this.log(gu,t,void 0)},ls.gf=function(t){for(var e=this;e;)e.We(t),e=e.getParent()},ls.We=function(t){if(this.Zd)for(var e,n=0;e=this.Zd[n];n++)e(t)},ls.Fg=function(t){this.$b=t},ls.Qe=function(t,e){this.pf()[t]=e};var vu={},bu=null;function _u(t){var e;if(bu||(bu=new lu(""),vu[""]=bu,bu.Ge(mu)),!(e=vu[t])){e=new lu(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=_u(t.substr(0,n))).Qe(r,e),e.Fg(n),vu[t]=e}return e}function wu(t,e){t&&t.info(e,void 0)}function Eu(t,e){t&&t.lf(e)}function Tu(){this.s=_u("goog.labs.net.webChannel.WebChannelDebug"),this.Wc=!0}(ls=Tu.prototype).Id=function(){this.Wc=!1},ls.Tg=function(t,e,n,r,i){var o=this;this.info(function(){return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+t+"\n"+e+"\n"+o.Xf(i)})},ls.Ug=function(t,e,n,r,i,o){this.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+t+"\n"+e+"\n"+i+" "+o})},ls.Wa=function(t,e,n){var r=this;this.info(function(){return"XMLHTTP TEXT ("+t+"): "+r.ng(e)+(n?" "+n:"")})},ls.Sg=function(t){this.info(function(){return"TIMEOUT: "+t})},ls.debug=function(t){Eu(this.s,t)},ls.cb=function(t,e){var n=this.s;n&&n.ca(e||"Exception",t)},ls.info=function(t){wu(this.s,t)},ls.T=function(t){var e=this.s;e&&e.T(t,void 0)},ls.ca=function(t){var e=this.s;e&&e.ca(t,void 0)},ls.ng=function(t){if(!this.Wc)return t;if(!t)return null;try{var e=JSON.parse(t);if(e)for(var n=0;n<e.length;n++)bs(e[n])&&this.Wf(e[n]);return Ga(e)}catch(e){return this.debug("Exception parsing expected JS array - probably was not JS"),t}},ls.Wf=function(t){if(!(2>t.length||(t=t[1],!bs(t)||1>t.length))){var e=t[0];if("noop"!=e&&"stop"!=e&&"close"!=e)for(e=1;e<t.length;e++)t[e]=""}},ls.Xf=function(t){if(!this.Wc)return t;if(!t)return null;var e="";t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].split("=");if(1<r.length){var i=r[0];r=r[1];var o=i.split("_");e=2<=o.length&&"type"==o[1]?e+(i+"=")+r+"&":e+(i+"=redacted&")}}return e};var Su=new Ha;function Iu(t){Sa.call(this,"serverreachability",t)}function Cu(t){Su.dispatchEvent(new Iu(Su,t))}function Nu(t,e){Sa.call(this,"statevent",t),this.stat=e}function Du(t){Su.dispatchEvent(new Nu(Su,t))}function Au(t,e,n){Sa.call(this,"timingevent",t),this.size=e,this.rtt=n}function Ru(t,e){if(!ws(t))throw Error("Fn must not be null and must be a function");return ds.setTimeout(function(){t()},e)}Rs(Iu,Sa),Rs(Nu,Sa),Rs(Au,Sa);var ku={NO_ERROR:0,Vg:1,bh:2,ah:3,Yg:4,$g:5,dh:6,Ne:7,TIMEOUT:8,gh:9},Ou={Xg:"complete",kh:"success",Oe:"error",Ne:"abort",ih:"ready",jh:"readystatechange",TIMEOUT:"timeout",eh:"incrementaldata",hh:"progress",Zg:"downloadprogress",lh:"uploadprogress"};function Pu(){}function Lu(){}Pu.prototype.pd=null,Pu.prototype.Vd=function(){return this.pd||(this.pd=this.Mf())};var Mu,xu={OPEN:"a",Wg:"b",Oe:"c",fh:"d"};function Fu(){Sa.call(this,"d")}function Uu(){Sa.call(this,"c")}function qu(){}function Bu(t,e,n,r,i){this.b=t,this.a=e,this.ra=n,this.R=r,this.Xc=i||1,this.Fc=new uu(this),this.Ua=Vu,t=ca?125:void 0,this.Vc=new ou(t),this.A=null,this.S=!1,this.Da=this.pa=this.ua=this.ic=this.qb=this.hd=this.Ga=null,this.ba=[],this.h=null,this.Bb=0,this.I=this.Fa=null,this.w=-1,this.Za=!1,this.Ra=0,this.ac=null,this.lb=this.Ed=this.yc=!1}Rs(Fu,Sa),Rs(Uu,Sa),Rs(qu,Pu),qu.prototype.Dd=function(){var t=this.Wd();return t?new ActiveXObject(t):new XMLHttpRequest},qu.prototype.Mf=function(){var t={};return this.Wd()&&(t[0]=!0,t[1]=!0),t},qu.prototype.Wd=function(){if(!this.be&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var t=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],e=0;e<t.length;e++){var n=t[e];try{return new ActiveXObject(n),this.be=n}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return this.be},Mu=new qu;var Vu=45e3;var Wu={},ju={};function Ku(t){if(t.H&&"function"==typeof t.H)return t.H();if(ys(t))return t.split("");if(_s(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}return $s(t)}function Qu(t,e,n){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,n);else if(_s(t)||ys(t))Us(t,e,n);else{if(t.W&&"function"==typeof t.W)var r=t.W();else if(t.H&&"function"==typeof t.H)r=void 0;else if(_s(t)||ys(t)){r=[];for(var i=t.length,o=0;o<i;o++)r.push(o)}else r=Zs(t);o=(i=Ku(t)).length;for(var s=0;s<o;s++)e.call(n,i[s],r&&r[s],t)}}function Hu(t,e){this.D={},this.o=[],this.j=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else t&&this.addAll(t)}function Gu(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(ls=Bu.prototype).ga=function(t){this.A=t},ls.setTimeout=function(t){this.Ua=t},ls.He=function(t){this.Ra=t},ls.Gg=function(t){this.ba=t},ls.la=function(){return this.ba},ls.kd=function(t,e){this.ic=1,this.ua=t.clone().Ub(),this.Da=e,this.yc=!0,this.Ce(null)},ls.jd=function(t,e,n){this.ic=1,this.ua=t.clone().Ub(),this.Da=null,this.yc=e,this.Ce(n)},ls.Ce=function(t){this.qb=As(),this.eb(),this.pa=this.ua.clone(),this.pa.dc("t",this.Xc),this.Bb=0,this.h=this.b.Jb(this.b.fc()?t:null),0<this.Ra&&(this.ac=new au(Ns(this.Me,this,this.h),this.Ra)),this.Fc.nb(this.h,"readystatechange",this.mg),t=this.A?ta(this.A):{},this.Da?(this.Fa||(this.Fa="POST"),t["Content-Type"]="application/x-www-form-urlencoded",this.h.send(this.pa,this.Fa,this.Da,t)):(this.Fa="GET",this.h.send(this.pa,this.Fa,null,t)),Cu(1),this.a.Tg(this.Fa,this.pa,this.R,this.Xc,this.Da)},ls.mg=function(t){t=t.target;var e=this.ac;e&&3==t.ma()?(this.a.debug("Throttling readystatechange."),e.mf()):this.Me(t)},ls.Me=function(t){try{t==this.h?this.hg():this.a.T("Called back with an unexpected xmlhttp")}catch(t){if(this.a.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.h&&this.h.ya()){var e=this;this.a.cb(t,function(){return"ResponseText: "+e.h.ya()})}else this.a.cb(t,"No response text")}},ls.hg=function(){var t=this.h.ma(),e=this.h.Ud(),n=this.h.za();if(!(3>t||3==t&&!ca&&!this.h.ya())){this.Za||4!=t||7==e||Cu(8==e||0>=n?3:2),this.Fb();var r=this.h.za();if(this.w=r,!(e=this.h.ya())){var i=this;this.a.debug(function(){return"No response text for uri "+i.pa+" status "+r})}if(this.S=200==r,this.a.Ug(this.Fa,this.pa,this.R,this.Xc,t,r),this.S){if(this.Ig()){if(!(n=this.sf()))return this.S=!1,this.I=3,Du(12),this.a.T("XMLHTTP Missing X_HTTP_INITIAL_RESPONSE ("+this.R+")"),this.Ia(),void this.Kb();this.a.Wa(this.R,n,"Initial handshake response via X-HTTP-Initial-Response"),this.lb=!0,this.Yc(n)}this.yc?(this.Fd(t,e),ca&&this.S&&3==t&&this.Ng()):(this.a.Wa(this.R,e,null),this.Yc(e)),4==t&&this.Ia(),this.S&&!this.Za&&(4==t?this.b.Tc(this):(this.S=!1,this.eb()))}else 400==r&&0<e.indexOf("Unknown SID")?(this.I=3,Du(12),this.a.T("XMLHTTP Unknown SID ("+this.R+")")):(this.I=0,Du(13),this.a.T("XMLHTTP Bad status "+r+" ("+this.R+")")),this.Ia(),this.Kb()}},ls.Ig=function(){return this.Ed&&!this.lb},ls.sf=function(){if(this.h){var t=this.h.kb("X-HTTP-Initial-Response");if(t&&!Ks(t))return t}return null},ls.Ag=function(){this.Ed=!0},ls.Fd=function(t,e){for(var n=!0;!this.Za&&this.Bb<e.length;){var r=this.vf(e);if(r==ju){4==t&&(this.I=4,Du(14),n=!1),this.a.Wa(this.R,null,"[Incomplete Response]");break}if(r==Wu){this.I=4,Du(15),this.a.Wa(this.R,e,"[Invalid Chunk]"),n=!1;break}this.a.Wa(this.R,r,null),this.Yc(r)}4==t&&0==e.length&&(this.I=1,Du(16),n=!1),this.S=this.S&&n,n||(this.a.Wa(this.R,e,"[Invalid Chunked Response]"),this.Ia(),this.Kb())},ls.kg=function(){if(this.h){var t=this.h.ma(),e=this.h.ya();this.Bb<e.length&&(this.Fb(),this.Fd(t,e),this.S&&4!=t&&this.eb())}},ls.Ng=function(){this.Fc.nb(this.Vc,"tick",this.kg),this.Vc.start()},ls.vf=function(t){var e=this.Bb,n=t.indexOf("\n",e);return-1==n?ju:(e=Number(t.substring(e,n)),isNaN(e)?Wu:(n+=1)+e>t.length?ju:(t=t.substr(n,e),this.Bb=n+e,t))},ls.yg=function(t){this.ic=2,this.ua=t.clone().Ub(),t=!1,ds.navigator&&ds.navigator.sendBeacon&&(t=ds.navigator.sendBeacon(this.ua.toString(),"")),!t&&ds.Image&&((new Image).src=this.ua,t=!0),t||(this.h=this.b.Jb(null),this.h.send(this.ua)),this.qb=As(),this.eb()},ls.cancel=function(){this.Za=!0,this.Ia()},ls.tg=function(t){t&&this.setTimeout(t),this.Ga&&(this.Fb(),this.eb())},ls.eb=function(){this.hd=As()+this.Ua,this.Ke(this.Ua)},ls.Ke=function(t){if(null!=this.Ga)throw Error("WatchDog timer not null");this.Ga=Ru(Ns(this.gg,this),t)},ls.Fb=function(){this.Ga&&(ds.clearTimeout(this.Ga),this.Ga=null)},ls.gg=function(){this.Ga=null;var t=As();0<=t-this.hd?this.Df():(this.a.T("WatchDog timer called too early"),this.Ke(this.hd-t))},ls.Df=function(){this.S&&this.a.ca("Received watchdog timeout even though request loaded successfully"),this.a.Sg(this.pa),2!=this.ic&&(Cu(3),Du(17)),this.Ia(),this.I=2,this.Kb()},ls.Kb=function(){this.b.de()||this.Za||this.b.Tc(this)},ls.Ia=function(){this.Fb();var t=this.ac;t&&"function"==typeof t.bb&&t.bb(),this.ac=null,this.Vc.stop(),this.Fc.pb(),this.h&&(t=this.h,this.h=null,t.abort(),t.bb())},ls.Hc=function(){return this.I},ls.Yc=function(t){try{this.b.ue(this,t),Cu(4)}catch(t){this.a.cb(t,"Error in httprequest callback")}},(ls=Hu.prototype).C=function(){return this.j},ls.H=function(){this.wc();for(var t=[],e=0;e<this.o.length;e++)t.push(this.D[this.o[e]]);return t},ls.W=function(){return this.wc(),this.o.concat()},ls.va=function(t){return Gu(this.D,t)},ls.X=function(){return 0==this.j},ls.clear=function(){this.D={},this.j=this.o.length=0},ls.remove=function(t){return!!Gu(this.D,t)&&(delete this.D[t],this.j--,this.o.length>2*this.j&&this.wc(),!0)},ls.wc=function(){if(this.j!=this.o.length){for(var t=0,e=0;t<this.o.length;){var n=this.o[t];Gu(this.D,n)&&(this.o[e++]=n),t++}this.o.length=e}if(this.j!=this.o.length){var r={};for(e=t=0;t<this.o.length;)Gu(r,n=this.o[t])||(this.o[e++]=n,r[n]=1),t++;this.o.length=e}},ls.get=function(t,e){return Gu(this.D,t)?this.D[t]:e},ls.set=function(t,e){Gu(this.D,t)||(this.j++,this.o.push(t)),this.D[t]=e},ls.addAll=function(t){if(t instanceof Hu)for(var e=t.W(),n=0;n<e.length;n++)this.set(e[n],t.get(e[n]));else for(e in t)this.set(e,t[e])},ls.forEach=function(t,e){for(var n=this.W(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}},ls.clone=function(){return new Hu(this)};var zu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yu(t,e){var n;this.xa=this.zb=this.qa="",this.Ca=null,this.ib=this.K="",this.O=this.Qf=!1,t instanceof Yu?(this.O=void 0!==e?e:t.O,this.tb(t.qa),this.cd(t.zb),this.rb(t.xa),this.sb(t.Ca),this.ec(t.K),this.bd(t.P.clone()),this.$c(t.ib)):t&&(n=String(t).match(zu))?(this.O=!!e,this.tb(n[1]||"",!0),this.cd(n[2]||"",!0),this.rb(n[3]||"",!0),this.sb(n[4]),this.ec(n[5]||"",!0),this.bd(n[6]||"",!0),this.$c(n[7]||"",!0)):(this.O=!!e,this.P=new ic(null,this.O))}function Xu(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ju(t,e,n){return ys(t)?(t=encodeURI(t).replace(e,$u),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function $u(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}(ls=Yu.prototype).toString=function(){var t=[],e=this.qa;e&&t.push(Ju(e,Zu,!0),":");var n=this.xa;return(n||"file"==e)&&(t.push("//"),(e=this.zb)&&t.push(Ju(e,Zu,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.Ca)&&t.push(":",String(n))),(n=this.K)&&(this.Ic()&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ju(n,"/"==n.charAt(0)?ec:tc,!0))),(n=this.Rd())&&t.push("?",n),(n=this.ib)&&t.push("#",Ju(n,rc)),t.join("")},ls.resolve=function(t){var e=this.clone(),n=t.Hf();n?e.tb(t.qa):n=t.If(),n?e.cd(t.zb):n=t.Ic(),n?e.rb(t.xa):n=t.Ff();var r=t.K;if(n)e.sb(t.Ca);else if(n=t.ae()){if("/"!=r.charAt(0))if(this.Ic()&&!this.ae())r="/"+r;else{var i=e.K.lastIndexOf("/");-1!=i&&(r=e.K.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.ec(r):n=t.Gf(),n?e.bd(t.P.clone()):n=t.Ef(),n&&e.$c(t.ib),e},ls.clone=function(){return new Yu(this)},ls.tb=function(t,e){this.U(),(this.qa=e?Xu(t,!0):t)&&(this.qa=this.qa.replace(/:$/,""))},ls.Hf=function(){return!!this.qa},ls.cd=function(t,e){this.U(),this.zb=e?Xu(t):t},ls.If=function(){return!!this.zb},ls.rb=function(t,e){this.U(),this.xa=e?Xu(t,!0):t},ls.Ic=function(){return!!this.xa},ls.sb=function(t){if(this.U(),t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);this.Ca=t}else this.Ca=null},ls.Ff=function(){return null!=this.Ca},ls.ec=function(t,e){this.U(),this.K=e?Xu(t,!0):t},ls.ae=function(){return!!this.K},ls.Gf=function(){return""!==this.P.toString()},ls.bd=function(t,e){this.U(),t instanceof ic?(this.P=t,this.P.ad(this.O)):(e||(t=Ju(t,nc)),this.P=new ic(t,this.O))},ls.Rd=function(){return this.P.toString()},ls.getQuery=function(){return this.Rd()},ls.l=function(t,e){this.U(),this.P.set(t,e)},ls.dc=function(t,e){this.U(),bs(e)||(e=[String(e)]),this.P.Ie(t,e)},ls.$c=function(t,e){this.U(),this.ib=e?Xu(t):t},ls.Ef=function(){return!!this.ib},ls.Ub=function(){return this.U(),this.l("zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^As()).toString(36)),this},ls.removeParameter=function(t){return this.U(),this.P.remove(t),this},ls.U=function(){if(this.Qf)throw Error("Tried to modify a read-only Uri")},ls.ad=function(t){this.O=t,this.P&&this.P.ad(t)};var Zu=/[#\/\?@]/g,tc=/[#\?:]/g,ec=/[#\?]/g,nc=/[#\?@]/g,rc=/#/g;function ic(t,e){this.j=this.m=null,this.ja=t||null,this.O=!!e}function oc(t,e){this.b=t,this.a=e,this.f=this.A=null,this.bc=!1,this.K=null,this.w=-1,this.Ad=this.na=null}function sc(t){this.D=new Hu,t&&this.addAll(t)}function ac(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Ts]||(t[Ts]=++Ss)):e.substr(0,1)+t}function uc(t){this.me=t||cc,ds.PerformanceNavigationTiming?t=0<(t=ds.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(ds.vc&&ds.vc.ke&&ds.vc.ke()&&ds.vc.ke().nh),this.Xb=t?this.me:1,this.v=null,1<this.Xb&&(this.v=new sc),this.f=null,this.ba=[]}(ls=ic.prototype).$=function(){if(!this.m&&(this.m=new Hu,this.j=0,this.ja)){var t=this;!function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(this.ja,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})}},ls.C=function(){return this.$(),this.j},ls.add=function(t,e){this.$(),this.Oa(),t=this.Ma(t);var n=this.m.get(t);return n||this.m.set(t,n=[]),n.push(e),this.j+=1,this},ls.remove=function(t){return this.$(),t=this.Ma(t),!!this.m.va(t)&&(this.Oa(),this.j-=this.m.get(t).length,this.m.remove(t))},ls.clear=function(){this.Oa(),this.m=null,this.j=0},ls.X=function(){return this.$(),0==this.j},ls.va=function(t){return this.$(),t=this.Ma(t),this.m.va(t)},ls.forEach=function(t,e){this.$(),this.m.forEach(function(n,r){Us(n,function(n){t.call(e,n,r,this)},this)},this)},ls.W=function(){this.$();for(var t=this.m.H(),e=this.m.W(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},ls.H=function(t){this.$();var e=[];if(ys(t))this.va(t)&&(e=Ws(e,this.m.get(this.Ma(t))));else{t=this.m.H();for(var n=0;n<t.length;n++)e=Ws(e,t[n])}return e},ls.set=function(t,e){return this.$(),this.Oa(),t=this.Ma(t),this.va(t)&&(this.j-=this.m.get(t).length),this.m.set(t,[e]),this.j+=1,this},ls.get=function(t,e){return t&&0<(t=this.H(t)).length?String(t[0]):e},ls.Ie=function(t,e){this.remove(t),0<e.length&&(this.Oa(),this.m.set(this.Ma(t),js(e)),this.j+=e.length)},ls.toString=function(){if(this.ja)return this.ja;if(!this.m)return"";for(var t=[],e=this.m.W(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.H(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.ja=t.join("&")},ls.Oa=function(){this.ja=null},ls.clone=function(){var t=new ic;return t.ja=this.ja,this.m&&(t.m=this.m.clone(),t.j=this.j),t},ls.Ma=function(t){return t=String(t),this.O&&(t=t.toLowerCase()),t},ls.ad=function(t){t&&!this.O&&(this.$(),this.Oa(),this.m.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(this.remove(e),this.Ie(n,t))},this)),this.O=t},ls.extend=function(t){for(var e=0;e<arguments.length;e++)Qu(arguments[e],function(t,e){this.add(e,t)},this)},Rs(function(){},function(){}),(ls=oc.prototype).g=null,ls.ga=function(t){this.A=t},ls.connect=function(t){this.K=t,t=this.b.Sd(this.K),Du(3);var e=this.b.Ib.$d;null!=e?(this.na=this.b.$a(e[0]),this.g=1,this.xd()):(t.dc("MODE","init"),!this.b.ta&&this.b.aa&&t.dc("X-HTTP-Session-Id",this.b.aa),this.f=new Bu(this,this.a,void 0,void 0,void 0),this.f.ga(this.A),this.f.jd(t,!1,null),this.g=0)},ls.xd=function(){this.a.debug("TestConnection: starting stage 2");var t=this.b.Ib.od;if(null!=t)this.a.debug(function(){return"Buffered"}),Du(4),t?(Du(10),this.b.ub(this,!1)):(Du(11),this.b.ub(this,!0));else{this.f=new Bu(this,this.a,void 0,void 0,void 0),this.f.ga(this.A);var e=this.b.Pd(this.na,this.K);Du(4),e.dc("TYPE","xmlhttp");var n=this.b.aa,r=this.b.Kc;n&&r&&e.l(n,r),this.f.jd(e,!1,this.na)}},ls.Jb=function(t){return this.b.Jb(t)},ls.abort=function(){this.f&&(this.f.cancel(),this.f=null),this.w=-1},ls.de=function(){return!1},ls.ue=function(t,e){if(this.w=t.w,0==this.g)if(this.a.debug("TestConnection: Got data for stage 1"),this.pc(t),e){try{var n=this.b.kc.zc(e)}catch(t){return this.a.cb(t),void this.b.dd(this)}this.na=this.b.$a(n[0])}else this.a.debug("TestConnection: Null responseText"),this.b.dd(this);else 1==this.g&&(this.bc?Du(6):"11111"==e?(Du(5),this.bc=!0,this.Ze()&&(this.w=200,this.f.cancel(),this.a.debug("Test connection succeeded; using streaming connection"),Du(11),this.b.ub(this,!0))):(Du(7),this.bc=!1))},ls.Tc=function(){this.w=this.f.w,this.f.S?0==this.g?(this.g=1,this.a.debug("TestConnection: request complete for initial check"),this.xd()):1==this.g&&(this.a.debug("TestConnection: request complete for stage 2"),this.bc?(this.a.debug("Test connection succeeded; using streaming connection"),Du(11),this.b.ub(this,!0)):(this.a.debug("Test connection failed; not using streaming"),Du(10),this.b.ub(this,!1))):(this.a.debug("TestConnection: request failed, in state "+this.g),0==this.g?Du(8):1==this.g&&Du(9),this.b.dd(this))},ls.pc=function(t){if(!this.b.ta&&(t=t.h)){var e=t.kb("X-Client-Wire-Protocol");this.Ad=e||null,this.b.aa&&((t=t.kb("X-HTTP-Session-Id"))?this.b.Fe(t):this.a.T("Missing X_HTTP_SESSION_ID in the handshake response"))}},ls.fc=function(){return this.b.fc()},ls.Ba=function(){return this.b.Ba()},ls.Ze=function(){return!aa||10<=Number(ma)},(ls=sc.prototype).C=function(){return this.D.C()},ls.add=function(t){this.D.set(ac(t),t)},ls.addAll=function(t){for(var e=(t=Ku(t)).length,n=0;n<e;n++)this.add(t[n])},ls.pb=function(t){for(var e=(t=Ku(t)).length,n=0;n<e;n++)this.remove(t[n])},ls.remove=function(t){return this.D.remove(ac(t))},ls.clear=function(){this.D.clear()},ls.X=function(){return this.D.X()},ls.contains=function(t){return this.D.va(ac(t))},ls.H=function(){return this.D.H()},ls.clone=function(){return new sc(this)};var cc=10;function hc(){this.xg=this.rg=void 0}function lc(){this.jg=new hc}function fc(t,e,n,r,i){try{t.debug(n),e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(e){t.cb(e)}}(ls=uc.prototype).ld=function(t){this.v||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(this.Xb=this.me,this.v=new sc,this.f&&(this.oc(this.f),this.f=null))},ls.ee=function(){return!!this.f||!!this.v&&this.v.C()>=this.Xb},ls.xf=function(){return this.f?1:this.v?this.v.C():0},ls.Jc=function(t){return this.f?this.f==t:!!this.v&&this.v.contains(t)},ls.oc=function(t){this.v?this.v.add(t):this.f=t},ls.ze=function(t){this.f&&this.f==t?this.f=null:this.v&&this.v.contains(t)&&this.v.remove(t)},ls.cancel=function(){this.ba=this.la(),this.f?(this.f.cancel(),this.f=null):this.v&&!this.v.X()&&(Us(this.v.H(),function(t){t.cancel()}),this.v.clear())},ls.la=function(){if(null!=this.f)return this.ba.concat(this.f.la());if(null!=this.v&&!this.v.X()){var t=this.ba;return Us(this.v.H(),function(e){t=t.concat(e.la())}),t}return js(this.ba)},ls.Re=function(t){this.ba=this.ba.concat(t)},ls.$e=function(){this.ba.length=0},hc.prototype.stringify=function(t){return ds.JSON.stringify(t,this.rg)},hc.prototype.parse=function(t){return ds.JSON.parse(t,this.xg)},lc.prototype.hf=function(t,e,n){var r=n||"";try{Qu(t,function(t,n){var i=t;Es(t)&&(i=Ga(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}},lc.prototype.jf=function(t,e,n){for(var r=-1;;){var i=["count="+e];-1==r?0<e?(r=t[0].Pc,i.push("ofs="+r)):r=0:i.push("ofs="+r);for(var o=!0,s=0;s<e;s++){var a=t[s].Pc,u=t[s].map;if(0>(a-=r))r=Math.max(0,t[s].Pc-100),o=!1;else try{this.hf(u,i,"req"+a+"_")}catch(t){n&&n(u)}}if(o)return i.join("&")}},lc.prototype.zc=function(t){return this.jg.parse(t)};var pc=ds.JSON.parse;function dc(t){Ha.call(this),this.headers=new Hu,this.Xa=t||null,this.ha=!1,this.mc=this.c=null,this.ge=this.Tb="",this.Pa=0,this.I="",this.Aa=this.Lc=this.Qb=this.Ec=!1,this.vb=0,this.hc=null,this.Ae=yc,this.jc=this.lg=this.Ab=!1}Rs(dc,Ha);var yc="";dc.prototype.s=_u("goog.net.XhrIo");var mc=/^https?$/i,gc=["POST","PUT"];function vc(t){return"content-type"==t.toLowerCase()}function bc(t,e){return{type:e,lengthComputable:t.lengthComputable,loaded:t.loaded,total:t.total}}function _c(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return Js(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),ys(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return t.l(e,n),t}function wc(t){this.Bd=22,this.De=0,this.M=[],this.a=new Tu,this.Ib=new function(){this.od=this.$d=null},this.na=this.md=this.hb=this.K=this.u=this.Kc=this.aa=this.gb=this.N=this.Rb=this.A=null,this.Te=!0,this.ag=this.Yb=0,this.kf=!!ms("internalChannelParams.failFast",t),this.fd=this.Ja=this.wa=this.ia=this.ea=this.i=null,this.Se=!0,this.w=this.he=this.Sb=-1,this.rc=this.Ha=this.La=0,this.Ve=ms("internalChannelParams.baseRetryDelayMs",t)||5e3,this.vg=ms("internalChannelParams.retryDelaySeedMs",t)||1e4,this.nf=ms("internalChannelParams.forwardChannelMaxRetries",t)||2,this.Od=ms("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Xa=t&&t.oh||void 0,this.Db=void 0,this.Ra=0,this.gc=t&&t.supportsCrossDomainXhr||!1,this.ra="",this.G=new uc(t&&t.concurrentRequestLimit),this.kc=new lc,this.ta=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.Nd=t&&t.fastHandshake||!1)&&!this.ta&&(this.a.T("Force backgroundChannelTest when fastHandshake is enabled."),this.ta=!0),t&&t.Id&&this.a.Id()}function Ec(){}function Tc(){if(aa&&!(10<=Number(ma)))throw Error("Environmental error: no available transport.")}function Sc(t,e){Ha.call(this),this.b=new wc(e),this.yb=t,this.Qg=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e=r?e+i:e+"/"+i)}return e}(this.yb,"test"),this.s=_u("goog.labs.net.webChannel.WebChannelBaseTransport"),this.Rc=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.b.ga(t),t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.zd&&(t?t["X-WebChannel-Client-Profile"]=e.zd:t={"X-WebChannel-Client-Profile":e.zd}),this.b.Eg(t),(t=e&&e.httpHeadersOverwriteParam)&&!Ks(t)&&this.b.Cg(t),this.Og=e&&e.supportsCrossDomainXhr||!1,this.zg=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ks(e)&&(this.b.Dg(e),null!==(t=this.Rc)&&e in t&&(e in(t=this.Rc)&&delete t[e],(t=this.s)&&t.T("Ignore httpSessionIdParam also specified with messageUrlParams: "+e,void 0))),this.vd=new Nc(this)}function Ic(t){Fu.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.ne=t)&&(t=this.ne,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Cc(t){Uu.call(this),this.status=1,this.errorCode=t}function Nc(t){this.b=t}(ls=dc.prototype).Je=function(t){this.Ab=t},ls.send=function(t,e,n,r){if(this.c)throw Error("[goog.net.XhrIo] Object is active with another request="+this.Tb+"; newUri="+t);e=e?e.toUpperCase():"GET",this.Tb=t,this.I="",this.Pa=0,this.ge=e,this.Ec=!1,this.ha=!0,this.c=this.df(),this.mc=this.Xa?this.Xa.Vd():Mu.Vd(),this.c.onreadystatechange=Ns(this.te,this),this.lg&&"onprogress"in this.c&&(this.c.onprogress=Ns(function(t){this.re(t,!0)},this),this.c.upload&&(this.c.upload.onprogress=Ns(this.re,this)));try{Eu(this.s,this.da("Opening Xhr")),this.Lc=!0,this.c.open(e,String(t),!0),this.Lc=!1}catch(t){return Eu(this.s,this.da("Error opening Xhr: "+t.message)),void this.Ld(t)}t=n||"";var i=this.headers.clone();r&&Qu(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=vc,n=t.length,r=ys(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:ys(t)?t.charAt(e):t[e]}(i.W()),n=ds.FormData&&t instanceof ds.FormData,!(0<=xs(gc,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.c.setRequestHeader(e,t)},this),this.Ae&&(this.c.responseType=this.Ae),"withCredentials"in this.c&&this.c.withCredentials!==this.Ab&&(this.c.withCredentials=this.Ab);try{this.yd(),0<this.vb&&(this.jc=function(t){return aa&&va(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.c),Eu(this.s,this.da("Will abort after "+this.vb+"ms if incomplete, xhr2 "+this.jc)),this.jc?(this.c.timeout=this.vb,this.c.ontimeout=Ns(this.Ua,this)):this.hc=su(this.Ua,this.vb,this)),Eu(this.s,this.da("Sending request")),this.Qb=!0,this.c.send(t),this.Qb=!1}catch(t){Eu(this.s,this.da("Send error: "+t.message)),this.Ld(t)}},ls.df=function(){return this.Xa?this.Xa.Dd():Mu.Dd()},ls.Ua=function(){void 0!==ps&&this.c&&(this.I="Timed out after "+this.vb+"ms, aborting",this.Pa=8,Eu(this.s,this.da(this.I)),this.dispatchEvent("timeout"),this.abort(8))},ls.Ld=function(t){this.ha=!1,this.c&&(this.Aa=!0,this.c.abort(),this.Aa=!1),this.I=t,this.Pa=5,this.Jd(),this.Gb()},ls.Jd=function(){this.Ec||(this.Ec=!0,this.dispatchEvent("complete"),this.dispatchEvent("error"))},ls.abort=function(t){this.c&&this.ha&&(Eu(this.s,this.da("Aborting")),this.ha=!1,this.Aa=!0,this.c.abort(),this.Aa=!1,this.Pa=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),this.Gb())},ls.F=function(){this.c&&(this.ha&&(this.ha=!1,this.Aa=!0,this.c.abort(),this.Aa=!1),this.Gb(!0)),dc.L.F.call(this)},ls.te=function(){this.Ka||(this.Lc||this.Qb||this.Aa?this.se():this.eg())},ls.eg=function(){this.se()},ls.se=function(){if(this.ha&&void 0!==ps)if(this.mc[1]&&4==this.ma()&&2==this.za())Eu(this.s,this.da("Local request error detected and ignored"));else if(this.Qb&&4==this.ma())su(this.te,0,this);else if(this.dispatchEvent("readystatechange"),this.Mc()){Eu(this.s,this.da("Request complete")),this.ha=!1;try{this.Rf()?(this.dispatchEvent("complete"),this.dispatchEvent("success")):(this.Pa=6,this.I=this.Yd()+" ["+this.za()+"]",this.Jd())}finally{this.Gb()}}},ls.re=function(t,e){this.dispatchEvent(bc(t,"progress")),this.dispatchEvent(bc(t,e?"downloadprogress":"uploadprogress"))},ls.Gb=function(t){if(this.c){this.yd();var e=this.c,n=this.mc[0]?gs:null;this.mc=this.c=null,t||this.dispatchEvent("ready");try{e.onreadystatechange=n}catch(e){(t=this.s)&&t.ca("Problem encountered resetting onreadystatechange: "+e.message,void 0)}}},ls.yd=function(){this.c&&this.jc&&(this.c.ontimeout=null),this.hc&&(ds.clearTimeout(this.hc),this.hc=null)},ls.Ba=function(){return!!this.c},ls.Mc=function(){return 4==this.ma()},ls.Rf=function(){var t=this.za();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}return e||0===t&&!this.Of()},ls.Of=function(){var t=String(this.Tb).match(zu)[1]||null;return!t&&ds.self&&ds.self.location&&(t=(t=ds.self.location.protocol).substr(0,t.length-1)),mc.test(t?t.toLowerCase():"")},ls.ma=function(){return this.c?this.c.readyState:0},ls.za=function(){try{return 2<this.ma()?this.c.status:-1}catch(t){return-1}},ls.Yd=function(){try{return 2<this.ma()?this.c.statusText:""}catch(t){return Eu(this.s,"Can not get status: "+t.message),""}},ls.ya=function(){try{return this.c?this.c.responseText:""}catch(t){return Eu(this.s,"Can not get responseText: "+t.message),""}},ls.yf=function(t){if(this.c){var e=this.c.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),pc(e)}},ls.getResponseHeader=function(t){if(this.c&&this.Mc())return null===(t=this.c.getResponseHeader(t))?void 0:t},ls.getAllResponseHeaders=function(){return this.c&&this.Mc()&&this.c.getAllResponseHeaders()||""},ls.kb=function(t){return this.c?this.c.getResponseHeader(t):null},ls.Ud=function(){return this.Pa},ls.Hc=function(){return ys(this.I)?this.I:String(this.I)},ls.da=function(t){return t+" ["+this.ge+" "+this.Tb+" "+this.za()+"]"},(ls=wc.prototype).tc=8,ls.g=1,ls.connect=function(t,e,n,r,i){this.a.debug("connect()"),Du(0),this.K=e,this.gb=n||{},r&&void 0!==i&&(this.gb.OSID=r,this.gb.OAID=i),this.ta&&(this.a.debug("connect() bypassed channel-test."),this.Ib.$d=[],this.Ib.od=!1),this.bf(t)},ls.disconnect=function(){if(this.a.debug("disconnect()"),this.qd(),3==this.g){var t=this.Yb++,e=this.hb.clone();e.l("SID",this.ra),e.l("RID",t),e.l("TYPE","terminate"),this.Ya(e),new Bu(this,this.a,this.ra,t,void 0).yg(e)}this.qe()},ls.bf=function(t){this.a.debug("connectTest_()"),this.Ja=new oc(this,this.a),null===this.N&&this.Ja.ga(this.A);var e=t;this.N&&this.A&&(e=_c(t,this.N,this.A)),this.Ja.connect(e)},ls.af=function(){this.a.debug("connectChannel_()"),this.hb=this.Sd(this.K),this.Dc()},ls.qd=function(){this.Ja&&(this.Ja.abort(),this.Ja=null),this.u&&(this.u.cancel(),this.u=null),this.ia&&(ds.clearTimeout(this.ia),this.ia=null),this.Hb(),this.G.cancel(),this.ea&&(ds.clearTimeout(this.ea),this.ea=null)},ls.ga=function(t){this.A=t},ls.Eg=function(t){this.Rb=t},ls.Cg=function(t){this.N=t},ls.Dg=function(t){this.aa=t},ls.Fe=function(t){this.Kc=t},ls.He=function(t){this.Ra=t},ls.Hg=function(){this.gc=!0},ls.Ee=function(t){this.i=t},ls.Nf=function(){return!this.fd},ls.Zc=function(t){1e3==this.M.length&&this.a.ca(function(){return"Already have 1000 queued maps upon queueing "+Ga(t)}),this.M.push(new function(t,e){this.Pc=t,this.map=e,this.context=null}(this.ag++,t)),3==this.g&&this.Dc()},ls.qf=function(){return this.kf?0:this.nf},ls.de=function(){return 0==this.g},ls.getState=function(){return this.g},ls.Dc=function(){this.G.ee()||this.ea||(this.ea=Ru(Ns(this.we,this),0),this.La=0)},ls.Yf=function(t){return this.G.xf()>=this.G.Xb-(this.ea?1:0)?(this.a.ca("Unexpected retry request is scheduled."),!1):this.ea?(this.a.debug("Use the retry request that is already scheduled."),this.M=t.la().concat(this.M),!0):!(1==this.g||2==this.g||this.La>=this.qf())&&(this.a.debug("Going to retry POST"),this.ea=Ru(Ns(this.we,this,t),this.Xd(this.La)),this.La++,!0)},ls.we=function(t){this.ea=null,this.Mg(t)},ls.Mg=function(t){this.a.debug("startForwardChannel_"),1==this.g?t?this.a.ca("Not supposed to retry the open"):(this.ig(),this.g=2):3==this.g&&(t?this.le(t):0==this.M.length?this.a.debug("startForwardChannel_ returned: nothing to send"):this.G.ee()?this.a.ca("startForwardChannel_ returned: connection already in progress"):(this.le(),this.a.debug("startForwardChannel_ finished, sent request")))},ls.ig=function(){this.a.debug("open_()"),this.Yb=Math.floor(1e5*Math.random());var t=this.Yb++,e=new Bu(this,this.a,"",t,void 0),n=this.A;this.Rb&&(n?na(n=ta(n),this.Rb):n=this.Rb),null===this.N&&e.ga(n);var r=this.Hd(e),i=this.hb.clone();i.l("RID",t),0<this.Bd&&i.l("CVER",this.Bd),this.ta&&this.aa&&i.l("X-HTTP-Session-Id",this.aa),this.Ya(i),this.N&&n&&_c(i,this.N,n),this.G.oc(e),this.Nd?(i.l("$req",r),i.l("SID","null"),e.Ag(),e.kd(i,null)):e.kd(i,r)},ls.le=function(t){var e=t?t.R:this.Yb++,n=this.hb.clone();n.l("SID",this.ra),n.l("RID",e),n.l("AID",this.Sb),this.Ya(n),this.N&&this.A&&_c(n,this.N,this.A),e=new Bu(this,this.a,this.ra,e,this.La+1),null===this.N&&e.ga(this.A),t&&this.sg(t),t=this.Hd(e),e.setTimeout(Math.round(.5*this.Od)+Math.round(.5*this.Od*Math.random())),this.G.oc(e),e.kd(n,t)},ls.Ya=function(t){this.i&&Qu({},function(e,n){t.l(n,e)})},ls.Hd=function(t){var e=Math.min(this.M.length,1e3),n=this.i?Ns(this.i.Ue,this.i,this):null;return n=this.kc.jf(this.M,e,n),t.Gg(this.M.splice(0,e)),n},ls.sg=function(t){this.M=t.la().concat(this.M)},ls.Kd=function(){if(!this.u&&!this.ia){this.rc=1;var t=this.ve;Ja||eu(),nu||(Ja(),nu=!0),ru.add(t,this),this.Ha=0}},ls.Qc=function(){return this.u||this.ia?(this.a.ca("Request already in progress"),!1):!(3<=this.Ha)&&(this.a.debug("Going to retry GET"),this.rc++,this.ia=Ru(Ns(this.ve,this),this.Xd(this.Ha)),this.Ha++,!0)},ls.ve=function(){this.ia=null,this.Kg()},ls.Kg=function(){this.a.debug("Creating new HttpRequest"),this.u=new Bu(this,this.a,this.ra,"rpc",this.rc),null===this.N&&this.u.ga(this.A),this.u.He(this.Ra);var t=this.md.clone();t.l("RID","rpc"),t.l("SID",this.ra),t.l("CI",this.fd?"0":"1"),t.l("AID",this.Sb),this.Ya(t),t.l("TYPE","xmlhttp"),this.N&&this.A&&_c(t,this.N,this.A),this.Db&&this.u.setTimeout(this.Db),this.u.jd(t,!0,this.na),this.a.debug("New Request created")},ls.ub=function(t,e){this.a.debug("Test Connection Finished");var n=t.Ad;n&&this.G.ld(n),this.fd=this.Se&&e,this.w=t.w,this.af()},ls.dd=function(t){this.a.debug("Test Connection Failed"),this.w=t.w,this.sa(2)},ls.ue=function(t,e){if(0!=this.g&&(this.u==t||this.G.Jc(t)))if(this.w=t.w,!t.lb&&this.G.Jc(t)&&3==this.g){try{var n=this.kc.zc(e)}catch(t){n=null}bs(n)&&3==n.length?this.Cf(n,t):(this.a.debug("Bad POST response data returned"),this.sa(11))}else(t.lb||this.u==t)&&this.Hb(),Ks(e)||(n=this.kc.zc(e),this.dg(n,t))},ls.Cf=function(t,e){0==t[0]?this.Bf(e):(this.he=t[1],0<(e=this.he-this.Sb)&&(t=t[2],this.a.debug(t+" bytes (in "+e+" arrays) are outstanding on the BackChannel"),this.Jg(t)&&!this.wa&&(this.wa=Ru(Ns(this.bg,this),6e3))))},ls.Bf=function(t){if(this.a.debug("Server claims our backchannel is missing."),this.ia)this.a.debug("But we are currently starting the request.");else{if(this.u){if(!(this.u.qb+3e3<t.qb))return;this.Hb(),this.u.cancel(),this.u=null}else this.a.T("We do not have a BackChannel established");this.Qc(),Du(18)}},ls.Jg=function(t){return 37500>t&&!this.Nf()&&0==this.Ha},ls.$a=function(t){return this.Te?this.i?this.i.$a(t):t:null},ls.bg=function(){null!=this.wa&&(this.wa=null,this.u.cancel(),this.u=null,this.Qc(),Du(19))},ls.Hb=function(){null!=this.wa&&(ds.clearTimeout(this.wa),this.wa=null)},ls.Tc=function(t){this.a.debug("Request complete");var e=null;if(this.u==t){this.Hb(),this.u=null;var n=2}else{if(!this.G.Jc(t))return;e=t.la(),this.G.ze(t),n=1}if(this.w=t.w,0!=this.g)if(t.S)1==n?(function(t,e,n){Su.dispatchEvent(new Au(Su,t,e,n))}(t.Da?t.Da.length:0,As()-t.qb,this.La),this.Dc()):this.Kd();else{var r=t.Hc();if(3==r||0==r&&0<this.w)this.a.debug("Not retrying due to error type");else{var i=this;if(this.a.debug(function(){return"Maybe retrying, last error: "+function(t,e){switch(t){case 0:return"Non-200 return code ("+e+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}(r,i.w)}),1==n&&this.Yf(t)||2==n&&this.Qc())return;this.a.debug("Exceeded max number of retries")}switch(e&&0<e.length&&this.G.Re(e),this.a.debug("Error: HTTP request failed"),r){case 1:this.sa(5);break;case 4:this.sa(10);break;case 3:this.sa(6);break;default:this.sa(2)}}},ls.Xd=function(t){var e=this.Ve+Math.floor(Math.random()*this.vg);return this.Ba()||(this.a.debug("Inactive channel"),e*=2),e*t},ls.pc=function(t){if(this.ta&&(t=t.h)){var e=t.kb("X-Client-Wire-Protocol");e&&this.G.ld(e),this.aa&&((t=t.kb("X-HTTP-Session-Id"))?(this.Fe(t),this.hb.l(this.aa,t)):this.a.T("Missing X_HTTP_SESSION_ID in the handshake response"))}},ls.dg=function(t,e){for(var n=this.i&&this.i.sc?[]:null,r=0;r<t.length;r++){var i=t[r];if(this.Sb=i[0],i=i[1],2==this.g)if("c"==i[0]){this.ra=i[1],this.na=this.$a(i[2]);var o=i[3];null!=o&&(this.tc=o,this.a.info("VER="+this.tc)),null!=(o=i[4])&&(this.De=o,this.a.info("SVER="+this.De)),null!=(i=i[5])&&"number"==typeof i&&0<i&&(this.Db=i*=1.5,this.a.info("backChannelRequestTimeoutMs_="+i)),this.pc(e),this.g=3,this.i&&this.i.wd(),this.Lg(e)}else"stop"!=i[0]&&"close"!=i[0]||this.sa(7);else 3==this.g&&("stop"==i[0]||"close"==i[0]?(n&&0!=n.length&&(this.i.sc(this,n),n.length=0),"stop"==i[0]?this.sa(7):this.disconnect()):"noop"!=i[0]&&(n?n.push(i):this.i&&this.i.ud(i)),this.Ha=0)}n&&0!=n.length&&this.i.sc(this,n)},ls.Lg=function(t){this.md=this.Pd(this.na,this.K),t.lb?(this.a.debug("Upgrade the handshake request to a backchannel."),this.G.ze(t),t.tg(this.Db),this.u=t):this.Kd()},ls.sa=function(t){if(this.a.info("Error code "+t),2==t){var e=null;this.i&&(e=null);var n=Ns(this.Pg,this);e||(e=new Yu("//www.google.com/images/cleardot.gif"),ds.location&&"http"==ds.location.protocol||e.tb("https"),e.Ub()),function(t,e){var n=new Tu;n.debug("TestLoadImage: loading "+t);var r=new Image;r.onload=Ds(fc,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Ds(fc,n,r,"TestLoadImage: error",!1,e),r.onabort=Ds(fc,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ds(fc,n,r,"TestLoadImage: timeout",!1,e),ds.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}(e.toString(),n)}else Du(2);this.cg(t)},ls.Pg=function(t){t?(this.a.info("Successfully pinged google.com"),Du(2)):(this.a.info("Failed to ping google.com"),Du(1))},ls.cg=function(t){this.a.debug("HttpChannel: error - "+t),this.g=0,this.i&&this.i.td(t),this.qe(),this.qd()},ls.qe=function(){if(this.g=0,this.w=-1,this.i){var t=this.G.la();if(0!=t.length||0!=this.M.length){var e=this;this.a.debug(function(){return"Number of undelivered maps, pending: "+t.length+", outgoing: "+e.M.length}),this.G.$e(),js(this.M),this.M.length=0}this.i.sd()}},ls.Sd=function(t){return t=this.Cd(null,t),this.a.debug("GetForwardChannelUri: "+t),t},ls.Pd=function(t,e){return t=this.Cd(this.fc()?t:null,e),this.a.debug("GetBackChannelUri: "+t),t},ls.Cd=function(t,e){var n=function(t){return t instanceof Yu?t.clone():new Yu(t,void 0)}(e);if(""!=n.xa)t&&n.rb(t+"."+n.xa),n.sb(n.Ca);else{var r=ds.location;n=function(t,e,n,r){var i=new Yu(null,void 0);return t&&i.tb(t),e&&i.rb(e),n&&i.sb(n),r&&i.ec(r),i}(r.protocol,t?t+"."+r.hostname:r.hostname,+r.port,e)}return this.gb&&Js(this.gb,function(t,e){n.l(e,t)}),t=this.aa,e=this.Kc,t&&e&&n.l(t,e),n.l("VER",this.tc),this.Ya(n),n},ls.Jb=function(t){if(t&&!this.gc)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new dc(this.Xa)).Je(this.gc),t},ls.Ba=function(){return!!this.i&&this.i.Ba()},ls.fc=function(){return this.gc},(ls=Ec.prototype).sc=null,ls.wd=function(){},ls.ud=function(){},ls.td=function(){},ls.sd=function(){},ls.Ba=function(){return!0},ls.Ue=function(){},ls.$a=function(t){return t},Tc.prototype.cf=function(t,e){return new Sc(t,e)},Rs(Sc,Ha),(ls=Sc.prototype).addEventListener=function(t,e,n,r){Sc.L.addEventListener.call(this,t,e,n,r)},ls.removeEventListener=function(t,e,n,r){Sc.L.removeEventListener.call(this,t,e,n,r)},ls.open=function(){this.b.Ee(this.vd),this.Og&&this.b.Hg(),this.b.connect(this.Qg,this.yb,this.Rc||void 0)},ls.close=function(){this.b.disconnect()},ls.send=function(t){if(ys(t)){var e={};e.__data__=t,this.b.Zc(e)}else this.zg?((e={}).__data__=Ga(t),this.b.Zc(e)):this.b.Zc(t)},ls.F=function(){this.b.Ee(null),delete this.vd,this.b.disconnect(),delete this.b,Sc.L.F.call(this)},Rs(Ic,Fu),Rs(Cc,Uu),Rs(Nc,Ec),Nc.prototype.wd=function(){wu(this.b.s,"WebChannel opened on "+this.b.yb),this.b.dispatchEvent("a")},Nc.prototype.ud=function(t){this.b.dispatchEvent(new Ic(t))},Nc.prototype.td=function(t){wu(this.b.s,"WebChannel aborted on "+this.b.yb+" due to channel error: "+t),this.b.dispatchEvent(new Cc(t))},Nc.prototype.sd=function(){wu(this.b.s,"WebChannel closed on "+this.b.yb),this.b.dispatchEvent("b")};var Dc=Ds(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},Tc);function Ac(){this.V=[],this.Z=[]}function Rc(t,e){if(Ps.call(this),this.oe=t||0,this.Wb=e||10,this.oe>this.Wb)throw Error(kc);this.fa=new Ac,this.oa=new sc,this.Ac=0,this.Nc=null,this.Cb()}(ls=Ac.prototype).Vf=function(){0==this.V.length&&(this.V=this.Z,this.V.reverse(),this.Z=[])},ls.enqueue=function(t){this.Z.push(t)},ls.ab=function(){return this.Vf(),this.V.pop()},ls.C=function(){return this.V.length+this.Z.length},ls.X=function(){return 0==this.V.length&&0==this.Z.length},ls.clear=function(){this.V=[],this.Z=[]},ls.contains=function(t){return 0<=xs(this.V,t)||0<=xs(this.Z,t)},ls.remove=function(t){var e=this.V,n=Fs(e,t);return 0<=n?(Array.prototype.splice.call(e,n,1),e=!0):e=!1,e||Vs(this.Z,t)},ls.H=function(){for(var t=[],e=this.V.length-1;0<=e;--e)t.push(this.V[e]);var n=this.Z.length;for(e=0;e<n;++e)t.push(this.Z[e]);return t},Rs(Rc,Ps);var kc="[goog.structs.Pool] Min can not be greater than max";function Oc(t,e){this.fe=t,this.gd=e}function Pc(t){this.Y=[],t&&this.Lf(t)}function Lc(){Pc.call(this)}function Mc(t,e){this.Gd=void 0,this.cc=new Lc,Rc.call(this,t,e)}function xc(t,e,n,r){this.Jf=t,this.Ab=!!r,Mc.call(this,e,n)}(ls=Rc.prototype).Mb=function(){var t=As();if(!(null!=this.Nc&&t-this.Nc<this.Ac)){var e=this.qg();return e&&(this.Nc=t,this.oa.add(e)),e}},ls.og=function(t){return!!this.oa.remove(t)&&(this.nc(t),!0)},ls.qg=function(){for(var t;0<this.Td()&&(t=this.fa.ab(),!this.Sc(t));)this.Cb();return!t&&this.C()<this.Wb&&(t=this.xc()),t},ls.nc=function(t){this.oa.remove(t),this.Sc(t)&&this.C()<this.Wb?this.fa.enqueue(t):this.Bc(t)},ls.Cb=function(){for(var t=this.fa;this.C()<this.oe;)t.enqueue(this.xc());for(;this.C()>this.Wb&&0<this.Td();)this.Bc(t.ab())},ls.xc=function(){return{}},ls.Bc=function(t){if("function"==typeof t.bb)t.bb();else for(var e in t)t[e]=null},ls.Sc=function(t){return"function"!=typeof t.Ye||t.Ye()},ls.contains=function(t){return this.fa.contains(t)||this.oa.contains(t)},ls.C=function(){return this.fa.C()+this.oa.C()},ls.rf=function(){return this.oa.C()},ls.Td=function(){return this.fa.C()},ls.X=function(){return this.fa.X()&&this.oa.X()},ls.F=function(){if(Rc.L.F.call(this),0<this.rf())throw Error("[goog.structs.Pool] Objects not released");delete this.oa;for(var t=this.fa;!t.X();)this.Bc(t.ab());delete this.fa},Oc.prototype.getKey=function(){return this.fe},Oc.prototype.clone=function(){return new Oc(this.fe,this.gd)},(ls=Pc.prototype).ce=function(t,e){var n=this.Y;n.push(new Oc(t,e)),this.$f(n.length-1)},ls.Lf=function(t){if(t instanceof Pc){var e=t.W();if(t=t.H(),0>=this.C()){for(var n=this.Y,r=0;r<e.length;r++)n.push(new Oc(e[r],t[r]));return}}else e=Zs(t),t=$s(t);for(r=0;r<e.length;r++)this.ce(e[r],t[r])},ls.remove=function(){var t=this.Y,e=t.length,n=t[0];if(!(0>=e))return 1==e?Bs(t):(t[0]=t.pop(),this.Zf()),n.gd},ls.Zf=function(){for(var t=0,e=this.Y,n=e.length,r=e[t];t<n>>1;){var i=this.tf(t),o=this.zf(t);if(e[i=o<n&&e[o].getKey()<e[i].getKey()?o:i].getKey()>r.getKey())break;e[t]=e[i],t=i}e[t]=r},ls.$f=function(t){for(var e=this.Y,n=e[t];0<t;){var r=this.wf(t);if(!(e[r].getKey()>n.getKey()))break;e[t]=e[r],t=r}e[t]=n},ls.tf=function(t){return 2*t+1},ls.zf=function(t){return 2*t+2},ls.wf=function(t){return t-1>>1},ls.H=function(){for(var t=this.Y,e=[],n=t.length,r=0;r<n;r++)e.push(t[r].gd);return e},ls.W=function(){for(var t=this.Y,e=[],n=t.length,r=0;r<n;r++)e.push(t[r].getKey());return e},ls.va=function(t){return qs(this.Y,function(e){return e.getKey()==t})},ls.clone=function(){return new Pc(this)},ls.C=function(){return this.Y.length},ls.X=function(){return 0==this.Y.length},ls.clear=function(){Bs(this.Y)},Rs(Lc,Pc),Lc.prototype.enqueue=function(t,e){this.ce(t,e)},Lc.prototype.ab=function(){return this.remove()},Rs(Mc,Rc),(ls=Mc.prototype).Mb=function(t,e){if(!t)return(t=Mc.L.Mb.call(this))&&this.Ac&&(this.Gd=ds.setTimeout(Ns(this.Nb,this),this.Ac)),t;this.cc.enqueue(void 0!==e?e:100,t),this.Nb()},ls.Nb=function(){for(var t=this.cc;0<t.C();){var e=this.Mb();if(!e)break;t.ab().apply(this,[e])}},ls.nc=function(t){Mc.L.nc.call(this,t),this.Nb()},ls.Cb=function(){Mc.L.Cb.call(this),this.Nb()},ls.F=function(){Mc.L.F.call(this),ds.clearTimeout(this.Gd),this.cc.clear(),this.cc=null},Rs(xc,Mc),xc.prototype.xc=function(){var t=new dc,e=this.Jf;return e&&e.forEach(function(e,n){t.headers.set(n,e)}),this.Ab&&t.Je(!0),t},xc.prototype.Sc=function(t){return!t.Ka&&!t.Ba()},Tc.prototype.createWebChannel=Tc.prototype.cf,Sc.prototype.send=Sc.prototype.send,Sc.prototype.open=Sc.prototype.open,Sc.prototype.close=Sc.prototype.close,ku.NO_ERROR=0,ku.TIMEOUT=8,ku.HTTP_ERROR=6,Ou.COMPLETE="complete",Lu.EventType=xu,xu.OPEN="a",xu.CLOSE="b",xu.ERROR="c",xu.MESSAGE="d",Ha.prototype.listen=Ha.prototype.nb,xc.prototype.getObject=xc.prototype.Mb,xc.prototype.releaseObject=xc.prototype.og,dc.prototype.listenOnce=dc.prototype.Oc,dc.prototype.getLastError=dc.prototype.Hc,dc.prototype.getLastErrorCode=dc.prototype.Ud,dc.prototype.getStatus=dc.prototype.za,dc.prototype.getStatusText=dc.prototype.Yd,dc.prototype.getResponseJson=dc.prototype.yf,dc.prototype.getResponseText=dc.prototype.ya,dc.prototype.getResponseText=dc.prototype.ya,dc.prototype.send=dc.prototype.send;var Fc,Uc,qc={createWebChannelTransport:Dc,ErrorCode:ku,EventType:Ou,WebChannel:Lu,XhrIoPool:xc},Bc=qc.createWebChannelTransport,Vc=qc.ErrorCode,Wc=qc.EventType,jc=qc.WebChannel,Kc=qc.XhrIoPool,Qc=Yn.SDK_VERSION,Hc=new $n("@firebase/firestore");function Gc(){return Hc.logLevel===Gn.DEBUG?Fc.DEBUG:Hc.logLevel===Gn.SILENT?Fc.SILENT:Fc.ERROR}function zc(t){switch(t){case Fc.DEBUG:Hc.logLevel=Gn.DEBUG;break;case Fc.ERROR:Hc.logLevel=Gn.ERROR;break;case Fc.SILENT:Hc.logLevel=Gn.SILENT;break;default:Hc.error("Firestore ("+Qc+"): Invalid value passed to `setLogLevel`")}}function Yc(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Hc.logLevel<=Gn.DEBUG){var i=n.map(Jc);Hc.debug.apply(Hc,["Firestore ("+Qc+") ["+t+"]: "+e].concat(i))}}function Xc(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Hc.logLevel<=Gn.ERROR){var r=e.map(Jc);Hc.error.apply(Hc,["Firestore ("+Qc+"): "+t].concat(r))}}function Jc(t){if("string"==typeof t)return t;var e=th.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function $c(t){var e="FIRESTORE ("+Qc+") INTERNAL ASSERTION FAILED: "+t;throw Xc(e),new Error(e)}function Zc(t,e){t||$c(e)}(Uc=Fc||(Fc={}))[Uc.DEBUG=0]="DEBUG",Uc[Uc.ERROR=1]="ERROR",Uc[Uc.SILENT=2]="SILENT";var th=function(){function t(){}return t.setPlatform=function(e){t.platform&&$c("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||$c("Platform not set"),t.platform},t}();function eh(){return th.getPlatform().emptyByteString}var nh={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},rh=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Je(e,t),e}(Error);function ih(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new rh(nh.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function oh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function sh(t,e){return void 0!==t?t:e}function ah(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function uh(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ch(t){for(var e in Zc(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function hh(t,e,n){if(e.length!==n)throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires "+Ch(n,"argument")+", but was called with "+Ch(e.length,"argument")+".")}function lh(t,e,n){if(e.length<n)throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Ch(n,"argument")+", but was called with "+Ch(e.length,"argument")+".")}function fh(t,e,n,r){if(e.length<n||e.length>r)throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Ch(e.length,"argument")+".")}function ph(t,e,n,r){bh(t,e,Ih(n)+" argument",r)}function dh(t,e,n,r){void 0!==r&&ph(t,e,n,r)}function yh(t,e,n,r){bh(t,e,n+" option",r)}function mh(t,e,n,r){void 0!==r&&yh(t,e,n,r)}function gh(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+wh(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+wh(r[o]))}(t,e,n,r,i)}function vh(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,a=i;s<a.length;s++){var u=a[s];if(u===r)return;o.push(wh(u))}var c=wh(r);throw new rh(nh.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function bh(t,e,n,r){if(!("object"===e?_h(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=wh(r);throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function _h(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function wh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":$c("Unknown wrong type: "+typeof t)}function Eh(t,e,n){if(void 0===n)throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Ih(e)+" argument, but it was undefined.")}function Th(t,e,n){uh(e,function(e,r){if(n.indexOf(e)<0)throw new rh(nh.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function Sh(t,e,n,r){var i=wh(r);return new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires its "+Ih(n)+" argument to be a "+e+", but it was: "+i)}function Ih(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ch(t,e){return t+" "+e+(1===t?"":"s")}var Nh=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Zc(20===e.length,"Invalid auto ID: "+e),e},t}();function Dh(t,e){return t<e?-1:t>e?1:0}function Ah(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Rh(){if("undefined"==typeof Uint8Array)throw new rh(nh.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function kh(){if(!th.getPlatform().base64Available)throw new rh(nh.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Oh,Ph,Lh=function(){function t(t){kh(),this._binaryString=t}return t.fromBase64String=function(e){hh("Blob.fromBase64String",arguments,1),ph("Blob.fromBase64String","string",1,e),kh();try{return new t(th.getPlatform().atob(e))}catch(t){throw new rh(nh.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(hh("Blob.fromUint8Array",arguments,1),Rh(),!(e instanceof Uint8Array))throw Sh("Blob.fromUint8Array","Uint8Array",1,e);return new t(Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join(""))},t.prototype.toBase64=function(){return hh("Blob.toBase64",arguments,0),kh(),th.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){hh("Blob.toUint8Array",arguments,0),Rh();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return Dh(this._binaryString,t._binaryString)},t}(),Mh=ih(Lh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),xh=function(){function t(t,e){if(hh("GeoPoint",arguments,2),ph("GeoPoint","number",1,t),ph("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new rh(nh.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new rh(nh.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return Dh(this._lat,t._lat)||Dh(this._long,t._long)},t}(),Fh=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new rh(nh.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new rh(nh.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new rh(nh.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new rh(nh.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Dh(this.nanoseconds,t.nanoseconds):Dh(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),Uh=function(){return function(t,e,n,r){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r}}(),qh="(default)",Bh=function(){function t(t,e){this.projectId=t,this.database=e||qh}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===qh},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return Dh(this.projectId,t.projectId)||Dh(this.database,t.database)},t}(),Vh=function(){function t(t,e,n){this.init(t,e,n)}return t.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&$c("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&$c("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},t.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):"string"==typeof e?n.push(e):$c("Unknown parameter type for Path.child(): "+e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,Zc(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return Zc(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return Zc(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return Zc(!this.isEmpty(),"Can't call lastSegment() on empty path"),this.segments[this.limit()-1]},t.prototype.get=function(t){return Zc(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Wh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new rh(nh.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return t.length>0}))},e.EMPTY_PATH=new e([]),e}(Vh),jh=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Kh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Je(e,t),e.isValidIdentifier=function(t){return jh.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new rh(nh.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new rh(nh.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new rh(nh.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new rh(nh.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(Vh),Qh=function(){function t(e){this.path=e,Zc(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.isEqual=function(t){return null!==t&&0===Wh.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Wh.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Wh(e.slice()))},t.fromPathString=function(e){return new t(Wh.fromString(e))},t.EMPTY=new t(new Wh([])),t}(),Hh=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return Qh.comparator(t.key,e.key)},t}(),Gh=function(t){function e(e,n,r,i,o){var s=t.call(this,e,n)||this;return s.data=r,s.proto=o,s.hasLocalMutations=!!i.hasLocalMutations,s.hasCommittedMutations=!!i.hasCommittedMutations,s}return Je(e,t),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return void 0!==r&&void 0!==i?r.compareTo(i):$c("Trying to compare documents on fields that don't exist")},e}(Hh),zh=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Je(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Hh),Yh=function(t){function e(e,n){return t.call(this,e,n)||this}return Je(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Hh),Xh=function(){function t(t,e){this.comparator=t,this.root=e||$h.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,$h.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$h.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Jh(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Jh(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Jh(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Jh(this.root,t,this.comparator,!0)},t}(),Jh=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){Zc(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),$h=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw $c("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw $c("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw $c("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),Zh=function(){function t(){this.size=0}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new $h(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();$h.EMPTY=new Zh,function(t){t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue"}(Oh||(Oh={})),function(t){t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous"}(Ph||(Ph={}));var tl=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(Ph.Estimate,n);case"previous":return new t(Ph.Previous,n);case"none":case void 0:return new t(Ph.Default,n);default:return $c("fromSnapshotOptions() called with invalid options.")}},t}(),el=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return Zc(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Dh(this.typeOrder,t.typeOrder)},t}(),nl=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=Oh.NullValue,e.internalValue=null,e}return Je(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(el),rl=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Oh.BooleanValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Dh(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(el),il=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Oh.NumberValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue,r=t.internalValue,n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1):this.defaultCompareTo(t);var n,r},e}(el);function ol(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var sl=function(t){function e(e){return t.call(this,e)||this}return Je(e,t),e.prototype.isEqual=function(t){return t instanceof e&&ol(this.internalValue,t.internalValue)},e}(il),al=function(t){function e(e){var n=t.call(this,e)||this;return n.internalValue=e,n}return Je(e,t),e.prototype.isEqual=function(t){return t instanceof e&&ol(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(il),ul=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Oh.StringValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Dh(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(el),cl=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Oh.TimestampValue,n}return Je(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof hl?-1:this.defaultCompareTo(t)},e}(el),hl=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=Oh.TimestampValue,r}return Je(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===Ph.Estimate?new cl(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Ph.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof cl?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(el),ll=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Oh.BlobValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(el),fl=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=Oh.RefValue,r}return Je(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:Qh.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(el),pl=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Oh.GeoPointValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(el),dl=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Oh.ObjectValue,n}return Je(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),s=Dh(i.key,o.key)||i.value.compareTo(o.value);if(s)return s}return Dh(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(Zc(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(Zc(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return void 0!==this.field(t)},e.prototype.field=function(t){Zc(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach(function(t){n=n instanceof e&&n.internalValue.get(t)||void 0}),n},e.prototype.toString=function(){return JSON.stringify(this.value())},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new Xh(Dh)),e}(el),yl=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Oh.ArrayValue,n}return Je(e,t),e.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return Dh(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return JSON.stringify(this.value())},e}(el),ml=Number,gl=ml.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),vl=ml.MAX_SAFE_INTEGER||Math.pow(2,53)-1,bl=ml.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function _l(t){return null===t||void 0===t}function wl(t){return bl(t)&&t<=vl&&t>=gl}var El,Tl=function(){function t(t,e,n,r,i,o){void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),this.path=t,this.explicitOrderBy=e,this.filters=n,this.limit=r,this.startAt=i,this.endAt=o,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[Ol]:this.memoizedOrderBy=[new kl(t),Ol];else{Zc(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var s=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Al.ASCENDING;this.memoizedOrderBy.push(s===Al.ASCENDING?Ol:Pl)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){Zc(null==this.getInequalityFilterField()||!(e instanceof Cl)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Zc(!Qh.isDocumentKey(this.path),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){Zc(!Qh.isDocumentKey(this.path),"No ordering allowed for document query"),Zc(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,n,this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.withLimit=function(e){return new t(this.path,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}_l(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),_l(this.limit)||(t+=", limit: "+this.limit),this.explicitOrderBy.length>0&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt))},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return Zc(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesAncestor(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimit=function(){return!_l(this.limit)},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Cl&&n.isInequality())return n.field}return null},t.prototype.hasArrayContainsFilter=function(){return void 0!==this.filters.find(function(t){return t instanceof Cl&&t.op===Il.ARRAY_CONTAINS})},t.prototype.isDocumentQuery=function(){return Qh.isDocumentKey(this.path)&&0===this.filters.length},t.prototype.matchesAncestor=function(t){var e=t.key.path;return Qh.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isPrefixOf(e)&&this.path.length===e.length-1},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&void 0===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){Zc(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),Sl=function(){function t(){}return t.create=function(t,e,n){if(n.isEqual(nl.INSTANCE)){if(e!==Il.EQUAL)throw new rh(nh.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on null.");return new Nl(t)}if(n.isEqual(al.NAN)){if(e!==Il.EQUAL)throw new rh(nh.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on NaN.");return new Dl(t)}return new Cl(t,e,n)},t}(),Il=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;default:return $c("Unknown relation: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t}(),Cl=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return Je(e,t),e.prototype.matches=function(t){if(this.field.isKeyField()){Zc(this.value instanceof fl,"Comparing on key, but filter value not a RefValue"),Zc(this.op!==Il.ARRAY_CONTAINS,"array-contains queries don't make sense on document keys.");var e=this.value,n=Qh.comparator(t.key,e.key);return this.matchesComparison(n)}var r=t.field(this.field);return void 0!==r&&this.matchesValue(r)},e.prototype.matchesValue=function(t){var e=this;return this.op===Il.ARRAY_CONTAINS?t instanceof yl&&void 0!==t.internalValue.find(function(t){return t.isEqual(e.value)}):this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case Il.LESS_THAN:return t<0;case Il.LESS_THAN_OR_EQUAL:return t<=0;case Il.EQUAL:return 0===t;case Il.GREATER_THAN:return t>0;case Il.GREATER_THAN_OR_EQUAL:return t>=0;default:return $c("Unknown relation op"+this.op)}},e.prototype.isInequality=function(){return this.op!==Il.EQUAL&&this.op!==Il.ARRAY_CONTAINS},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(Sl),Nl=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return Je(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return void 0!==e&&null===e.value()},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"},e.prototype.toString=function(){return this.field.canonicalString()+" IS null"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(Sl),Dl=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return Je(e,t),e.prototype.matches=function(t){var e=t.field(this.field),n=e&&e.value();return"number"==typeof n&&isNaN(n)},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(Sl),Al=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),Rl=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){Zc(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Zc(o instanceof fl,"Bound has a non-key value where the key path is being used."),n=Qh.comparator(o.key,e.key);else{var s=e.field(i.field);Zc(void 0!==s,"Field should exist since document matched the orderBy already."),n=o.compareTo(s)}if(i.dir===Al.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];return n.isEqual(r)}return!0},t}(),kl=function(){function t(t,e){this.field=t,void 0===e&&(e=Al.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Gh.compareByKey(t,e):Gh.compareByField(this.field,t,e);switch(this.dir){case Al.ASCENDING:return n;case Al.DESCENDING:return-1*n;default:return $c("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),Ol=new kl(Kh.keyField(),Al.ASCENDING),Pl=new kl(Kh.keyField(),Al.DESCENDING),Ll=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new Fh(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new Fh(0,0)),t}();!function(t){t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution"}(El||(El={}));var Ml,xl=function(){function t(t,e,n,r,i,o){void 0===i&&(i=Ll.MIN),void 0===o&&(o=eh()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return t.prototype.copy=function(e){return new t(this.query,this.targetId,this.purpose,void 0===e.sequenceNumber?this.sequenceNumber:e.sequenceNumber,void 0===e.snapshotVersion?this.snapshotVersion:e.snapshotVersion,void 0===e.resumeToken?this.resumeToken:e.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},t}(),Fl=function(){function t(t){this.comparator=t,this.data=new Xh(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Ul(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Ul(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Ul=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),ql=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new Fl(Kh.comparator);return e.forEach(function(t){return n=n.add(t)}),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),Bl=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),Vl=function(){return function(t,e){this.version=t,this.transformResults=e}}();!function(t){t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete"}(Ml||(Ml={}));var Wl=function(){function t(t,e){this.updateTime=t,this.exists=e,Zc(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Gh&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Gh:(Zc(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!==e&&void 0!==e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),jl=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&Zc(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof Gh?t.version:Ll.MIN},t}(),Kl=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=Ml.Set,i}return Je(e,t),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Zc(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Gh(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=jl.getPostMutationVersion(t);return new Gh(this.key,r,this.value,{hasLocalMutations:!0})},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(jl),Ql=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=Ml.Patch,o}return Je(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Zc(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Yh(this.key,e.version);var n=this.patchDocument(t);return new Gh(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=jl.getPostMutationVersion(t),i=this.patchDocument(t);return new Gh(this.key,r,i,{hasLocalMutations:!0})},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof Gh?t.data:dl.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=void 0!==r?t.set(n,r):t.delete(n)}}),t},e}(jl),Hl=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=Ml.Transform,r.precondition=Wl.exists(!0),r}return Je(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Zc(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Yh(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new Gh(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,e),o=this.transformObject(r.data,i);return new Gh(this.key,r.version,o,{hasLocalMutations:!0})},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&Ah(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){Zc(t instanceof Gh,"Unknown MaybeDocument type "+t);var e=t;return Zc(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];Zc(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Gh&&(s=t.field(i.field)||null),n.push(o.applyToRemoteDocument(s,e[r]))}return n},e.prototype.localTransformResults=function(t,e){for(var n=[],r=0,i=this.fieldTransforms;r<i.length;r++){var o=i[r],s=o.transform,a=null;e instanceof Gh&&(a=e.field(o.field)||null),n.push(s.applyToLocalView(a,t))}return n},e.prototype.transformObject=function(t,e){Zc(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(jl),Gl=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=Ml.Delete,r}return Je(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Zc(null==e.transformResults,"Transform results received by DeleteMutation."),new zh(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Zc(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new zh(this.key,Ll.forDeletedDoc())):t},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(jl),zl=function(){function t(){}return t.prototype.applyToLocalView=function(t,e){return new hl(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),Yl=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=Jl(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new yl(e)},t.prototype.isEqual=function(e){return e instanceof t&&Ah(e.elements,this.elements)},t}(),Xl=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=Jl(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new yl(e)},t.prototype.isEqual=function(e){return e instanceof t&&Ah(e.elements,this.elements)},t}();function Jl(t){return t instanceof yl?t.internalValue.slice():[]}var $l,Zl=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}();function tf(t){switch(t){case nh.OK:return $c("Treated status OK as error");case nh.CANCELLED:case nh.UNKNOWN:case nh.DEADLINE_EXCEEDED:case nh.RESOURCE_EXHAUSTED:case nh.INTERNAL:case nh.UNAVAILABLE:case nh.UNAUTHENTICATED:return!1;case nh.INVALID_ARGUMENT:case nh.NOT_FOUND:case nh.ALREADY_EXISTS:case nh.PERMISSION_DENIED:case nh.FAILED_PRECONDITION:case nh.ABORTED:case nh.OUT_OF_RANGE:case nh.UNIMPLEMENTED:case nh.DATA_LOSS:return!0;default:return $c("Unknown status code: "+t)}}function ef(t){if(void 0===t)return Xc("GRPC error has no .code"),nh.UNKNOWN;switch(t){case $l.OK:return nh.OK;case $l.CANCELLED:return nh.CANCELLED;case $l.UNKNOWN:return nh.UNKNOWN;case $l.DEADLINE_EXCEEDED:return nh.DEADLINE_EXCEEDED;case $l.RESOURCE_EXHAUSTED:return nh.RESOURCE_EXHAUSTED;case $l.INTERNAL:return nh.INTERNAL;case $l.UNAVAILABLE:return nh.UNAVAILABLE;case $l.UNAUTHENTICATED:return nh.UNAUTHENTICATED;case $l.INVALID_ARGUMENT:return nh.INVALID_ARGUMENT;case $l.NOT_FOUND:return nh.NOT_FOUND;case $l.ALREADY_EXISTS:return nh.ALREADY_EXISTS;case $l.PERMISSION_DENIED:return nh.PERMISSION_DENIED;case $l.FAILED_PRECONDITION:return nh.FAILED_PRECONDITION;case $l.ABORTED:return nh.ABORTED;case $l.OUT_OF_RANGE:return nh.OUT_OF_RANGE;case $l.UNIMPLEMENTED:return nh.UNIMPLEMENTED;case $l.DATA_LOSS:return nh.DATA_LOSS;default:return $c("Unknown status code: "+t)}}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}($l||($l={}));var nf=new Xh(Qh.comparator);function rf(){return nf}function of(){return rf()}var sf=new Xh(Qh.comparator);function af(){return sf}var uf=new Xh(Qh.comparator);function cf(){return uf}var hf=new Fl(Qh.comparator);function lf(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=hf,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var ff=new Fl(Dh);function pf(){return ff}var df,yf,mf=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Qh.comparator(e.key,n.key)}:function(t,e){return Qh.comparator(t.key,e.key)},this.keyedMap=af(),this.sortedSet=new Xh(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();!function(t){t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata"}(df||(df={})),function(t){t[t.Local=0]="Local",t[t.Synced=1]="Synced"}(yf||(yf={}));var gf,vf=function(){function t(){this.changeMap=new Xh(Qh.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==df.Added&&n.type===df.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===df.Metadata&&n.type!==df.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===df.Modified&&n.type===df.Modified?this.changeMap=this.changeMap.insert(e,{type:df.Modified,doc:t.doc}):t.type===df.Modified&&n.type===df.Added?this.changeMap=this.changeMap.insert(e,{type:df.Added,doc:t.doc}):t.type===df.Removed&&n.type===df.Added?this.changeMap=this.changeMap.remove(e):t.type===df.Removed&&n.type===df.Modified?this.changeMap=this.changeMap.insert(e,{type:df.Removed,doc:n.doc}):t.type===df.Added&&n.type===df.Removed?this.changeMap=this.changeMap.insert(e,{type:df.Modified,doc:t.doc}):$c("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),bf=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:df.Added,doc:t})}),new t(e,n,mf.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),_f=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=wf.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(Ll.MIN,i,pf(),rf(),lf())},t}(),wf=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(eh(),n,lf(),lf(),lf())},t}(),Ef=function(){return function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r}}(),Tf=function(){return function(t,e){this.targetId=t,this.existenceFilter=e}}();!function(t){t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset"}(gf||(gf={}));var Sf=function(){return function(t,e,n,r){void 0===n&&(n=eh()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}(),If=function(){function t(){this.pendingResponses=0,this.documentChanges=Df(),this._resumeToken=eh(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=lf(),e=lf(),n=lf();return this.documentChanges.forEach(function(r,i){switch(i){case df.Added:t=t.add(r);break;case df.Modified:e=e.add(r);break;case df.Removed:n=n.add(r);break;default:$c("Encountered invalid change type: "+i)}}),new wf(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=Df()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),Cf=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=rf(),this.pendingDocumentTargetMapping=Nf(),this.pendingTargetResets=new Fl(Dh)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Gh?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof zh&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case gf.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case gf.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case gf.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),Zc(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case gf.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case gf.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:$c("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):ah(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new Qh(i.path);this.removeDocumentFromTarget(e,o,new zh(o,Ll.forDeletedDoc()))}else Zc(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};ah(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var s=new Qh(o.query.path);null!==e.pendingDocumentUpdates.get(s)||e.targetContainsDocument(r,s)||e.removeDocumentFromTarget(r,s,new zh(s,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=lf();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===El.LimboResolution||(i=!1,!1)}),i&&(r=r.add(t))});var i=new _f(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=rf(),this.pendingDocumentTargetMapping=Nf(),this.pendingTargetResets=new Fl(Dh),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?df.Modified:df.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,df.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new If),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Fl(Dh),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){return null!==this.queryDataForActiveTarget(t)},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;Zc(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new If,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function Nf(){return new Xh(Qh.comparator)}function Df(){return new Xh(Qh.comparator)}var Af,Rf,kf=((Af={})[Al.ASCENDING.name]="ASCENDING",Af[Al.DESCENDING.name]="DESCENDING",Af),Of=((Rf={})[Il.LESS_THAN.name]="LESS_THAN",Rf[Il.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Rf[Il.GREATER_THAN.name]="GREATER_THAN",Rf[Il.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Rf[Il.EQUAL.name]="EQUAL",Rf[Il.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Rf),Pf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lf(t,e){Zc(!_l(t),e+" is missing")}function Mf(t){return"number"==typeof t?t:"string"==typeof t?Number(t):$c("can't parse "+t)}var xf=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?nh.UNKNOWN:ef(t.code);return new rh(e,t.message||"")},t.prototype.toInt32Value=function(t){return _l(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return _l(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Zc(!!t,"Cannot deserialize null or undefined timestamp.");var e=Mf(t.seconds||"0"),n=t.nanos||0;return new Fh(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=Pf.exec(t);if(Zc(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Fh(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(Zc(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Lh.fromBase64String(t)):(Zc(!this.options.useProto3Json,"Expected bytes to be passed in as string, but got something else instead."),Lh.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return Zc(!!t,"Trying to deserialize version that isn't set"),Ll.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=Wh.fromString(t);return Zc(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return Zc(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Zc(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Qh(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Wh.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new Wh(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new Wh(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return Zc(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof nl)return{nullValue:"NULL_VALUE"};if(t instanceof rl)return{booleanValue:t.value()};if(t instanceof sl)return{integerValue:""+t.value()};if(t instanceof al){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof ul?{stringValue:t.value()}:t instanceof dl?{mapValue:this.toMapValue(t)}:t instanceof yl?{arrayValue:this.toArrayValue(t)}:t instanceof cl?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof pl?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof ll?{bytesValue:this.toBytes(t.value())}:t instanceof fl?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:$c("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this,n=t.value_type;if(Ff(t,n,"nullValue"))return nl.INSTANCE;if(Ff(t,n,"booleanValue"))return rl.of(t.booleanValue);if(Ff(t,n,"integerValue"))return new sl(Mf(t.integerValue));if(Ff(t,n,"doubleValue")){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return al.NAN;if("Infinity"===t.doubleValue)return al.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return al.NEGATIVE_INFINITY}return new al(t.doubleValue)}if(Ff(t,n,"stringValue"))return new ul(t.stringValue);if(Ff(t,n,"mapValue"))return this.fromFields(t.mapValue.fields||{});if(Ff(t,n,"arrayValue")){Lf(t.arrayValue,"arrayValue");var r=t.arrayValue.values||[];return new yl(r.map(function(t){return e.fromValue(t)}))}if(Ff(t,n,"timestampValue"))return Lf(t.timestampValue,"timestampValue"),new cl(this.fromTimestamp(t.timestampValue));if(Ff(t,n,"geoPointValue")){Lf(t.geoPointValue,"geoPointValue");var i=t.geoPointValue.latitude||0,o=t.geoPointValue.longitude||0;return new pl(new xh(i,o))}if(Ff(t,n,"bytesValue")){Lf(t.bytesValue,"bytesValue");var s=this.fromBlob(t.bytesValue);return new ll(s)}if(Ff(t,n,"referenceValue")){Lf(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),u=new Bh(a.get(1),a.get(3)),c=new Qh(this.extractLocalPathFromResourceName(a));return new fl(u,c)}return $c("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return Zc(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new Gh(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=t,r=dl.EMPTY;return uh(n,function(t,n){r=r.set(new Kh([t]),e.fromValue(n))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){Zc(!!t.found,"Tried to deserialize a found document from a missing document."),Lf(t.found.name,"doc.found.name"),Lf(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new Gh(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){Zc(!!t.missing,"Tried to deserialize a missing document from a found document."),Zc(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new zh(e,n)},t.prototype.fromMaybeDocument=function(t){var e=t.result;return Ff(t,e,"found")?this.fromFound(t):Ff(t,e,"missing")?this.fromMissing(t):$c("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case gf.Added:return"ADD";case gf.Current:return"CURRENT";case gf.NoChange:return"NO_CHANGE";case gf.Removed:return"REMOVE";case gf.Reset:return"RESET";default:return $c("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof Tf)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof Ef){if(t.newDoc instanceof Gh){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof zh){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof Sf){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return $l.OK;switch(t){case nh.OK:return $l.OK;case nh.CANCELLED:return $l.CANCELLED;case nh.UNKNOWN:return $l.UNKNOWN;case nh.DEADLINE_EXCEEDED:return $l.DEADLINE_EXCEEDED;case nh.RESOURCE_EXHAUSTED:return $l.RESOURCE_EXHAUSTED;case nh.INTERNAL:return $l.INTERNAL;case nh.UNAVAILABLE:return $l.UNAVAILABLE;case nh.UNAUTHENTICATED:return $l.UNAUTHENTICATED;case nh.INVALID_ARGUMENT:return $l.INVALID_ARGUMENT;case nh.NOT_FOUND:return $l.NOT_FOUND;case nh.ALREADY_EXISTS:return $l.ALREADY_EXISTS;case nh.PERMISSION_DENIED:return $l.PERMISSION_DENIED;case nh.FAILED_PRECONDITION:return $l.FAILED_PRECONDITION;case nh.ABORTED:return $l.ABORTED;case nh.OUT_OF_RANGE:return $l.OUT_OF_RANGE;case nh.UNIMPLEMENTED:return $l.UNIMPLEMENTED;case nh.DATA_LOSS:return $l.DATA_LOSS;default:return $c("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return $c("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=t.response_type;if(Ff(t,n,"targetChange")){Lf(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),s=t.targetChange.cause,a=s&&this.fromRpcStatus(s);e=new Sf(r,i,o,a||null)}else if(Ff(t,n,"documentChange")){Lf(t.documentChange,"documentChange"),Lf(t.documentChange.document,"documentChange.name"),Lf(t.documentChange.document.name,"documentChange.document.name"),Lf(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=this.fromFields(u.document.fields||{}),f=new Gh(c,h,l,{},u.document),p=u.targetIds||[],d=u.removedTargetIds||[];e=new Ef(p,d,f.key,f)}else if(Ff(t,n,"documentDelete")){Lf(t.documentDelete,"documentDelete"),Lf(t.documentDelete.document,"documentDelete.document");var y=t.documentDelete;c=this.fromName(y.document),h=y.readTime?this.fromVersion(y.readTime):Ll.forDeletedDoc(),f=new zh(c,h),d=y.removedTargetIds||[];e=new Ef([],d,f.key,f)}else if(Ff(t,n,"documentRemove")){Lf(t.documentRemove,"documentRemove"),Lf(t.documentRemove.document,"documentRemove");var m=t.documentRemove;c=this.fromName(m.document),d=m.removedTargetIds||[];e=new Ef([],d,c,null)}else{if(!Ff(t,n,"filter"))return $c("Unknown change type "+JSON.stringify(t));Lf(t.filter,"filter"),Lf(t.filter.targetId,"filter.targetId");var g=t.filter,v=g.count||0,b=new Zl(v),_=g.targetId;e=new Tf(_,b)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?gf.NoChange:"ADD"===t?gf.Added:"REMOVE"===t?gf.Removed:"CURRENT"===t?gf.Current:"RESET"===t?gf.Reset:$c("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!Ff(t,t.response_type,"targetChange"))return Ll.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ll.MIN:e.readTime?this.fromVersion(e.readTime):Ll.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof Kl)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Gl)e={delete:this.toName(t.key)};else if(t instanceof Ql)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Hl))return $c("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Wl.NONE;if(t.update){Lf(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Ql(r,i,o,n)}return new Kl(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new Gl(r,n)}if(t.transform){r=this.fromName(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Zc(!0===n.exists,'Transforms only support precondition "exists == true"'),new Hl(r,s)}return $c("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return Zc(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:$c("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Wl.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Wl.exists(t.exists):Wl.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new Vl(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(Zc(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof zl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Yl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Xl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};throw $c("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=t.transform_type,r=null;if(Ff(t,n,"setToServerValue"))Zc("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),r=zl.instance;else if(Ff(t,n,"appendMissingElements")){var i=t.appendMissingElements.values||[];r=new Yl(i.map(function(t){return e.fromValue(t)}))}else if(Ff(t,n,"removeAllFromArray")){i=t.removeAllFromArray.values||[];r=new Xl(i.map(function(t){return e.fromValue(t)}))}else $c("Unknown transform proto: "+JSON.stringify(t));var o=Kh.fromServerFormat(t.fieldPath);return new Bl(o,r)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Zc(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Tl.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}};if(t.path.isEmpty())e.parent=this.toQueryPath(Wh.EMPTY_PATH);else{var n=t.path;Zc(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]}var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0;if(r>0){Zc(1===r,"StructuredQuery.from with more than one collection is not supported.");var i=n.from[0];e=e.child(i.collectionId)}var o=[];n.where&&(o=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var a=null;n.limit&&(a=this.fromInt32Value(n.limit));var u=null;n.startAt&&(u=this.fromCursor(n.startAt));var c=null;return n.endAt&&(c=this.fromCursor(n.endAt)),new Tl(e,s,o,a,u,c)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case El.Listen:return null;case El.ExistenceFilterMismatch:return"existence-filter-mismatch";case El.LimboResolution:return"limbo-document";default:return $c("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof Cl?e.toRelationFilter(t):e.toUnaryFilter(t)});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromRelationFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):$c("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new Rl(r,n)},t.prototype.toDirection=function(t){return kf[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return Al.ASCENDING;case"DESCENDING":return Al.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Of[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Il.EQUAL;case"GREATER_THAN":return Il.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Il.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Il.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Il.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Il.ARRAY_CONTAINS;case"OPERATOR_UNSPECIFIED":return $c("Unspecified relation");default:return $c("Unknown relation")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return Kh.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new kl(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.toRelationFilter=function(t){return t instanceof Cl?{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}:$c("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromRelationFilter=function(t){return new Cl(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryFilter=function(t){return t instanceof Dl?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}}:t instanceof Nl?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}:$c("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return new Dl(e);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return new Nl(n);case"OPERATOR_UNSPECIFIED":return $c("Unspecified filter");default:return $c("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Kh.fromServerFormat(t)});return ql.fromArray(e)},t}();function Ff(t,e,n){return e===n||!e&&n in t}var Uf=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){Zc(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){Zc(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){Zc(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){Zc(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){Zc(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){Zc(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),qf="Connection",Bf={BatchGetDocuments:"batchGet",Commit:"commit"},Vf="gl-js/ fire/"+Qc,Wf=function(){function t(t){this.databaseId=t.databaseId,this.pool=new Kc;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=Vf},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,s){r.pool.getObject(function(a){a.listenOnce(Wc.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Vc.NO_ERROR:var e=a.getResponseJson();Yc(qf,"XHR received:",JSON.stringify(e)),o(e);break;case Vc.TIMEOUT:Yc(qf,'RPC "'+t+'" timed out'),s(new rh(nh.DEADLINE_EXCEEDED,"Request time out"));break;case Vc.HTTP_ERROR:var n=a.getStatus();Yc(qf,'RPC "'+t+'" failed with status:',n,"response text:",a.getResponseText()),n>0?s(new rh(function(t){switch(t){case 200:return nh.OK;case 400:return nh.INVALID_ARGUMENT;case 401:return nh.UNAUTHENTICATED;case 403:return nh.PERMISSION_DENIED;case 404:return nh.NOT_FOUND;case 409:return nh.ABORTED;case 416:return nh.OUT_OF_RANGE;case 429:return nh.RESOURCE_EXHAUSTED;case 499:return nh.CANCELLED;case 500:return nh.UNKNOWN;case 501:return nh.UNIMPLEMENTED;case 503:return nh.UNAVAILABLE;case 504:return nh.DEADLINE_EXCEEDED;default:return t>=200&&t<300?nh.OK:t>=400&&t<500?nh.FAILED_PRECONDITION:t>=500&&t<600?nh.INTERNAL:nh.UNKNOWN}}(n),"Server responded with status "+a.getStatusText())):(Yc(qf,'RPC "'+t+'" failed'),s(new rh(nh.UNAVAILABLE,"Connection failed.")));break;default:$c('RPC "'+t+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Yc(qf,'RPC "'+t+'" completed.'),r.pool.releaseObject(a)}});var u=JSON.stringify(e);Yc(qf,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),a.send(i,"POST",u,c,15)})})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Bc(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0};this.modifyHeadersForRequest(i.initMessageHeaders,e),yn()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");Yc(qf,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),a=!1,u=!1,c=new Uf({sendFn:function(t){u?Yc(qf,"Not sending because WebChannel is closed:",t):(a||(Yc(qf,"Opening WebChannel transport."),s.open(),a=!0),Yc(qf,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}}),h=function(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(jc.EventType.OPEN,function(){u||Yc(qf,"WebChannel transport opened.")}),h(jc.EventType.CLOSE,function(){u||(u=!0,Yc(qf,"WebChannel transport closed"),c.callOnClose())}),h(jc.EventType.ERROR,function(t){u||(u=!0,Yc(qf,"WebChannel transport errored:",t),c.callOnClose(new rh(nh.UNAVAILABLE,"The operation could not be completed")))}),h(jc.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];Zc(!!e,"Got a webchannel message without data.");var n=e.error||e[0]&&e[0].error;if(n){Yc(qf,"WebChannel received error:",n);var r=n.status,i=function(t){var e=$l[t];if(void 0!==e)return ef(e)}(r),o=n.message;void 0===i&&(i=nh.INTERNAL,o="Unknown error status: "+r+" with message "+n.message),u=!0,c.callOnClose(new rh(i,o)),s.close()}else Yc(qf,"WebChannel received:",e),c.callOnMessage(e)}}),setTimeout(function(){c.callOnOpen()},0),c},t.prototype.makeUrl=function(t){var e=Bf[t];Zc(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),jf=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new Wf(t))},t.prototype.newSerializer=function(t){return new xf(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();th.setPlatform(new jf);var Kf,Qf=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),Hf=function(){return function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}}();!function(t){t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection"}(Kf||(Kf={}));var Gf=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Hf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rh(nh.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),zf=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var e=this;this.verifyNotFailed();var n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Xc("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Zc(e>=0,"Attempted to schedule an operation with a negative delay of "+e),Zc(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=Gf.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&$c("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){Zc(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){Zc(t===Kf.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==Kf.All&&i.timerId===t)break}return e.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Zc(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Yf="",Xf="",Jf="",$f="";function Zf(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ep(e)),e=tp(t.get(n),e);return ep(e)}function tp(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Yf+Jf;break;case Yf:n+=Yf+$f;break;default:n+=o}}return n}function ep(t){return t+Yf+Xf}function np(t){var e=t.length;if(Zc(e>=2,"Invalid path "+t),2===e)return Zc(t.charAt(0)===Yf&&t.charAt(1)===Xf,"Non-empty path "+t+" had length 2"),Wh.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf(Yf,o);switch((s<0||s>n)&&$c('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case Xf:var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case Jf:i+=t.substring(o,s),i+="\0";break;case $f:i+=t.substring(o,s+1);break;default:$c('Invalid encoded resource path: "'+t+'"')}o=s+2}return new Wh(r)}var rp,ip=function(){function t(t,e,n){this.batchId=t,this.localWriteTime=e,this.mutations=n,Zc(n.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&Zc(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Zc(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.applyToRemoteDocument(e,s)}}return e},t.prototype.applyToLocalView=function(t,e){e&&Zc(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=e,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t)&&(e=i.applyToLocalView(e,n,this.localWriteTime))}return e},t.prototype.keys=function(){for(var t=lf(),e=0,n=this.mutations;e<n.length;e++){var r=n[e];t=t.add(r.key)}return t},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ah(this.mutations,t.mutations)},t}(),op=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){Zc(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=cf(),s=e.mutations,a=0;a<s.length;a++)o=o.insert(s[a].key,r[a].version);return new t(e,n,r,i,o)},t}(),sp=1;!function(t){t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine"}(rp||(rp={}));var ap=function(){function t(t,e){this.generatorId=t,Zc((t&sp)===t,"Generator ID "+t+" contains more than "+sp+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<sp,t},t.prototype.after=function(t){return this.seek(t+(1<<sp)),this.next()},t.prototype.seek=function(t){Zc((t&sp)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(rp.QueryCache,2)},t.forSyncEngine=function(){return new t(rp.SyncEngine)},t}(),up=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&$c("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++){r(o[i])}return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),cp=function(){function t(t){this.db=t}return t.openOrCreate=function(e,n,r){return Zc(t.isAvailable(),"IndexedDB not supported in current environment."),Yc("SimpleDb","Opening database:",e),new up(function(i,o){var s=window.indexedDB.open(e,n);s.onsuccess=function(e){var n=e.target.result;i(new t(n))},s.onblocked=function(){o(new rh(nh.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new rh(nh.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},s.onupgradeneeded=function(t){Yc("SimpleDb",'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result,i=new lp(s.transaction);r.createOrUpgrade(n,i,t.oldVersion,Ap).next(function(){Yc("SimpleDb","Database upgrade to version "+Ap+" complete")})}}).toPromise()},t.delete=function(t){return Yc("SimpleDb","Removing database:",t),pp(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=window.navigator.userAgent;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0)},t.getStore=function(t,e){return t.store(e)},t.prototype.runTransaction=function(t,e,n){var r=lp.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),up.reject(t)}).toPromise();return r.completionPromise.then(function(){return i})},t.prototype.close=function(){this.db.close()},t}(),hp=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return pp(this.dbCursor.delete())},t}(),lp=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Hf,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){e.completionDeferred.reject(t.target.error)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Yc("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return Zc(!!e,"Object store not part of transaction: "+t),new fp(e)},t}(),fp=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Yc("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Yc("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),pp(n)},t.prototype.add=function(t){return Yc("SimpleDb","ADD",this.store.name,t,t),pp(this.store.add(t))},t.prototype.get=function(t){var e=this;return pp(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Yc("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Yc("SimpleDb","DELETE",this.store.name,t),pp(this.store.delete(t))},t.prototype.count=function(){return Yc("SimpleDb","COUNT",this.store.name),pp(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){Yc("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new up(function(n,r){e.onerror=function(t){r(t.target.error)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new up(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new hp(i),s=e(i.primaryKey,i.value,o);if(s instanceof up){var a=s.catch(function(t){return o.done(),up.reject(t)});n.push(a)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return up.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Zc(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function pp(t){return new up(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){n(t.target.error)}})}var dp=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=ap.forQueryCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Ll.fromTimestamp(new Fh(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return gp(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return yp(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return Zc(e.targetCount>0,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return yp(t).iterate(function(s,a){var u=r.serializer.fromDbTarget(a);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return up.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return yp(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return mp(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,fd.getStore(n,Wp.store)).put(Wp.key,e);var n},t.prototype.saveQueryData=function(t,e){return yp(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return yp(t).iterate({range:i,index:Bp.queryTargetsIndexName},function(t,r,i){var s=n.serializer.fromDbTarget(r);e.isEqual(s.query)&&(o=s,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=vp(t);return e.forEach(function(e){var s=Zf(e.path);i.push(o.put(new Vp(n,s))),i.push(r.referenceDelegate.addReference(t,e))}),up.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=vp(t);return up.forEach(e,function(e){var o=Zf(e.path);return up.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=vp(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=vp(t),i=lf();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=np(t[1]),o=new Qh(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n,r=Zf(e.path),i=IDBKeyRange.bound([r],[(n=r,n+"\0")],!1,!0),o=0;return vp(t).iterate({index:Vp.documentTargetsIndex,keysOnly:!0,range:i},function(t,e,n){var r=t[0];t[1];0!==r&&(o++,n.done())}).next(function(){return o>0})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return yp(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function yp(t){return fd.getStore(t,Bp.store)}function mp(t){return cp.getStore(t,Wp.store).get(Wp.key).next(function(t){return Zc(null!==t,"Missing metadata row."),t})}function gp(t){return mp(t).next(function(t){return t.highestListenSequenceNumber})}function vp(t){return fd.getStore(t,Vp.store)}var bp=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){uh(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}})},t.prototype.isEmpty=function(){return ch(this.inner)},t}(),_p=function(){function t(){this.changes=rf(),this.documentSizes=new bp(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?up.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return Zc(null!==this.changes,"Changes have already been applied."),this.changes},t}(),wp="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",Ep=function(){function t(t,e){this.serializer=t,this.keepDocumentChangeLog=e,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=cp.getStore(t,Kp.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(e.length>0){for(var i=Ip(t),o=lf(),s=0,a=e;s<a.length;s++){var u=a[s],c=u.key,h=u.doc;r.push(i.put(Np(c),h)),o=o.add(c)}this.keepDocumentChangeLog&&r.push(Cp(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return up.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=Ip(t),r=Np(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return Dp(t)}):up.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return Ip(t).get(Np(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return Ip(t).get(Np(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Dp(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=of();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=of(),i=new Xh(Qh.comparator);return this.forEachDbEntry(t,e,function(t,e){e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i=i.insert(t,Dp(e))):(r=r.insert(t,null),i=i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return up.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Ip(t).iterate({range:r},function(t,e,r){for(var s=Qh.fromSegments(t);o&&Qh.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e){var n=this,r=af(),i=e.path.toArray(),o=IDBKeyRange.lowerBound(i);return Ip(t).iterate({range:o},function(t,i,o){var s=n.serializer.fromDbRemoteDocument(i);e.path.isPrefixOf(s.key.path)?s instanceof Gh&&e.matches(s)&&(r=r.insert(s.key,s)):o.done()}).next(function(){return r})},t.prototype.getNewDocumentChanges=function(t){var e=this;Zc(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=lf(),r=rf(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,s=Cp(t);return s.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(s).next(function(){return up.reject(new rh(nh.DATA_LOSS,wp))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new zh(n,Ll.forDeletedDoc());r=r.insert(n,e)}))}),up.waitFor(i)}).next(function(){return r})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Cp(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},t.prototype.newChangeBuffer=function(){return new Sp(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Tp(t).get(qp.key).next(function(t){return Zc(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return Tp(t).put(qp.key,e)},t.prototype.updateSize=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},t}();function Tp(t){return fd.getStore(t,qp.store)}var Sp=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return Je(e,t),e.prototype.applyChanges=function(t){var e=this,n=0,r=[];return this.assertChanges().forEach(function(t,i){var o=e.documentCache.serializer.toDbRemoteDocument(i),s=e.documentSizes.get(t);Zc(void 0!==s,"Attempting to change document "+t.toString()+" without having read it first");var a=Dp(o);n+=a-s,r.push({key:t,doc:o})}),this.documentCache.addEntries(t,r,n)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(_p);function Ip(t){return fd.getStore(t,Up.store)}function Cp(t){return fd.getStore(t,Kp.store)}function Np(t){return t.path.toArray()}function Dp(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw $c("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Ap=7,Rp=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Zc(n<r&&n>=0&&r<=Ap,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&r>=1&&(function(t){t.createObjectStore(Op.store)}(t),function(t){t.createObjectStore(Pp.store,{keyPath:Pp.keyPath}),t.createObjectStore(Lp.store,{keyPath:Lp.keyPath,autoIncrement:!0}).createIndex(Lp.userMutationsIndex,Lp.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Mp.store)}(t),jp(t),function(t){t.createObjectStore(Up.store)}(t));var o=up.resolve();return n<3&&r>=3&&(0!==n&&(!function(t){t.deleteObjectStore(Vp.store),t.deleteObjectStore(Bp.store),t.deleteObjectStore(Wp.store)}(t),jp(t)),o=o.next(function(){return function(t){var e=t.store(Wp.store),n=new Wp(0,0,Ll.MIN.toTimestamp(),0);return e.put(Wp.key,n)}(e)})),n<4&&r>=4&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(Lp.store).loadAll().next(function(n){t.deleteObjectStore(Lp.store);var r=t.createObjectStore(Lp.store,{keyPath:Lp.keyPath,autoIncrement:!0});r.createIndex(Lp.userMutationsIndex,Lp.userMutationsKeyPath,{unique:!0});var i=e.store(Lp.store),o=n.map(function(t){return i.put(t)});return up.waitFor(o)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(Qp.store,{keyPath:Qp.keyPath})}(t),function(t){t.createObjectStore(Kp.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&r>=5&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&r>=6&&(o=o.next(function(){return function(t){t.createObjectStore(qp.store)}(t),i.addDocumentGlobal(e)})),n<7&&r>=7&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),o},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Up.store).iterate(function(t,n){e+=Dp(n)}).next(function(){var n=new qp(e);return t.store(qp.store).put(qp.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Pp.store),r=t.store(Lp.store);return n.loadAll().next(function(n){return up.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(Lp.userMutationsIndex,i).next(function(r){return up.forEach(r,function(r){Zc(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return Yp(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Vp.store),n=t.store(Up.store);return gp(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new Wh(n),s=function(t){return[0,Zf(t)]}(o);r.push(e.get(s).next(function(n){return n?up.resolve():function(n){return e.put(new Vp(0,Zf(n),t))}(o)}))}).next(function(){return up.waitFor(r)})})},t}();var kp=function(){return function(t,e){this.seconds=t,this.nanoseconds=e}}(),Op=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var Pp=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),Lp=function(){function t(t,e,n,r){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.mutations=r}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var Mp=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Zf(e)]},t.key=function(t,e,n){return[t,Zf(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var xp=function(){return function(t,e){this.path=t,this.readTime=e}}(),Fp=function(){return function(t,e){this.path=t,this.version=e}}(),Up=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),qp=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var Bp=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),Vp=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,Zc(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),Wp=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}();function jp(t){t.createObjectStore(Vp.store,{keyPath:Vp.keyPath}).createIndex(Vp.documentTargetsIndex,Vp.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Bp.store,{keyPath:Bp.keyPath}).createIndex(Bp.queryTargetsIndexName,Bp.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Wp.store)}var Kp=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}();var Qp=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}();var Hp=[Pp.store,Lp.store,Mp.store,Up.store,Bp.store,Op.store,Wp.store,Vp.store].concat([Qp.store,Kp.store]).concat([qp.store]),Gp=function(){function t(t,e,n){this.userId=t,this.serializer=e,this.referenceDelegate=n,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r){return Zc(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Jp(t).iterate({index:Lp.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=Xp(n),Zp(t).put(e)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=Xp(e),Zp(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n){var r=this,i=$p(t),o=Jp(t);return o.add({}).next(function(t){Zc("number"==typeof t,"Auto-generated key is not a number");var s=new ip(t,e,n),a=r.serializer.toDbMutationBatch(r.userId,s);r.documentKeysByBatchId[t]=s.keys();for(var u=[],c=0,h=n;c<h.length;c++){var l=h[c],f=Mp.key(r.userId,l.key.path,t);u.push(o.put(a)),u.push(i.put(f,Mp.PLACEHOLDER))}return up.waitFor(u).next(function(){return s})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Jp(t).get(e).next(function(t){return t?(Zc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?up.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this;return this.getMutationQueueMetadata(t).next(function(r){var i=e+1,o=IDBKeyRange.lowerBound([n.userId,i]),s=null;return Jp(t).iterate({index:Lp.userMutationsIndex,range:o},function(t,e,r){e.userId===n.userId&&(Zc(e.batchId>=i,"Should have found mutation after "+i),s=n.serializer.fromDbMutationBatch(e)),r.done()}).next(function(){return s})})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Jp(t).loadAll(Lp.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Mp.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return $p(t).iterate({range:i},function(r,i,s){var a=r[0],u=r[1],c=r[2],h=np(u);if(a===n.userId&&e.path.isEqual(h))return Jp(t).get(c).next(function(t){if(!t)throw $c("Dangling document-mutation reference found: "+r+" which points to "+c);Zc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Fl(Dh),i=[];return e.forEach(function(e){var o=Mp.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=$p(t).iterate({range:s},function(t,i,o){var s=t[0],a=t[1],u=t[2],c=np(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(a)}),up.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;Zc(!e.isDocumentQuery(),"Document queries shouldn't go down this path");var r=e.path,i=r.length+1,o=Mp.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Fl(Dh);return $p(t).iterate({range:s},function(t,e,o){var s=t[0],u=t[1],c=t[2],h=np(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,a)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Jp(t).get(e).next(function(t){if(null===t)throw $c("Dangling document-mutation reference found, which points to "+e);Zc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),up.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Yp(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),up.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return up.resolve();var r=IDBKeyRange.lowerBound(Mp.prefixForUser(e.userId)),i=[];return $p(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=np(t[1]);i.push(o)}else r.done()}).next(function(){Zc(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return zp(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return Zp(t).get(this.userId).next(function(t){return t||new Pp(e.userId,-1,"")})},t}();function zp(t,e,n){var r=Mp.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return $p(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],a=t[1];t[2];o===e&&a===i&&(s=!0),r.done()}).next(function(){return s})}function Yp(t,e,n){var r=t.store(Lp.store),i=t.store(Mp.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.iterate({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Zc(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Mp.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return up.waitFor(o).next(function(){return c})}function Xp(t){return t instanceof Uint8Array?(Zc("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Jp(t){return fd.getStore(t,Lp.store)}function $p(t){return fd.getStore(t,Mp.store)}function Zp(t){return fd.getStore(t,Pp.store)}var td=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Qh.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new zh(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=Qh.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new Yh(e,n)}return $c("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof Gh){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Up(null,null,e,n)}if(t instanceof zh){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);n=t.hasCommittedMutations;return new Up(null,new xp(r,i),null,n)}if(t instanceof Yh){r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return new Up(new Fp(r,i),null,null,!0)}return $c("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new kp(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new Fh(t.seconds,t.nanoseconds);return Ll.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Lp(t,e.batchId,e.localWriteTime.toMillis(),r)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),r=Fh.fromMillis(t.localWriteTimeMs);return new ip(t.batchId,r,n)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Zf(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=lf(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Qh(np(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new xl(e,t.targetId,El.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){Zc(El.Listen===t.purpose,"Only queries with purpose "+El.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),t.resumeToken instanceof Uint8Array?(Zc("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new Bp(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function ed(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Dh(n,i);return 0===s?Dh(r,o):s}var nd=function(){function t(t){this.maxElements=t,this.buffer=new Fl(ed),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ed(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),rd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},id=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),od=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}return t.prototype.start=function(){Zc(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==id.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;Zc(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Yc("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Kf.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(pd)})},t}(),sd=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return up.resolve(Qf.INVALID);var r=new nd(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===id.COLLECTION_DISABLED?(Yc("LruGarbageCollector","Garbage collection skipped; disabled"),up.resolve(rd)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Yc("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),rd):n.runGarbageCollection(t,e)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,s,a,u,c,h=this;return o=Date.now(),this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>h.params.maximumSequenceNumbersToCollect?(Yc("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),h.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),h.removeTargets(t,n,e)}).next(function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)}).next(function(t){(c=Date.now(),Gc()<=Fc.DEBUG)&&Yc("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-o)+"ms\n\tDetermined least recently used "+r+" in "+(a-s)+"ms\n\tRemoved "+i+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-o)+"ms");return up.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),ad="IndexedDbPersistence",ud="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",cd="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `experimentalTabSynchronization:true` in all tabs.",hd="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",ld=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return Je(e,t),e}(function(){return function(){}}()),fd=function(){function t(e,n,r,i,o,s,a){if(this.persistenceKey=e,this.clientId=n,this.queue=i,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!t.isAvailable())throw new rh(nh.UNIMPLEMENTED,hd);if(this.referenceDelegate=new md(this,s),this.dbName=e+t.MAIN_DATABASE,this.serializer=new td(o),this.document=r.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new dp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new Ep(this.serializer,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new rh(nh.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof ld)return cp.getStore(t.simpleDbTransaction,e);throw $c("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e,n,r,i,o,s){return Ze(this,void 0,void 0,function(){var a;return tn(this,function(u){switch(u.label){case 0:return[4,(a=new t(e,n,r,i,o,s)).start()];case 1:return u.sent(),[2,a]}})})},t.createMultiClientIndexedDbPersistence=function(e,n,r,i,o,s,a){return Ze(this,void 0,void 0,function(){var u;return tn(this,function(c){switch(c.label){case 0:return[4,(u=new t(e,n,r,i,o,s,a)).start()];case 1:return c.sent(),[2,u]}})})},t.prototype.start=function(){var t=this;return Zc(!this.started,"IndexedDbPersistence double-started!"),Zc(null!==this.window,"Expected 'window' to be defined"),cp.openOrCreate(this.dbName,Ap,new Rp(this.serializer)).then(function(e){t.simpleDb=e}).then(function(){return t.startRemoteDocumentCache()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})}).then(function(){return t.simpleDb.runTransaction("readonly",[Wp.store],function(e){return gp(e).next(function(e){var n=t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0;t.listenSequence=new Qf(e,n)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},t.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",Hp,function(e){return t.remoteDocumentCache.start(e)})},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return Ze(e,void 0,void 0,function(){return tn(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return Ze(e,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",Hp,function(e){return yd(e).put(new Qp(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},t.prototype.verifyPrimaryLease=function(t){var e=this;return dd(t).get(Op.key).next(function(t){return up.resolve(e.isLocalClient(t))})},t.prototype.removeClientMetadata=function(t){return yd(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return Ze(this,void 0,void 0,function(){var e,n,r=this;return tn(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),n=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=t.getStore(i,Qp.store);return o.loadAll().next(function(t){e=r.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)})}).next(function(){return up.forEach(n,function(t){return o.delete(t.clientId)})}).next(function(){if((e=e.filter(function(t){return t.clientId!==r.clientId})).length>0){var t=e.map(function(t){return t.lastProcessedDocumentChangeId||0}),n=Math.min.apply(Math,t);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})]);case 1:i.sent(),n.forEach(function(t){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(t.clientId))}),i.label=2;case 2:return[2]}})})},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Kf.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return dd(t).get(Op.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new rh(nh.FAILED_PRECONDITION,cd);return!1}}return!(!e.networkEnabled||!e.inForeground)||yd(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&Yc(ad,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(t){return Ze(this,void 0,void 0,function(){var e=this;return tn(this,function(n){switch(n.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Op.store,Qp.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return n.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),t?[4,cp.delete(this.dbName)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[Qp.store],function(e){return yd(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return Zc(this.started,"Cannot initialize MutationQueue before persistence is started."),Gp.forUser(t,this.serializer,this.referenceDelegate)},t.prototype.getQueryCache=function(){return Zc(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},t.prototype.getRemoteDocumentCache=function(){return Zc(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;return Yc(ad,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",Hp,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw Xc("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new rh(nh.FAILED_PRECONDITION,ud);return n(new ld(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new ld(i,r.listenSequence.next()))})})},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return dd(t).get(Op.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new rh(nh.FAILED_PRECONDITION,cd)})},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Op(this.clientId,this.allowTabSynchronization,Date.now());return dd(t).put(Op.key,e)},t.isAvailable=function(){return cp.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=dd(t);return n.get(Op.key).next(function(t){return e.isLocalClient(t)?(Yc(ad,"Releasing primary lease."),n.delete(Op.key)):up.resolve()})},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(t>n)||(Xc("Detected an update time that is in the future: "+t+" > "+n),!1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Zc(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Zc("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Yc(ad,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Xc(ad,"Failed to get zombied client id.",t),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Xc("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function pd(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){if(!function(t){return t.code===nh.FAILED_PRECONDITION&&t.message===ud}(t))throw t;return Yc(ad,"Unexpectedly lost primary lease"),[2]})})}function dd(t){return t.store(Op.store)}function yd(t){return t.store(Qp.store)}var md=function(){function t(t,e){this.db=t,this.garbageCollector=new sd(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return gd(t,e)},t.prototype.removeReference=function(t,e){return gd(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return gd(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?up.resolve(!0):function(t,e){var n=!1;return Zp(t).iterateSerial(function(r){return zp(t,r,e).next(function(t){return t&&(n=!0),up.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=0,o=[];return this.forEachOrphanedDocument(t,function(s,a){if(a<=e){var u=n.isPinned(t,s).next(function(e){if(!e)return r++,n.removeOrphanedDocument(t,s).next(function(t){i+=t})});o.push(u)}}).next(function(){return up.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(t,-i)}).next(function(){return r})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return up.waitFor([vp(t).delete((n=e,[0,Zf(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return gd(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=vp(t),i=Qf.INVALID;return r.iterate({index:Vp.documentTargetsIndex},function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==Qf.INVALID&&e(new Qh(np(n)),i),i=a,n=s):i=Qf.INVALID}).next(function(){i!==Qf.INVALID&&e(new Qh(np(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function gd(t,e){return vp(t).put(function(t,e){return new Vp(0,Zf(t.path),e)}(e,t.currentSequenceNumber))}var vd=function(){function t(t,e){this.remoteDocumentCache=t,this.mutationQueue=e}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++){t=i[r].applyToLocalView(e,t)}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=of();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++){e=o[i].applyToLocalView(t,e)}r=r.insert(t,e)}),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=rf();return i.forEach(function(t,e){e||(e=new zh(t,Ll.forDeletedDoc())),o=o.insert(t,e)}),o})},t.prototype.getDocumentsMatchingQuery=function(t,e){return Qh.isDocumentKey(e.path)?this.getDocumentsMatchingDocumentQuery(t,e.path):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Qh(e)).next(function(t){var e=af();return t instanceof Gh&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(i){return n=i,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(t){for(var r=0,i=t;r<i.length;r++)for(var o=i[r],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key;if(e.path.isImmediateParentOf(c.path)){var h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof Gh?n.insert(c,l):n.remove(c)}}}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},t}(),bd=function(){function t(){this.refsByKey=new Fl(_d.compareByKey),this.refsByTarget=new Fl(_d.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new _d(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new _d(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=Qh.EMPTY,r=new _d(n,t),i=new _d(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=Qh.EMPTY,n=new _d(e,t),r=new _d(e,t+1),i=lf();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new _d(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),_d=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return Qh.comparator(t.key,e.key)||Dh(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return Dh(t.targetOrBatchId,e.targetOrBatchId)||Qh.comparator(t.key,e.key)},t}(),wd=function(){function t(t,e){this.persistence=t,this.localViewReferences=new bd,this.queryDataByTarget={},Zc(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new vd(this.remoteDocuments,this.mutationQueue)}return t.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new vd(e.remoteDocuments,e.mutationQueue),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],s=lf(),a=0,u=r;a<u.length;a++){var c=u[a];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p];o.push(c.batchId);for(var y=0,m=c.mutations;y<m.length;y++){f=m[y];s=s.add(f.key)}}return e.localDocuments.getDocuments(n,s).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},t.prototype.localWrite=function(t){var e=this;return this.persistence.runTransaction("Locally write mutations","readwrite",function(n){var r,i=Fh.now();return e.mutationQueue.addMutationBatch(n,i,t).next(function(t){var i=(r=t).keys();return e.localDocuments.getDocuments(n,i)}).next(function(t){return{batchId:r.batchId,changes:t}})})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):up.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return Zc(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[],s=lf();ah(e.targetChanges,function(r,a){var u=n.queryDataByTarget[r];if(u){a.addedDocuments.forEach(function(t){s=s.add(t)}),a.modifiedDocuments.forEach(function(t){s=s.add(t)}),o.push(n.queryCache.removeMatchingKeys(i,a.removedDocuments,r).next(function(){return n.queryCache.addMatchingKeys(i,a.addedDocuments,r)}));var c=a.resumeToken;if(c.length>0){var h=u;u=u.copy({resumeToken:c,snapshotVersion:e.snapshotVersion}),n.queryDataByTarget[r]=u,t.shouldPersistQueryData(h,u,a)&&o.push(n.queryCache.updateQueryData(i,u))}}});var a=rf(),u=lf();e.documentUpdates.forEach(function(t,e){u=u.add(t)}),o.push(r.getEntries(i,u).next(function(t){e.documentUpdates.forEach(function(u,c){var h=t.get(u);null==h||c.version.isEqual(Ll.MIN)||s.has(c.key)&&!h.hasPendingWrites||c.version.compareTo(h.version)>=0?(r.addEntry(c),a=a.insert(u,c)):Yc("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.resolvedLimboDocuments.has(u)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))})}));var c=e.snapshotVersion;if(!c.isEqual(Ll.MIN)){var h=n.queryCache.getLastRemoteSnapshotVersion(i).next(function(t){return Zc(c.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+c+" < "+t),n.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,c)});o.push(h)}return up.waitFor(o).next(function(){return r.apply(i)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(i,a)})})},t.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0))},t.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return up.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),up.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,up.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new xl(t,i,El.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return Zc(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r,r})})},t.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){Zc(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,s=n.queryDataByTarget[o],a=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?up.resolve():up.forEach(a,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,s)})})})},t.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=up.resolve();return o.forEach(function(r){s=s.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,s=e.docVersions.get(r);Zc(null!==s,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(s)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):Zc(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),s.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},t.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),Ed=function(){function t(t){this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=eh(),this.batchesByDocumentKey=new Fl(_d.compareByKey)}return t.prototype.checkEmpty=function(t){return up.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Zc(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Zc(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,up.resolve()},t.prototype.getLastStreamToken=function(t){return up.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,up.resolve()},t.prototype.addMutationBatch=function(t,e,n){Zc(0!==n.length,"Mutation batches should not be empty");var r=this.nextBatchId;(this.nextBatchId++,this.mutationQueue.length>0)&&Zc(this.mutationQueue[this.mutationQueue.length-1].batchId<r,"Mutation batchIDs must be monotonically increasing order");var i=new ip(r,e,n);this.mutationQueue.push(i);for(var o=0,s=n;o<s.length;o++){var a=s[o];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new _d(a.key,r))}return up.resolve(i)},t.prototype.lookupMutationBatch=function(t,e){return up.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Zc(null!=n,"Failed to find local mutation batch."),up.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return up.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(t){return up.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new _d(e,0),i=new _d(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){Zc(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);Zc(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),up.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Fl(Dh);return e.forEach(function(t){var e=new _d(t,0),i=new _d(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){Zc(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),up.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Qh.isDocumentKey(i)||(i=i.child(""));var o=new _d(new Qh(i),0),s=new Fl(Dh);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.targetOrBatchId)),!0)},o),up.resolve(this.findMutationBatches(s))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Zc(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return up.forEach(e.mutations,function(i){var o=new _d(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new _d(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return up.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Zc(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),up.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Zc(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Zc(n.batchId===t,"If found batch must match"),n},t}(),Td=function(){function t(t){this.persistence=t,this.queries=new bp(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Ll.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new bd,this.targetCount=0,this.targetIdGenerator=ap.forQueryCache()}return t.prototype.getTargetCount=function(t){return up.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),up.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return up.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return up.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,up.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),up.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return Zc(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,up.resolve()},t.prototype.updateQueryData=function(t,e){return Zc(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),up.resolve()},t.prototype.removeQueryData=function(t,e){return Zc(this.targetCount>0,"Removing a target from an empty cache"),Zc(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,up.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(s,a){a.sequenceNumber<=e&&!n[a.targetId]&&(r.queries.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),up.waitFor(o).next(function(){return i})},t.prototype.getQueryCount=function(t){return up.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return up.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return $c("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),up.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),up.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),up.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return up.resolve(n)},t.prototype.containsKey=function(t,e){return up.resolve(this.references.containsKey(e))},t}();var Sd,Id=function(){function t(t){this.sizer=t,this.docs=new Xh(Qh.comparator),this.newDocumentChanges=lf(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=0,i=e;r<i.length;r++){var o=i[r],s=o.maybeDocument.key;this.docs=this.docs.insert(s,o),this.newDocumentChanges=this.newDocumentChanges.add(s)}return this.size+=n,up.resolve()},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,up.resolve(n.size)):up.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return up.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return up.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=of();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),up.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=of(),i=new Xh(Qh.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),up.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){for(var n=af(),r=new Qh(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),s=o.key,a=o.value.maybeDocument;if(!e.path.isPrefixOf(s.path))break;a instanceof Gh&&e.matches(a)&&(n=n.insert(a.key,a))}return up.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return up.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var e=this,n=rf();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new zh(t,Ll.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=lf(),up.resolve(n)},t.prototype.newChangeBuffer=function(){return new Cd(this.sizer,this)},t.prototype.getSize=function(t){return up.resolve(this.size)},t}(),Cd=function(t){function e(e,n){var r=t.call(this)||this;return r.sizer=e,r.documentCache=n,r}return Je(e,t),e.prototype.applyChanges=function(t){var e=this,n=0,r=[];return this.assertChanges().forEach(function(t,i){var o=e.documentSizes.get(t);Zc(void 0!==o,"Attempting to change document "+t.toString()+" without having read it first");var s=e.sizer(i);n+=s-o,r.push({maybeDocument:i,size:s})}),this.documentCache.addEntries(t,r,n)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(_p),Nd=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Qf(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new Td(this);this.remoteDocumentCache=new Id(function(t){return n.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n,r){return new t(e,function(t){return new Rd(t,new td(n),r)})},t.createEagerPersistence=function(e){return new t(e,function(t){return new Ad(t)})},t.prototype.shutdown=function(t){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setNetworkEnabled=function(t){},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new Ed(this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getQueryCache=function(){return this.queryCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;Yc("MemoryPersistence","Starting transaction:",t);var i=new Dd(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},t.prototype.mutationQueuesContainKey=function(t,e){return up.or((n=this.mutationQueues,r=[],uh(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),Dd=function(){return function(t){this.currentSequenceNumber=t}}(),Ad=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),up.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),up.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),up.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache();return up.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(e){return e?up.resolve():n.removeEntry(t,r).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return up.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return up.resolve(n.inMemoryPins.containsKey(e))}])},t}(),Rd=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new bp(function(t){return Zf(t.path)}),this.garbageCollector=new sd(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return up.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return up.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?up.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache();return i.forEachDocumentKey(t,function(o){return n.isPinned(t,o,e).next(function(e){return e?up.resolve():(r++,i.removeEntry(t,o).next())})}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),up.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),up.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),up.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),up.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw $c("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return up.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return up.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return up.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),kd=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&Yc("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}();!function(t){t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff"}(Sd||(Sd={}));var Od,Pd,Ld=1e3,Md=6e4,xd=1.5,Fd=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Sd.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new kd(t,e,Ld,xd,Md)}return t.prototype.isStarted=function(){return this.state===Sd.Starting||this.state===Sd.Open||this.state===Sd.Backoff},t.prototype.isOpen=function(){return this.state===Sd.Open},t.prototype.start=function(){this.state!==Sd.Error?(Zc(this.state===Sd.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Sd.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){Zc(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Sd.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.isOpen()?[2,this.close(Sd.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return Ze(this,void 0,void 0,function(){return tn(this,function(n){switch(n.label){case 0:return Zc(this.isStarted(),"Only started streams should be closed."),Zc(t===Sd.Error||_l(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==Sd.Error?this.backoff.reset():e&&e.code===nh.RESOURCE_EXHAUSTED?(Xc(e.toString()),Xc("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===nh.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;Zc(this.state===Sd.Initial,"Must be in initial state to auth"),this.state=Sd.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new rh(nh.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;Zc(this.state===Sd.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Zc(e.state===Sd.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Sd.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;Zc(this.state===Sd.Error,"Should only perform backoff when in Error state"),this.state=Sd.Backoff,this.backoff.backoffAndRun(function(){return Ze(t,void 0,void 0,function(){return tn(this,function(t){return Zc(this.state===Sd.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Sd.Initial,this.start(),Zc(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return Zc(this.isStarted(),"Can't handle server close on non-started stream"),Yc("PersistentStream","close with error: "+t),this.stream=null,this.close(Sd.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(Yc("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Ud=function(t){function e(e,n,r,i,o){var s=t.call(this,e,Kf.ListenStreamConnectionBackoff,Kf.ListenStreamIdle,n,r,o)||this;return s.serializer=i,s}return Je(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(Fd),qd=function(t){function e(e,n,r,i,o){var s=t.call(this,e,Kf.WriteStreamConnectionBackoff,Kf.WriteStreamIdle,n,r,o)||this;return s.serializer=i,s.handshakeComplete_=!1,s}return Je(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(Zc(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Zc(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){Zc(this.isOpen(),"Writing handshake requires an opened stream"),Zc(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;Zc(this.isOpen(),"Writing mutations requires an opened stream"),Zc(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Zc(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e}(Fd),Bd=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new qd(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Ud(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=rf();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);Zc(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===nh.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===nh.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),Vd=function(){function t(t){this.datastore=t,this.readVersions=cf(),this.mutations=[],this.committed=!1}return t.prototype.recordVersion=function(t){var e;if(t instanceof Gh)e=t.version;else{if(!(t instanceof zh))throw $c("Document in a transaction was a "+t.constructor.name);e=Ll.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new rh(nh.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.lookup=function(t){var e=this;return this.committed?Promise.reject("Transaction has already completed."):this.mutations.length>0?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(t).then(function(t){return t.forEach(function(t){t instanceof zh||t instanceof Gh?e.recordVersion(t):$c("Document in a transaction was a "+t.constructor.name)}),t})},t.prototype.write=function(t){if(this.committed)throw new rh(nh.FAILED_PRECONDITION,"Transaction has already completed.");this.mutations=this.mutations.concat(t)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return e?Wl.updateTime(e):Wl.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(e&&e.isEqual(Ll.forDeletedDoc()))throw new rh(nh.FAILED_PRECONDITION,"Can't update a document that doesn't exist.");return e?Wl.updateTime(e):Wl.exists(!0)},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t)))},t.prototype.update=function(t,e){this.write(e.toMutations(t,this.preconditionForUpdate(t)))},t.prototype.delete=function(t){this.write([new Gl(t,this.precondition(t))]),this.readVersions=this.readVersions.insert(t,Ll.forDeletedDoc())},t.prototype.commit=function(){var t=this,e=this.readVersions;return this.mutations.forEach(function(t){e=e.remove(t.key)}),e.isEmpty()?this.datastore.commit(this.mutations).then(function(){t.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline"}(Od||(Od={})),function(t){t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState"}(Pd||(Pd={}));var Wd=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Od.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Od.Unknown),Zc(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Kf.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Zc(t.state===Od.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Od.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===Od.Online?(this.setAndBroadcast(Od.Unknown),Zc(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Zc(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Od.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Od.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Xc(e),this.shouldWarnClientIsOffline=!1):Yc("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}(),jd=function(){function t(t,e,n,r){this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.onlineStateTracker=new Wd(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return Ze(this,void 0,void 0,function(){var t;return tn(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Od.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Od.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(Yc("RemoteStore","Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return Yc("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Od.Unknown),[2]}})})},t.prototype.listen=function(t){Zc(!oh(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){Zc(oh(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),ch(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Od.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){Zc(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new Cf(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!ch(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return Ze(this,void 0,void 0,function(){var t=this;return tn(this,function(e){return ah(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){return void 0===t&&Zc(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(Od.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return Ze(this,void 0,void 0,function(){var n;return tn(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(Od.Online),t instanceof Sf&&t.state===gf.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof Ef?this.watchChangeAggregator.handleDocumentChange(t):t instanceof Tf?this.watchChangeAggregator.handleExistenceFilter(t):(Zc(t instanceof Sf,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Ll.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;Zc(!t.isEqual(Ll.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return ah(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:eh()}),e.sendUnwatchRequest(t);var r=new xl(n.query,t,El.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;Zc(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return Ze(e,void 0,void 0,function(){return tn(this,function(e){return oh(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},t.prototype.fillWritePipeline=function(){return Ze(this,void 0,void 0,function(){var t,e;return tn(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){Zc(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){Zc(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(pd)},t.prototype.onMutationResult=function(t,e){var n=this;Zc(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=op.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return Ze(this,void 0,void 0,function(){var e=this;return tn(this,function(n){return void 0===t&&Zc(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){return tf(t.code)?(Yc("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=eh(),[2,this.localStore.setLastStreamToken(eh()).catch(pd)]):[2]})})},t.prototype.handleWriteError=function(t){return Ze(this,void 0,void 0,function(){var e,n=this;return tn(this,function(r){return tf(i=t.code)&&i!==nh.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2];var i})})},t.prototype.createTransaction=function(){return new Vd(this.datastore)},t.prototype.handleCredentialChange=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Yc("RemoteStore","RemoteStore restarting streams for new credential"),this.networkEnabled=!1,[4,this.disableNetworkInternal()]):[3,3];case 1:return t.sent(),this.onlineStateTracker.set(Od.Unknown),[4,this.enableNetwork()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.applyPrimaryState=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(Od.Unknown),e.label=4;case 4:return[2]}})})},t}(),Kd=function(){return function(){this.listeners=[]}}(),Qd=function(){function t(t){this.syncEngine=t,this.queries=new bp(function(t){return t.canonicalId()}),this.onlineState=Od.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new Kd,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t,t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i;return tn(this,function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var s=0,a=o.listeners;s<a.length;s++){a[s].onViewSnapshot(r)}o.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++){i[r].applyOnlineStateChange(t)}})},t}(),Hd=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=Od.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(Zc(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==df.Metadata&&e.push(i)}t=new bf(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(Zc(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Od.Offline;return this.options.waitForSyncWhenOnline&&n?(Zc(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Od.Offline},t.prototype.shouldRaiseEvent=function(t){if(t.docChanges.length>0)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){Zc(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=bf.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),Gd=function(){function t(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return t.fromSnapshot=function(e,n){for(var r=lf(),i=lf(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case df.Added:r=r.add(a.doc.key);break;case df.Removed:i=i.add(a.doc.key)}}return new t(e,r,i)},t}(),zd=function(){return function(t){this.key=t}}(),Yd=function(){return function(t){this.key=t}}(),Xd=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=lf(),this.mutatedKeys=lf(),this.documentSet=new mf(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new vf,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof Gh?e:null;h&&(Zc(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data.isEqual(h.data)?l!==f&&(r.track({type:df.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:df.Modified,doc:h}),p=!0,u&&n.query.docComparator(h,u)>0&&(a=!0)):!c&&h?(r.track({type:df.Added,doc:h}),p=!0):c&&!h&&(r.track({type:df.Removed,doc:c}),p=!0,u&&(a=!0));p&&(h?(s=s.add(h),o=f?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),this.query.hasLimit())for(;s.size>this.query.limit;){var c=s.last();s=s.delete(c.key),o=o.delete(c.key),r.track({type:df.Removed,doc:c})}return Zc(!a||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;Zc(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case df.Added:return 1;case df.Modified:case df.Metadata:return 2;case df.Removed:return 0;default:return $c("Unknown ChangeType: "+t)}};return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var s=e?this.updateLimboDocuments():[],a=0===this.limboDocuments.size&&this.current?yf.Synced:yf.Local,u=a!==this.syncState;return this.syncState=a,0!==o.length||u?{snapshot:new bf(this.query,t.documentSet,i,o,t.mutatedKeys,a===yf.Local,u,!1),limboChanges:s}:{limboChanges:s}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Od.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new vf,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Zc(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=lf(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new Yd(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new zd(t))}),n},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=lf();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return bf.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===yf.Local)},t}();var Jd=function(){return function(t,e,n){this.query=t,this.targetId=e,this.view=n}}(),$d=function(){return function(t){this.key=t}}(),Zd=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new bp(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new Xh(Qh.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new bd,this.mutationUserCallbacks={},this.limboTargetIdGenerator=ap.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Od.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){Zc(null!==t,"SyncEngine listener cannot be null"),Zc(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i,o;return tn(this,function(s){switch(s.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=s.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=s.sent(),this.isPrimary&&this.remoteStore.listen(i),s.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e){var n=this,r=t.query;return this.localStore.executeQuery(r).then(function(i){return n.localStore.remoteDocumentKeys(t.targetId).then(function(o){var s=new Xd(r,o),a=s.computeDocChanges(i),u=wf.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&n.onlineState!==Od.Offline),c=s.applyChanges(a,!0===n.isPrimary,u);Zc(0===c.limboChanges.length,"View returned limbo docs before target ack from the server."),Zc(!!c.snapshot,"applyChanges for new view should always return a snapshot");var h=new Jd(r,t.targetId,s);return n.queryViewsByQuery.set(r,h),n.queryViewsByTarget[t.targetId]=h,c.snapshot})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){var e=this;return this.localStore.executeQuery(t.query).then(function(n){return e.localStore.remoteDocumentKeys(t.targetId).then(function(r){return Ze(e,void 0,void 0,function(){var e;return tn(this,function(i){return e=t.view.synchronizeWithPersistedState(n,r),this.isPrimary&&this.updateTrackedLimbos(t.targetId,e.limboChanges),[2,e]})})})})},t.prototype.unlisten=function(t){return Ze(this,void 0,void 0,function(){var e,n=this;return tn(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),Zc(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(pd)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){var n=this;return this.assertSubscribed("write()"),this.localStore.localWrite(t).then(function(t){return n.sharedClientState.addPendingMutation(t.batchId),n.addMutationCallback(t.batchId,e),n.emitNewSnapsAndNotifyLocalStore(t.changes)}).then(function(){return n.remoteStore.fillWritePipeline()})},t.prototype.wrapUpdateFunctionError=function(t){return t},t.prototype.runTransaction=function(t,e){var n=this;void 0===e&&(e=5),Zc(e>=0,"Got negative number of retries for transaction.");var r=this.remoteStore.createTransaction();return function(){try{var e=t(r);return!_l(e)&&e.catch&&e.then?e.catch(function(t){return Promise.reject(n.wrapUpdateFunctionError(t))}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(t){return Promise.reject(n.wrapUpdateFunctionError(t))}}().then(function(i){return r.commit().then(function(){return i}).catch(function(r){return 0===e?Promise.reject(r):n.runTransaction(t,e-1)})})},t.prototype.applyRemoteEvent=function(t){var e=this;return this.assertSubscribed("applyRemoteEvent()"),this.localStore.applyRemoteEvent(t).then(function(n){return uh(t.targetChanges,function(t,n){var r=e.limboResolutionsByTarget[t];r&&(Zc(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),n.addedDocuments.size>0?r.receivedDocument=!0:n.modifiedDocuments.size>0?Zc(r.receivedDocument,"Received change for limbo target document without add."):n.removedDocuments.size>0&&(Zc(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),e.emitNewSnapsAndNotifyLocalStore(n,t)}).catch(pd)},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Pd.RemoteStore||!this.isPrimary&&e===Pd.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);Zc(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return Ze(this,void 0,void 0,function(){var n,r,i,o,s,a,u=this;return tn(this,function(c){switch(c.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new Xh(Qh.comparator)).insert(r,new zh(r,Ll.forDeletedDoc())),o=lf().add(r),s=new _f(Ll.MIN,{},new Fl(Dh),i,o),[2,this.applyRemoteEvent(s)]):[3,1];case 1:return Zc(!!(a=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return u.removeAndCleanupQuery(a)}).catch(pd)];case 2:c.sent(),this.syncEngineListener.onWatchError(a.query,e),c.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return Ze(this,void 0,void 0,function(){var r;return tn(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(Yc("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):$c("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){var e=this;this.assertSubscribed("applySuccessfulWrite()");var n=t.batch.batchId;return this.processUserCallback(n,null),this.localStore.acknowledgeBatch(t).then(function(t){return e.sharedClientState.updateMutationState(n,"acknowledged"),e.emitNewSnapsAndNotifyLocalStore(t)}).catch(pd)},t.prototype.rejectFailedWrite=function(t,e){var n=this;return this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.localStore.rejectBatch(t).then(function(r){return n.sharedClientState.updateMutationState(t,"rejected",e),n.emitNewSnapsAndNotifyLocalStore(r)}).catch(pd)},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new Xh(Dh)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Zc(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof zd)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof Yd){Yc("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else $c("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Yc("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Tl.atPath(e.path);this.limboResolutionsByTarget[n]=new $d(e),this.remoteStore.listen(new xl(r,n,El.LimboResolution,Qf.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return Ze(this,void 0,void 0,function(){var n,r,i,o=this;return tn(this,function(s){switch(s.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(s,a){i.push(Promise.resolve().then(function(){var e=a.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(a.query).then(function(t){return a.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[a.targetId],s=a.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(a.targetId,s.limboChanges),s.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(a.targetId,s.snapshot.fromCache?"not-current":"current"),n.push(s.snapshot);var u=Gd.fromSnapshot(a.targetId,s.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return s.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return s.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){Zc(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return Ze(this,void 0,void 0,function(){var e,n;return tn(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?[4,this.localStore.handleUserChange(t)]:[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u=this;return tn(this,function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],a=Promise.resolve(),ah(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?s.push(t):a=a.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,a]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;ah(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Xh(Qh.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){for(var e=this,n=Promise.resolve(),r=[],i=[],o=function(t){n=n.then(function(){return Ze(e,void 0,void 0,function(){var e,n,o,s;return tn(this,function(a){switch(a.label){case 0:return(n=this.queryViewsByTarget[t])?[4,this.localStore.releaseQuery(n.query,!0)]:[3,4];case 1:return a.sent(),[4,this.localStore.allocateQuery(n.query)];case 2:return e=a.sent(),[4,this.synchronizeViewAndComputeSnapshot(n)];case 3:return(o=a.sent()).snapshot&&i.push(o.snapshot),[3,8];case 4:return Zc(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(t)];case 5:return Zc(!!(s=a.sent()),"Query data for target "+t+" not found"),[4,this.localStore.allocateQuery(s)];case 6:return e=a.sent(),[4,this.initializeViewAndComputeSnapshot(e,!1)];case 7:a.sent(),a.label=8;case 8:return r.push(e),[2]}})})})},s=0,a=t;s<a.length;s++){o(a[s])}return n.then(function(){return e.syncEngineListener.onWatchChange(i),r})},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i=this;return tn(this,function(o){switch(o.label){case 0:if(this.isPrimary)return Yc("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,5];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,2]}return[3,4];case 1:return[2,this.localStore.getNewDocumentChanges().then(function(n){return Ze(i,void 0,void 0,function(){var r;return tn(this,function(i){switch(i.label){case 0:return r=_f.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(n,r)];case 1:return i.sent(),[2]}})})},function(t){return Ze(i,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:return function(t){return t.code===nh.DATA_LOSS&&t.message===wp}(t)?(e=[],ah(this.queryViewsByTarget,function(t){return e.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e)]):[3,2];case 1:return n.sent(),[3,3];case 2:throw t;case 3:return[2]}})})})];case 2:return r=this.queryViewsByTarget[t],this.removeAndCleanupQuery(r),[4,this.localStore.releaseQuery(r.query,!0)];case 3:return o.sent(),this.syncEngineListener.onWatchError(r.query,n),[3,5];case 4:$c("Unexpected target state: "+e),o.label=5;case 5:return[2]}})})},t.prototype.applyActiveTargetsChange=function(t,e){return Ze(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l=this;return tn(this,function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],Zc(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]):[3,6];case 2:return Zc(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:s=function(t){var e;return tn(this,function(n){switch(n.label){case 0:return(e=a.queryViewsByTarget[t])?[4,a.localStore.releaseQuery(e.query,!1).then(function(){l.remoteStore.unlisten(t),l.removeAndCleanupQuery(e)}).catch(pd)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},a=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,s(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?lf().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:lf()},t}(),ty=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),ey="SharedClientState",ny="firestore_clients",ry="firestore_mutations",iy="firestore_targets",oy="firestore_online_state",sy="firestore_sequence_number",ay=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,Zc(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new rh(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(Xc(ey,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),uy=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,Zc(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new rh(r.error.code,r.error.message)),i?new t(e,r.state,o):(Xc(ey,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),cy=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=pf(),s=0;i&&s<r.activeTargetIds.length;++s)i=wl(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Xc(ey,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),hy=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&void 0!==Od[n.onlineState]&&"string"==typeof n.clientId?new t(n.clientId,Od[n.onlineState]):(Xc(ey,"Failed to parse online state: "+e),null)},t}(),ly=function(){function t(){this.activeTargetIds=pf()}return t.prototype.addQueryTarget=function(t){Zc(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),fy=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new rh(nh.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey=sy+"_"+r,this.activeClients[this.localClientId]=new ly,this.clientStateKeyRe=new RegExp("^"+ny+"_"+s+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+ry+"_"+s+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+iy+"_"+s+"_(\\d+)$"),this.onlineStateKey=oy+"_"+r,this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return Ze(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h,l=this;return tn(this,function(f){switch(f.label){case 0:return Zc(!this.started,"WebStorageSharedClientState already started"),Zc(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Zc(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=cy.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(a=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(a),u=0,c=this.earlyEvents;u<c.length;u++)h=c[u],this.handleWebStorageEvent(h);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=pf();return uh(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=uy.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Yc(ey,"READ",t,e),e},t.prototype.setItem=function(t,e){Yc(ey,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Yc(ey,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(Yc(ey,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Xc("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return Ze(e,void 0,void 0,function(){var e,n,r,i,o,s;return tn(this,function(a){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(Zc(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(s=function(t){var e=Qf.INVALID;if(null!=t)try{var n=JSON.parse(t);Zc("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Xc(ey,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Qf.INVALID&&this.sequenceNumberHandler(s));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new ay(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Od[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new uy(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.toWebStorageClientStateKey=function(t){return Zc(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),ny+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageQueryTargetMetadataKey=function(t){return iy+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageMutationBatchKey=function(t){var e=ry+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Zc(null!==n,"Cannot parse client state key '"+t+"'"),cy.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Zc(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ay.fromWebStorageEntry(new ty(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Zc(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return uy.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return hy.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){return t.user.uid!==this.currentUser.uid?(Yc(ey,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],s=[];return i.forEach(function(t){return Ze(n,void 0,void 0,function(){return tn(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return Ze(n,void 0,void 0,function(){return tn(this,function(e){return i.has(t)||s.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,s)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}();var py=function(){function t(){this.localState=new ly,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new ly,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),dy=function(){function t(t,e){this.cacheSizeBytes=t,this.experimentalTabSynchronization=e}return t.prototype.lruParams=function(){return id.withCacheSize(this.cacheSizeBytes)},t}(),yy=function(){return function(){}}(),my=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=Nh.newId()}return t.prototype.start=function(t){var e=this,n=new Hf,r=new Hf,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof dy?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline storage. Falling back to storage disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof rh?t.code===nh.FAILED_PRECONDITION||t.code===nh.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code)},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=fd.buildStoragePrefix(this.databaseInfo),i=new xf(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return Ze(n,void 0,void 0,function(){var n,o;return tn(this,function(s){switch(s.label){case 0:if(e.experimentalTabSynchronization&&!fy.isAvailable(this.platform))throw new rh(nh.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return o=e.lruParams(),e.experimentalTabSynchronization?(this.sharedClientState=new fy(this.asyncQueue,this.platform,r,this.clientId,t),[4,fd.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n=s.sent(),[3,4];case 2:return this.sharedClientState=new py,[4,fd.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o)];case 3:n=s.sent(),s.label=4;case 4:return this.persistence=n,[2,n.referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=Nd.createEagerPersistence(this.clientId),this.sharedClientState=new py,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return Yc("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return Ze(n,void 0,void 0,function(){var n,i,o,s,a=this;return tn(this,function(u){switch(u.label){case 0:return this.localStore=new wd(this.persistence,t),e&&(this.lruScheduler=new od(e,this.asyncQueue,this.localStore)),n=this.platform.newSerializer(this.databaseInfo.databaseId),i=new Bd(this.asyncQueue,r,this.credentials,n),o=function(t){return a.syncEngine.applyOnlineStateChange(t,Pd.RemoteStore)},s=function(t){return a.syncEngine.applyOnlineStateChange(t,Pd.SharedClientState)},this.remoteStore=new jd(this.localStore,i,this.asyncQueue,o),this.syncEngine=new Zd(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=s,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Qd(this.syncEngine),[4,this.sharedClientState.start()];case 1:return u.sent(),[4,this.remoteStore.start()];case 2:return u.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return Ze(a,void 0,void 0,function(){return tn(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return u.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Yc("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(t){var e=this;return this.asyncQueue.enqueue(function(){return Ze(e,void 0,void 0,function(){return tn(this,function(e){switch(e.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return e.sent(),[4,this.sharedClientState.shutdown()];case 2:return e.sent(),[4,this.persistence.shutdown(t&&t.purgePersistenceWithDataLoss)];case 3:return e.sent(),this.credentials.removeChangeListener(),[2]}})})})},t.prototype.listen=function(t,e,n){var r=this,i=new Hd(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Gh)return t;if(t instanceof zh)return null;throw new rh(nh.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=lf(),r=new Xd(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},t.prototype.write=function(t){var e=this,n=new Hf;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.transaction=function(t){var e=this;return this.asyncQueue.enqueue(function(){return Ze(e,void 0,void 0,function(){return tn(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),gy=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),vy=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+Ch(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(ph("FieldPath","string",n,t[n]),0===t[n].length)throw new rh(nh.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Kh(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Sh("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(Kh.keyField().canonicalString()),t}(),by=new RegExp("[~\\*/\\[\\]]");var _y=function(){return function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}}}(),wy=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){Zc(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(ty.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){Zc(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),Ey=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var t=this;Zc(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new rh(nh.ABORTED,"getToken aborted due to token change.");return n?(Zc("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new _y(n.accessToken,t.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){Zc(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){Zc(null!=this.tokenListener,"removeChangeListener() called twice"),Zc(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Zc(null===t||"string"==typeof t,"Received invalid UID: "+t),new ty(t)},t}(),Ty=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=ty.FIRST_PARTY,Zc(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){return{Authorization:this.gapi.auth.getAuthHeaderValueForFirstParty([]),"X-Goog-AuthUser":this.sessionIndex}},enumerable:!0,configurable:!0}),t}(),Sy=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,Zc(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,"unexpected gapi interface")}return t.prototype.getToken=function(){return Promise.resolve(new Ty(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(ty.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Iy(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var Cy,Ny=function(){function t(t){this._methodName=t}return t.delete=function(){return Dy.instance},t.serverTimestamp=function(){return Ay.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return lh("FieldValue.arrayUnion",arguments,1),new Ry(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return lh("FieldValue.arrayRemove",arguments,1),new ky(t)},t.prototype.isEqual=function(t){return this===t},t}(),Dy=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return Je(e,t),e.instance=new e,e}(Ny),Ay=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return Je(e,t),e.instance=new e,e}(Ny),Ry=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return Je(e,t),e}(Ny),ky=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return Je(e,t),e}(Ny),Oy=ih(Ny,"Use FieldValue.<field>() instead."),Py=/^__.*__$/,Ly=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Ql(t,this.data,this.fieldMask,e)):n.push(new Kl(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Hl(t,this.fieldTransforms)),n},t}(),My=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new Ql(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new Hl(t,this.fieldTransforms)),n},t}();function xy(t){switch(t){case Cy.Set:case Cy.MergeSet:case Cy.Update:return!0;case Cy.Argument:return!1;default:throw $c("Unexpected case for UserDataSource: "+t)}}!function(t){t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument"}(Cy||(Cy={}));var Fy=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new rh(nh.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(xy(this.dataSource)&&Py.test(t))throw this.createError("Document fields cannot begin and end with __")},t}(),Uy=function(){return function(t,e){this.databaseId=t,this.key=e}}(),qy=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Fy(Cy.Set,t,Kh.EMPTY_PATH);Vy("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Ly(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new Fy(Cy.MergeSet,t,Kh.EMPTY_PATH);Vy("Data must be an object, but it was:",r,e);var i,o,s=this.parseData(e,r);if(n){for(var a=new Fl(Kh.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof vy)l=h._internalPath;else{if("string"!=typeof h)throw $c("Expected stringOrFieldPath to be a string or a FieldPath");l=jy(t,h)}if(!r.contains(l))throw new rh(nh.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");a=a.add(l)}i=ql.fromSet(a),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=ql.fromArray(r.fieldMask),o=r.fieldTransforms;return new Ly(s,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new Fy(Cy.Update,t,Kh.EMPTY_PATH);Vy("Data must be an object, but it was:",r,e);var i=new Fl(Kh.comparator),o=dl.EMPTY;uh(e,function(e,s){var a=jy(t,e),u=r.childContextForFieldPath(a);if((s=n.runPreConverter(s,u))instanceof Dy)i=i.add(a);else{var c=n.parseData(s,u);null!=c&&(i=i.add(a),o=o.set(a,c))}});var s=ql.fromSet(i);return new My(o,s,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Fy(Cy.Update,t,Kh.EMPTY_PATH),o=[Wy(t,e)],s=[n];if(r.length%2!=0)throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(Wy(t,r[a])),s.push(r[a+1]);var u=new Fl(Kh.comparator),c=dl.EMPTY;for(a=0;a<o.length;++a){var h=o[a],l=i.childContextForFieldPath(h),f=this.runPreConverter(s[a],l);if(f instanceof Dy)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=ql.fromSet(u);return new My(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new Fy(Cy.Argument,t,Kh.EMPTY_PATH),r=this.parseData(e,n);return Zc(null!=r,"Parsed data should not be null."),Zc(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=Ky(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(By(t=this.runPreConverter(t,e)))return Vy("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof Ny)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new Xh(Dh);return ch(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):uh(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new dl(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.parseData(s,e.childContextForArray(r));null==a&&(a=nl.INSTANCE),n.push(a),r++}return new yl(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!xy(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof Dy){if(e.dataSource!==Cy.MergeSet)throw e.dataSource===Cy.Update?(Zc(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof Ay)e.fieldTransforms.push(new Bl(e.path,zl.instance));else if(t instanceof Ry){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new Yl(n);e.fieldTransforms.push(new Bl(e.path,r))}else if(t instanceof ky){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new Xl(n);e.fieldTransforms.push(new Bl(e.path,i))}else $c("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return nl.INSTANCE;if("number"==typeof t)return wl(t)?new sl(t):new al(t);if("boolean"==typeof t)return rl.of(t);if("string"==typeof t)return new ul(t);if(t instanceof Date)return new cl(Fh.fromDate(t));if(t instanceof Fh)return new cl(new Fh(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof xh)return new pl(t);if(t instanceof Lh)return new ll(t);if(t instanceof Uy)return new fl(t.databaseId,t.key);throw e.createError("Unsupported field value: "+wh(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new Fy(Cy.Argument,t,Kh.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function By(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Fh||t instanceof xh||t instanceof Lh||t instanceof Uy||t instanceof Ny)}function Vy(t,e,n){if(!By(n)||!_h(n)){var r=wh(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Wy(t,e){if(e instanceof vy)return e._internalPath;if("string"==typeof e)return jy(t,e);throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function jy(t,e){try{return function(t){if(t.search(by)>=0)throw new rh(nh.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(vy.bind.apply(vy,[void 0].concat(t.split("."))))}catch(e){throw new rh(nh.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=Ky(e);throw new rh(nh.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Ky(t){return t instanceof Error?t.message:t.toString()}var Qy="firestore.googleapis.com",Hy=!0,Gy=!0,zy=id.COLLECTION_DISABLED,Yy=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new rh(nh.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Qy,this.ssl=Hy}else yh("settings","non-empty string","host",t.host),this.host=t.host,mh("settings","boolean","ssl",t.ssl),this.ssl=sh(t.ssl,Hy);if(Th("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes"]),mh("settings","object","credentials",t.credentials),this.credentials=t.credentials,mh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Xc("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Xc("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=sh(t.timestampsInSnapshots,Gy),mh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=id.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==zy&&t.cacheSizeBytes<id.MINIMUM_CACHE_SIZE_BYTES)throw new rh(nh.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+id.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes},t}(),Xy=function(){return function(){}}(),Jy=function(){function t(e){var n=this;this._queue=new zf,this.INTERNAL={delete:function(t){return Ze(n,void 0,void 0,function(){return tn(this,function(e){return this._firestoreClient?[2,this._firestoreClient.shutdown(t)]:[2]})})}};var r=new Xy;if("object"==typeof e.options){var i=e;r.firebaseApp=i,r.databaseId=t.databaseIdFromApp(i),r.persistenceKey=r.firebaseApp.name,r.credentials=new Ey(i)}else{var o=e;if(!o.projectId)throw new rh(nh.INVALID_ARGUMENT,"Must provide projectId");r.databaseId=new Bh(o.projectId,o.database),r.persistenceKey="[DEFAULT]",r.credentials=new wy}r.settings=new Yy({}),this._config=r,this._databaseId=r.databaseId}return t.prototype.settings=function(t){if(hh("Firestore.settings",arguments,1),ph("Firestore.settings","object",1,t),oh(t,"persistence"))throw new rh(nh.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Yy(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new rh(nh.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._config.settings=e,void 0!==e.credentials&&(this._config.credentials=function(t){if(!t)return new wy;switch(t.type){case"gapi":return new Sy(t.client,t.sessionIndex||"0");case"provider":return t.client;default:throw new rh(nh.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new rh(nh.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");return this.configureClient(new dy(this._config.settings.cacheSizeBytes,void 0!==t&&sh(t.experimentalTabSynchronization,!1)))},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new yy),this._firestoreClient},t.prototype.configureClient=function(t){var e=this;Zc(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),Zc(!this._firestoreClient,"configureClient() called multiple times");var n=new Uh(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl);return this._dataConverter=new qy(function(t){if(t instanceof tm){var n=e._config.databaseId,r=t.firestore._config.databaseId;if(!r.isEqual(n))throw new rh(nh.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new Uy(e._config.databaseId,t._key)}return t}),this._firestoreClient=new my(th.getPlatform(),n,this._config.credentials,this._queue),this._firestoreClient.start(t)},t.databaseIdFromApp=function(t){var e=t.options;if(!oh(e,"projectId"))throw new rh(nh.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new rh(nh.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Bh(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new rh(nh.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(hh("Firestore.collection",arguments,1),ph("Firestore.collection","non-empty string",1,t),!t)throw new rh(nh.INVALID_ARGUMENT,"Must provide a non-empty collection path to collection()");return this.ensureClientConfigured(),new sm(Wh.fromString(t),this)},t.prototype.doc=function(t){if(hh("Firestore.doc",arguments,1),ph("Firestore.doc","non-empty string",1,t),!t)throw new rh(nh.INVALID_ARGUMENT,"Must provide a non-empty document path to doc()");return this.ensureClientConfigured(),tm.forPath(Wh.fromString(t),this)},t.prototype.runTransaction=function(t){var e=this;return hh("Firestore.runTransaction",arguments,1),ph("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new $y(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new Zy(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(Gc()){case Fc.DEBUG:return"debug";case Fc.ERROR:return"error";case Fc.SILENT:return"silent";default:return $c("Unknown log level: "+Gc())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(hh("Firestore.setLogLevel",arguments,1),ph("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":zc(Fc.DEBUG);break;case"error":zc(Fc.ERROR);break;case"silent":zc(Fc.SILENT);break;default:throw new rh(nh.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},t}(),$y=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;hh("Transaction.get",arguments,1);var n=hm("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return $c("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof zh)return new nm(e._firestore,n._key,null,!1,!1);if(r instanceof Gh)return new nm(e._firestore,n._key,r,!1,!1);throw $c("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){fh("Transaction.set",arguments,2,3);var r=hm("Transaction.set",t,this._firestore),i=(n=am("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof vy?(lh("Transaction.update",arguments,3),r=hm("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(hh("Transaction.update",arguments,2),r=hm("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){hh("Transaction.delete",arguments,1);var e=hm("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Zy=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){fh("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=hm("WriteBatch.set",t,this._firestore),i=(n=am("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,Wl.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.verifyNotCommitted(),"string"==typeof e||e instanceof vy?(lh("WriteBatch.update",arguments,3),r=hm("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(hh("WriteBatch.update",arguments,2),r=hm("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Wl.exists(!0))),this},t.prototype.delete=function(t){hh("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=hm("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Gl(e._key,Wl.NONE)),this},t.prototype.commit=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new rh(nh.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),tm=function(){function t(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n){if(e.length%2!=0)throw new rh(nh.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new Qh(e),n)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new sm(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(hh("DocumentReference.collection",arguments,1),ph("DocumentReference.collection","non-empty string",1,t),!t)throw new rh(nh.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Wh.fromString(t);return new sm(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Sh("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},t.prototype.set=function(t,e){fh("DocumentReference.set",arguments,1,2);var n=(e=am("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,Wl.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof vy?(lh("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(hh("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Wl.exists(!0)))},t.prototype.delete=function(){return hh("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Gl(this._key,Wl.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];fh("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Iy(t[i])||(Th("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),mh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return Iy(t[i])?n=t[i]:(ph("DocumentReference.onSnapshot","function",i,t[i]),dh("DocumentReference.onSnapshot","function",i+1,t[i+1]),dh("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new gy({next:function(t){if(e.next){Zc(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new nm(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(Tl.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return fh("DocumentReference.get",arguments,0,1),cm("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new nm(e.firestore,e._key,t,!0,t instanceof Gh&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new rh(nh.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new rh(nh.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t}(),em=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),nm=function(){function t(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return t.prototype.data=function(t){return fh("DocumentSnapshot.data",arguments,0,1),t=um("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,tl.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},t.prototype.get=function(t,e){if(fh("DocumentSnapshot.get",arguments,1,2),e=um("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(Wy("DocumentSnapshot.get",t));if(void 0!==n)return this.convertValue(n,tl.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new tm(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new em(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Sh("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))},t.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertValue=function(t,e){if(t instanceof dl)return this.convertObject(t,e);if(t instanceof yl)return this.convertArray(t,e);if(t instanceof fl){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Xc("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new tm(n,this._firestore)}return t.value(e)},t.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},t}(),rm=function(t){function e(e,n,r,i,o){return t.call(this,e,n,r,i,o)||this}return Je(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return Zc("object"==typeof n,"Document in a QueryDocumentSnapshot should exist"),n},e}(nm),im=function(){function t(t,e){this._query=t,this.firestore=e}return t.prototype.where=function(e,n,r){var i;hh("Query.where",arguments,3),ph("Query.where","non-empty string",2,n),Eh("Query.where",3,r);var o=Wy("Query.where",e),s=Il.fromString(n);if(o.isKeyField()){if(s===Il.ARRAY_CONTAINS)throw new rh(nh.INVALID_ARGUMENT,"Invalid Query. You can't perform array-contains queries on FieldPath.documentId() since document IDs are not arrays.");if("string"==typeof r){if(-1!==r.indexOf("/"))throw new rh(nh.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it contains a slash.");if(""===r)throw new rh(nh.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it was an empty string.");var a=this._query.path.child(new Wh([r]));Zc(a.length%2==0,"Path should be a document key"),i=new fl(this.firestore._databaseId,new Qh(a))}else{if(!(r instanceof tm))throw new rh(nh.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a string or a DocumentReference if the first parameter is FieldPath.documentId(), but it was: "+wh(r)+".");var u=r;i=new fl(this.firestore._databaseId,u._key)}}else i=this.firestore._dataConverter.parseQueryValue("Query.where",r);var c=Sl.create(o,s,i);return this.validateNewFilter(c),new t(this._query.addFilter(c),this.firestore)},t.prototype.orderBy=function(e,n){var r;if(fh("Query.orderBy",arguments,1,2),dh("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=Al.ASCENDING;else{if("desc"!==n)throw new rh(nh.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=Al.DESCENDING}if(null!==this._query.startAt)throw new rh(nh.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new rh(nh.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=Wy("Query.orderBy",e),o=new kl(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore)},t.prototype.limit=function(e){if(hh("Query.limit",arguments,1),ph("Query.limit","number",1,e),e<=0)throw new rh(nh.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new t(this._query.withLimit(e),this.firestore)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];lh("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];lh("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];lh("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];lh("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Sh("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(Eh(t,1,e),e instanceof nm){if(n.length>0)throw new rh(nh.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new rh(nh.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var s=o[i];if(s.field.isKeyField())r.push(new fl(this.firestore._databaseId,e.key));else{var a=e.field(s.field);if(void 0===a){var u=s.field.canonicalString();throw new rh(nh.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new Rl(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new rh(nh.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.isKeyField()){if("string"!=typeof s)throw new rh(nh.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(-1!==s.indexOf("/"))throw new rh(nh.INVALID_ARGUMENT,"Invalid query. Document ID '"+s+"' contains a slash in "+t+"()");var a=new Qh(this._query.path.child(s));i.push(new fl(this.firestore._databaseId,a))}else{var u=this.firestore._dataConverter.parseQueryValue(t,s);i.push(u)}}return new Rl(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];fh("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Iy(t[i])||(Th("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),mh("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),Iy(t[i])?n=t[i]:(ph("Query.onSnapshot","function",i,t[i]),dh("Query.onSnapshot","function",i+1,t[i+1]),dh("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new gy({next:function(t){e.next&&e.next(new om(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),s=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(s)}},t.prototype.get=function(t){var e=this;return fh("Query.get",arguments,0,1),cm("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new om(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new rh(nh.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.validateNewFilter=function(t){if(t instanceof Cl)if(t.isInequality()){var e=this._query.getInequalityFilterField();if(null!==e&&!e.isEqual(t.field))throw new rh(nh.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+e.toString()+"' and '"+t.field.toString()+"'");var n=this._query.getFirstOrderByField();null!==n&&this.validateOrderByAndInequalityMatch(t.field,n)}else if(t.op===Il.ARRAY_CONTAINS&&this._query.hasArrayContainsFilter())throw new rh(nh.INVALID_ARGUMENT,"Invalid query. Queries only support a single array-contains filter.")},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new rh(nh.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),om=function(){function t(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new em(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;fh("QuerySnapshot.forEach",arguments,1,2),ph("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new im(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(Th("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),mh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new rh(nh.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new rm(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return Zc(e.type===df.Added,"Invalid event type for first snapshot"),Zc(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==df.Metadata}).map(function(e){var r=new rm(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,s=-1;return e.type!==df.Added&&(Zc((i=o.indexOf(e.doc.key))>=0,"Index for document not found"),o=o.delete(e.doc.key)),e.type!==df.Removed&&(o=o.add(e.doc),s=o.indexOf(e.doc.key)),{type:function(t){switch(t){case df.Added:return"added";case df.Modified:case df.Metadata:return"modified";case df.Removed:return"removed";default:return $c("Unknown change type: "+t)}}(e.type),doc:r,oldIndex:i,newIndex:s}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Sh("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},t.prototype.convertToDocumentImpl=function(t){return new rm(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},t}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(om.prototype.docChanges,t,{get:function(){return function(){throw new rh(nh.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var sm=function(t){function e(e,n){var r=t.call(this,Tl.atPath(e),n)||this;if(e.length%2!=1)throw new rh(nh.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}return Je(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new tm(new Qh(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(fh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Nh.newId()),ph("CollectionReference.doc","non-empty string",1,t),""===t)throw new rh(nh.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Wh.fromString(t);return tm.forPath(this._query.path.child(e),this.firestore)},e.prototype.add=function(t){hh("CollectionReference.add",arguments,1),ph("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},e}(im);function am(t,e){if(void 0===e)return{merge:!1};if(Th(t,e,["merge","mergeFields"]),mh(t,"boolean","merge",e.merge),gh(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof vy}),void 0!==e.mergeFields&&void 0!==e.merge)throw new rh(nh.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function um(t,e){return void 0===e?{}:(Th(t,e,["serverTimestamps"]),vh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function cm(t,e){dh(t,"object",1,e),e&&(Th(t,e,["source"]),vh(t,0,"source",e.source,["default","server","cache"]))}function hm(t,e,n){if(e instanceof tm){if(e.firestore!==n)throw new rh(nh.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Sh(t,"DocumentReference",1,e)}var lm=ih(Jy,"Use firebase.firestore() instead."),fm=ih($y,"Use firebase.firestore().runTransaction() instead."),pm=ih(Zy,"Use firebase.firestore().batch() instead."),dm=ih(tm,"Use firebase.firestore().doc() instead."),ym=ih(nm),mm=ih(rm),gm=ih(im),vm=ih(om),bm=ih(sm,"Use firebase.firestore().collection() instead."),_m={Firestore:lm,GeoPoint:xh,Timestamp:Fh,Blob:Mh,Transaction:fm,WriteBatch:pm,DocumentReference:dm,DocumentSnapshot:ym,Query:gm,QueryDocumentSnapshot:mm,QuerySnapshot:vm,CollectionReference:bm,FieldPath:vy,FieldValue:Oy,setLogLevel:Jy.setLogLevel,CACHE_SIZE_UNLIMITED:zy};function wm(t){t.INTERNAL.registerService("firestore",function(t){return new Jy(t)},function(t){Zc(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(_m))}!function(t){wm(t)}(Yn);var Em={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Tm=function(t){function e(n,r,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.code=n,o.details=i,o}return Je(e,t),e}(Error);var Sm=function(){function t(t){this.app=t}return t.prototype.getAuthToken=function(){return Ze(this,void 0,void 0,function(){var t;return tn(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getInstanceIdToken=function(){return Ze(this,void 0,void 0,function(){var t;return tn(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(t=e.sent())?[2,t]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getContext=function(){return Ze(this,void 0,void 0,function(){var t,e;return tn(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}})})},t}();function Im(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var Cm=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null===t||void 0===t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return Im(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null===t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=parseFloat(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?Im(t,function(t){return e.decode(t)}):t},t}(),Nm=function(){function t(t,e){void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new Cm,this.emulatorOrigin=null,this.contextProvider=new Sm(t)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+n+"/"+t:"https://"+n+"-"+e+".cloudfunctions.net/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(t){var e=this;return function(n){return e.call(t,n)}},t.prototype.postJSON=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i;return tn(this,function(o){switch(o.label){case 0:n.append("Content-Type","application/json"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=o.sent(),[3,4];case 3:return o.sent(),[2,{status:0,json:null}];case 4:i=null,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,r.json()];case 6:return i=o.sent(),[3,8];case 7:return o.sent(),[3,8];case 8:return[2,{status:r.status,json:i}]}})})},t.prototype.call=function(t,e){return Ze(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return tn(this,function(c){switch(c.label){case 0:return n=this._url(t),e=this.serializer.encode(e),r={data:e},i=new Headers,[4,this.contextProvider.getContext()];case 1:return(o=c.sent()).authToken&&i.append("Authorization","Bearer "+o.authToken),o.instanceIdToken&&i.append("Firebase-Instance-ID-Token",o.instanceIdToken),[4,this.postJSON(n,r,i)];case 2:if(s=c.sent(),a=function(t,e,n){var r=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var s=e.error;if(s){var a=s.status;if("string"==typeof a){if(!Em[a])return new Tm("internal","internal");r=Em[a]}i=a;var u=s.message;"string"==typeof u&&(i=u),void 0!==(o=s.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new Tm(r,i,o)}(s.status,s.json,this.serializer))throw a;if(!s.json)throw new Tm("internal","Response is not valid JSON object.");if(void 0===(u=s.json.data)&&(u=s.json.result),void 0===u)throw new Tm("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},t}(),Dm="functions";function Am(t,e,n){return new Nm(t,n)}!function(t){var e={Functions:Nm};t.INTERNAL.registerService(Dm,Am,e,void 0,!0)}(Yn);var Rm,km,Om,Pm={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",TOKEN_UNSUBSCRIBE_FAILED:"token-unsubscribe-failed",TOKEN_UPDATE_FAILED:"token-update-failed",TOKEN_UPDATE_NO_TOKEN:"token-update-no-token",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key",INVALID_PUBLIC_VAPID_KEY:"invalid-public-vapid-key",USE_PUBLIC_KEY_BEFORE_GET_TOKEN:"use-public-key-before-get-token",PUBLIC_KEY_DECRYPTION_FAILED:"public-vapid-key-decryption-failed"},Lm=((Rm={})[Pm.AVAILABLE_IN_WINDOW]="This method is available in a Window context.",Rm[Pm.AVAILABLE_IN_SW]="This method is available in a service worker context.",Rm[Pm.SHOULD_BE_INHERITED]="This method should be overriden by extended classes.",Rm[Pm.BAD_SENDER_ID]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",Rm[Pm.PERMISSION_DEFAULT]="The required permissions were not granted and dismissed instead.",Rm[Pm.PERMISSION_BLOCKED]="The required permissions were not granted and blocked instead.",Rm[Pm.UNSUPPORTED_BROWSER]="This browser doesn't support the API's required to use the firebase SDK.",Rm[Pm.NOTIFICATIONS_BLOCKED]="Notifications have been blocked.",Rm[Pm.FAILED_DEFAULT_REGISTRATION]="We are unable to register the default service worker. {$browserErrorMessage}",Rm[Pm.SW_REGISTRATION_EXPECTED]="A service worker registration was the expected input.",Rm[Pm.GET_SUBSCRIPTION_FAILED]="There was an error when trying to get any existing Push Subscriptions.",Rm[Pm.INVALID_SAVED_TOKEN]="Unable to access details of the saved token.",Rm[Pm.SW_REG_REDUNDANT]="The service worker being used for push was made redundant.",Rm[Pm.TOKEN_SUBSCRIBE_FAILED]="A problem occured while subscribing the user to FCM: {$message}",Rm[Pm.TOKEN_SUBSCRIBE_NO_TOKEN]="FCM returned no token when subscribing the user to push.",Rm[Pm.TOKEN_SUBSCRIBE_NO_PUSH_SET]="FCM returned an invalid response when getting an FCM token.",Rm[Pm.TOKEN_UNSUBSCRIBE_FAILED]="A problem occured while unsubscribing the user from FCM: {$message}",Rm[Pm.TOKEN_UPDATE_FAILED]="A problem occured while updating the user from FCM: {$message}",Rm[Pm.TOKEN_UPDATE_NO_TOKEN]="FCM returned no token when updating the user to push.",Rm[Pm.USE_SW_BEFORE_GET_TOKEN]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",Rm[Pm.INVALID_DELETE_TOKEN]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",Rm[Pm.DELETE_TOKEN_NOT_FOUND]="The deletion attempt for token could not be performed as the token was not found.",Rm[Pm.DELETE_SCOPE_NOT_FOUND]="The deletion attempt for service worker scope could not be performed as the scope was not found.",Rm[Pm.BG_HANDLER_FUNCTION_EXPECTED]="The input to setBackgroundMessageHandler() must be a function.",Rm[Pm.NO_WINDOW_CLIENT_TO_MSG]="An attempt was made to message a non-existant window client.",Rm[Pm.UNABLE_TO_RESUBSCRIBE]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",Rm[Pm.NO_FCM_TOKEN_FOR_RESUBSCRIBE]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",Rm[Pm.FAILED_TO_DELETE_TOKEN]="Unable to delete the currently saved token.",Rm[Pm.NO_SW_IN_REG]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",Rm[Pm.INCORRECT_GCM_SENDER_ID]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",Rm[Pm.BAD_SCOPE]="The service worker scope must be a string with at least one character.",Rm[Pm.BAD_VAPID_KEY]="The public VAPID key is not a Uint8Array with 65 bytes.",Rm[Pm.BAD_SUBSCRIPTION]="The subscription must be a valid PushSubscription.",Rm[Pm.BAD_TOKEN]="The FCM Token used for storage / lookup was not a valid token string.",Rm[Pm.BAD_PUSH_SET]="The FCM push set used for storage / lookup was not not a valid push set string.",Rm[Pm.FAILED_DELETE_VAPID_KEY]="The VAPID key could not be deleted.",Rm[Pm.INVALID_PUBLIC_VAPID_KEY]="The public VAPID key must be a string.",Rm[Pm.PUBLIC_KEY_DECRYPTION_FAILED]="The public VAPID key did not equal 65 bytes when decrypted.",Rm),Mm=new _n("messaging","Messaging",Lm),xm=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),Fm="https://fcm.googleapis.com";function Um(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function qm(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(null,e))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}!function(t){t.TYPE_OF_MSG="firebase-messaging-msg-type",t.DATA="firebase-messaging-msg-data"}(km||(km={})),function(t){t.PUSH_MSG_RECEIVED="push-msg-received",t.NOTIFICATION_CLICKED="notification-clicked"}(Om||(Om={}));var Bm=function(){function t(){}return t.prototype.getToken=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h;return tn(this,function(l){switch(l.label){case 0:r=qm(e.getKey("p256dh")),i=qm(e.getKey("auth")),o="authorized_entity="+t+"&endpoint="+e.endpoint+"&encryption_key="+r+"&encryption_auth="+i,Um(n.buffer,xm.buffer)||(s=qm(n),o+="&application_pub_key="+s),(a=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u={method:"POST",headers:a,body:o},l.label=1;case 1:return l.trys.push([1,4,,5]),[4,fetch(Fm+"/fcm/connect/subscribe",u)];case 2:return[4,l.sent().json()];case 3:return c=l.sent(),[3,5];case 4:throw l.sent(),Mm.create(Pm.TOKEN_SUBSCRIBE_FAILED);case 5:if(c.error)throw h=c.error.message,Mm.create(Pm.TOKEN_SUBSCRIBE_FAILED,{message:h});if(!c.token)throw Mm.create(Pm.TOKEN_SUBSCRIBE_NO_TOKEN);if(!c.pushSet)throw Mm.create(Pm.TOKEN_SUBSCRIBE_NO_PUSH_SET);return[2,{token:c.token,pushSet:c.pushSet}]}})})},t.prototype.updateToken=function(t,e,n,r,i){return Ze(this,void 0,void 0,function(){var o,s,a,u,c,h,l,f;return tn(this,function(p){switch(p.label){case 0:o=qm(r.getKey("p256dh")),s=qm(r.getKey("auth")),a="push_set="+n+"&token="+e+"&authorized_entity="+t+"&endpoint="+r.endpoint+"&encryption_key="+o+"&encryption_auth="+s,Um(i.buffer,xm.buffer)||(u=qm(i),a+="&application_pub_key="+u),(c=new Headers).append("Content-Type","application/x-www-form-urlencoded"),h={method:"POST",headers:c,body:a},p.label=1;case 1:return p.trys.push([1,4,,5]),[4,fetch(Fm+"/fcm/connect/subscribe",h)];case 2:return[4,p.sent().json()];case 3:return l=p.sent(),[3,5];case 4:throw p.sent(),Mm.create(Pm.TOKEN_UPDATE_FAILED);case 5:if(l.error)throw f=l.error.message,Mm.create(Pm.TOKEN_UPDATE_FAILED,{message:f});if(!l.token)throw Mm.create(Pm.TOKEN_UPDATE_NO_TOKEN);return[2,l.token]}})})},t.prototype.deleteToken=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i,o,s,a;return tn(this,function(u){switch(u.label){case 0:r="authorized_entity="+t+"&token="+e+"&pushSet="+n,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),o={method:"POST",headers:i,body:r},u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch(Fm+"/fcm/connect/unsubscribe",o)];case 2:return[4,u.sent().json()];case 3:if((s=u.sent()).error)throw a=s.error.message,Mm.create(Pm.TOKEN_UNSUBSCRIBE_FAILED,{message:a});return[3,5];case 4:throw u.sent(),Mm.create(Pm.TOKEN_UNSUBSCRIBE_FAILED);case 5:return[2]}})})},t}();function Vm(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var Wm="undefined",jm="fcm_token_object_Store";function Km(){var t=indexedDB.open(Wm);t.onerror=function(t){},t.onsuccess=function(e){!function(t){if(t.objectStoreNames.contains(jm)){var e=t.transaction(jm).objectStore(jm),n=new Bm,r=e.openCursor();r.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},r.onsuccess=function(){var e=r.result;if(e){var i=e.value;n.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),e.continue()}else t.close(),indexedDB.deleteDatabase(Wm)}}}(t.result)}}var Qm=function(){function t(){this.dbPromise=null}return t.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},t.prototype.getIndex=function(t,e){return this.createTransaction(function(n){return n.index(t).get(e)})},t.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},t.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},t.prototype.closeDatabase=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(t,e){return void 0===e&&(e="readonly"),Ze(this,void 0,void 0,function(){var n,r,i,o;return tn(this,function(s){switch(s.label){case 0:return[4,this.getDb()];case 1:return n=s.sent(),r=n.transaction(this.objectStoreName,e),i=r.objectStore(this.objectStoreName),[4,function(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}(t(i))];case 2:return o=s.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}})]}})})},t.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise(function(e,n){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){e(r.result)},r.onerror=function(){t.dbPromise=null,n(r.error)},r.onupgradeneeded=function(e){return t.onDbUpgrade(r,e)}})),this.dbPromise},t}();var Hm=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dbName="fcm_token_details_db",e.dbVersion=3,e.objectStoreName="fcm_token_object_Store",e}return Je(e,t),e.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:Km();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=$e({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=Vm(e.vapidKey)),"string"==typeof e.auth&&(n.auth=Vm(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=Vm(e.p256dh).buffer),t.update(n),t.continue()}}}},e.prototype.getTokenDetailsFromToken=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){if(!t)throw Mm.create(Pm.BAD_TOKEN);return Gm({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},e.prototype.getTokenDetailsFromSWScope=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){if(!t)throw Mm.create(Pm.BAD_SCOPE);return Gm({swScope:t}),[2,this.get(t)]})})},e.prototype.saveTokenDetails=function(t){return Ze(this,void 0,void 0,function(){return tn(this,function(e){if(!t.swScope)throw Mm.create(Pm.BAD_SCOPE);if(!t.vapidKey)throw Mm.create(Pm.BAD_VAPID_KEY);if(!t.endpoint||!t.auth||!t.p256dh)throw Mm.create(Pm.BAD_SUBSCRIPTION);if(!t.fcmSenderId)throw Mm.create(Pm.BAD_SENDER_ID);if(!t.fcmToken)throw Mm.create(Pm.BAD_TOKEN);if(!t.fcmPushSet)throw Mm.create(Pm.BAD_PUSH_SET);return Gm(t),[2,this.put(t)]})})},e.prototype.deleteToken=function(t){return Ze(this,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(Mm.create(Pm.INVALID_DELETE_TOKEN))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(e=n.sent()))throw Mm.create(Pm.DELETE_TOKEN_NOT_FOUND);return[4,this.delete(e.swScope)];case 2:return n.sent(),[2,e]}})})},e}(Qm);function Gm(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw Mm.create(Pm.BAD_TOKEN);if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw Mm.create(Pm.BAD_SCOPE);if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw Mm.create(Pm.BAD_VAPID_KEY);if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw Mm.create(Pm.BAD_SUBSCRIPTION);if(t.auth&&!(t.auth instanceof ArrayBuffer))throw Mm.create(Pm.BAD_SUBSCRIPTION);if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw Mm.create(Pm.BAD_SUBSCRIPTION);if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw Mm.create(Pm.BAD_SENDER_ID);if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw Mm.create(Pm.BAD_PUSH_SET)}var zm=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dbName="fcm_vapid_details_db",e.dbVersion=1,e.objectStoreName="fcm_vapid_object_Store",e}return Je(e,t),e.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},e.prototype.getVapidFromSWScope=function(t){return Ze(this,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:if("string"!=typeof t||0===t.length)throw Mm.create(Pm.BAD_SCOPE);return[4,this.get(t)];case 1:return[2,(e=n.sent())?e.vapidKey:void 0]}})})},e.prototype.saveVapidDetails=function(t,e){return Ze(this,void 0,void 0,function(){var n;return tn(this,function(r){if("string"!=typeof t||0===t.length)throw Mm.create(Pm.BAD_SCOPE);if(null===e||65!==e.length)throw Mm.create(Pm.BAD_VAPID_KEY);return n={swScope:t,vapidKey:e},[2,this.put(n)]})})},e.prototype.deleteVapidDetails=function(t){return Ze(this,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(e=n.sent()))throw Mm.create(Pm.DELETE_SCOPE_NOT_FOUND);return[4,this.delete(t)];case 2:return n.sent(),[2,e]}})})},e}(Qm),Ym="messagingSenderId",Xm=function(){function t(t){var e=this;if(!t.options[Ym]||"string"!=typeof t.options[Ym])throw Mm.create(Pm.BAD_SENDER_ID);this.messagingSenderId=t.options[Ym],this.tokenDetailsModel=new Hm,this.vapidDetailsModel=new zm,this.iidModel=new Bm,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}return t.prototype.getToken=function(){return Ze(this,void 0,void 0,function(){var t,e,n,r,i;return tn(this,function(o){switch(o.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw Mm.create(Pm.NOTIFICATIONS_BLOCKED);return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return e=o.sent(),[4,this.getPublicVapidKey_()];case 2:return n=o.sent(),[4,this.getPushSubscription(e,n)];case 3:return r=o.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(e.scope)];case 4:return(i=o.sent())?[2,this.manageExistingToken(e,r,n,i)]:[2,this.getNewToken(e,r,n)]}})})},t.prototype.manageExistingToken=function(t,e,n,r){return Ze(this,void 0,void 0,function(){return tn(this,function(i){switch(i.label){case 0:return function(t,e,n){if(!n.vapidKey||!Um(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=Um(t.getKey("auth"),n.auth),o=Um(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(e,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,e,n,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(t,e,n)]}})})},t.prototype.updateToken=function(t,e,n,r){return Ze(this,void 0,void 0,function(){var i,o,s;return tn(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,r.fcmToken,r.fcmPushSet,e,n)];case 1:return i=a.sent(),o={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:r.fcmPushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return a.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return a.sent(),[2,i];case 4:return s=a.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw a.sent(),s;case 6:return[2]}})})},t.prototype.getNewToken=function(t,e,n){return Ze(this,void 0,void 0,function(){var r,i;return tn(this,function(o){switch(o.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,e,n)];case 1:return r=o.sent(),i={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:r.token,fcmPushSet:r.pushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return o.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return o.sent(),[2,r.token]}})})},t.prototype.deleteToken=function(t){return Ze(this,void 0,void 0,function(){var e,n;return tn(this,function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(t){return Ze(this,void 0,void 0,function(){var e;return tn(this,function(n){switch(n.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:return e=n.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return n.sent(),[2]}})})},t.prototype.getPushSubscription=function(t,e){return t.pushManager.getSubscription().then(function(n){return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})})},t.prototype.requestPermission=function(){throw Mm.create(Pm.AVAILABLE_IN_WINDOW)},t.prototype.useServiceWorker=function(t){throw Mm.create(Pm.AVAILABLE_IN_WINDOW)},t.prototype.usePublicVapidKey=function(t){throw Mm.create(Pm.AVAILABLE_IN_WINDOW)},t.prototype.onMessage=function(t,e,n){throw Mm.create(Pm.AVAILABLE_IN_WINDOW)},t.prototype.onTokenRefresh=function(t,e,n){throw Mm.create(Pm.AVAILABLE_IN_WINDOW)},t.prototype.setBackgroundMessageHandler=function(t){throw Mm.create(Pm.AVAILABLE_IN_SW)},t.prototype.delete=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission_=function(){return Notification.permission},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getIidModel=function(){return this.iidModel},t}();var Jm=function(t){function e(e){var n=t.call(this,e)||this;return n.bgMessageHandler=null,self.addEventListener("push",function(t){n.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){n.onSubChange(t)}),self.addEventListener("notificationclick",function(t){n.onNotificationClick(t)}),n}return Je(e,t),e.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},e.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},e.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},e.prototype.onPush_=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i,o,s;return tn(this,function(a){switch(a.label){case 0:if(!t.data)return[2];try{e=t.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return a.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=a.sent(),o=n.actions,s=Notification.maxActions,o&&s&&o.length>s&&console.warn("This browser only supports "+s+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return a.sent(),[2];case 5:return[2]}})})},e.prototype.onSubChange_=function(t){return Ze(this,void 0,void 0,function(){var t,e,n,r;return tn(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw e=i.sent(),Mm.create(Pm.UNABLE_TO_RESUBSCRIBE,{message:e});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}})})},e.prototype.onNotificationClick_=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i;return tn(this,function(o){switch(o.label){case 0:return t.notification&&t.notification.data&&t.notification.data.FCM_MSG?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(e=t.notification.data.FCM_MSG).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=o.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=o.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=o.sent(),o.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=Zm(Om.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},e.prototype.getNotificationData_=function(t){if(t&&"object"==typeof t.notification){var e,n=$e({},t.notification);return n.data=$e({},t.notification.data,((e={}).FCM_MSG=t,e)),n}},e.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw Mm.create(Pm.BG_HANDLER_FUNCTION_EXPECTED);this.bgMessageHandler=t},e.prototype.getWindowClient_=function(t){return Ze(this,void 0,void 0,function(){var e,n,r,i;return tn(this,function(o){switch(o.label){case 0:return e=new URL(t,self.location.href).href,[4,$m()];case 1:for(n=o.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},e.prototype.attemptToMessageClient_=function(t,e){return Ze(this,void 0,void 0,function(){return tn(this,function(n){if(!t)throw Mm.create(Pm.NO_WINDOW_CLIENT_TO_MSG);return t.postMessage(e),[2]})})},e.prototype.hasVisibleClients_=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return[4,$m()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState})]}})})},e.prototype.sendMessageToWindowClients_=function(t){return Ze(this,void 0,void 0,function(){var e,n,r=this;return tn(this,function(i){switch(i.label){case 0:return[4,$m()];case 1:return e=i.sent(),n=Zm(Om.PUSH_MSG_RECEIVED,t),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return i.sent(),[2]}})})},e.prototype.getSWRegistration_=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return[2,self.registration]})})},e.prototype.getPublicVapidKey_=function(){return Ze(this,void 0,void 0,function(){var t,e;return tn(this,function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=n.sent()))throw Mm.create(Pm.SW_REGISTRATION_EXPECTED);return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(e=n.sent())?[2,xm]:[2,e]}})})},e}(Xm);function $m(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function Zm(t,e){return(n={})[km.TYPE_OF_MSG]=t,n[km.DATA]=e,n;var n}var tg=function(t){function e(e){var n=t.call(this,e)||this;return n.registrationToUse=null,n.publicVapidKeyToUse=null,n.manifestCheckPromise=null,n.messageObserver=null,n.tokenRefreshObserver=null,n.onMessageInternal=Ln(function(t){n.messageObserver=t}),n.onTokenRefreshInternal=Ln(function(t){n.tokenRefreshObserver=t}),n.setupSWMessageListener_(),n}return Je(e,t),e.prototype.getToken=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(e){switch(e.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return Ze(this,void 0,void 0,function(){var t,e;return tn(this,function(n){switch(n.label){case 0:if(!(t=document.querySelector('link[rel="manifest"]')))return[2];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(t.href)];case 2:return[4,n.sent().json()];case 3:return e=n.sent(),[3,5];case 4:return n.sent(),[2];case 5:if(!e||!e.gcm_sender_id)return[2];if("103953800507"!==e.gcm_sender_id)throw Mm.create(Pm.INCORRECT_GCM_SENDER_ID);return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return e.sent(),[2,t.prototype.getToken.call(this)]}})})},e.prototype.requestPermission=function(){return Ze(this,void 0,void 0,function(){var t;return tn(this,function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?Mm.create(Pm.PERMISSION_BLOCKED):Mm.create(Pm.PERMISSION_DEFAULT)}})})},e.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw Mm.create(Pm.SW_REGISTRATION_EXPECTED);if(null!=this.registrationToUse)throw Mm.create(Pm.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse=t},e.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw Mm.create(Pm.INVALID_PUBLIC_VAPID_KEY);if(null!=this.publicVapidKeyToUse)throw Mm.create(Pm.USE_PUBLIC_KEY_BEFORE_GET_TOKEN);var e=Vm(t);if(65!==e.length)throw Mm.create(Pm.PUBLIC_KEY_DECRYPTION_FAILED);this.publicVapidKeyToUse=e},e.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},e.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},e.prototype.waitForRegistrationToActivate_=function(t){var e=t.installing||t.waiting||t.active;return new Promise(function(n,r){if(e)if("activated"!==e.state)if("redundant"!==e.state){var i=function(){if("activated"===e.state)n(t);else{if("redundant"!==e.state)return;r(Mm.create(Pm.SW_REG_REDUNDANT))}e.removeEventListener("statechange",i)};e.addEventListener("statechange",i)}else r(Mm.create(Pm.SW_REG_REDUNDANT));else n(t);else r(Mm.create(Pm.NO_SW_IN_REG))})},e.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw Mm.create(Pm.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:t.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return t.registrationToUse=e,e.update(),e})}))},e.prototype.getPublicVapidKey_=function(){return Ze(this,void 0,void 0,function(){return tn(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,xm]})})},e.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[km.TYPE_OF_MSG]){var n=e.data;switch(n[km.TYPE_OF_MSG]){case Om.PUSH_MSG_RECEIVED:case Om.NOTIFICATION_CLICKED:var r=n[km.DATA];t.messageObserver&&t.messageObserver.next(r)}}},!1)},e}(Xm);function eg(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}!function(t){var e={isSupported:eg};t.INTERNAL.registerService("messaging",function(t){if(!eg())throw Mm.create(Pm.UNSUPPORTED_BROWSER);return self&&"ServiceWorkerGlobalScope"in self?new Jm(t):new tg(t)},e)}(Yn);var ng="https://firebasestorage.googleapis.com",rg="https://firebasestorage.googleapis.com",ig="/v0",og="/v0",sg=12e4,ag=6e4,ug=-9007199254740991,cg=function(){function t(t,e){this.code_=lg(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return lg(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),hg={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function lg(t){return"storage/"+t}function fg(){return new cg(hg.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function pg(){return new cg(hg.CANCELED,"User canceled the upload/download.")}function dg(){return new cg(hg.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function yg(t,e,n){return new cg(hg.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function mg(){return new cg(hg.APP_DELETED,"The Firebase app was deleted.")}function gg(t,e){return new cg(hg.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function vg(t){throw new cg(hg.INTERNAL_ERROR,"Internal error: "+t)}var bg={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function _g(t){switch(t){case bg.RAW:case bg.BASE64:case bg.BASE64URL:case bg.DATA_URL:return;default:throw"Expected one of the event types: ["+bg.RAW+", "+bg.BASE64+", "+bg.BASE64URL+", "+bg.DATA_URL+"]."}}var wg=function(){return function(t,e){this.data=t,this.contentType=e||null}}();function Eg(t,e){switch(t){case bg.RAW:return new wg(Tg(e));case bg.BASE64:case bg.BASE64URL:return new wg(Sg(t,e));case bg.DATA_URL:return new wg(function(t){var e=new Ig(t);return e.base64?Sg(bg.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw gg(bg.DATA_URL,"Malformed data URL.")}return Tg(e)}(e.rest)}(e),function(t){return new Ig(t).contentType}(e))}throw fg()}function Tg(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function Sg(t,e){switch(t){case bg.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw gg(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case bg.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw gg(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var s;try{s=atob(e)}catch(e){throw gg(t,"Invalid character found")}for(var a=new Uint8Array(s.length),u=0;u<s.length;u++)a[u]=s.charCodeAt(u);return a}var Ig=function(){return function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw gg(bg.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=(r=n,i=";base64",r.length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1);var r,i}}();var Cg,Ng={STATE_CHANGED:"state_changed"},Dg={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},Ag={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Rg(t){switch(t){case Dg.RUNNING:case Dg.PAUSING:case Dg.CANCELING:return Ag.RUNNING;case Dg.PAUSED:return Ag.PAUSED;case Dg.SUCCESS:return Ag.SUCCESS;case Dg.CANCELED:return Ag.CANCELED;case Dg.ERROR:default:return Ag.ERROR}}function kg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Og(t,e){for(var n in t)kg(t,n)&&e(n,t[n])}function Pg(t){if(null==t)return{};var e={};return Og(t,function(t,n){e[t]=n}),e}function Lg(t){return new Promise(t)}function Mg(t){return Promise.resolve(t)}function xg(t){return null!=t}function Fg(t){return void 0!==t}function Ug(t){return"function"==typeof t}function qg(t){return"object"==typeof t}function Bg(t){return qg(t)&&null!==t}function Vg(t){return"string"==typeof t||t instanceof String}function Wg(t){return jg()&&t instanceof Blob}function jg(){return"undefined"!=typeof Blob}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(Cg||(Cg={}));var Kg=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Cg.NO_ERROR,this.sendPromise_=Lg(function(e,n){t.xhr_.addEventListener("abort",function(n){t.errorCode_=Cg.ABORT,e(t)}),t.xhr_.addEventListener("error",function(n){t.errorCode_=Cg.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(n){e(t)})})}return t.prototype.send=function(t,e,n,r){var i=this;if(this.sent_)throw vg("cannot .send() more than once");(this.sent_=!0,this.xhr_.open(e,t,!0),xg(r))&&Og(r,function(t,e){i.xhr_.setRequestHeader(t,e.toString())});return xg(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw vg("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw vg("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw vg("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){xg(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){xg(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),Qg=function(){function t(){}return t.prototype.createXhrIo=function(){return new Kg},t}();function Hg(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return qg(n=e)&&!Array.isArray(n)?e:null}var Gg=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n,r;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw r=e,new cg(hg.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")},t.makeFromUrl=function(e){var n=null;for(var r=[{regex:new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i"),indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://firebasestorage\\.googleapis\\.com/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],i=0;i<r.length;i++){var o=r[i],s=o.regex.exec(e);if(s){var a=s[o.indices.bucket],u=s[o.indices.path];u||(u=""),n=new t(a,u),o.postModify(n);break}}if(null==n)throw function(t){return new cg(hg.INVALID_URL,"Invalid URL '"+t+"'.")}(e);return n},t}();function zg(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function Yg(t){return ng+ig+t}function Xg(t){return ng+og+t}function Jg(t){var e=encodeURIComponent,n="?";return Og(t,function(t,r){var i=e(t)+"="+e(r);n=n+i+"&"}),n=n.slice(0,-1)}function $g(t,e){return e}var Zg=function(){return function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||$g}}(),tv=null;function ev(){if(tv)return tv;var t=[];t.push(new Zg("bucket")),t.push(new Zg("generation")),t.push(new Zg("metageneration")),t.push(new Zg("name","fullPath",!0));var e=new Zg("name");e.xform=function(t,e){return function(t){return!Vg(t)||t.length<2?t:zg(t=t)}(e)},t.push(e);var n=new Zg("size");return n.xform=function(t,e){return xg(e)?+e:e},t.push(n),t.push(new Zg("timeCreated")),t.push(new Zg("updated")),t.push(new Zg("md5Hash",null,!0)),t.push(new Zg("cacheControl",null,!0)),t.push(new Zg("contentDisposition",null,!0)),t.push(new Zg("contentEncoding",null,!0)),t.push(new Zg("contentLanguage",null,!0)),t.push(new Zg("contentType",null,!0)),t.push(new Zg("metadata","customMetadata",!0)),tv=t}function nv(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var s=n[o];r[s.local]=s.xform(r,e[s.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new Gg(n,r);return e.makeStorageReference(i)}})}(r,t),r}function rv(t,e,n){var r=Hg(e);return null===r?null:nv(t,r,n)}function iv(t,e){var n=Hg(e);if(null===n)return null;if(!Vg(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(e){var n=t.bucket,r=t.fullPath;return function(t){return rg+ig+t}("/b/"+i(n)+"/o/"+i(r))+Jg({alt:"media",token:e})})[0]}function ov(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function sv(t){if(!(t&&qg(t)))throw"Expected Metadata object.";for(var e in t){var n=t[e];if("customMetadata"===e){if(!qg(n))throw"Expected object for 'customMetadata' mapping."}else if(Bg(n))throw"Mapping for '"+e+"' cannot be an object."}}function av(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}var s,a,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw s=r,a=i,u=t,c=n.length,s===a?(h=s,l=1===s?"argument":"arguments"):(h="between "+s+" and "+a,l="arguments"),new cg(hg.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?yg(o,t,e.message):yg(o,t,e)}}var uv=function(){return function(t,e){var n=this;this.validator=function(e){n.optional&&!Fg(e)||t(e)},this.optional=!!e}}();function cv(t,e){function n(t){if(!Vg(t))throw"Expected string."}var r,i,o;return t?(i=n,o=t,r=function(t){i(t),o(t)}):r=n,new uv(r,e)}function hv(t){return new uv(sv,t)}function lv(){return new uv(function(t){if(!(function(t){return"number"==typeof t||t instanceof Number}(t)&&t>=0))throw"Expected a number 0 or greater."})}function fv(t,e){return new uv(function(e){if(!(null===e||xg(e)&&e instanceof Object))throw"Expected an Object.";void 0!==t&&null!==t&&t(e)},e)}function pv(t){return new uv(function(t){if(null!==t&&!Ug(t))throw"Expected a Function."},t)}function dv(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}var yv=function(){function t(t,e){var n=0,r="";Wg(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(Wg(this.data_)){var r=this.data_,i=(s=e,a=n,(o=r).webkitSlice?o.webkitSlice(s,a):o.mozSlice?o.mozSlice(s,a):o.slice?o.slice(s,a):null);return null===i?null:new t(i)}var o,s,a;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(jg()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=dv();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(jg())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}.apply(null,r))}var i=e.map(function(t){return Vg(t)?Eg(bg.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var s=new Uint8Array(o),a=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)s[a++]=t[e]}),new t(s,!0)},t.prototype.uploadData=function(){return this.data_},t}();function mv(t,e){return-1!==t.indexOf(e)}var gv=function(){return function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function vv(t){if(!t)throw fg()}function bv(t,e){return function(n,r){var i=rv(t,r,e);return vv(null!==i),i}}function _v(t){return function(e,n){var r,i,o;return 401===e.getStatus()?r=new cg(hg.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(o=t.bucket,r=new cg(hg.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,r=new cg(hg.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.setServerResponseProp(n.serverResponseProp()),r}}function wv(t){var e=_v(t);return function(n,r){var i,o=e(n,r);return 404===n.getStatus()&&(i=t.path,o=new cg(hg.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),o.setServerResponseProp(r.serverResponseProp()),o}}function Ev(t,e,n){var r=Yg(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new gv(r,"GET",bv(t,n),i);return o.errorHandler=wv(e),o}function Tv(t,e,n){var r=Yg(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new gv(r,"GET",function(t,e){return function(n,r){var i=rv(t,r,e);return vv(null!==i),iv(i,r)}}(t,n),i);return o.errorHandler=wv(e),o}function Sv(t,e,n){var r=Pg(n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var Iv=function(){return function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}();function Cv(t,e){var n;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){vv(!1)}return vv(mv(e||["active"],n)),n}function Nv(t,e,n,r,i,o,s,a){var u=new Iv(0,0);if(s?(u.current=s.current,u.total=s.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new cg(hg.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;i>0&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw dg();var y=e.maxUploadRetryTime(),m=new gv(n,"POST",function(t,n){var i,s=Cv(t,["active","final"]),a=u.current+h,c=r.size();return i="final"===s?bv(e,o)(t,n):null,new Iv(a,c,"final"===s,i)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=a||null,m.errorHandler=_v(t),m}var Dv=function(){return function(t,e,n){if(Ug(t)||xg(e)||xg(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}}}(),Av=function(){return function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o}}();function Rv(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Mg(!0).then(function(){t.apply(null,e)})}}var kv=function(){function t(t,e,n,r,i,o){void 0===o&&(o=null);var s=this;this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=Dg.RUNNING,this.errorHandler_=function(t){s.request_=null,s.chunkMultiplier_=1,t.codeEquals(hg.CANCELED)?(s.needToFetchStatus_=!0,s.completeTransitions_()):(s.error_=t,s.transition_(Dg.ERROR))},this.metadataErrorHandler_=function(t){s.request_=null,t.codeEquals(hg.CANCELED)?s.completeTransitions_():(s.error_=t,s.transition_(Dg.ERROR))},this.promise_=Lg(function(t,e){s.resolve_=t,s.reject_=e,s.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n,r){t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===Dg.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case Dg.RUNNING:t(n);break;case Dg.CANCELING:e.transition_(Dg.CANCELED);break;case Dg.PAUSING:e.transition_(Dg.PAUSED)}})},t.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s=Sv(e,r,i),a={name:s.fullPath},u=Xg(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},h=ov(s,n),l=t.maxUploadRetryTime(),f=new gv(u,"POST",function(t,e){var n;Cv(t);try{n=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){vv(!1)}return vv(Vg(n)),n},l);return f.urlParams=a,f.headers=c,f.body=h,f.errorHandler=_v(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new gv(n,"POST",function(t,e){var n,i=Cv(t,["active","final"]);try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){vv(!1)}var o=parseInt(n,10);return vv(!isNaN(o)),new Iv(o,r.size(),"final"===i)},i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=_v(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);t.request_=i,i.getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new Iv(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=Nv(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(e){return t.error_=e,void t.transition_(Dg.ERROR)}var s=t.authWrapper_.makeRequest(o,i);t.request_=s,s.getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(Dg.SUCCESS)):t.completeTransitions_()},t.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=Ev(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(Dg.SUCCESS)},t.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();s["Content-Type"]="multipart/related; boundary="+a;var u=Sv(e,r,i),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ov(u,n)+"\r\n--"+a+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+a+"--",l=yv.getBlob(c,r,h);if(null===l)throw dg();var f={name:u.fullPath},p=Xg(o),d=t.maxUploadRetryTime(),y=new gv(p,"POST",bv(t,n),d);return y.urlParams=f,y.headers=s,y.body=l.uploadData(),y.errorHandler=_v(e),y}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(Dg.SUCCESS)},t.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case Dg.CANCELING:case Dg.PAUSING:this.state_=t,null!==this.request_&&this.request_.cancel();break;case Dg.RUNNING:var e=this.state_===Dg.PAUSED;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case Dg.PAUSED:this.state_=t,this.notifyObservers_();break;case Dg.CANCELED:this.error_=pg(),this.state_=t,this.notifyObservers_();break;case Dg.ERROR:case Dg.SUCCESS:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case Dg.PAUSING:this.transition_(Dg.PAUSED);break;case Dg.CANCELING:this.transition_(Dg.CANCELED);break;case Dg.RUNNING:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=Rg(this.state_);return new Av(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){void 0===e&&(e=void 0),void 0===n&&(n=void 0),void 0===r&&(r=void 0);var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=pv(!0).validator,s=fv(null,!0).validator;function a(t){try{return void o(t)}catch(t){}try{if(s(t),!(Fg(t.next)||Fg(t.error)||Fg(t.complete)))throw"";return}catch(t){throw i}}av("on",[cv(function(e){if(t!==Ng.STATE_CHANGED)throw"Expected one of the event types: ["+Ng.STATE_CHANGED+"]."}),fv(a,!0),pv(!0),pv(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&av("on",t,arguments);var o=new Dv(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[fv(function(t){if(null===t)throw i;a(t)}),pv(!0),pv(!0)];return!(Fg(e)||Fg(n)||Fg(r))?c(h):c(null)(e,n,r)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e,n,r;e=this.observers_,n=t,-1!==(r=e.indexOf(n))&&e.splice(r,1)},t.prototype.notifyObservers_=function(){var t,e=this;this.finishPromise_(),(t=this.observers_,Array.prototype.slice.call(t)).forEach(function(t){e.notifyObserver_(t)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(Rg(this.state_)){case Ag.SUCCESS:Rv(this.resolve_.bind(null,this.snapshot))();break;case Ag.CANCELED:case Ag.ERROR:Rv(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(Rg(this.state_)){case Ag.RUNNING:case Ag.PAUSED:null!==t.next&&Rv(t.next.bind(t,this.snapshot))();break;case Ag.SUCCESS:null!==t.complete&&Rv(t.complete.bind(t))();break;case Ag.CANCELED:case Ag.ERROR:null!==t.error&&Rv(t.error.bind(t,this.error_))();break;default:null!==t.error&&Rv(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){av("resume",[],arguments);var t=this.state_===Dg.PAUSED||this.state_===Dg.PAUSING;return t&&this.transition_(Dg.RUNNING),t},t.prototype.pause=function(){av("pause",[],arguments);var t=this.state_===Dg.RUNNING;return t&&this.transition_(Dg.PAUSING),t},t.prototype.cancel=function(){av("cancel",[],arguments);var t=this.state_===Dg.RUNNING||this.state_===Dg.PAUSING;return t&&this.transition_(Dg.CANCELING),t},t}(),Ov=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof Gg?e:Gg.makeFromUrl(e)}return t.prototype.toString=function(){return av("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return ev()},t.prototype.child=function(t){av("child",[cv()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new Gg(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0==t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new Gg(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new Gg(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return zg(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),av("put",[new uv(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||jg()&&t instanceof Blob))throw"Expected Blob or File."}),hv(!0)],arguments),this.throwIfRoot_("put"),new kv(this,this.authWrapper,this.location,this.mappings(),new yv(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=bg.RAW),av("putString",[cv(),cv(_g,!0),hv(!0)],arguments),this.throwIfRoot_("putString");var r=Eg(e,t),i=Pg(n);return!xg(i.contentType)&&xg(r.contentType)&&(i.contentType=r.contentType),new kv(this,this.authWrapper,this.location,this.mappings(),new yv(r.data,!0),i)},t.prototype.delete=function(){av("delete",[],arguments),this.throwIfRoot_("delete");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=function(t,e){var n=Yg(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new gv(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=wv(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.getMetadata=function(){av("getMetadata",[],arguments),this.throwIfRoot_("getMetadata");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=Ev(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.updateMetadata=function(t){av("updateMetadata",[hv()],arguments),this.throwIfRoot_("updateMetadata");var e=this;return this.authWrapper.getAuthToken().then(function(n){var r=function(t,e,n,r){var i=Yg(e.fullServerUrl()),o=ov(n,r),s=t.maxOperationRetryTime(),a=new gv(i,"PATCH",bv(t,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=o,a.errorHandler=wv(e),a}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()})},t.prototype.getDownloadURL=function(){av("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=Tv(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then(function(t){if(null===t)throw new cg(hg.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new cg(hg.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),Pv=function(){function t(t){this.promise_=function(t){return Promise.reject(t)}(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){void 0===t&&(t=!1)},t}(),Lv=function(){function t(){this.map_={},this.id_=ug}return t.prototype.addRequest=function(t){var e=this.id_;this.id_++,this.map_[e]=t;var n=this;function r(){delete n.map_[e]}t.getPromise().then(r,r)},t.prototype.clear=function(){Og(this.map_,function(t,e){e&&e.cancel(!0)}),this.map_={}},t}(),Mv=function(){function t(e,n,r,i,o){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var s=this.app_.options;xg(s)&&(this.bucket_=t.extractBucket_(s))}this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=o,this.service_=i,this.maxOperationRetryTime_=sg,this.maxUploadRetryTime_=ag,this.requestMap_=new Lv}return t.extractBucket_=function(t){var e=t.storageBucket||null;return null==e?null:Gg.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){return null!==this.app_&&xg(this.app_.INTERNAL)&&xg(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(t){return null}):Mg(null)},t.prototype.bucket=function(){if(this.deleted_)throw mg();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new Pv(mg());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}();var xv=function(){function t(t,e,n,r,i,o,s,a,u,c,h){this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=s,this.errorCallback_=a,this.progressCallback_=c,this.timeout_=u,this.pool_=h;var l=this;this.promise_=Lg(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,s=n.xhr;if(n.wasSuccessCode)try{var a=t.callback_(s,s.getResponseText());Fg(a)?i(a):i()}catch(t){o(t)}else null!==s?((r=fg()).setServerResponseProp(s.getResponseText()),t.errorCallback_?o(t.errorCallback_(s,r)):o(r)):n.canceled?o(r=t.appDelete_?mg():pg()):o(r=new cg(hg.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new Fv(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,s=0;function a(){return 2===s}var u=!1;function c(){u||(u=!0,e.apply(null,arguments))}function h(e){i=setTimeout(function(){i=null,t(l,a())},e)}function l(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];u||(t?c.apply(null,arguments):a()||o?c.apply(null,arguments):(r<64&&(r*=2),1===s?(s=2,e=0):e=1e3*(r+Math.random()),h(e)))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(s=2),clearTimeout(i),h(0)):t||(s=1)))}return h(0),setTimeout(function(){o=!0,p(!0)},n),p}(function(e,n){if(n)e(!1,new Fv(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===Cg.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var s=mv(t.successCodes_,o);e(!0,new Fv(s,n))}else{var a=n.getErrorCode()===Cg.ABORT;e(!1,new Fv(!1,null,a))}})}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}},e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=mv([408,429],t),r=mv(this.additionalRetryCodes_,t);return e||n||r},t}(),Fv=function(){return function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n}}();function Uv(t,e,n){var r=Jg(t.urlParams),i=t.url+r,o=Pg(t.headers);return function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==Yn?Yn.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new xv(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var qv=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new Mv(t,function(t,e){return new Ov(t,e)},Uv,this,e),this.app_=t,null!=n)this.bucket_=Gg.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new Gg(r,""))}this.internals_=new Bv(this)}return t.prototype.ref=function(t){if(av("ref",[cv(function(t){if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new Ov(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return av("refFromURL",[cv(function(t){if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{Gg.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new Ov(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){av("setMaxUploadRetryTime",[lv()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this.authWrapper_.maxOperationRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxOperationRetryTime=function(t){av("setMaxOperationRetryTime",[lv()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),Bv=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Mg(void 0)},t}(),Vv="storage";function Wv(t,e,n){return new qv(t,new Qg,n)}return function(t){var e={TaskState:Ag,TaskEvent:Ng,StringFormat:bg,Storage:qv,Reference:Ov};t.INTERNAL.registerService(Vv,Wv,e,void 0,!0)}(Yn),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Yn});
/*!
 * Vue.js v2.6.10
 * (c) 2014-2019 Evan You
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Vue=t()}(this,function(){"use strict";var e=Object.freeze({});function t(e){return null==e}function n(e){return null!=e}function r(e){return!0===e}function i(e){return"string"==typeof e||"number"==typeof e||"symbol"==typeof e||"boolean"==typeof e}function o(e){return null!==e&&"object"==typeof e}var a=Object.prototype.toString;function s(e){return"[object Object]"===a.call(e)}function c(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}function u(e){return n(e)&&"function"==typeof e.then&&"function"==typeof e.catch}function l(e){return null==e?"":Array.isArray(e)||s(e)&&e.toString===a?JSON.stringify(e,null,2):String(e)}function f(e){var t=parseFloat(e);return isNaN(t)?e:t}function p(e,t){for(var n=Object.create(null),r=e.split(","),i=0;i<r.length;i++)n[r[i]]=!0;return t?function(e){return n[e.toLowerCase()]}:function(e){return n[e]}}var d=p("slot,component",!0),v=p("key,ref,slot,slot-scope,is");function h(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}var m=Object.prototype.hasOwnProperty;function y(e,t){return m.call(e,t)}function g(e){var t=Object.create(null);return function(n){return t[n]||(t[n]=e(n))}}var _=/-(\w)/g,b=g(function(e){return e.replace(_,function(e,t){return t?t.toUpperCase():""})}),$=g(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}),w=/\B([A-Z])/g,C=g(function(e){return e.replace(w,"-$1").toLowerCase()});var x=Function.prototype.bind?function(e,t){return e.bind(t)}:function(e,t){function n(n){var r=arguments.length;return r?r>1?e.apply(t,arguments):e.call(t,n):e.call(t)}return n._length=e.length,n};function k(e,t){t=t||0;for(var n=e.length-t,r=new Array(n);n--;)r[n]=e[n+t];return r}function A(e,t){for(var n in t)e[n]=t[n];return e}function O(e){for(var t={},n=0;n<e.length;n++)e[n]&&A(t,e[n]);return t}function S(e,t,n){}var T=function(e,t,n){return!1},E=function(e){return e};function N(e,t){if(e===t)return!0;var n=o(e),r=o(t);if(!n||!r)return!n&&!r&&String(e)===String(t);try{var i=Array.isArray(e),a=Array.isArray(t);if(i&&a)return e.length===t.length&&e.every(function(e,n){return N(e,t[n])});if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(i||a)return!1;var s=Object.keys(e),c=Object.keys(t);return s.length===c.length&&s.every(function(n){return N(e[n],t[n])})}catch(e){return!1}}function j(e,t){for(var n=0;n<e.length;n++)if(N(e[n],t))return n;return-1}function D(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var L="data-server-rendered",M=["component","directive","filter"],I=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],F={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:T,isReservedAttr:T,isUnknownElement:T,getTagNamespace:S,parsePlatformTagName:E,mustUseProp:T,async:!0,_lifecycleHooks:I},P=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function R(e,t,n,r){Object.defineProperty(e,t,{value:n,enumerable:!!r,writable:!0,configurable:!0})}var H=new RegExp("[^"+P.source+".$_\\d]");var B,U="__proto__"in{},z="undefined"!=typeof window,V="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,K=V&&WXEnvironment.platform.toLowerCase(),J=z&&window.navigator.userAgent.toLowerCase(),q=J&&/msie|trident/.test(J),W=J&&J.indexOf("msie 9.0")>0,Z=J&&J.indexOf("edge/")>0,G=(J&&J.indexOf("android"),J&&/iphone|ipad|ipod|ios/.test(J)||"ios"===K),X=(J&&/chrome\/\d+/.test(J),J&&/phantomjs/.test(J),J&&J.match(/firefox\/(\d+)/)),Y={}.watch,Q=!1;if(z)try{var ee={};Object.defineProperty(ee,"passive",{get:function(){Q=!0}}),window.addEventListener("test-passive",null,ee)}catch(e){}var te=function(){return void 0===B&&(B=!z&&!V&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),B},ne=z&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function re(e){return"function"==typeof e&&/native code/.test(e.toString())}var ie,oe="undefined"!=typeof Symbol&&re(Symbol)&&"undefined"!=typeof Reflect&&re(Reflect.ownKeys);ie="undefined"!=typeof Set&&re(Set)?Set:function(){function e(){this.set=Object.create(null)}return e.prototype.has=function(e){return!0===this.set[e]},e.prototype.add=function(e){this.set[e]=!0},e.prototype.clear=function(){this.set=Object.create(null)},e}();var ae=S,se=0,ce=function(){this.id=se++,this.subs=[]};ce.prototype.addSub=function(e){this.subs.push(e)},ce.prototype.removeSub=function(e){h(this.subs,e)},ce.prototype.depend=function(){ce.target&&ce.target.addDep(this)},ce.prototype.notify=function(){for(var e=this.subs.slice(),t=0,n=e.length;t<n;t++)e[t].update()},ce.target=null;var ue=[];function le(e){ue.push(e),ce.target=e}function fe(){ue.pop(),ce.target=ue[ue.length-1]}var pe=function(e,t,n,r,i,o,a,s){this.tag=e,this.data=t,this.children=n,this.text=r,this.elm=i,this.ns=void 0,this.context=o,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=t&&t.key,this.componentOptions=a,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=s,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},de={child:{configurable:!0}};de.child.get=function(){return this.componentInstance},Object.defineProperties(pe.prototype,de);var ve=function(e){void 0===e&&(e="");var t=new pe;return t.text=e,t.isComment=!0,t};function he(e){return new pe(void 0,void 0,void 0,String(e))}function me(e){var t=new pe(e.tag,e.data,e.children&&e.children.slice(),e.text,e.elm,e.context,e.componentOptions,e.asyncFactory);return t.ns=e.ns,t.isStatic=e.isStatic,t.key=e.key,t.isComment=e.isComment,t.fnContext=e.fnContext,t.fnOptions=e.fnOptions,t.fnScopeId=e.fnScopeId,t.asyncMeta=e.asyncMeta,t.isCloned=!0,t}var ye=Array.prototype,ge=Object.create(ye);["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(e){var t=ye[e];R(ge,e,function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var i,o=t.apply(this,n),a=this.__ob__;switch(e){case"push":case"unshift":i=n;break;case"splice":i=n.slice(2)}return i&&a.observeArray(i),a.dep.notify(),o})});var _e=Object.getOwnPropertyNames(ge),be=!0;function $e(e){be=e}var we=function(e){var t;this.value=e,this.dep=new ce,this.vmCount=0,R(e,"__ob__",this),Array.isArray(e)?(U?(t=ge,e.__proto__=t):function(e,t,n){for(var r=0,i=n.length;r<i;r++){var o=n[r];R(e,o,t[o])}}(e,ge,_e),this.observeArray(e)):this.walk(e)};function Ce(e,t){var n;if(o(e)&&!(e instanceof pe))return y(e,"__ob__")&&e.__ob__ instanceof we?n=e.__ob__:be&&!te()&&(Array.isArray(e)||s(e))&&Object.isExtensible(e)&&!e._isVue&&(n=new we(e)),t&&n&&n.vmCount++,n}function xe(e,t,n,r,i){var o=new ce,a=Object.getOwnPropertyDescriptor(e,t);if(!a||!1!==a.configurable){var s=a&&a.get,c=a&&a.set;s&&!c||2!==arguments.length||(n=e[t]);var u=!i&&Ce(n);Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){var t=s?s.call(e):n;return ce.target&&(o.depend(),u&&(u.dep.depend(),Array.isArray(t)&&function e(t){for(var n=void 0,r=0,i=t.length;r<i;r++)(n=t[r])&&n.__ob__&&n.__ob__.dep.depend(),Array.isArray(n)&&e(n)}(t))),t},set:function(t){var r=s?s.call(e):n;t===r||t!=t&&r!=r||s&&!c||(c?c.call(e,t):n=t,u=!i&&Ce(t),o.notify())}})}}function ke(e,t,n){if(Array.isArray(e)&&c(t))return e.length=Math.max(e.length,t),e.splice(t,1,n),n;if(t in e&&!(t in Object.prototype))return e[t]=n,n;var r=e.__ob__;return e._isVue||r&&r.vmCount?n:r?(xe(r.value,t,n),r.dep.notify(),n):(e[t]=n,n)}function Ae(e,t){if(Array.isArray(e)&&c(t))e.splice(t,1);else{var n=e.__ob__;e._isVue||n&&n.vmCount||y(e,t)&&(delete e[t],n&&n.dep.notify())}}we.prototype.walk=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)xe(e,t[n])},we.prototype.observeArray=function(e){for(var t=0,n=e.length;t<n;t++)Ce(e[t])};var Oe=F.optionMergeStrategies;function Se(e,t){if(!t)return e;for(var n,r,i,o=oe?Reflect.ownKeys(t):Object.keys(t),a=0;a<o.length;a++)"__ob__"!==(n=o[a])&&(r=e[n],i=t[n],y(e,n)?r!==i&&s(r)&&s(i)&&Se(r,i):ke(e,n,i));return e}function Te(e,t,n){return n?function(){var r="function"==typeof t?t.call(n,n):t,i="function"==typeof e?e.call(n,n):e;return r?Se(r,i):i}:t?e?function(){return Se("function"==typeof t?t.call(this,this):t,"function"==typeof e?e.call(this,this):e)}:t:e}function Ee(e,t){var n=t?e?e.concat(t):Array.isArray(t)?t:[t]:e;return n?function(e){for(var t=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t}(n):n}function Ne(e,t,n,r){var i=Object.create(e||null);return t?A(i,t):i}Oe.data=function(e,t,n){return n?Te(e,t,n):t&&"function"!=typeof t?e:Te(e,t)},I.forEach(function(e){Oe[e]=Ee}),M.forEach(function(e){Oe[e+"s"]=Ne}),Oe.watch=function(e,t,n,r){if(e===Y&&(e=void 0),t===Y&&(t=void 0),!t)return Object.create(e||null);if(!e)return t;var i={};for(var o in A(i,e),t){var a=i[o],s=t[o];a&&!Array.isArray(a)&&(a=[a]),i[o]=a?a.concat(s):Array.isArray(s)?s:[s]}return i},Oe.props=Oe.methods=Oe.inject=Oe.computed=function(e,t,n,r){if(!e)return t;var i=Object.create(null);return A(i,e),t&&A(i,t),i},Oe.provide=Te;var je=function(e,t){return void 0===t?e:t};function De(e,t,n){if("function"==typeof t&&(t=t.options),function(e,t){var n=e.props;if(n){var r,i,o={};if(Array.isArray(n))for(r=n.length;r--;)"string"==typeof(i=n[r])&&(o[b(i)]={type:null});else if(s(n))for(var a in n)i=n[a],o[b(a)]=s(i)?i:{type:i};e.props=o}}(t),function(e,t){var n=e.inject;if(n){var r=e.inject={};if(Array.isArray(n))for(var i=0;i<n.length;i++)r[n[i]]={from:n[i]};else if(s(n))for(var o in n){var a=n[o];r[o]=s(a)?A({from:o},a):{from:a}}}}(t),function(e){var t=e.directives;if(t)for(var n in t){var r=t[n];"function"==typeof r&&(t[n]={bind:r,update:r})}}(t),!t._base&&(t.extends&&(e=De(e,t.extends,n)),t.mixins))for(var r=0,i=t.mixins.length;r<i;r++)e=De(e,t.mixins[r],n);var o,a={};for(o in e)c(o);for(o in t)y(e,o)||c(o);function c(r){var i=Oe[r]||je;a[r]=i(e[r],t[r],n,r)}return a}function Le(e,t,n,r){if("string"==typeof n){var i=e[t];if(y(i,n))return i[n];var o=b(n);if(y(i,o))return i[o];var a=$(o);return y(i,a)?i[a]:i[n]||i[o]||i[a]}}function Me(e,t,n,r){var i=t[e],o=!y(n,e),a=n[e],s=Pe(Boolean,i.type);if(s>-1)if(o&&!y(i,"default"))a=!1;else if(""===a||a===C(e)){var c=Pe(String,i.type);(c<0||s<c)&&(a=!0)}if(void 0===a){a=function(e,t,n){if(!y(t,"default"))return;var r=t.default;if(e&&e.$options.propsData&&void 0===e.$options.propsData[n]&&void 0!==e._props[n])return e._props[n];return"function"==typeof r&&"Function"!==Ie(t.type)?r.call(e):r}(r,i,e);var u=be;$e(!0),Ce(a),$e(u)}return a}function Ie(e){var t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:""}function Fe(e,t){return Ie(e)===Ie(t)}function Pe(e,t){if(!Array.isArray(t))return Fe(t,e)?0:-1;for(var n=0,r=t.length;n<r;n++)if(Fe(t[n],e))return n;return-1}function Re(e,t,n){le();try{if(t)for(var r=t;r=r.$parent;){var i=r.$options.errorCaptured;if(i)for(var o=0;o<i.length;o++)try{if(!1===i[o].call(r,e,t,n))return}catch(e){Be(e,r,"errorCaptured hook")}}Be(e,t,n)}finally{fe()}}function He(e,t,n,r,i){var o;try{(o=n?e.apply(t,n):e.call(t))&&!o._isVue&&u(o)&&!o._handled&&(o.catch(function(e){return Re(e,r,i+" (Promise/async)")}),o._handled=!0)}catch(e){Re(e,r,i)}return o}function Be(e,t,n){if(F.errorHandler)try{return F.errorHandler.call(null,e,t,n)}catch(t){t!==e&&Ue(t,null,"config.errorHandler")}Ue(e,t,n)}function Ue(e,t,n){if(!z&&!V||"undefined"==typeof console)throw e;console.error(e)}var ze,Ve=!1,Ke=[],Je=!1;function qe(){Je=!1;var e=Ke.slice(0);Ke.length=0;for(var t=0;t<e.length;t++)e[t]()}if("undefined"!=typeof Promise&&re(Promise)){var We=Promise.resolve();ze=function(){We.then(qe),G&&setTimeout(S)},Ve=!0}else if(q||"undefined"==typeof MutationObserver||!re(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())ze="undefined"!=typeof setImmediate&&re(setImmediate)?function(){setImmediate(qe)}:function(){setTimeout(qe,0)};else{var Ze=1,Ge=new MutationObserver(qe),Xe=document.createTextNode(String(Ze));Ge.observe(Xe,{characterData:!0}),ze=function(){Ze=(Ze+1)%2,Xe.data=String(Ze)},Ve=!0}function Ye(e,t){var n;if(Ke.push(function(){if(e)try{e.call(t)}catch(e){Re(e,t,"nextTick")}else n&&n(t)}),Je||(Je=!0,ze()),!e&&"undefined"!=typeof Promise)return new Promise(function(e){n=e})}var Qe=new ie;function et(e){!function e(t,n){var r,i;var a=Array.isArray(t);if(!a&&!o(t)||Object.isFrozen(t)||t instanceof pe)return;if(t.__ob__){var s=t.__ob__.dep.id;if(n.has(s))return;n.add(s)}if(a)for(r=t.length;r--;)e(t[r],n);else for(i=Object.keys(t),r=i.length;r--;)e(t[i[r]],n)}(e,Qe),Qe.clear()}var tt=g(function(e){var t="&"===e.charAt(0),n="~"===(e=t?e.slice(1):e).charAt(0),r="!"===(e=n?e.slice(1):e).charAt(0);return{name:e=r?e.slice(1):e,once:n,capture:r,passive:t}});function nt(e,t){function n(){var e=arguments,r=n.fns;if(!Array.isArray(r))return He(r,null,arguments,t,"v-on handler");for(var i=r.slice(),o=0;o<i.length;o++)He(i[o],null,e,t,"v-on handler")}return n.fns=e,n}function rt(e,n,i,o,a,s){var c,u,l,f;for(c in e)u=e[c],l=n[c],f=tt(c),t(u)||(t(l)?(t(u.fns)&&(u=e[c]=nt(u,s)),r(f.once)&&(u=e[c]=a(f.name,u,f.capture)),i(f.name,u,f.capture,f.passive,f.params)):u!==l&&(l.fns=u,e[c]=l));for(c in n)t(e[c])&&o((f=tt(c)).name,n[c],f.capture)}function it(e,i,o){var a;e instanceof pe&&(e=e.data.hook||(e.data.hook={}));var s=e[i];function c(){o.apply(this,arguments),h(a.fns,c)}t(s)?a=nt([c]):n(s.fns)&&r(s.merged)?(a=s).fns.push(c):a=nt([s,c]),a.merged=!0,e[i]=a}function ot(e,t,r,i,o){if(n(t)){if(y(t,r))return e[r]=t[r],o||delete t[r],!0;if(y(t,i))return e[r]=t[i],o||delete t[i],!0}return!1}function at(e){return i(e)?[he(e)]:Array.isArray(e)?function e(o,a){var s=[];var c,u,l,f;for(c=0;c<o.length;c++)t(u=o[c])||"boolean"==typeof u||(l=s.length-1,f=s[l],Array.isArray(u)?u.length>0&&(st((u=e(u,(a||"")+"_"+c))[0])&&st(f)&&(s[l]=he(f.text+u[0].text),u.shift()),s.push.apply(s,u)):i(u)?st(f)?s[l]=he(f.text+u):""!==u&&s.push(he(u)):st(u)&&st(f)?s[l]=he(f.text+u.text):(r(o._isVList)&&n(u.tag)&&t(u.key)&&n(a)&&(u.key="__vlist"+a+"_"+c+"__"),s.push(u)));return s}(e):void 0}function st(e){return n(e)&&n(e.text)&&!1===e.isComment}function ct(e,t){if(e){for(var n=Object.create(null),r=oe?Reflect.ownKeys(e):Object.keys(e),i=0;i<r.length;i++){var o=r[i];if("__ob__"!==o){for(var a=e[o].from,s=t;s;){if(s._provided&&y(s._provided,a)){n[o]=s._provided[a];break}s=s.$parent}if(!s&&"default"in e[o]){var c=e[o].default;n[o]="function"==typeof c?c.call(t):c}}}return n}}function ut(e,t){if(!e||!e.length)return{};for(var n={},r=0,i=e.length;r<i;r++){var o=e[r],a=o.data;if(a&&a.attrs&&a.attrs.slot&&delete a.attrs.slot,o.context!==t&&o.fnContext!==t||!a||null==a.slot)(n.default||(n.default=[])).push(o);else{var s=a.slot,c=n[s]||(n[s]=[]);"template"===o.tag?c.push.apply(c,o.children||[]):c.push(o)}}for(var u in n)n[u].every(lt)&&delete n[u];return n}function lt(e){return e.isComment&&!e.asyncFactory||" "===e.text}function ft(t,n,r){var i,o=Object.keys(n).length>0,a=t?!!t.$stable:!o,s=t&&t.$key;if(t){if(t._normalized)return t._normalized;if(a&&r&&r!==e&&s===r.$key&&!o&&!r.$hasNormal)return r;for(var c in i={},t)t[c]&&"$"!==c[0]&&(i[c]=pt(n,c,t[c]))}else i={};for(var u in n)u in i||(i[u]=dt(n,u));return t&&Object.isExtensible(t)&&(t._normalized=i),R(i,"$stable",a),R(i,"$key",s),R(i,"$hasNormal",o),i}function pt(e,t,n){var r=function(){var e=arguments.length?n.apply(null,arguments):n({});return(e=e&&"object"==typeof e&&!Array.isArray(e)?[e]:at(e))&&(0===e.length||1===e.length&&e[0].isComment)?void 0:e};return n.proxy&&Object.defineProperty(e,t,{get:r,enumerable:!0,configurable:!0}),r}function dt(e,t){return function(){return e[t]}}function vt(e,t){var r,i,a,s,c;if(Array.isArray(e)||"string"==typeof e)for(r=new Array(e.length),i=0,a=e.length;i<a;i++)r[i]=t(e[i],i);else if("number"==typeof e)for(r=new Array(e),i=0;i<e;i++)r[i]=t(i+1,i);else if(o(e))if(oe&&e[Symbol.iterator]){r=[];for(var u=e[Symbol.iterator](),l=u.next();!l.done;)r.push(t(l.value,r.length)),l=u.next()}else for(s=Object.keys(e),r=new Array(s.length),i=0,a=s.length;i<a;i++)c=s[i],r[i]=t(e[c],c,i);return n(r)||(r=[]),r._isVList=!0,r}function ht(e,t,n,r){var i,o=this.$scopedSlots[e];o?(n=n||{},r&&(n=A(A({},r),n)),i=o(n)||t):i=this.$slots[e]||t;var a=n&&n.slot;return a?this.$createElement("template",{slot:a},i):i}function mt(e){return Le(this.$options,"filters",e)||E}function yt(e,t){return Array.isArray(e)?-1===e.indexOf(t):e!==t}function gt(e,t,n,r,i){var o=F.keyCodes[t]||n;return i&&r&&!F.keyCodes[t]?yt(i,r):o?yt(o,e):r?C(r)!==t:void 0}function _t(e,t,n,r,i){if(n)if(o(n)){var a;Array.isArray(n)&&(n=O(n));var s=function(o){if("class"===o||"style"===o||v(o))a=e;else{var s=e.attrs&&e.attrs.type;a=r||F.mustUseProp(t,s,o)?e.domProps||(e.domProps={}):e.attrs||(e.attrs={})}var c=b(o),u=C(o);c in a||u in a||(a[o]=n[o],i&&((e.on||(e.on={}))["update:"+o]=function(e){n[o]=e}))};for(var c in n)s(c)}else;return e}function bt(e,t){var n=this._staticTrees||(this._staticTrees=[]),r=n[e];return r&&!t?r:(wt(r=n[e]=this.$options.staticRenderFns[e].call(this._renderProxy,null,this),"__static__"+e,!1),r)}function $t(e,t,n){return wt(e,"__once__"+t+(n?"_"+n:""),!0),e}function wt(e,t,n){if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]&&"string"!=typeof e[r]&&Ct(e[r],t+"_"+r,n);else Ct(e,t,n)}function Ct(e,t,n){e.isStatic=!0,e.key=t,e.isOnce=n}function xt(e,t){if(t)if(s(t)){var n=e.on=e.on?A({},e.on):{};for(var r in t){var i=n[r],o=t[r];n[r]=i?[].concat(i,o):o}}else;return e}function kt(e,t,n,r){t=t||{$stable:!n};for(var i=0;i<e.length;i++){var o=e[i];Array.isArray(o)?kt(o,t,n):o&&(o.proxy&&(o.fn.proxy=!0),t[o.key]=o.fn)}return r&&(t.$key=r),t}function At(e,t){for(var n=0;n<t.length;n+=2){var r=t[n];"string"==typeof r&&r&&(e[t[n]]=t[n+1])}return e}function Ot(e,t){return"string"==typeof e?t+e:e}function St(e){e._o=$t,e._n=f,e._s=l,e._l=vt,e._t=ht,e._q=N,e._i=j,e._m=bt,e._f=mt,e._k=gt,e._b=_t,e._v=he,e._e=ve,e._u=kt,e._g=xt,e._d=At,e._p=Ot}function Tt(t,n,i,o,a){var s,c=this,u=a.options;y(o,"_uid")?(s=Object.create(o))._original=o:(s=o,o=o._original);var l=r(u._compiled),f=!l;this.data=t,this.props=n,this.children=i,this.parent=o,this.listeners=t.on||e,this.injections=ct(u.inject,o),this.slots=function(){return c.$slots||ft(t.scopedSlots,c.$slots=ut(i,o)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ft(t.scopedSlots,this.slots())}}),l&&(this.$options=u,this.$slots=this.slots(),this.$scopedSlots=ft(t.scopedSlots,this.$slots)),u._scopeId?this._c=function(e,t,n,r){var i=Pt(s,e,t,n,r,f);return i&&!Array.isArray(i)&&(i.fnScopeId=u._scopeId,i.fnContext=o),i}:this._c=function(e,t,n,r){return Pt(s,e,t,n,r,f)}}function Et(e,t,n,r,i){var o=me(e);return o.fnContext=n,o.fnOptions=r,t.slot&&((o.data||(o.data={})).slot=t.slot),o}function Nt(e,t){for(var n in t)e[b(n)]=t[n]}St(Tt.prototype);var jt={init:function(e,t){if(e.componentInstance&&!e.componentInstance._isDestroyed&&e.data.keepAlive){var r=e;jt.prepatch(r,r)}else{(e.componentInstance=function(e,t){var r={_isComponent:!0,_parentVnode:e,parent:t},i=e.data.inlineTemplate;n(i)&&(r.render=i.render,r.staticRenderFns=i.staticRenderFns);return new e.componentOptions.Ctor(r)}(e,Wt)).$mount(t?e.elm:void 0,t)}},prepatch:function(t,n){var r=n.componentOptions;!function(t,n,r,i,o){var a=i.data.scopedSlots,s=t.$scopedSlots,c=!!(a&&!a.$stable||s!==e&&!s.$stable||a&&t.$scopedSlots.$key!==a.$key),u=!!(o||t.$options._renderChildren||c);t.$options._parentVnode=i,t.$vnode=i,t._vnode&&(t._vnode.parent=i);if(t.$options._renderChildren=o,t.$attrs=i.data.attrs||e,t.$listeners=r||e,n&&t.$options.props){$e(!1);for(var l=t._props,f=t.$options._propKeys||[],p=0;p<f.length;p++){var d=f[p],v=t.$options.props;l[d]=Me(d,v,n,t)}$e(!0),t.$options.propsData=n}r=r||e;var h=t.$options._parentListeners;t.$options._parentListeners=r,qt(t,r,h),u&&(t.$slots=ut(o,i.context),t.$forceUpdate())}(n.componentInstance=t.componentInstance,r.propsData,r.listeners,n,r.children)},insert:function(e){var t,n=e.context,r=e.componentInstance;r._isMounted||(r._isMounted=!0,Yt(r,"mounted")),e.data.keepAlive&&(n._isMounted?((t=r)._inactive=!1,en.push(t)):Xt(r,!0))},destroy:function(e){var t=e.componentInstance;t._isDestroyed||(e.data.keepAlive?function e(t,n){if(n&&(t._directInactive=!0,Gt(t)))return;if(!t._inactive){t._inactive=!0;for(var r=0;r<t.$children.length;r++)e(t.$children[r]);Yt(t,"deactivated")}}(t,!0):t.$destroy())}},Dt=Object.keys(jt);function Lt(i,a,s,c,l){if(!t(i)){var f=s.$options._base;if(o(i)&&(i=f.extend(i)),"function"==typeof i){var p;if(t(i.cid)&&void 0===(i=function(e,i){if(r(e.error)&&n(e.errorComp))return e.errorComp;if(n(e.resolved))return e.resolved;var a=Ht;a&&n(e.owners)&&-1===e.owners.indexOf(a)&&e.owners.push(a);if(r(e.loading)&&n(e.loadingComp))return e.loadingComp;if(a&&!n(e.owners)){var s=e.owners=[a],c=!0,l=null,f=null;a.$on("hook:destroyed",function(){return h(s,a)});var p=function(e){for(var t=0,n=s.length;t<n;t++)s[t].$forceUpdate();e&&(s.length=0,null!==l&&(clearTimeout(l),l=null),null!==f&&(clearTimeout(f),f=null))},d=D(function(t){e.resolved=Bt(t,i),c?s.length=0:p(!0)}),v=D(function(t){n(e.errorComp)&&(e.error=!0,p(!0))}),m=e(d,v);return o(m)&&(u(m)?t(e.resolved)&&m.then(d,v):u(m.component)&&(m.component.then(d,v),n(m.error)&&(e.errorComp=Bt(m.error,i)),n(m.loading)&&(e.loadingComp=Bt(m.loading,i),0===m.delay?e.loading=!0:l=setTimeout(function(){l=null,t(e.resolved)&&t(e.error)&&(e.loading=!0,p(!1))},m.delay||200)),n(m.timeout)&&(f=setTimeout(function(){f=null,t(e.resolved)&&v(null)},m.timeout)))),c=!1,e.loading?e.loadingComp:e.resolved}}(p=i,f)))return function(e,t,n,r,i){var o=ve();return o.asyncFactory=e,o.asyncMeta={data:t,context:n,children:r,tag:i},o}(p,a,s,c,l);a=a||{},$n(i),n(a.model)&&function(e,t){var r=e.model&&e.model.prop||"value",i=e.model&&e.model.event||"input";(t.attrs||(t.attrs={}))[r]=t.model.value;var o=t.on||(t.on={}),a=o[i],s=t.model.callback;n(a)?(Array.isArray(a)?-1===a.indexOf(s):a!==s)&&(o[i]=[s].concat(a)):o[i]=s}(i.options,a);var d=function(e,r,i){var o=r.options.props;if(!t(o)){var a={},s=e.attrs,c=e.props;if(n(s)||n(c))for(var u in o){var l=C(u);ot(a,c,u,l,!0)||ot(a,s,u,l,!1)}return a}}(a,i);if(r(i.options.functional))return function(t,r,i,o,a){var s=t.options,c={},u=s.props;if(n(u))for(var l in u)c[l]=Me(l,u,r||e);else n(i.attrs)&&Nt(c,i.attrs),n(i.props)&&Nt(c,i.props);var f=new Tt(i,c,a,o,t),p=s.render.call(null,f._c,f);if(p instanceof pe)return Et(p,i,f.parent,s);if(Array.isArray(p)){for(var d=at(p)||[],v=new Array(d.length),h=0;h<d.length;h++)v[h]=Et(d[h],i,f.parent,s);return v}}(i,d,a,s,c);var v=a.on;if(a.on=a.nativeOn,r(i.options.abstract)){var m=a.slot;a={},m&&(a.slot=m)}!function(e){for(var t=e.hook||(e.hook={}),n=0;n<Dt.length;n++){var r=Dt[n],i=t[r],o=jt[r];i===o||i&&i._merged||(t[r]=i?Mt(o,i):o)}}(a);var y=i.options.name||l;return new pe("vue-component-"+i.cid+(y?"-"+y:""),a,void 0,void 0,void 0,s,{Ctor:i,propsData:d,listeners:v,tag:l,children:c},p)}}}function Mt(e,t){var n=function(n,r){e(n,r),t(n,r)};return n._merged=!0,n}var It=1,Ft=2;function Pt(e,a,s,c,u,l){return(Array.isArray(s)||i(s))&&(u=c,c=s,s=void 0),r(l)&&(u=Ft),function(e,i,a,s,c){if(n(a)&&n(a.__ob__))return ve();n(a)&&n(a.is)&&(i=a.is);if(!i)return ve();Array.isArray(s)&&"function"==typeof s[0]&&((a=a||{}).scopedSlots={default:s[0]},s.length=0);c===Ft?s=at(s):c===It&&(s=function(e){for(var t=0;t<e.length;t++)if(Array.isArray(e[t]))return Array.prototype.concat.apply([],e);return e}(s));var u,l;if("string"==typeof i){var f;l=e.$vnode&&e.$vnode.ns||F.getTagNamespace(i),u=F.isReservedTag(i)?new pe(F.parsePlatformTagName(i),a,s,void 0,void 0,e):a&&a.pre||!n(f=Le(e.$options,"components",i))?new pe(i,a,s,void 0,void 0,e):Lt(f,a,e,s,i)}else u=Lt(i,a,e,s);return Array.isArray(u)?u:n(u)?(n(l)&&function e(i,o,a){i.ns=o;"foreignObject"===i.tag&&(o=void 0,a=!0);if(n(i.children))for(var s=0,c=i.children.length;s<c;s++){var u=i.children[s];n(u.tag)&&(t(u.ns)||r(a)&&"svg"!==u.tag)&&e(u,o,a)}}(u,l),n(a)&&function(e){o(e.style)&&et(e.style);o(e.class)&&et(e.class)}(a),u):ve()}(e,a,s,c,u)}var Rt,Ht=null;function Bt(e,t){return(e.__esModule||oe&&"Module"===e[Symbol.toStringTag])&&(e=e.default),o(e)?t.extend(e):e}function Ut(e){return e.isComment&&e.asyncFactory}function zt(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var r=e[t];if(n(r)&&(n(r.componentOptions)||Ut(r)))return r}}function Vt(e,t){Rt.$on(e,t)}function Kt(e,t){Rt.$off(e,t)}function Jt(e,t){var n=Rt;return function r(){null!==t.apply(null,arguments)&&n.$off(e,r)}}function qt(e,t,n){Rt=e,rt(t,n||{},Vt,Kt,Jt,e),Rt=void 0}var Wt=null;function Zt(e){var t=Wt;return Wt=e,function(){Wt=t}}function Gt(e){for(;e&&(e=e.$parent);)if(e._inactive)return!0;return!1}function Xt(e,t){if(t){if(e._directInactive=!1,Gt(e))return}else if(e._directInactive)return;if(e._inactive||null===e._inactive){e._inactive=!1;for(var n=0;n<e.$children.length;n++)Xt(e.$children[n]);Yt(e,"activated")}}function Yt(e,t){le();var n=e.$options[t],r=t+" hook";if(n)for(var i=0,o=n.length;i<o;i++)He(n[i],e,null,e,r);e._hasHookEvent&&e.$emit("hook:"+t),fe()}var Qt=[],en=[],tn={},nn=!1,rn=!1,on=0;var an=0,sn=Date.now;if(z&&!q){var cn=window.performance;cn&&"function"==typeof cn.now&&sn()>document.createEvent("Event").timeStamp&&(sn=function(){return cn.now()})}function un(){var e,t;for(an=sn(),rn=!0,Qt.sort(function(e,t){return e.id-t.id}),on=0;on<Qt.length;on++)(e=Qt[on]).before&&e.before(),t=e.id,tn[t]=null,e.run();var n=en.slice(),r=Qt.slice();on=Qt.length=en.length=0,tn={},nn=rn=!1,function(e){for(var t=0;t<e.length;t++)e[t]._inactive=!0,Xt(e[t],!0)}(n),function(e){var t=e.length;for(;t--;){var n=e[t],r=n.vm;r._watcher===n&&r._isMounted&&!r._isDestroyed&&Yt(r,"updated")}}(r),ne&&F.devtools&&ne.emit("flush")}var ln=0,fn=function(e,t,n,r,i){this.vm=e,i&&(e._watcher=this),e._watchers.push(this),r?(this.deep=!!r.deep,this.user=!!r.user,this.lazy=!!r.lazy,this.sync=!!r.sync,this.before=r.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++ln,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new ie,this.newDepIds=new ie,this.expression="","function"==typeof t?this.getter=t:(this.getter=function(e){if(!H.test(e)){var t=e.split(".");return function(e){for(var n=0;n<t.length;n++){if(!e)return;e=e[t[n]]}return e}}}(t),this.getter||(this.getter=S)),this.value=this.lazy?void 0:this.get()};fn.prototype.get=function(){var e;le(this);var t=this.vm;try{e=this.getter.call(t,t)}catch(e){if(!this.user)throw e;Re(e,t,'getter for watcher "'+this.expression+'"')}finally{this.deep&&et(e),fe(),this.cleanupDeps()}return e},fn.prototype.addDep=function(e){var t=e.id;this.newDepIds.has(t)||(this.newDepIds.add(t),this.newDeps.push(e),this.depIds.has(t)||e.addSub(this))},fn.prototype.cleanupDeps=function(){for(var e=this.deps.length;e--;){var t=this.deps[e];this.newDepIds.has(t.id)||t.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},fn.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(e){var t=e.id;if(null==tn[t]){if(tn[t]=!0,rn){for(var n=Qt.length-1;n>on&&Qt[n].id>e.id;)n--;Qt.splice(n+1,0,e)}else Qt.push(e);nn||(nn=!0,Ye(un))}}(this)},fn.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||o(e)||this.deep){var t=this.value;if(this.value=e,this.user)try{this.cb.call(this.vm,e,t)}catch(e){Re(e,this.vm,'callback for watcher "'+this.expression+'"')}else this.cb.call(this.vm,e,t)}}},fn.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},fn.prototype.depend=function(){for(var e=this.deps.length;e--;)this.deps[e].depend()},fn.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||h(this.vm._watchers,this);for(var e=this.deps.length;e--;)this.deps[e].removeSub(this);this.active=!1}};var pn={enumerable:!0,configurable:!0,get:S,set:S};function dn(e,t,n){pn.get=function(){return this[t][n]},pn.set=function(e){this[t][n]=e},Object.defineProperty(e,n,pn)}function vn(e){e._watchers=[];var t=e.$options;t.props&&function(e,t){var n=e.$options.propsData||{},r=e._props={},i=e.$options._propKeys=[];e.$parent&&$e(!1);var o=function(o){i.push(o);var a=Me(o,t,n,e);xe(r,o,a),o in e||dn(e,"_props",o)};for(var a in t)o(a);$e(!0)}(e,t.props),t.methods&&function(e,t){e.$options.props;for(var n in t)e[n]="function"!=typeof t[n]?S:x(t[n],e)}(e,t.methods),t.data?function(e){var t=e.$options.data;s(t=e._data="function"==typeof t?function(e,t){le();try{return e.call(t,t)}catch(e){return Re(e,t,"data()"),{}}finally{fe()}}(t,e):t||{})||(t={});var n=Object.keys(t),r=e.$options.props,i=(e.$options.methods,n.length);for(;i--;){var o=n[i];r&&y(r,o)||(a=void 0,36!==(a=(o+"").charCodeAt(0))&&95!==a&&dn(e,"_data",o))}var a;Ce(t,!0)}(e):Ce(e._data={},!0),t.computed&&function(e,t){var n=e._computedWatchers=Object.create(null),r=te();for(var i in t){var o=t[i],a="function"==typeof o?o:o.get;r||(n[i]=new fn(e,a||S,S,hn)),i in e||mn(e,i,o)}}(e,t.computed),t.watch&&t.watch!==Y&&function(e,t){for(var n in t){var r=t[n];if(Array.isArray(r))for(var i=0;i<r.length;i++)_n(e,n,r[i]);else _n(e,n,r)}}(e,t.watch)}var hn={lazy:!0};function mn(e,t,n){var r=!te();"function"==typeof n?(pn.get=r?yn(t):gn(n),pn.set=S):(pn.get=n.get?r&&!1!==n.cache?yn(t):gn(n.get):S,pn.set=n.set||S),Object.defineProperty(e,t,pn)}function yn(e){return function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),ce.target&&t.depend(),t.value}}function gn(e){return function(){return e.call(this,this)}}function _n(e,t,n,r){return s(n)&&(r=n,n=n.handler),"string"==typeof n&&(n=e[n]),e.$watch(t,n,r)}var bn=0;function $n(e){var t=e.options;if(e.super){var n=$n(e.super);if(n!==e.superOptions){e.superOptions=n;var r=function(e){var t,n=e.options,r=e.sealedOptions;for(var i in n)n[i]!==r[i]&&(t||(t={}),t[i]=n[i]);return t}(e);r&&A(e.extendOptions,r),(t=e.options=De(n,e.extendOptions)).name&&(t.components[t.name]=e)}}return t}function wn(e){this._init(e)}function Cn(e){e.cid=0;var t=1;e.extend=function(e){e=e||{};var n=this,r=n.cid,i=e._Ctor||(e._Ctor={});if(i[r])return i[r];var o=e.name||n.options.name,a=function(e){this._init(e)};return(a.prototype=Object.create(n.prototype)).constructor=a,a.cid=t++,a.options=De(n.options,e),a.super=n,a.options.props&&function(e){var t=e.options.props;for(var n in t)dn(e.prototype,"_props",n)}(a),a.options.computed&&function(e){var t=e.options.computed;for(var n in t)mn(e.prototype,n,t[n])}(a),a.extend=n.extend,a.mixin=n.mixin,a.use=n.use,M.forEach(function(e){a[e]=n[e]}),o&&(a.options.components[o]=a),a.superOptions=n.options,a.extendOptions=e,a.sealedOptions=A({},a.options),i[r]=a,a}}function xn(e){return e&&(e.Ctor.options.name||e.tag)}function kn(e,t){return Array.isArray(e)?e.indexOf(t)>-1:"string"==typeof e?e.split(",").indexOf(t)>-1:(n=e,"[object RegExp]"===a.call(n)&&e.test(t));var n}function An(e,t){var n=e.cache,r=e.keys,i=e._vnode;for(var o in n){var a=n[o];if(a){var s=xn(a.componentOptions);s&&!t(s)&&On(n,o,r,i)}}}function On(e,t,n,r){var i=e[t];!i||r&&i.tag===r.tag||i.componentInstance.$destroy(),e[t]=null,h(n,t)}!function(t){t.prototype._init=function(t){var n=this;n._uid=bn++,n._isVue=!0,t&&t._isComponent?function(e,t){var n=e.$options=Object.create(e.constructor.options),r=t._parentVnode;n.parent=t.parent,n._parentVnode=r;var i=r.componentOptions;n.propsData=i.propsData,n._parentListeners=i.listeners,n._renderChildren=i.children,n._componentTag=i.tag,t.render&&(n.render=t.render,n.staticRenderFns=t.staticRenderFns)}(n,t):n.$options=De($n(n.constructor),t||{},n),n._renderProxy=n,n._self=n,function(e){var t=e.$options,n=t.parent;if(n&&!t.abstract){for(;n.$options.abstract&&n.$parent;)n=n.$parent;n.$children.push(e)}e.$parent=n,e.$root=n?n.$root:e,e.$children=[],e.$refs={},e._watcher=null,e._inactive=null,e._directInactive=!1,e._isMounted=!1,e._isDestroyed=!1,e._isBeingDestroyed=!1}(n),function(e){e._events=Object.create(null),e._hasHookEvent=!1;var t=e.$options._parentListeners;t&&qt(e,t)}(n),function(t){t._vnode=null,t._staticTrees=null;var n=t.$options,r=t.$vnode=n._parentVnode,i=r&&r.context;t.$slots=ut(n._renderChildren,i),t.$scopedSlots=e,t._c=function(e,n,r,i){return Pt(t,e,n,r,i,!1)},t.$createElement=function(e,n,r,i){return Pt(t,e,n,r,i,!0)};var o=r&&r.data;xe(t,"$attrs",o&&o.attrs||e,null,!0),xe(t,"$listeners",n._parentListeners||e,null,!0)}(n),Yt(n,"beforeCreate"),function(e){var t=ct(e.$options.inject,e);t&&($e(!1),Object.keys(t).forEach(function(n){xe(e,n,t[n])}),$e(!0))}(n),vn(n),function(e){var t=e.$options.provide;t&&(e._provided="function"==typeof t?t.call(e):t)}(n),Yt(n,"created"),n.$options.el&&n.$mount(n.$options.el)}}(wn),function(e){var t={get:function(){return this._data}},n={get:function(){return this._props}};Object.defineProperty(e.prototype,"$data",t),Object.defineProperty(e.prototype,"$props",n),e.prototype.$set=ke,e.prototype.$delete=Ae,e.prototype.$watch=function(e,t,n){if(s(t))return _n(this,e,t,n);(n=n||{}).user=!0;var r=new fn(this,e,t,n);if(n.immediate)try{t.call(this,r.value)}catch(e){Re(e,this,'callback for immediate watcher "'+r.expression+'"')}return function(){r.teardown()}}}(wn),function(e){var t=/^hook:/;e.prototype.$on=function(e,n){var r=this;if(Array.isArray(e))for(var i=0,o=e.length;i<o;i++)r.$on(e[i],n);else(r._events[e]||(r._events[e]=[])).push(n),t.test(e)&&(r._hasHookEvent=!0);return r},e.prototype.$once=function(e,t){var n=this;function r(){n.$off(e,r),t.apply(n,arguments)}return r.fn=t,n.$on(e,r),n},e.prototype.$off=function(e,t){var n=this;if(!arguments.length)return n._events=Object.create(null),n;if(Array.isArray(e)){for(var r=0,i=e.length;r<i;r++)n.$off(e[r],t);return n}var o,a=n._events[e];if(!a)return n;if(!t)return n._events[e]=null,n;for(var s=a.length;s--;)if((o=a[s])===t||o.fn===t){a.splice(s,1);break}return n},e.prototype.$emit=function(e){var t=this._events[e];if(t){t=t.length>1?k(t):t;for(var n=k(arguments,1),r='event handler for "'+e+'"',i=0,o=t.length;i<o;i++)He(t[i],this,n,this,r)}return this}}(wn),function(e){e.prototype._update=function(e,t){var n=this,r=n.$el,i=n._vnode,o=Zt(n);n._vnode=e,n.$el=i?n.__patch__(i,e):n.__patch__(n.$el,e,t,!1),o(),r&&(r.__vue__=null),n.$el&&(n.$el.__vue__=n),n.$vnode&&n.$parent&&n.$vnode===n.$parent._vnode&&(n.$parent.$el=n.$el)},e.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},e.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){Yt(e,"beforeDestroy"),e._isBeingDestroyed=!0;var t=e.$parent;!t||t._isBeingDestroyed||e.$options.abstract||h(t.$children,e),e._watcher&&e._watcher.teardown();for(var n=e._watchers.length;n--;)e._watchers[n].teardown();e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),Yt(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}(wn),function(e){St(e.prototype),e.prototype.$nextTick=function(e){return Ye(e,this)},e.prototype._render=function(){var e,t=this,n=t.$options,r=n.render,i=n._parentVnode;i&&(t.$scopedSlots=ft(i.data.scopedSlots,t.$slots,t.$scopedSlots)),t.$vnode=i;try{Ht=t,e=r.call(t._renderProxy,t.$createElement)}catch(n){Re(n,t,"render"),e=t._vnode}finally{Ht=null}return Array.isArray(e)&&1===e.length&&(e=e[0]),e instanceof pe||(e=ve()),e.parent=i,e}}(wn);var Sn=[String,RegExp,Array],Tn={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Sn,exclude:Sn,max:[String,Number]},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var e in this.cache)On(this.cache,e,this.keys)},mounted:function(){var e=this;this.$watch("include",function(t){An(e,function(e){return kn(t,e)})}),this.$watch("exclude",function(t){An(e,function(e){return!kn(t,e)})})},render:function(){var e=this.$slots.default,t=zt(e),n=t&&t.componentOptions;if(n){var r=xn(n),i=this.include,o=this.exclude;if(i&&(!r||!kn(i,r))||o&&r&&kn(o,r))return t;var a=this.cache,s=this.keys,c=null==t.key?n.Ctor.cid+(n.tag?"::"+n.tag:""):t.key;a[c]?(t.componentInstance=a[c].componentInstance,h(s,c),s.push(c)):(a[c]=t,s.push(c),this.max&&s.length>parseInt(this.max)&&On(a,s[0],s,this._vnode)),t.data.keepAlive=!0}return t||e&&e[0]}}};!function(e){var t={get:function(){return F}};Object.defineProperty(e,"config",t),e.util={warn:ae,extend:A,mergeOptions:De,defineReactive:xe},e.set=ke,e.delete=Ae,e.nextTick=Ye,e.observable=function(e){return Ce(e),e},e.options=Object.create(null),M.forEach(function(t){e.options[t+"s"]=Object.create(null)}),e.options._base=e,A(e.options.components,Tn),function(e){e.use=function(e){var t=this._installedPlugins||(this._installedPlugins=[]);if(t.indexOf(e)>-1)return this;var n=k(arguments,1);return n.unshift(this),"function"==typeof e.install?e.install.apply(e,n):"function"==typeof e&&e.apply(null,n),t.push(e),this}}(e),function(e){e.mixin=function(e){return this.options=De(this.options,e),this}}(e),Cn(e),function(e){M.forEach(function(t){e[t]=function(e,n){return n?("component"===t&&s(n)&&(n.name=n.name||e,n=this.options._base.extend(n)),"directive"===t&&"function"==typeof n&&(n={bind:n,update:n}),this.options[t+"s"][e]=n,n):this.options[t+"s"][e]}})}(e)}(wn),Object.defineProperty(wn.prototype,"$isServer",{get:te}),Object.defineProperty(wn.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(wn,"FunctionalRenderContext",{value:Tt}),wn.version="2.6.10";var En=p("style,class"),Nn=p("input,textarea,option,select,progress"),jn=function(e,t,n){return"value"===n&&Nn(e)&&"button"!==t||"selected"===n&&"option"===e||"checked"===n&&"input"===e||"muted"===n&&"video"===e},Dn=p("contenteditable,draggable,spellcheck"),Ln=p("events,caret,typing,plaintext-only"),Mn=function(e,t){return Hn(t)||"false"===t?"false":"contenteditable"===e&&Ln(t)?t:"true"},In=p("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible"),Fn="http://www.w3.org/1999/xlink",Pn=function(e){return":"===e.charAt(5)&&"xlink"===e.slice(0,5)},Rn=function(e){return Pn(e)?e.slice(6,e.length):""},Hn=function(e){return null==e||!1===e};function Bn(e){for(var t=e.data,r=e,i=e;n(i.componentInstance);)(i=i.componentInstance._vnode)&&i.data&&(t=Un(i.data,t));for(;n(r=r.parent);)r&&r.data&&(t=Un(t,r.data));return function(e,t){if(n(e)||n(t))return zn(e,Vn(t));return""}(t.staticClass,t.class)}function Un(e,t){return{staticClass:zn(e.staticClass,t.staticClass),class:n(e.class)?[e.class,t.class]:t.class}}function zn(e,t){return e?t?e+" "+t:e:t||""}function Vn(e){return Array.isArray(e)?function(e){for(var t,r="",i=0,o=e.length;i<o;i++)n(t=Vn(e[i]))&&""!==t&&(r&&(r+=" "),r+=t);return r}(e):o(e)?function(e){var t="";for(var n in e)e[n]&&(t&&(t+=" "),t+=n);return t}(e):"string"==typeof e?e:""}var Kn={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Jn=p("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),qn=p("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Wn=function(e){return Jn(e)||qn(e)};function Zn(e){return qn(e)?"svg":"math"===e?"math":void 0}var Gn=Object.create(null);var Xn=p("text,number,password,search,email,tel,url");function Yn(e){if("string"==typeof e){var t=document.querySelector(e);return t||document.createElement("div")}return e}var Qn=Object.freeze({createElement:function(e,t){var n=document.createElement(e);return"select"!==e?n:(t.data&&t.data.attrs&&void 0!==t.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n)},createElementNS:function(e,t){return document.createElementNS(Kn[e],t)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},setStyleScope:function(e,t){e.setAttribute(t,"")}}),er={create:function(e,t){tr(t)},update:function(e,t){e.data.ref!==t.data.ref&&(tr(e,!0),tr(t))},destroy:function(e){tr(e,!0)}};function tr(e,t){var r=e.data.ref;if(n(r)){var i=e.context,o=e.componentInstance||e.elm,a=i.$refs;t?Array.isArray(a[r])?h(a[r],o):a[r]===o&&(a[r]=void 0):e.data.refInFor?Array.isArray(a[r])?a[r].indexOf(o)<0&&a[r].push(o):a[r]=[o]:a[r]=o}}var nr=new pe("",{},[]),rr=["create","activate","update","remove","destroy"];function ir(e,i){return e.key===i.key&&(e.tag===i.tag&&e.isComment===i.isComment&&n(e.data)===n(i.data)&&function(e,t){if("input"!==e.tag)return!0;var r,i=n(r=e.data)&&n(r=r.attrs)&&r.type,o=n(r=t.data)&&n(r=r.attrs)&&r.type;return i===o||Xn(i)&&Xn(o)}(e,i)||r(e.isAsyncPlaceholder)&&e.asyncFactory===i.asyncFactory&&t(i.asyncFactory.error))}function or(e,t,r){var i,o,a={};for(i=t;i<=r;++i)n(o=e[i].key)&&(a[o]=i);return a}var ar={create:sr,update:sr,destroy:function(e){sr(e,nr)}};function sr(e,t){(e.data.directives||t.data.directives)&&function(e,t){var n,r,i,o=e===nr,a=t===nr,s=ur(e.data.directives,e.context),c=ur(t.data.directives,t.context),u=[],l=[];for(n in c)r=s[n],i=c[n],r?(i.oldValue=r.value,i.oldArg=r.arg,fr(i,"update",t,e),i.def&&i.def.componentUpdated&&l.push(i)):(fr(i,"bind",t,e),i.def&&i.def.inserted&&u.push(i));if(u.length){var f=function(){for(var n=0;n<u.length;n++)fr(u[n],"inserted",t,e)};o?it(t,"insert",f):f()}l.length&&it(t,"postpatch",function(){for(var n=0;n<l.length;n++)fr(l[n],"componentUpdated",t,e)});if(!o)for(n in s)c[n]||fr(s[n],"unbind",e,e,a)}(e,t)}var cr=Object.create(null);function ur(e,t){var n,r,i=Object.create(null);if(!e)return i;for(n=0;n<e.length;n++)(r=e[n]).modifiers||(r.modifiers=cr),i[lr(r)]=r,r.def=Le(t.$options,"directives",r.name);return i}function lr(e){return e.rawName||e.name+"."+Object.keys(e.modifiers||{}).join(".")}function fr(e,t,n,r,i){var o=e.def&&e.def[t];if(o)try{o(n.elm,e,n,r,i)}catch(r){Re(r,n.context,"directive "+e.name+" "+t+" hook")}}var pr=[er,ar];function dr(e,r){var i=r.componentOptions;if(!(n(i)&&!1===i.Ctor.options.inheritAttrs||t(e.data.attrs)&&t(r.data.attrs))){var o,a,s=r.elm,c=e.data.attrs||{},u=r.data.attrs||{};for(o in n(u.__ob__)&&(u=r.data.attrs=A({},u)),u)a=u[o],c[o]!==a&&vr(s,o,a);for(o in(q||Z)&&u.value!==c.value&&vr(s,"value",u.value),c)t(u[o])&&(Pn(o)?s.removeAttributeNS(Fn,Rn(o)):Dn(o)||s.removeAttribute(o))}}function vr(e,t,n){e.tagName.indexOf("-")>-1?hr(e,t,n):In(t)?Hn(n)?e.removeAttribute(t):(n="allowfullscreen"===t&&"EMBED"===e.tagName?"true":t,e.setAttribute(t,n)):Dn(t)?e.setAttribute(t,Mn(t,n)):Pn(t)?Hn(n)?e.removeAttributeNS(Fn,Rn(t)):e.setAttributeNS(Fn,t,n):hr(e,t,n)}function hr(e,t,n){if(Hn(n))e.removeAttribute(t);else{if(q&&!W&&"TEXTAREA"===e.tagName&&"placeholder"===t&&""!==n&&!e.__ieph){var r=function(t){t.stopImmediatePropagation(),e.removeEventListener("input",r)};e.addEventListener("input",r),e.__ieph=!0}e.setAttribute(t,n)}}var mr={create:dr,update:dr};function yr(e,r){var i=r.elm,o=r.data,a=e.data;if(!(t(o.staticClass)&&t(o.class)&&(t(a)||t(a.staticClass)&&t(a.class)))){var s=Bn(r),c=i._transitionClasses;n(c)&&(s=zn(s,Vn(c))),s!==i._prevClass&&(i.setAttribute("class",s),i._prevClass=s)}}var gr,_r,br,$r,wr,Cr,xr={create:yr,update:yr},kr=/[\w).+\-_$\]]/;function Ar(e){var t,n,r,i,o,a=!1,s=!1,c=!1,u=!1,l=0,f=0,p=0,d=0;for(r=0;r<e.length;r++)if(n=t,t=e.charCodeAt(r),a)39===t&&92!==n&&(a=!1);else if(s)34===t&&92!==n&&(s=!1);else if(c)96===t&&92!==n&&(c=!1);else if(u)47===t&&92!==n&&(u=!1);else if(124!==t||124===e.charCodeAt(r+1)||124===e.charCodeAt(r-1)||l||f||p){switch(t){case 34:s=!0;break;case 39:a=!0;break;case 96:c=!0;break;case 40:p++;break;case 41:p--;break;case 91:f++;break;case 93:f--;break;case 123:l++;break;case 125:l--}if(47===t){for(var v=r-1,h=void 0;v>=0&&" "===(h=e.charAt(v));v--);h&&kr.test(h)||(u=!0)}}else void 0===i?(d=r+1,i=e.slice(0,r).trim()):m();function m(){(o||(o=[])).push(e.slice(d,r).trim()),d=r+1}if(void 0===i?i=e.slice(0,r).trim():0!==d&&m(),o)for(r=0;r<o.length;r++)i=Or(i,o[r]);return i}function Or(e,t){var n=t.indexOf("(");if(n<0)return'_f("'+t+'")('+e+")";var r=t.slice(0,n),i=t.slice(n+1);return'_f("'+r+'")('+e+(")"!==i?","+i:i)}function Sr(e,t){console.error("[Vue compiler]: "+e)}function Tr(e,t){return e?e.map(function(e){return e[t]}).filter(function(e){return e}):[]}function Er(e,t,n,r,i){(e.props||(e.props=[])).push(Rr({name:t,value:n,dynamic:i},r)),e.plain=!1}function Nr(e,t,n,r,i){(i?e.dynamicAttrs||(e.dynamicAttrs=[]):e.attrs||(e.attrs=[])).push(Rr({name:t,value:n,dynamic:i},r)),e.plain=!1}function jr(e,t,n,r){e.attrsMap[t]=n,e.attrsList.push(Rr({name:t,value:n},r))}function Dr(e,t,n,r,i,o,a,s){(e.directives||(e.directives=[])).push(Rr({name:t,rawName:n,value:r,arg:i,isDynamicArg:o,modifiers:a},s)),e.plain=!1}function Lr(e,t,n){return n?"_p("+t+',"'+e+'")':e+t}function Mr(t,n,r,i,o,a,s,c){var u;(i=i||e).right?c?n="("+n+")==='click'?'contextmenu':("+n+")":"click"===n&&(n="contextmenu",delete i.right):i.middle&&(c?n="("+n+")==='click'?'mouseup':("+n+")":"click"===n&&(n="mouseup")),i.capture&&(delete i.capture,n=Lr("!",n,c)),i.once&&(delete i.once,n=Lr("~",n,c)),i.passive&&(delete i.passive,n=Lr("&",n,c)),i.native?(delete i.native,u=t.nativeEvents||(t.nativeEvents={})):u=t.events||(t.events={});var l=Rr({value:r.trim(),dynamic:c},s);i!==e&&(l.modifiers=i);var f=u[n];Array.isArray(f)?o?f.unshift(l):f.push(l):u[n]=f?o?[l,f]:[f,l]:l,t.plain=!1}function Ir(e,t,n){var r=Fr(e,":"+t)||Fr(e,"v-bind:"+t);if(null!=r)return Ar(r);if(!1!==n){var i=Fr(e,t);if(null!=i)return JSON.stringify(i)}}function Fr(e,t,n){var r;if(null!=(r=e.attrsMap[t]))for(var i=e.attrsList,o=0,a=i.length;o<a;o++)if(i[o].name===t){i.splice(o,1);break}return n&&delete e.attrsMap[t],r}function Pr(e,t){for(var n=e.attrsList,r=0,i=n.length;r<i;r++){var o=n[r];if(t.test(o.name))return n.splice(r,1),o}}function Rr(e,t){return t&&(null!=t.start&&(e.start=t.start),null!=t.end&&(e.end=t.end)),e}function Hr(e,t,n){var r=n||{},i=r.number,o="$$v";r.trim&&(o="(typeof $$v === 'string'? $$v.trim(): $$v)"),i&&(o="_n("+o+")");var a=Br(t,o);e.model={value:"("+t+")",expression:JSON.stringify(t),callback:"function ($$v) {"+a+"}"}}function Br(e,t){var n=function(e){if(e=e.trim(),gr=e.length,e.indexOf("[")<0||e.lastIndexOf("]")<gr-1)return($r=e.lastIndexOf("."))>-1?{exp:e.slice(0,$r),key:'"'+e.slice($r+1)+'"'}:{exp:e,key:null};_r=e,$r=wr=Cr=0;for(;!zr();)Vr(br=Ur())?Jr(br):91===br&&Kr(br);return{exp:e.slice(0,wr),key:e.slice(wr+1,Cr)}}(e);return null===n.key?e+"="+t:"$set("+n.exp+", "+n.key+", "+t+")"}function Ur(){return _r.charCodeAt(++$r)}function zr(){return $r>=gr}function Vr(e){return 34===e||39===e}function Kr(e){var t=1;for(wr=$r;!zr();)if(Vr(e=Ur()))Jr(e);else if(91===e&&t++,93===e&&t--,0===t){Cr=$r;break}}function Jr(e){for(var t=e;!zr()&&(e=Ur())!==t;);}var qr,Wr="__r",Zr="__c";function Gr(e,t,n){var r=qr;return function i(){null!==t.apply(null,arguments)&&Qr(e,i,n,r)}}var Xr=Ve&&!(X&&Number(X[1])<=53);function Yr(e,t,n,r){if(Xr){var i=an,o=t;t=o._wrapper=function(e){if(e.target===e.currentTarget||e.timeStamp>=i||e.timeStamp<=0||e.target.ownerDocument!==document)return o.apply(this,arguments)}}qr.addEventListener(e,t,Q?{capture:n,passive:r}:n)}function Qr(e,t,n,r){(r||qr).removeEventListener(e,t._wrapper||t,n)}function ei(e,r){if(!t(e.data.on)||!t(r.data.on)){var i=r.data.on||{},o=e.data.on||{};qr=r.elm,function(e){if(n(e[Wr])){var t=q?"change":"input";e[t]=[].concat(e[Wr],e[t]||[]),delete e[Wr]}n(e[Zr])&&(e.change=[].concat(e[Zr],e.change||[]),delete e[Zr])}(i),rt(i,o,Yr,Qr,Gr,r.context),qr=void 0}}var ti,ni={create:ei,update:ei};function ri(e,r){if(!t(e.data.domProps)||!t(r.data.domProps)){var i,o,a=r.elm,s=e.data.domProps||{},c=r.data.domProps||{};for(i in n(c.__ob__)&&(c=r.data.domProps=A({},c)),s)i in c||(a[i]="");for(i in c){if(o=c[i],"textContent"===i||"innerHTML"===i){if(r.children&&(r.children.length=0),o===s[i])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===i&&"PROGRESS"!==a.tagName){a._value=o;var u=t(o)?"":String(o);ii(a,u)&&(a.value=u)}else if("innerHTML"===i&&qn(a.tagName)&&t(a.innerHTML)){(ti=ti||document.createElement("div")).innerHTML="<svg>"+o+"</svg>";for(var l=ti.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}else if(o!==s[i])try{a[i]=o}catch(e){}}}}function ii(e,t){return!e.composing&&("OPTION"===e.tagName||function(e,t){var n=!0;try{n=document.activeElement!==e}catch(e){}return n&&e.value!==t}(e,t)||function(e,t){var r=e.value,i=e._vModifiers;if(n(i)){if(i.number)return f(r)!==f(t);if(i.trim)return r.trim()!==t.trim()}return r!==t}(e,t))}var oi={create:ri,update:ri},ai=g(function(e){var t={},n=/:(.+)/;return e.split(/;(?![^(]*\))/g).forEach(function(e){if(e){var r=e.split(n);r.length>1&&(t[r[0].trim()]=r[1].trim())}}),t});function si(e){var t=ci(e.style);return e.staticStyle?A(e.staticStyle,t):t}function ci(e){return Array.isArray(e)?O(e):"string"==typeof e?ai(e):e}var ui,li=/^--/,fi=/\s*!important$/,pi=function(e,t,n){if(li.test(t))e.style.setProperty(t,n);else if(fi.test(n))e.style.setProperty(C(t),n.replace(fi,""),"important");else{var r=vi(t);if(Array.isArray(n))for(var i=0,o=n.length;i<o;i++)e.style[r]=n[i];else e.style[r]=n}},di=["Webkit","Moz","ms"],vi=g(function(e){if(ui=ui||document.createElement("div").style,"filter"!==(e=b(e))&&e in ui)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<di.length;n++){var r=di[n]+t;if(r in ui)return r}});function hi(e,r){var i=r.data,o=e.data;if(!(t(i.staticStyle)&&t(i.style)&&t(o.staticStyle)&&t(o.style))){var a,s,c=r.elm,u=o.staticStyle,l=o.normalizedStyle||o.style||{},f=u||l,p=ci(r.data.style)||{};r.data.normalizedStyle=n(p.__ob__)?A({},p):p;var d=function(e,t){var n,r={};if(t)for(var i=e;i.componentInstance;)(i=i.componentInstance._vnode)&&i.data&&(n=si(i.data))&&A(r,n);(n=si(e.data))&&A(r,n);for(var o=e;o=o.parent;)o.data&&(n=si(o.data))&&A(r,n);return r}(r,!0);for(s in f)t(d[s])&&pi(c,s,"");for(s in d)(a=d[s])!==f[s]&&pi(c,s,null==a?"":a)}}var mi={create:hi,update:hi},yi=/\s+/;function gi(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(yi).forEach(function(t){return e.classList.add(t)}):e.classList.add(t);else{var n=" "+(e.getAttribute("class")||"")+" ";n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}}function _i(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(yi).forEach(function(t){return e.classList.remove(t)}):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{for(var n=" "+(e.getAttribute("class")||"")+" ",r=" "+t+" ";n.indexOf(r)>=0;)n=n.replace(r," ");(n=n.trim())?e.setAttribute("class",n):e.removeAttribute("class")}}function bi(e){if(e){if("object"==typeof e){var t={};return!1!==e.css&&A(t,$i(e.name||"v")),A(t,e),t}return"string"==typeof e?$i(e):void 0}}var $i=g(function(e){return{enterClass:e+"-enter",enterToClass:e+"-enter-to",enterActiveClass:e+"-enter-active",leaveClass:e+"-leave",leaveToClass:e+"-leave-to",leaveActiveClass:e+"-leave-active"}}),wi=z&&!W,Ci="transition",xi="animation",ki="transition",Ai="transitionend",Oi="animation",Si="animationend";wi&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(ki="WebkitTransition",Ai="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Oi="WebkitAnimation",Si="webkitAnimationEnd"));var Ti=z?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(e){return e()};function Ei(e){Ti(function(){Ti(e)})}function Ni(e,t){var n=e._transitionClasses||(e._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),gi(e,t))}function ji(e,t){e._transitionClasses&&h(e._transitionClasses,t),_i(e,t)}function Di(e,t,n){var r=Mi(e,t),i=r.type,o=r.timeout,a=r.propCount;if(!i)return n();var s=i===Ci?Ai:Si,c=0,u=function(){e.removeEventListener(s,l),n()},l=function(t){t.target===e&&++c>=a&&u()};setTimeout(function(){c<a&&u()},o+1),e.addEventListener(s,l)}var Li=/\b(transform|all)(,|$)/;function Mi(e,t){var n,r=window.getComputedStyle(e),i=(r[ki+"Delay"]||"").split(", "),o=(r[ki+"Duration"]||"").split(", "),a=Ii(i,o),s=(r[Oi+"Delay"]||"").split(", "),c=(r[Oi+"Duration"]||"").split(", "),u=Ii(s,c),l=0,f=0;return t===Ci?a>0&&(n=Ci,l=a,f=o.length):t===xi?u>0&&(n=xi,l=u,f=c.length):f=(n=(l=Math.max(a,u))>0?a>u?Ci:xi:null)?n===Ci?o.length:c.length:0,{type:n,timeout:l,propCount:f,hasTransform:n===Ci&&Li.test(r[ki+"Property"])}}function Ii(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max.apply(null,t.map(function(t,n){return Fi(t)+Fi(e[n])}))}function Fi(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function Pi(e,r){var i=e.elm;n(i._leaveCb)&&(i._leaveCb.cancelled=!0,i._leaveCb());var a=bi(e.data.transition);if(!t(a)&&!n(i._enterCb)&&1===i.nodeType){for(var s=a.css,c=a.type,u=a.enterClass,l=a.enterToClass,p=a.enterActiveClass,d=a.appearClass,v=a.appearToClass,h=a.appearActiveClass,m=a.beforeEnter,y=a.enter,g=a.afterEnter,_=a.enterCancelled,b=a.beforeAppear,$=a.appear,w=a.afterAppear,C=a.appearCancelled,x=a.duration,k=Wt,A=Wt.$vnode;A&&A.parent;)k=A.context,A=A.parent;var O=!k._isMounted||!e.isRootInsert;if(!O||$||""===$){var S=O&&d?d:u,T=O&&h?h:p,E=O&&v?v:l,N=O&&b||m,j=O&&"function"==typeof $?$:y,L=O&&w||g,M=O&&C||_,I=f(o(x)?x.enter:x),F=!1!==s&&!W,P=Bi(j),R=i._enterCb=D(function(){F&&(ji(i,E),ji(i,T)),R.cancelled?(F&&ji(i,S),M&&M(i)):L&&L(i),i._enterCb=null});e.data.show||it(e,"insert",function(){var t=i.parentNode,n=t&&t._pending&&t._pending[e.key];n&&n.tag===e.tag&&n.elm._leaveCb&&n.elm._leaveCb(),j&&j(i,R)}),N&&N(i),F&&(Ni(i,S),Ni(i,T),Ei(function(){ji(i,S),R.cancelled||(Ni(i,E),P||(Hi(I)?setTimeout(R,I):Di(i,c,R)))})),e.data.show&&(r&&r(),j&&j(i,R)),F||P||R()}}}function Ri(e,r){var i=e.elm;n(i._enterCb)&&(i._enterCb.cancelled=!0,i._enterCb());var a=bi(e.data.transition);if(t(a)||1!==i.nodeType)return r();if(!n(i._leaveCb)){var s=a.css,c=a.type,u=a.leaveClass,l=a.leaveToClass,p=a.leaveActiveClass,d=a.beforeLeave,v=a.leave,h=a.afterLeave,m=a.leaveCancelled,y=a.delayLeave,g=a.duration,_=!1!==s&&!W,b=Bi(v),$=f(o(g)?g.leave:g),w=i._leaveCb=D(function(){i.parentNode&&i.parentNode._pending&&(i.parentNode._pending[e.key]=null),_&&(ji(i,l),ji(i,p)),w.cancelled?(_&&ji(i,u),m&&m(i)):(r(),h&&h(i)),i._leaveCb=null});y?y(C):C()}function C(){w.cancelled||(!e.data.show&&i.parentNode&&((i.parentNode._pending||(i.parentNode._pending={}))[e.key]=e),d&&d(i),_&&(Ni(i,u),Ni(i,p),Ei(function(){ji(i,u),w.cancelled||(Ni(i,l),b||(Hi($)?setTimeout(w,$):Di(i,c,w)))})),v&&v(i,w),_||b||w())}}function Hi(e){return"number"==typeof e&&!isNaN(e)}function Bi(e){if(t(e))return!1;var r=e.fns;return n(r)?Bi(Array.isArray(r)?r[0]:r):(e._length||e.length)>1}function Ui(e,t){!0!==t.data.show&&Pi(t)}var zi=function(e){var o,a,s={},c=e.modules,u=e.nodeOps;for(o=0;o<rr.length;++o)for(s[rr[o]]=[],a=0;a<c.length;++a)n(c[a][rr[o]])&&s[rr[o]].push(c[a][rr[o]]);function l(e){var t=u.parentNode(e);n(t)&&u.removeChild(t,e)}function f(e,t,i,o,a,c,l){if(n(e.elm)&&n(c)&&(e=c[l]=me(e)),e.isRootInsert=!a,!function(e,t,i,o){var a=e.data;if(n(a)){var c=n(e.componentInstance)&&a.keepAlive;if(n(a=a.hook)&&n(a=a.init)&&a(e,!1),n(e.componentInstance))return d(e,t),v(i,e.elm,o),r(c)&&function(e,t,r,i){for(var o,a=e;a.componentInstance;)if(a=a.componentInstance._vnode,n(o=a.data)&&n(o=o.transition)){for(o=0;o<s.activate.length;++o)s.activate[o](nr,a);t.push(a);break}v(r,e.elm,i)}(e,t,i,o),!0}}(e,t,i,o)){var f=e.data,p=e.children,m=e.tag;n(m)?(e.elm=e.ns?u.createElementNS(e.ns,m):u.createElement(m,e),g(e),h(e,p,t),n(f)&&y(e,t),v(i,e.elm,o)):r(e.isComment)?(e.elm=u.createComment(e.text),v(i,e.elm,o)):(e.elm=u.createTextNode(e.text),v(i,e.elm,o))}}function d(e,t){n(e.data.pendingInsert)&&(t.push.apply(t,e.data.pendingInsert),e.data.pendingInsert=null),e.elm=e.componentInstance.$el,m(e)?(y(e,t),g(e)):(tr(e),t.push(e))}function v(e,t,r){n(e)&&(n(r)?u.parentNode(r)===e&&u.insertBefore(e,t,r):u.appendChild(e,t))}function h(e,t,n){if(Array.isArray(t))for(var r=0;r<t.length;++r)f(t[r],n,e.elm,null,!0,t,r);else i(e.text)&&u.appendChild(e.elm,u.createTextNode(String(e.text)))}function m(e){for(;e.componentInstance;)e=e.componentInstance._vnode;return n(e.tag)}function y(e,t){for(var r=0;r<s.create.length;++r)s.create[r](nr,e);n(o=e.data.hook)&&(n(o.create)&&o.create(nr,e),n(o.insert)&&t.push(e))}function g(e){var t;if(n(t=e.fnScopeId))u.setStyleScope(e.elm,t);else for(var r=e;r;)n(t=r.context)&&n(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t),r=r.parent;n(t=Wt)&&t!==e.context&&t!==e.fnContext&&n(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t)}function _(e,t,n,r,i,o){for(;r<=i;++r)f(n[r],o,e,t,!1,n,r)}function b(e){var t,r,i=e.data;if(n(i))for(n(t=i.hook)&&n(t=t.destroy)&&t(e),t=0;t<s.destroy.length;++t)s.destroy[t](e);if(n(t=e.children))for(r=0;r<e.children.length;++r)b(e.children[r])}function $(e,t,r,i){for(;r<=i;++r){var o=t[r];n(o)&&(n(o.tag)?(w(o),b(o)):l(o.elm))}}function w(e,t){if(n(t)||n(e.data)){var r,i=s.remove.length+1;for(n(t)?t.listeners+=i:t=function(e,t){function n(){0==--n.listeners&&l(e)}return n.listeners=t,n}(e.elm,i),n(r=e.componentInstance)&&n(r=r._vnode)&&n(r.data)&&w(r,t),r=0;r<s.remove.length;++r)s.remove[r](e,t);n(r=e.data.hook)&&n(r=r.remove)?r(e,t):t()}else l(e.elm)}function C(e,t,r,i){for(var o=r;o<i;o++){var a=t[o];if(n(a)&&ir(e,a))return o}}function x(e,i,o,a,c,l){if(e!==i){n(i.elm)&&n(a)&&(i=a[c]=me(i));var p=i.elm=e.elm;if(r(e.isAsyncPlaceholder))n(i.asyncFactory.resolved)?O(e.elm,i,o):i.isAsyncPlaceholder=!0;else if(r(i.isStatic)&&r(e.isStatic)&&i.key===e.key&&(r(i.isCloned)||r(i.isOnce)))i.componentInstance=e.componentInstance;else{var d,v=i.data;n(v)&&n(d=v.hook)&&n(d=d.prepatch)&&d(e,i);var h=e.children,y=i.children;if(n(v)&&m(i)){for(d=0;d<s.update.length;++d)s.update[d](e,i);n(d=v.hook)&&n(d=d.update)&&d(e,i)}t(i.text)?n(h)&&n(y)?h!==y&&function(e,r,i,o,a){for(var s,c,l,p=0,d=0,v=r.length-1,h=r[0],m=r[v],y=i.length-1,g=i[0],b=i[y],w=!a;p<=v&&d<=y;)t(h)?h=r[++p]:t(m)?m=r[--v]:ir(h,g)?(x(h,g,o,i,d),h=r[++p],g=i[++d]):ir(m,b)?(x(m,b,o,i,y),m=r[--v],b=i[--y]):ir(h,b)?(x(h,b,o,i,y),w&&u.insertBefore(e,h.elm,u.nextSibling(m.elm)),h=r[++p],b=i[--y]):ir(m,g)?(x(m,g,o,i,d),w&&u.insertBefore(e,m.elm,h.elm),m=r[--v],g=i[++d]):(t(s)&&(s=or(r,p,v)),t(c=n(g.key)?s[g.key]:C(g,r,p,v))?f(g,o,e,h.elm,!1,i,d):ir(l=r[c],g)?(x(l,g,o,i,d),r[c]=void 0,w&&u.insertBefore(e,l.elm,h.elm)):f(g,o,e,h.elm,!1,i,d),g=i[++d]);p>v?_(e,t(i[y+1])?null:i[y+1].elm,i,d,y,o):d>y&&$(0,r,p,v)}(p,h,y,o,l):n(y)?(n(e.text)&&u.setTextContent(p,""),_(p,null,y,0,y.length-1,o)):n(h)?$(0,h,0,h.length-1):n(e.text)&&u.setTextContent(p,""):e.text!==i.text&&u.setTextContent(p,i.text),n(v)&&n(d=v.hook)&&n(d=d.postpatch)&&d(e,i)}}}function k(e,t,i){if(r(i)&&n(e.parent))e.parent.data.pendingInsert=t;else for(var o=0;o<t.length;++o)t[o].data.hook.insert(t[o])}var A=p("attrs,class,staticClass,staticStyle,key");function O(e,t,i,o){var a,s=t.tag,c=t.data,u=t.children;if(o=o||c&&c.pre,t.elm=e,r(t.isComment)&&n(t.asyncFactory))return t.isAsyncPlaceholder=!0,!0;if(n(c)&&(n(a=c.hook)&&n(a=a.init)&&a(t,!0),n(a=t.componentInstance)))return d(t,i),!0;if(n(s)){if(n(u))if(e.hasChildNodes())if(n(a=c)&&n(a=a.domProps)&&n(a=a.innerHTML)){if(a!==e.innerHTML)return!1}else{for(var l=!0,f=e.firstChild,p=0;p<u.length;p++){if(!f||!O(f,u[p],i,o)){l=!1;break}f=f.nextSibling}if(!l||f)return!1}else h(t,u,i);if(n(c)){var v=!1;for(var m in c)if(!A(m)){v=!0,y(t,i);break}!v&&c.class&&et(c.class)}}else e.data!==t.text&&(e.data=t.text);return!0}return function(e,i,o,a){if(!t(i)){var c,l=!1,p=[];if(t(e))l=!0,f(i,p);else{var d=n(e.nodeType);if(!d&&ir(e,i))x(e,i,p,null,null,a);else{if(d){if(1===e.nodeType&&e.hasAttribute(L)&&(e.removeAttribute(L),o=!0),r(o)&&O(e,i,p))return k(i,p,!0),e;c=e,e=new pe(u.tagName(c).toLowerCase(),{},[],void 0,c)}var v=e.elm,h=u.parentNode(v);if(f(i,p,v._leaveCb?null:h,u.nextSibling(v)),n(i.parent))for(var y=i.parent,g=m(i);y;){for(var _=0;_<s.destroy.length;++_)s.destroy[_](y);if(y.elm=i.elm,g){for(var w=0;w<s.create.length;++w)s.create[w](nr,y);var C=y.data.hook.insert;if(C.merged)for(var A=1;A<C.fns.length;A++)C.fns[A]()}else tr(y);y=y.parent}n(h)?$(0,[e],0,0):n(e.tag)&&b(e)}}return k(i,p,l),i.elm}n(e)&&b(e)}}({nodeOps:Qn,modules:[mr,xr,ni,oi,mi,z?{create:Ui,activate:Ui,remove:function(e,t){!0!==e.data.show?Ri(e,t):t()}}:{}].concat(pr)});W&&document.addEventListener("selectionchange",function(){var e=document.activeElement;e&&e.vmodel&&Xi(e,"input")});var Vi={inserted:function(e,t,n,r){"select"===n.tag?(r.elm&&!r.elm._vOptions?it(n,"postpatch",function(){Vi.componentUpdated(e,t,n)}):Ki(e,t,n.context),e._vOptions=[].map.call(e.options,Wi)):("textarea"===n.tag||Xn(e.type))&&(e._vModifiers=t.modifiers,t.modifiers.lazy||(e.addEventListener("compositionstart",Zi),e.addEventListener("compositionend",Gi),e.addEventListener("change",Gi),W&&(e.vmodel=!0)))},componentUpdated:function(e,t,n){if("select"===n.tag){Ki(e,t,n.context);var r=e._vOptions,i=e._vOptions=[].map.call(e.options,Wi);if(i.some(function(e,t){return!N(e,r[t])}))(e.multiple?t.value.some(function(e){return qi(e,i)}):t.value!==t.oldValue&&qi(t.value,i))&&Xi(e,"change")}}};function Ki(e,t,n){Ji(e,t,n),(q||Z)&&setTimeout(function(){Ji(e,t,n)},0)}function Ji(e,t,n){var r=t.value,i=e.multiple;if(!i||Array.isArray(r)){for(var o,a,s=0,c=e.options.length;s<c;s++)if(a=e.options[s],i)o=j(r,Wi(a))>-1,a.selected!==o&&(a.selected=o);else if(N(Wi(a),r))return void(e.selectedIndex!==s&&(e.selectedIndex=s));i||(e.selectedIndex=-1)}}function qi(e,t){return t.every(function(t){return!N(t,e)})}function Wi(e){return"_value"in e?e._value:e.value}function Zi(e){e.target.composing=!0}function Gi(e){e.target.composing&&(e.target.composing=!1,Xi(e.target,"input"))}function Xi(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}function Yi(e){return!e.componentInstance||e.data&&e.data.transition?e:Yi(e.componentInstance._vnode)}var Qi={model:Vi,show:{bind:function(e,t,n){var r=t.value,i=(n=Yi(n)).data&&n.data.transition,o=e.__vOriginalDisplay="none"===e.style.display?"":e.style.display;r&&i?(n.data.show=!0,Pi(n,function(){e.style.display=o})):e.style.display=r?o:"none"},update:function(e,t,n){var r=t.value;!r!=!t.oldValue&&((n=Yi(n)).data&&n.data.transition?(n.data.show=!0,r?Pi(n,function(){e.style.display=e.__vOriginalDisplay}):Ri(n,function(){e.style.display="none"})):e.style.display=r?e.__vOriginalDisplay:"none")},unbind:function(e,t,n,r,i){i||(e.style.display=e.__vOriginalDisplay)}}},eo={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function to(e){var t=e&&e.componentOptions;return t&&t.Ctor.options.abstract?to(zt(t.children)):e}function no(e){var t={},n=e.$options;for(var r in n.propsData)t[r]=e[r];var i=n._parentListeners;for(var o in i)t[b(o)]=i[o];return t}function ro(e,t){if(/\d-keep-alive$/.test(t.tag))return e("keep-alive",{props:t.componentOptions.propsData})}var io=function(e){return e.tag||Ut(e)},oo=function(e){return"show"===e.name},ao={name:"transition",props:eo,abstract:!0,render:function(e){var t=this,n=this.$slots.default;if(n&&(n=n.filter(io)).length){var r=this.mode,o=n[0];if(function(e){for(;e=e.parent;)if(e.data.transition)return!0}(this.$vnode))return o;var a=to(o);if(!a)return o;if(this._leaving)return ro(e,o);var s="__transition-"+this._uid+"-";a.key=null==a.key?a.isComment?s+"comment":s+a.tag:i(a.key)?0===String(a.key).indexOf(s)?a.key:s+a.key:a.key;var c=(a.data||(a.data={})).transition=no(this),u=this._vnode,l=to(u);if(a.data.directives&&a.data.directives.some(oo)&&(a.data.show=!0),l&&l.data&&!function(e,t){return t.key===e.key&&t.tag===e.tag}(a,l)&&!Ut(l)&&(!l.componentInstance||!l.componentInstance._vnode.isComment)){var f=l.data.transition=A({},c);if("out-in"===r)return this._leaving=!0,it(f,"afterLeave",function(){t._leaving=!1,t.$forceUpdate()}),ro(e,o);if("in-out"===r){if(Ut(a))return u;var p,d=function(){p()};it(c,"afterEnter",d),it(c,"enterCancelled",d),it(f,"delayLeave",function(e){p=e})}}return o}}},so=A({tag:String,moveClass:String},eo);function co(e){e.elm._moveCb&&e.elm._moveCb(),e.elm._enterCb&&e.elm._enterCb()}function uo(e){e.data.newPos=e.elm.getBoundingClientRect()}function lo(e){var t=e.data.pos,n=e.data.newPos,r=t.left-n.left,i=t.top-n.top;if(r||i){e.data.moved=!0;var o=e.elm.style;o.transform=o.WebkitTransform="translate("+r+"px,"+i+"px)",o.transitionDuration="0s"}}delete so.mode;var fo={Transition:ao,TransitionGroup:{props:so,beforeMount:function(){var e=this,t=this._update;this._update=function(n,r){var i=Zt(e);e.__patch__(e._vnode,e.kept,!1,!0),e._vnode=e.kept,i(),t.call(e,n,r)}},render:function(e){for(var t=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),r=this.prevChildren=this.children,i=this.$slots.default||[],o=this.children=[],a=no(this),s=0;s<i.length;s++){var c=i[s];c.tag&&null!=c.key&&0!==String(c.key).indexOf("__vlist")&&(o.push(c),n[c.key]=c,(c.data||(c.data={})).transition=a)}if(r){for(var u=[],l=[],f=0;f<r.length;f++){var p=r[f];p.data.transition=a,p.data.pos=p.elm.getBoundingClientRect(),n[p.key]?u.push(p):l.push(p)}this.kept=e(t,null,u),this.removed=l}return e(t,null,o)},updated:function(){var e=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";e.length&&this.hasMove(e[0].elm,t)&&(e.forEach(co),e.forEach(uo),e.forEach(lo),this._reflow=document.body.offsetHeight,e.forEach(function(e){if(e.data.moved){var n=e.elm,r=n.style;Ni(n,t),r.transform=r.WebkitTransform=r.transitionDuration="",n.addEventListener(Ai,n._moveCb=function e(r){r&&r.target!==n||r&&!/transform$/.test(r.propertyName)||(n.removeEventListener(Ai,e),n._moveCb=null,ji(n,t))})}}))},methods:{hasMove:function(e,t){if(!wi)return!1;if(this._hasMove)return this._hasMove;var n=e.cloneNode();e._transitionClasses&&e._transitionClasses.forEach(function(e){_i(n,e)}),gi(n,t),n.style.display="none",this.$el.appendChild(n);var r=Mi(n);return this.$el.removeChild(n),this._hasMove=r.hasTransform}}}};wn.config.mustUseProp=jn,wn.config.isReservedTag=Wn,wn.config.isReservedAttr=En,wn.config.getTagNamespace=Zn,wn.config.isUnknownElement=function(e){if(!z)return!0;if(Wn(e))return!1;if(e=e.toLowerCase(),null!=Gn[e])return Gn[e];var t=document.createElement(e);return e.indexOf("-")>-1?Gn[e]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:Gn[e]=/HTMLUnknownElement/.test(t.toString())},A(wn.options.directives,Qi),A(wn.options.components,fo),wn.prototype.__patch__=z?zi:S,wn.prototype.$mount=function(e,t){return function(e,t,n){var r;return e.$el=t,e.$options.render||(e.$options.render=ve),Yt(e,"beforeMount"),r=function(){e._update(e._render(),n)},new fn(e,r,S,{before:function(){e._isMounted&&!e._isDestroyed&&Yt(e,"beforeUpdate")}},!0),n=!1,null==e.$vnode&&(e._isMounted=!0,Yt(e,"mounted")),e}(this,e=e&&z?Yn(e):void 0,t)},z&&setTimeout(function(){F.devtools&&ne&&ne.emit("init",wn)},0);var po=/\{\{((?:.|\r?\n)+?)\}\}/g,vo=/[-.*+?^${}()|[\]\/\\]/g,ho=g(function(e){var t=e[0].replace(vo,"\\$&"),n=e[1].replace(vo,"\\$&");return new RegExp(t+"((?:.|\\n)+?)"+n,"g")});var mo={staticKeys:["staticClass"],transformNode:function(e,t){t.warn;var n=Fr(e,"class");n&&(e.staticClass=JSON.stringify(n));var r=Ir(e,"class",!1);r&&(e.classBinding=r)},genData:function(e){var t="";return e.staticClass&&(t+="staticClass:"+e.staticClass+","),e.classBinding&&(t+="class:"+e.classBinding+","),t}};var yo,go={staticKeys:["staticStyle"],transformNode:function(e,t){t.warn;var n=Fr(e,"style");n&&(e.staticStyle=JSON.stringify(ai(n)));var r=Ir(e,"style",!1);r&&(e.styleBinding=r)},genData:function(e){var t="";return e.staticStyle&&(t+="staticStyle:"+e.staticStyle+","),e.styleBinding&&(t+="style:("+e.styleBinding+"),"),t}},_o=function(e){return(yo=yo||document.createElement("div")).innerHTML=e,yo.textContent},bo=p("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"),$o=p("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr,source"),wo=p("address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track"),Co=/^\s*([^\s"'<>\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,xo=/^\s*((?:v-[\w-]+:|@|:|#)\[[^=]+\][^\s"'<>\/=]*)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>`]+)))?/,ko="[a-zA-Z_][\\-\\.0-9_a-zA-Z"+P.source+"]*",Ao="((?:"+ko+"\\:)?"+ko+")",Oo=new RegExp("^<"+Ao),So=/^\s*(\/?)>/,To=new RegExp("^<\\/"+Ao+"[^>]*>"),Eo=/^<!DOCTYPE [^>]+>/i,No=/^<!\--/,jo=/^<!\[/,Do=p("script,style,textarea",!0),Lo={},Mo={"&lt;":"<","&gt;":">","&quot;":'"',"&amp;":"&","&#10;":"\n","&#9;":"\t","&#39;":"'"},Io=/&(?:lt|gt|quot|amp|#39);/g,Fo=/&(?:lt|gt|quot|amp|#39|#10|#9);/g,Po=p("pre,textarea",!0),Ro=function(e,t){return e&&Po(e)&&"\n"===t[0]};function Ho(e,t){var n=t?Fo:Io;return e.replace(n,function(e){return Mo[e]})}var Bo,Uo,zo,Vo,Ko,Jo,qo,Wo,Zo=/^@|^v-on:/,Go=/^v-|^@|^:/,Xo=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,Yo=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,Qo=/^\(|\)$/g,ea=/^\[.*\]$/,ta=/:(.*)$/,na=/^:|^\.|^v-bind:/,ra=/\.[^.\]]+(?=[^\]]*$)/g,ia=/^v-slot(:|$)|^#/,oa=/[\r\n]/,aa=/\s+/g,sa=g(_o),ca="_empty_";function ua(e,t,n){return{type:1,tag:e,attrsList:t,attrsMap:ma(t),rawAttrsMap:{},parent:n,children:[]}}function la(e,t){Bo=t.warn||Sr,Jo=t.isPreTag||T,qo=t.mustUseProp||T,Wo=t.getTagNamespace||T;t.isReservedTag;zo=Tr(t.modules,"transformNode"),Vo=Tr(t.modules,"preTransformNode"),Ko=Tr(t.modules,"postTransformNode"),Uo=t.delimiters;var n,r,i=[],o=!1!==t.preserveWhitespace,a=t.whitespace,s=!1,c=!1;function u(e){if(l(e),s||e.processed||(e=fa(e,t)),i.length||e===n||n.if&&(e.elseif||e.else)&&da(n,{exp:e.elseif,block:e}),r&&!e.forbidden)if(e.elseif||e.else)a=e,(u=function(e){var t=e.length;for(;t--;){if(1===e[t].type)return e[t];e.pop()}}(r.children))&&u.if&&da(u,{exp:a.elseif,block:a});else{if(e.slotScope){var o=e.slotTarget||'"default"';(r.scopedSlots||(r.scopedSlots={}))[o]=e}r.children.push(e),e.parent=r}var a,u;e.children=e.children.filter(function(e){return!e.slotScope}),l(e),e.pre&&(s=!1),Jo(e.tag)&&(c=!1);for(var f=0;f<Ko.length;f++)Ko[f](e,t)}function l(e){if(!c)for(var t;(t=e.children[e.children.length-1])&&3===t.type&&" "===t.text;)e.children.pop()}return function(e,t){for(var n,r,i=[],o=t.expectHTML,a=t.isUnaryTag||T,s=t.canBeLeftOpenTag||T,c=0;e;){if(n=e,r&&Do(r)){var u=0,l=r.toLowerCase(),f=Lo[l]||(Lo[l]=new RegExp("([\\s\\S]*?)(</"+l+"[^>]*>)","i")),p=e.replace(f,function(e,n,r){return u=r.length,Do(l)||"noscript"===l||(n=n.replace(/<!\--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1")),Ro(l,n)&&(n=n.slice(1)),t.chars&&t.chars(n),""});c+=e.length-p.length,e=p,A(l,c-u,c)}else{var d=e.indexOf("<");if(0===d){if(No.test(e)){var v=e.indexOf("--\x3e");if(v>=0){t.shouldKeepComment&&t.comment(e.substring(4,v),c,c+v+3),C(v+3);continue}}if(jo.test(e)){var h=e.indexOf("]>");if(h>=0){C(h+2);continue}}var m=e.match(Eo);if(m){C(m[0].length);continue}var y=e.match(To);if(y){var g=c;C(y[0].length),A(y[1],g,c);continue}var _=x();if(_){k(_),Ro(_.tagName,e)&&C(1);continue}}var b=void 0,$=void 0,w=void 0;if(d>=0){for($=e.slice(d);!(To.test($)||Oo.test($)||No.test($)||jo.test($)||(w=$.indexOf("<",1))<0);)d+=w,$=e.slice(d);b=e.substring(0,d)}d<0&&(b=e),b&&C(b.length),t.chars&&b&&t.chars(b,c-b.length,c)}if(e===n){t.chars&&t.chars(e);break}}function C(t){c+=t,e=e.substring(t)}function x(){var t=e.match(Oo);if(t){var n,r,i={tagName:t[1],attrs:[],start:c};for(C(t[0].length);!(n=e.match(So))&&(r=e.match(xo)||e.match(Co));)r.start=c,C(r[0].length),r.end=c,i.attrs.push(r);if(n)return i.unarySlash=n[1],C(n[0].length),i.end=c,i}}function k(e){var n=e.tagName,c=e.unarySlash;o&&("p"===r&&wo(n)&&A(r),s(n)&&r===n&&A(n));for(var u=a(n)||!!c,l=e.attrs.length,f=new Array(l),p=0;p<l;p++){var d=e.attrs[p],v=d[3]||d[4]||d[5]||"",h="a"===n&&"href"===d[1]?t.shouldDecodeNewlinesForHref:t.shouldDecodeNewlines;f[p]={name:d[1],value:Ho(v,h)}}u||(i.push({tag:n,lowerCasedTag:n.toLowerCase(),attrs:f,start:e.start,end:e.end}),r=n),t.start&&t.start(n,f,u,e.start,e.end)}function A(e,n,o){var a,s;if(null==n&&(n=c),null==o&&(o=c),e)for(s=e.toLowerCase(),a=i.length-1;a>=0&&i[a].lowerCasedTag!==s;a--);else a=0;if(a>=0){for(var u=i.length-1;u>=a;u--)t.end&&t.end(i[u].tag,n,o);i.length=a,r=a&&i[a-1].tag}else"br"===s?t.start&&t.start(e,[],!0,n,o):"p"===s&&(t.start&&t.start(e,[],!1,n,o),t.end&&t.end(e,n,o))}A()}(e,{warn:Bo,expectHTML:t.expectHTML,isUnaryTag:t.isUnaryTag,canBeLeftOpenTag:t.canBeLeftOpenTag,shouldDecodeNewlines:t.shouldDecodeNewlines,shouldDecodeNewlinesForHref:t.shouldDecodeNewlinesForHref,shouldKeepComment:t.comments,outputSourceRange:t.outputSourceRange,start:function(e,o,a,l,f){var p=r&&r.ns||Wo(e);q&&"svg"===p&&(o=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];ya.test(r.name)||(r.name=r.name.replace(ga,""),t.push(r))}return t}(o));var d,v=ua(e,o,r);p&&(v.ns=p),"style"!==(d=v).tag&&("script"!==d.tag||d.attrsMap.type&&"text/javascript"!==d.attrsMap.type)||te()||(v.forbidden=!0);for(var h=0;h<Vo.length;h++)v=Vo[h](v,t)||v;s||(!function(e){null!=Fr(e,"v-pre")&&(e.pre=!0)}(v),v.pre&&(s=!0)),Jo(v.tag)&&(c=!0),s?function(e){var t=e.attrsList,n=t.length;if(n)for(var r=e.attrs=new Array(n),i=0;i<n;i++)r[i]={name:t[i].name,value:JSON.stringify(t[i].value)},null!=t[i].start&&(r[i].start=t[i].start,r[i].end=t[i].end);else e.pre||(e.plain=!0)}(v):v.processed||(pa(v),function(e){var t=Fr(e,"v-if");if(t)e.if=t,da(e,{exp:t,block:e});else{null!=Fr(e,"v-else")&&(e.else=!0);var n=Fr(e,"v-else-if");n&&(e.elseif=n)}}(v),function(e){null!=Fr(e,"v-once")&&(e.once=!0)}(v)),n||(n=v),a?u(v):(r=v,i.push(v))},end:function(e,t,n){var o=i[i.length-1];i.length-=1,r=i[i.length-1],u(o)},chars:function(e,t,n){if(r&&(!q||"textarea"!==r.tag||r.attrsMap.placeholder!==e)){var i,u,l,f=r.children;if(e=c||e.trim()?"script"===(i=r).tag||"style"===i.tag?e:sa(e):f.length?a?"condense"===a&&oa.test(e)?"":" ":o?" ":"":"")c||"condense"!==a||(e=e.replace(aa," ")),!s&&" "!==e&&(u=function(e,t){var n=t?ho(t):po;if(n.test(e)){for(var r,i,o,a=[],s=[],c=n.lastIndex=0;r=n.exec(e);){(i=r.index)>c&&(s.push(o=e.slice(c,i)),a.push(JSON.stringify(o)));var u=Ar(r[1].trim());a.push("_s("+u+")"),s.push({"@binding":u}),c=i+r[0].length}return c<e.length&&(s.push(o=e.slice(c)),a.push(JSON.stringify(o))),{expression:a.join("+"),tokens:s}}}(e,Uo))?l={type:2,expression:u.expression,tokens:u.tokens,text:e}:" "===e&&f.length&&" "===f[f.length-1].text||(l={type:3,text:e}),l&&f.push(l)}},comment:function(e,t,n){if(r){var i={type:3,text:e,isComment:!0};r.children.push(i)}}}),n}function fa(e,t){var n,r;(r=Ir(n=e,"key"))&&(n.key=r),e.plain=!e.key&&!e.scopedSlots&&!e.attrsList.length,function(e){var t=Ir(e,"ref");t&&(e.ref=t,e.refInFor=function(e){var t=e;for(;t;){if(void 0!==t.for)return!0;t=t.parent}return!1}(e))}(e),function(e){var t;"template"===e.tag?(t=Fr(e,"scope"),e.slotScope=t||Fr(e,"slot-scope")):(t=Fr(e,"slot-scope"))&&(e.slotScope=t);var n=Ir(e,"slot");n&&(e.slotTarget='""'===n?'"default"':n,e.slotTargetDynamic=!(!e.attrsMap[":slot"]&&!e.attrsMap["v-bind:slot"]),"template"===e.tag||e.slotScope||Nr(e,"slot",n,function(e,t){return e.rawAttrsMap[":"+t]||e.rawAttrsMap["v-bind:"+t]||e.rawAttrsMap[t]}(e,"slot")));if("template"===e.tag){var r=Pr(e,ia);if(r){var i=va(r),o=i.name,a=i.dynamic;e.slotTarget=o,e.slotTargetDynamic=a,e.slotScope=r.value||ca}}else{var s=Pr(e,ia);if(s){var c=e.scopedSlots||(e.scopedSlots={}),u=va(s),l=u.name,f=u.dynamic,p=c[l]=ua("template",[],e);p.slotTarget=l,p.slotTargetDynamic=f,p.children=e.children.filter(function(e){if(!e.slotScope)return e.parent=p,!0}),p.slotScope=s.value||ca,e.children=[],e.plain=!1}}}(e),function(e){"slot"===e.tag&&(e.slotName=Ir(e,"name"))}(e),function(e){var t;(t=Ir(e,"is"))&&(e.component=t);null!=Fr(e,"inline-template")&&(e.inlineTemplate=!0)}(e);for(var i=0;i<zo.length;i++)e=zo[i](e,t)||e;return function(e){var t,n,r,i,o,a,s,c,u=e.attrsList;for(t=0,n=u.length;t<n;t++)if(r=i=u[t].name,o=u[t].value,Go.test(r))if(e.hasBindings=!0,(a=ha(r.replace(Go,"")))&&(r=r.replace(ra,"")),na.test(r))r=r.replace(na,""),o=Ar(o),(c=ea.test(r))&&(r=r.slice(1,-1)),a&&(a.prop&&!c&&"innerHtml"===(r=b(r))&&(r="innerHTML"),a.camel&&!c&&(r=b(r)),a.sync&&(s=Br(o,"$event"),c?Mr(e,'"update:"+('+r+")",s,null,!1,0,u[t],!0):(Mr(e,"update:"+b(r),s,null,!1,0,u[t]),C(r)!==b(r)&&Mr(e,"update:"+C(r),s,null,!1,0,u[t])))),a&&a.prop||!e.component&&qo(e.tag,e.attrsMap.type,r)?Er(e,r,o,u[t],c):Nr(e,r,o,u[t],c);else if(Zo.test(r))r=r.replace(Zo,""),(c=ea.test(r))&&(r=r.slice(1,-1)),Mr(e,r,o,a,!1,0,u[t],c);else{var l=(r=r.replace(Go,"")).match(ta),f=l&&l[1];c=!1,f&&(r=r.slice(0,-(f.length+1)),ea.test(f)&&(f=f.slice(1,-1),c=!0)),Dr(e,r,i,o,f,c,a,u[t])}else Nr(e,r,JSON.stringify(o),u[t]),!e.component&&"muted"===r&&qo(e.tag,e.attrsMap.type,r)&&Er(e,r,"true",u[t])}(e),e}function pa(e){var t;if(t=Fr(e,"v-for")){var n=function(e){var t=e.match(Xo);if(!t)return;var n={};n.for=t[2].trim();var r=t[1].trim().replace(Qo,""),i=r.match(Yo);i?(n.alias=r.replace(Yo,"").trim(),n.iterator1=i[1].trim(),i[2]&&(n.iterator2=i[2].trim())):n.alias=r;return n}(t);n&&A(e,n)}}function da(e,t){e.ifConditions||(e.ifConditions=[]),e.ifConditions.push(t)}function va(e){var t=e.name.replace(ia,"");return t||"#"!==e.name[0]&&(t="default"),ea.test(t)?{name:t.slice(1,-1),dynamic:!0}:{name:'"'+t+'"',dynamic:!1}}function ha(e){var t=e.match(ra);if(t){var n={};return t.forEach(function(e){n[e.slice(1)]=!0}),n}}function ma(e){for(var t={},n=0,r=e.length;n<r;n++)t[e[n].name]=e[n].value;return t}var ya=/^xmlns:NS\d+/,ga=/^NS\d+:/;function _a(e){return ua(e.tag,e.attrsList.slice(),e.parent)}var ba=[mo,go,{preTransformNode:function(e,t){if("input"===e.tag){var n,r=e.attrsMap;if(!r["v-model"])return;if((r[":type"]||r["v-bind:type"])&&(n=Ir(e,"type")),r.type||n||!r["v-bind"]||(n="("+r["v-bind"]+").type"),n){var i=Fr(e,"v-if",!0),o=i?"&&("+i+")":"",a=null!=Fr(e,"v-else",!0),s=Fr(e,"v-else-if",!0),c=_a(e);pa(c),jr(c,"type","checkbox"),fa(c,t),c.processed=!0,c.if="("+n+")==='checkbox'"+o,da(c,{exp:c.if,block:c});var u=_a(e);Fr(u,"v-for",!0),jr(u,"type","radio"),fa(u,t),da(c,{exp:"("+n+")==='radio'"+o,block:u});var l=_a(e);return Fr(l,"v-for",!0),jr(l,":type",n),fa(l,t),da(c,{exp:i,block:l}),a?c.else=!0:s&&(c.elseif=s),c}}}}];var $a,wa,Ca={expectHTML:!0,modules:ba,directives:{model:function(e,t,n){var r=t.value,i=t.modifiers,o=e.tag,a=e.attrsMap.type;if(e.component)return Hr(e,r,i),!1;if("select"===o)!function(e,t,n){var r='var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = "_value" in o ? o._value : o.value;return '+(n&&n.number?"_n(val)":"val")+"});";r=r+" "+Br(t,"$event.target.multiple ? $$selectedVal : $$selectedVal[0]"),Mr(e,"change",r,null,!0)}(e,r,i);else if("input"===o&&"checkbox"===a)!function(e,t,n){var r=n&&n.number,i=Ir(e,"value")||"null",o=Ir(e,"true-value")||"true",a=Ir(e,"false-value")||"false";Er(e,"checked","Array.isArray("+t+")?_i("+t+","+i+")>-1"+("true"===o?":("+t+")":":_q("+t+","+o+")")),Mr(e,"change","var $$a="+t+",$$el=$event.target,$$c=$$el.checked?("+o+"):("+a+");if(Array.isArray($$a)){var $$v="+(r?"_n("+i+")":i)+",$$i=_i($$a,$$v);if($$el.checked){$$i<0&&("+Br(t,"$$a.concat([$$v])")+")}else{$$i>-1&&("+Br(t,"$$a.slice(0,$$i).concat($$a.slice($$i+1))")+")}}else{"+Br(t,"$$c")+"}",null,!0)}(e,r,i);else if("input"===o&&"radio"===a)!function(e,t,n){var r=n&&n.number,i=Ir(e,"value")||"null";Er(e,"checked","_q("+t+","+(i=r?"_n("+i+")":i)+")"),Mr(e,"change",Br(t,i),null,!0)}(e,r,i);else if("input"===o||"textarea"===o)!function(e,t,n){var r=e.attrsMap.type,i=n||{},o=i.lazy,a=i.number,s=i.trim,c=!o&&"range"!==r,u=o?"change":"range"===r?Wr:"input",l="$event.target.value";s&&(l="$event.target.value.trim()"),a&&(l="_n("+l+")");var f=Br(t,l);c&&(f="if($event.target.composing)return;"+f),Er(e,"value","("+t+")"),Mr(e,u,f,null,!0),(s||a)&&Mr(e,"blur","$forceUpdate()")}(e,r,i);else if(!F.isReservedTag(o))return Hr(e,r,i),!1;return!0},text:function(e,t){t.value&&Er(e,"textContent","_s("+t.value+")",t)},html:function(e,t){t.value&&Er(e,"innerHTML","_s("+t.value+")",t)}},isPreTag:function(e){return"pre"===e},isUnaryTag:bo,mustUseProp:jn,canBeLeftOpenTag:$o,isReservedTag:Wn,getTagNamespace:Zn,staticKeys:function(e){return e.reduce(function(e,t){return e.concat(t.staticKeys||[])},[]).join(",")}(ba)},xa=g(function(e){return p("type,tag,attrsList,attrsMap,plain,parent,children,attrs,start,end,rawAttrsMap"+(e?","+e:""))});function ka(e,t){e&&($a=xa(t.staticKeys||""),wa=t.isReservedTag||T,function e(t){t.static=function(e){if(2===e.type)return!1;if(3===e.type)return!0;return!(!e.pre&&(e.hasBindings||e.if||e.for||d(e.tag)||!wa(e.tag)||function(e){for(;e.parent;){if("template"!==(e=e.parent).tag)return!1;if(e.for)return!0}return!1}(e)||!Object.keys(e).every($a)))}(t);if(1===t.type){if(!wa(t.tag)&&"slot"!==t.tag&&null==t.attrsMap["inline-template"])return;for(var n=0,r=t.children.length;n<r;n++){var i=t.children[n];e(i),i.static||(t.static=!1)}if(t.ifConditions)for(var o=1,a=t.ifConditions.length;o<a;o++){var s=t.ifConditions[o].block;e(s),s.static||(t.static=!1)}}}(e),function e(t,n){if(1===t.type){if((t.static||t.once)&&(t.staticInFor=n),t.static&&t.children.length&&(1!==t.children.length||3!==t.children[0].type))return void(t.staticRoot=!0);if(t.staticRoot=!1,t.children)for(var r=0,i=t.children.length;r<i;r++)e(t.children[r],n||!!t.for);if(t.ifConditions)for(var o=1,a=t.ifConditions.length;o<a;o++)e(t.ifConditions[o].block,n)}}(e,!1))}var Aa=/^([\w$_]+|\([^)]*?\))\s*=>|^function\s*(?:[\w$]+)?\s*\(/,Oa=/\([^)]*?\);*$/,Sa=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['[^']*?']|\["[^"]*?"]|\[\d+]|\[[A-Za-z_$][\w$]*])*$/,Ta={esc:27,tab:9,enter:13,space:32,up:38,left:37,right:39,down:40,delete:[8,46]},Ea={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]},Na=function(e){return"if("+e+")return null;"},ja={stop:"$event.stopPropagation();",prevent:"$event.preventDefault();",self:Na("$event.target !== $event.currentTarget"),ctrl:Na("!$event.ctrlKey"),shift:Na("!$event.shiftKey"),alt:Na("!$event.altKey"),meta:Na("!$event.metaKey"),left:Na("'button' in $event && $event.button !== 0"),middle:Na("'button' in $event && $event.button !== 1"),right:Na("'button' in $event && $event.button !== 2")};function Da(e,t){var n=t?"nativeOn:":"on:",r="",i="";for(var o in e){var a=La(e[o]);e[o]&&e[o].dynamic?i+=o+","+a+",":r+='"'+o+'":'+a+","}return r="{"+r.slice(0,-1)+"}",i?n+"_d("+r+",["+i.slice(0,-1)+"])":n+r}function La(e){if(!e)return"function(){}";if(Array.isArray(e))return"["+e.map(function(e){return La(e)}).join(",")+"]";var t=Sa.test(e.value),n=Aa.test(e.value),r=Sa.test(e.value.replace(Oa,""));if(e.modifiers){var i="",o="",a=[];for(var s in e.modifiers)if(ja[s])o+=ja[s],Ta[s]&&a.push(s);else if("exact"===s){var c=e.modifiers;o+=Na(["ctrl","shift","alt","meta"].filter(function(e){return!c[e]}).map(function(e){return"$event."+e+"Key"}).join("||"))}else a.push(s);return a.length&&(i+=function(e){return"if(!$event.type.indexOf('key')&&"+e.map(Ma).join("&&")+")return null;"}(a)),o&&(i+=o),"function($event){"+i+(t?"return "+e.value+"($event)":n?"return ("+e.value+")($event)":r?"return "+e.value:e.value)+"}"}return t||n?e.value:"function($event){"+(r?"return "+e.value:e.value)+"}"}function Ma(e){var t=parseInt(e,10);if(t)return"$event.keyCode!=="+t;var n=Ta[e],r=Ea[e];return"_k($event.keyCode,"+JSON.stringify(e)+","+JSON.stringify(n)+",$event.key,"+JSON.stringify(r)+")"}var Ia={on:function(e,t){e.wrapListeners=function(e){return"_g("+e+","+t.value+")"}},bind:function(e,t){e.wrapData=function(n){return"_b("+n+",'"+e.tag+"',"+t.value+","+(t.modifiers&&t.modifiers.prop?"true":"false")+(t.modifiers&&t.modifiers.sync?",true":"")+")"}},cloak:S},Fa=function(e){this.options=e,this.warn=e.warn||Sr,this.transforms=Tr(e.modules,"transformCode"),this.dataGenFns=Tr(e.modules,"genData"),this.directives=A(A({},Ia),e.directives);var t=e.isReservedTag||T;this.maybeComponent=function(e){return!!e.component||!t(e.tag)},this.onceId=0,this.staticRenderFns=[],this.pre=!1};function Pa(e,t){var n=new Fa(t);return{render:"with(this){return "+(e?Ra(e,n):'_c("div")')+"}",staticRenderFns:n.staticRenderFns}}function Ra(e,t){if(e.parent&&(e.pre=e.pre||e.parent.pre),e.staticRoot&&!e.staticProcessed)return Ha(e,t);if(e.once&&!e.onceProcessed)return Ba(e,t);if(e.for&&!e.forProcessed)return za(e,t);if(e.if&&!e.ifProcessed)return Ua(e,t);if("template"!==e.tag||e.slotTarget||t.pre){if("slot"===e.tag)return function(e,t){var n=e.slotName||'"default"',r=qa(e,t),i="_t("+n+(r?","+r:""),o=e.attrs||e.dynamicAttrs?Ga((e.attrs||[]).concat(e.dynamicAttrs||[]).map(function(e){return{name:b(e.name),value:e.value,dynamic:e.dynamic}})):null,a=e.attrsMap["v-bind"];!o&&!a||r||(i+=",null");o&&(i+=","+o);a&&(i+=(o?"":",null")+","+a);return i+")"}(e,t);var n;if(e.component)n=function(e,t,n){var r=t.inlineTemplate?null:qa(t,n,!0);return"_c("+e+","+Va(t,n)+(r?","+r:"")+")"}(e.component,e,t);else{var r;(!e.plain||e.pre&&t.maybeComponent(e))&&(r=Va(e,t));var i=e.inlineTemplate?null:qa(e,t,!0);n="_c('"+e.tag+"'"+(r?","+r:"")+(i?","+i:"")+")"}for(var o=0;o<t.transforms.length;o++)n=t.transforms[o](e,n);return n}return qa(e,t)||"void 0"}function Ha(e,t){e.staticProcessed=!0;var n=t.pre;return e.pre&&(t.pre=e.pre),t.staticRenderFns.push("with(this){return "+Ra(e,t)+"}"),t.pre=n,"_m("+(t.staticRenderFns.length-1)+(e.staticInFor?",true":"")+")"}function Ba(e,t){if(e.onceProcessed=!0,e.if&&!e.ifProcessed)return Ua(e,t);if(e.staticInFor){for(var n="",r=e.parent;r;){if(r.for){n=r.key;break}r=r.parent}return n?"_o("+Ra(e,t)+","+t.onceId+++","+n+")":Ra(e,t)}return Ha(e,t)}function Ua(e,t,n,r){return e.ifProcessed=!0,function e(t,n,r,i){if(!t.length)return i||"_e()";var o=t.shift();return o.exp?"("+o.exp+")?"+a(o.block)+":"+e(t,n,r,i):""+a(o.block);function a(e){return r?r(e,n):e.once?Ba(e,n):Ra(e,n)}}(e.ifConditions.slice(),t,n,r)}function za(e,t,n,r){var i=e.for,o=e.alias,a=e.iterator1?","+e.iterator1:"",s=e.iterator2?","+e.iterator2:"";return e.forProcessed=!0,(r||"_l")+"(("+i+"),function("+o+a+s+"){return "+(n||Ra)(e,t)+"})"}function Va(e,t){var n="{",r=function(e,t){var n=e.directives;if(!n)return;var r,i,o,a,s="directives:[",c=!1;for(r=0,i=n.length;r<i;r++){o=n[r],a=!0;var u=t.directives[o.name];u&&(a=!!u(e,o,t.warn)),a&&(c=!0,s+='{name:"'+o.name+'",rawName:"'+o.rawName+'"'+(o.value?",value:("+o.value+"),expression:"+JSON.stringify(o.value):"")+(o.arg?",arg:"+(o.isDynamicArg?o.arg:'"'+o.arg+'"'):"")+(o.modifiers?",modifiers:"+JSON.stringify(o.modifiers):"")+"},")}if(c)return s.slice(0,-1)+"]"}(e,t);r&&(n+=r+","),e.key&&(n+="key:"+e.key+","),e.ref&&(n+="ref:"+e.ref+","),e.refInFor&&(n+="refInFor:true,"),e.pre&&(n+="pre:true,"),e.component&&(n+='tag:"'+e.tag+'",');for(var i=0;i<t.dataGenFns.length;i++)n+=t.dataGenFns[i](e);if(e.attrs&&(n+="attrs:"+Ga(e.attrs)+","),e.props&&(n+="domProps:"+Ga(e.props)+","),e.events&&(n+=Da(e.events,!1)+","),e.nativeEvents&&(n+=Da(e.nativeEvents,!0)+","),e.slotTarget&&!e.slotScope&&(n+="slot:"+e.slotTarget+","),e.scopedSlots&&(n+=function(e,t,n){var r=e.for||Object.keys(t).some(function(e){var n=t[e];return n.slotTargetDynamic||n.if||n.for||Ka(n)}),i=!!e.if;if(!r)for(var o=e.parent;o;){if(o.slotScope&&o.slotScope!==ca||o.for){r=!0;break}o.if&&(i=!0),o=o.parent}var a=Object.keys(t).map(function(e){return Ja(t[e],n)}).join(",");return"scopedSlots:_u(["+a+"]"+(r?",null,true":"")+(!r&&i?",null,false,"+function(e){var t=5381,n=e.length;for(;n;)t=33*t^e.charCodeAt(--n);return t>>>0}(a):"")+")"}(e,e.scopedSlots,t)+","),e.model&&(n+="model:{value:"+e.model.value+",callback:"+e.model.callback+",expression:"+e.model.expression+"},"),e.inlineTemplate){var o=function(e,t){var n=e.children[0];if(n&&1===n.type){var r=Pa(n,t.options);return"inlineTemplate:{render:function(){"+r.render+"},staticRenderFns:["+r.staticRenderFns.map(function(e){return"function(){"+e+"}"}).join(",")+"]}"}}(e,t);o&&(n+=o+",")}return n=n.replace(/,$/,"")+"}",e.dynamicAttrs&&(n="_b("+n+',"'+e.tag+'",'+Ga(e.dynamicAttrs)+")"),e.wrapData&&(n=e.wrapData(n)),e.wrapListeners&&(n=e.wrapListeners(n)),n}function Ka(e){return 1===e.type&&("slot"===e.tag||e.children.some(Ka))}function Ja(e,t){var n=e.attrsMap["slot-scope"];if(e.if&&!e.ifProcessed&&!n)return Ua(e,t,Ja,"null");if(e.for&&!e.forProcessed)return za(e,t,Ja);var r=e.slotScope===ca?"":String(e.slotScope),i="function("+r+"){return "+("template"===e.tag?e.if&&n?"("+e.if+")?"+(qa(e,t)||"undefined")+":undefined":qa(e,t)||"undefined":Ra(e,t))+"}",o=r?"":",proxy:true";return"{key:"+(e.slotTarget||'"default"')+",fn:"+i+o+"}"}function qa(e,t,n,r,i){var o=e.children;if(o.length){var a=o[0];if(1===o.length&&a.for&&"template"!==a.tag&&"slot"!==a.tag){var s=n?t.maybeComponent(a)?",1":",0":"";return""+(r||Ra)(a,t)+s}var c=n?function(e,t){for(var n=0,r=0;r<e.length;r++){var i=e[r];if(1===i.type){if(Wa(i)||i.ifConditions&&i.ifConditions.some(function(e){return Wa(e.block)})){n=2;break}(t(i)||i.ifConditions&&i.ifConditions.some(function(e){return t(e.block)}))&&(n=1)}}return n}(o,t.maybeComponent):0,u=i||Za;return"["+o.map(function(e){return u(e,t)}).join(",")+"]"+(c?","+c:"")}}function Wa(e){return void 0!==e.for||"template"===e.tag||"slot"===e.tag}function Za(e,t){return 1===e.type?Ra(e,t):3===e.type&&e.isComment?(r=e,"_e("+JSON.stringify(r.text)+")"):"_v("+(2===(n=e).type?n.expression:Xa(JSON.stringify(n.text)))+")";var n,r}function Ga(e){for(var t="",n="",r=0;r<e.length;r++){var i=e[r],o=Xa(i.value);i.dynamic?n+=i.name+","+o+",":t+='"'+i.name+'":'+o+","}return t="{"+t.slice(0,-1)+"}",n?"_d("+t+",["+n.slice(0,-1)+"])":t}function Xa(e){return e.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}new RegExp("\\b"+"do,if,for,let,new,try,var,case,else,with,await,break,catch,class,const,super,throw,while,yield,delete,export,import,return,switch,default,extends,finally,continue,debugger,function,arguments".split(",").join("\\b|\\b")+"\\b");function Ya(e,t){try{return new Function(e)}catch(n){return t.push({err:n,code:e}),S}}function Qa(e){var t=Object.create(null);return function(n,r,i){(r=A({},r)).warn;delete r.warn;var o=r.delimiters?String(r.delimiters)+n:n;if(t[o])return t[o];var a=e(n,r),s={},c=[];return s.render=Ya(a.render,c),s.staticRenderFns=a.staticRenderFns.map(function(e){return Ya(e,c)}),t[o]=s}}var es,ts,ns=(es=function(e,t){var n=la(e.trim(),t);!1!==t.optimize&&ka(n,t);var r=Pa(n,t);return{ast:n,render:r.render,staticRenderFns:r.staticRenderFns}},function(e){function t(t,n){var r=Object.create(e),i=[],o=[];if(n)for(var a in n.modules&&(r.modules=(e.modules||[]).concat(n.modules)),n.directives&&(r.directives=A(Object.create(e.directives||null),n.directives)),n)"modules"!==a&&"directives"!==a&&(r[a]=n[a]);r.warn=function(e,t,n){(n?o:i).push(e)};var s=es(t.trim(),r);return s.errors=i,s.tips=o,s}return{compile:t,compileToFunctions:Qa(t)}})(Ca),rs=(ns.compile,ns.compileToFunctions);function is(e){return(ts=ts||document.createElement("div")).innerHTML=e?'<a href="\n"/>':'<div a="\n"/>',ts.innerHTML.indexOf("&#10;")>0}var os=!!z&&is(!1),as=!!z&&is(!0),ss=g(function(e){var t=Yn(e);return t&&t.innerHTML}),cs=wn.prototype.$mount;return wn.prototype.$mount=function(e,t){if((e=e&&Yn(e))===document.body||e===document.documentElement)return this;var n=this.$options;if(!n.render){var r=n.template;if(r)if("string"==typeof r)"#"===r.charAt(0)&&(r=ss(r));else{if(!r.nodeType)return this;r=r.innerHTML}else e&&(r=function(e){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}(e));if(r){var i=rs(r,{outputSourceRange:!1,shouldDecodeNewlines:os,shouldDecodeNewlinesForHref:as,delimiters:n.delimiters,comments:n.comments},this),o=i.render,a=i.staticRenderFns;n.render=o,n.staticRenderFns=a}}return cs.call(this,e,t)},wn.compile=rs,wn});/**
 * vuex v3.1.0
 * (c) 2019 Evan You
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Vuex=e()}(this,function(){"use strict";var u="undefined"!=typeof window&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function a(e,n){Object.keys(e).forEach(function(t){return n(e[t],t)})}var r=function(t,e){this.runtime=e,this._children=Object.create(null);var n=(this._rawModule=t).state;this.state=("function"==typeof n?n():n)||{}},t={namespaced:{configurable:!0}};t.namespaced.get=function(){return!!this._rawModule.namespaced},r.prototype.addChild=function(t,e){this._children[t]=e},r.prototype.removeChild=function(t){delete this._children[t]},r.prototype.getChild=function(t){return this._children[t]},r.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)},r.prototype.forEachChild=function(t){a(this._children,t)},r.prototype.forEachGetter=function(t){this._rawModule.getters&&a(this._rawModule.getters,t)},r.prototype.forEachAction=function(t){this._rawModule.actions&&a(this._rawModule.actions,t)},r.prototype.forEachMutation=function(t){this._rawModule.mutations&&a(this._rawModule.mutations,t)},Object.defineProperties(r.prototype,t);var m,f=function(t){this.register([],t,!1)};f.prototype.get=function(t){return t.reduce(function(t,e){return t.getChild(e)},this.root)},f.prototype.getNamespace=function(t){var n=this.root;return t.reduce(function(t,e){return t+((n=n.getChild(e)).namespaced?e+"/":"")},"")},f.prototype.update=function(t){!function t(e,n,o){n.update(o);if(o.modules)for(var i in o.modules){if(!n.getChild(i))return;t(e.concat(i),n.getChild(i),o.modules[i])}}([],this.root,t)},f.prototype.register=function(n,t,o){var i=this;void 0===o&&(o=!0);var e=new r(t,o);0===n.length?this.root=e:this.get(n.slice(0,-1)).addChild(n[n.length-1],e);t.modules&&a(t.modules,function(t,e){i.register(n.concat(e),t,o)})},f.prototype.unregister=function(t){var e=this.get(t.slice(0,-1)),n=t[t.length-1];e.getChild(n).runtime&&e.removeChild(n)};var e=function(t){var e=this;void 0===t&&(t={}),!m&&"undefined"!=typeof window&&window.Vue&&p(window.Vue);var n=t.plugins;void 0===n&&(n=[]);var o=t.strict;void 0===o&&(o=!1),this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new f(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._watcherVM=new m;var i=this,r=this.dispatch,s=this.commit;this.dispatch=function(t,e){return r.call(i,t,e)},this.commit=function(t,e,n){return s.call(i,t,e,n)},this.strict=o;var a,c=this._modules.root.state;v(this,c,[],this._modules.root),h(this,c),n.forEach(function(t){return t(e)}),(void 0!==t.devtools?t.devtools:m.config.devtools)&&(a=this,u&&((a._devtoolHook=u).emit("vuex:init",a),u.on("vuex:travel-to-state",function(t){a.replaceState(t)}),a.subscribe(function(t,e){u.emit("vuex:mutation",t,e)})))},n={state:{configurable:!0}};function o(e,n){return n.indexOf(e)<0&&n.push(e),function(){var t=n.indexOf(e);-1<t&&n.splice(t,1)}}function i(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var n=t.state;v(t,n,[],t._modules.root,!0),h(t,n,e)}function h(n,t,e){var o=n._vm;n.getters={};var i=n._wrappedGetters,r={};a(i,function(t,e){r[e]=function(){return t(n)},Object.defineProperty(n.getters,e,{get:function(){return n._vm[e]},enumerable:!0})});var s=m.config.silent;m.config.silent=!0,n._vm=new m({data:{$$state:t},computed:r}),m.config.silent=s,n.strict&&n._vm.$watch(function(){return this._data.$$state},function(){},{deep:!0,sync:!0}),o&&(e&&n._withCommit(function(){o._data.$$state=null}),m.nextTick(function(){return o.$destroy()}))}function v(c,n,o,t,i){var e=!o.length,u=c._modules.getNamespace(o);if(t.namespaced&&(c._modulesNamespaceMap[u]=t),!e&&!i){var r=_(n,o.slice(0,-1)),s=o[o.length-1];c._withCommit(function(){m.set(r,s,t.state)})}var a,f,h,p,l,d=t.context=(a=c,h=o,l={dispatch:(p=""===(f=u))?a.dispatch:function(t,e,n){var o=y(t,e,n),i=o.payload,r=o.options,s=o.type;return r&&r.root||(s=f+s),a.dispatch(s,i)},commit:p?a.commit:function(t,e,n){var o=y(t,e,n),i=o.payload,r=o.options,s=o.type;r&&r.root||(s=f+s),a.commit(s,i,r)}},Object.defineProperties(l,{getters:{get:p?function(){return a.getters}:function(){return n=a,i={},r=(o=f).length,Object.keys(n.getters).forEach(function(t){if(t.slice(0,r)===o){var e=t.slice(r);Object.defineProperty(i,e,{get:function(){return n.getters[t]},enumerable:!0})}}),i;var n,o,i,r}},state:{get:function(){return _(a.state,h)}}}),l);t.forEachMutation(function(t,e){var n,o,i,r;o=u+e,i=t,r=d,((n=c)._mutations[o]||(n._mutations[o]=[])).push(function(t){i.call(n,r.state,t)})}),t.forEachAction(function(t,e){var i,n,r,s,o=t.root?e:u+e,a=t.handler||t;n=o,r=a,s=d,((i=c)._actions[n]||(i._actions[n]=[])).push(function(t,e){var n,o=r.call(i,{dispatch:s.dispatch,commit:s.commit,getters:s.getters,state:s.state,rootGetters:i.getters,rootState:i.state},t,e);return(n=o)&&"function"==typeof n.then||(o=Promise.resolve(o)),i._devtoolHook?o.catch(function(t){throw i._devtoolHook.emit("vuex:error",t),t}):o})}),t.forEachGetter(function(t,e){!function(t,e,n,o){if(t._wrappedGetters[e])return;t._wrappedGetters[e]=function(t){return n(o.state,o.getters,t.state,t.getters)}}(c,u+e,t,d)}),t.forEachChild(function(t,e){v(c,n,o.concat(e),t,i)})}function _(t,e){return e.length?e.reduce(function(t,e){return t[e]},t):t}function y(t,e,n){var o;return null!==(o=t)&&"object"==typeof o&&t.type&&(n=e,t=(e=t).type),{type:t,payload:e,options:n}}function p(t){m&&t===m||function(t){if(2<=Number(t.version.split(".")[0]))t.mixin({beforeCreate:n});else{var e=t.prototype._init;t.prototype._init=function(t){void 0===t&&(t={}),t.init=t.init?[n].concat(t.init):n,e.call(this,t)}}function n(){var t=this.$options;t.store?this.$store="function"==typeof t.store?t.store():t.store:t.parent&&t.parent.$store&&(this.$store=t.parent.$store)}}(m=t)}n.state.get=function(){return this._vm._data.$$state},n.state.set=function(t){},e.prototype.commit=function(t,e,n){var o=this,i=y(t,e,n),r=i.type,s=i.payload,a={type:r,payload:s},c=this._mutations[r];c&&(this._withCommit(function(){c.forEach(function(t){t(s)})}),this._subscribers.forEach(function(t){return t(a,o.state)}))},e.prototype.dispatch=function(t,e){var n=this,o=y(t,e),i=o.type,r=o.payload,s={type:i,payload:r},a=this._actions[i];if(a){try{this._actionSubscribers.filter(function(t){return t.before}).forEach(function(t){return t.before(s,n.state)})}catch(t){}return(1<a.length?Promise.all(a.map(function(t){return t(r)})):a[0](r)).then(function(t){try{n._actionSubscribers.filter(function(t){return t.after}).forEach(function(t){return t.after(s,n.state)})}catch(t){}return t})}},e.prototype.subscribe=function(t){return o(t,this._subscribers)},e.prototype.subscribeAction=function(t){return o("function"==typeof t?{before:t}:t,this._actionSubscribers)},e.prototype.watch=function(t,e,n){var o=this;return this._watcherVM.$watch(function(){return t(o.state,o.getters)},e,n)},e.prototype.replaceState=function(t){var e=this;this._withCommit(function(){e._vm._data.$$state=t})},e.prototype.registerModule=function(t,e,n){void 0===n&&(n={}),"string"==typeof t&&(t=[t]),this._modules.register(t,e),v(this,this.state,t,this._modules.get(t),n.preserveState),h(this,this.state)},e.prototype.unregisterModule=function(e){var n=this;"string"==typeof e&&(e=[e]),this._modules.unregister(e),this._withCommit(function(){var t=_(n.state,e.slice(0,-1));m.delete(t,e[e.length-1])}),i(this)},e.prototype.hotUpdate=function(t){this._modules.update(t),i(this,!0)},e.prototype._withCommit=function(t){var e=this._committing;this._committing=!0,t(),this._committing=e},Object.defineProperties(e.prototype,n);var s=b(function(i,t){var n={};return g(t).forEach(function(t){var e=t.key,o=t.val;n[e]=function(){var t=this.$store.state,e=this.$store.getters;if(i){var n=w(this.$store,"mapState",i);if(!n)return;t=n.context.state,e=n.context.getters}return"function"==typeof o?o.call(this,t,e):t[o]},n[e].vuex=!0}),n}),c=b(function(r,t){var n={};return g(t).forEach(function(t){var e=t.key,i=t.val;n[e]=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=this.$store.commit;if(r){var o=w(this.$store,"mapMutations",r);if(!o)return;n=o.context.commit}return"function"==typeof i?i.apply(this,[n].concat(t)):n.apply(this.$store,[i].concat(t))}}),n}),l=b(function(o,t){var i={};return g(t).forEach(function(t){var e=t.key,n=t.val;n=o+n,i[e]=function(){if(!o||w(this.$store,"mapGetters",o))return this.$store.getters[n]},i[e].vuex=!0}),i}),d=b(function(r,t){var n={};return g(t).forEach(function(t){var e=t.key,i=t.val;n[e]=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=this.$store.dispatch;if(r){var o=w(this.$store,"mapActions",r);if(!o)return;n=o.context.dispatch}return"function"==typeof i?i.apply(this,[n].concat(t)):n.apply(this.$store,[i].concat(t))}}),n});function g(e){return Array.isArray(e)?e.map(function(t){return{key:t,val:t}}):Object.keys(e).map(function(t){return{key:t,val:e[t]}})}function b(n){return function(t,e){return"string"!=typeof t?(e=t,t=""):"/"!==t.charAt(t.length-1)&&(t+="/"),n(t,e)}}function w(t,e,n){return t._modulesNamespaceMap[n]}return{Store:e,install:p,version:"3.1.0",mapState:s,mapMutations:c,mapGetters:l,mapActions:d,createNamespacedHelpers:function(t){return{mapState:s.bind(null,t),mapGetters:l.bind(null,t),mapMutations:c.bind(null,t),mapActions:d.bind(null,t)}}}});var glider = (function (exports) {
  'use strict';

  // This gets the Glider options from the URL and from parameters passed
  // Specifically, it gets the flight instanceId, herePlace and the Phase target

  function getGliderOptions() {
    
    let hash = window.location.hash,
        initialize, jumpTarget;
    
    let [flightInstanceId, clientPlace, target] = hash.slice(2).split('/');

    if (target === 'main') {
      initialize = true;
      jumpTarget = null;
    } else {
      initialize = false;
      jumpTarget = target;
    }
    
    return {
      flightInstanceId: flightInstanceId || '0000', // NO MAGIC
      herePlace: clientPlace,
      nowPhase: jumpTarget,
      initialize: initialize
    }
  }

  let PARSING_CONSTANTS = {

    FLIGHT_PLAN_SELECTOR: '.glider-root',

    PART: {
      ID_ATT_NAME: 'id',
      PART_ID_ATT_NAME: 'part-id',
      PART_REF_ATT_NAME: 'part-ref',
      PART_ATT_NAME: 'part',
      TYPE_ATT_NAME: 'part-type',
      VIEW_ATT_NAME: 'part-view',
      OPTIONS_ATT_NAME: 'part-options',
      SELECTOR_PREFIX: 'part-',
      CLASSNAME_PREFIX: 'part-',
      TYPE_VIEW_DELIMITER: '-',
      TYPE_CSS_CLASS_PATTERN: /^part-([^\-\s]+)$/,
      VIEW_CSS_CLASS_PATTERN: /^part-[^\-\s]+-([^\-\s]+)$/,
      DEFAULT_PART_NAME: 'identity',
      DEFAULT_VIEW_NAME: 'defaultView',
      VIEW_UNDEF: 'no-view-defined'
    },

    PHASE: {
      ID_ATT_NAME: 'id',
      TYPE_ATT_NAME: 'phase-type',
      TYPES: { PAR: 'par', SEQ: 'seq', LEAF: 'leaf' },
      DELAY_ATT_NAME: 'phase-begin',
      DURATION_ATT_NAME: 'phase-duration',
      PHASE_DESCENDANT_SELECTOR: '*[phase-type],*[phase-duration],*[phase-begin]'
    },

    PLACE: {
      ID_ATT_NAME: 'place',
      PLACE_ATT_NAME: 'place',
      ROLE_ATT_NAME: 'place-role',
      REGION_ATT_NAME: 'place-region',
      SELECTOR_PREFIX: 'place-',
      CLASSNAME_PREFIX: 'place-',
      ROLE_REGION_DELIMITER: '-', // We define this but don't use it!
      DEFAULT_REGION_NAME: 'defaultRegion'
    }
  };

  // ID and Classname generators

  PARSING_CONSTANTS.PART.GET_CSS_CLASS = (partName, partViewName) => {
    return `${PARSING_CONSTANTS.PART.CLASSNAME_PREFIX}${partName}` 
      + (partViewName 
         ? `${PARSING_CONSTANTS.PART.TYPE_VIEW_DELIMITER}${partViewName}` 
         : '');
  };

  PARSING_CONSTANTS.PART.GET_VUE_COMPONENT_NAME = (partName, partViewName) => {
    return `${partName}-${partViewName}`;
  };

  /*

  OUTLINE

  - Constants used by the parser

  - Utility functions
    - getHash()
    - getIdFromDomPosition()
    
  - Misc parsing functions
    - getPlaceDefinitions()

  - P4V_Data class
    (The data structure that will initialize the PPPPv objects)

  - Register class
    (This object keeps track of "current" Parts, Places, Phases
    as the DOM is parsed)

  - High-level parsing functions 
    (they don't access the DOM directly, but do the high-level
    analysis and recursion)
    - parseFlightPlans()
    - parseFlightPlan()
    - parseDomElem()

  - Data from DOM functions
    (Routines that look at the DOM and pull out the data as
    it relates to PPP definitions. This data is passed back to 
    the high-level parsing functions)
    - getDataFromDomElem(), which calls:
      - getPhaseDataFromDomElem()
      - getPartDataFromDomElem()
      - getPlaceDataFromDomElem()

  - main()
    This is what is exported from the module

  */


  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

  // Utilities

  // Simple hash function adapted from 
  //  https://stackoverflow.com/questions/6122571/simple-non-secure-hash-function-for-javascript
  // NOTE: Can return negative numbers; e.g. hash for 'strign' is -891986113

  function getHash(string) {
    
    let hash = 0;
    
    string.split('').forEach((char) => {
      hash = ((hash << 5) - hash) + char.charCodeAt();
      hash = hash & hash; // Convert to 32bit integer
    });
    
    return Math.abs(hash);
  }

  // Get a unique identifier based on the position of the element in the DOM tree.
  // Good for auto-generating IDs for elements that will be the same across Clients
  // (Currently not used)

  function getIdFromDomPosition(domElement) {
    
    function makeId(domElement) {

      if (domElement === document.body) return ''; // boundary condition

      let previousSiblingCount = 0,
          currSibling = domElement;

      while (currSibling = currSibling.previousSibling) 
        previousSiblingCount++;

      return previousSiblingCount + '.' + makeId(domElement.parentNode);
    }
    
    return getHash(makeId(domElement));
  }


  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // Misc Parsing functions


  function getPlaceDefinitions() {
    
    let placeDefinitions = [];
    
    const toCamelCase = function(dashTerm) { 
      return dashTerm.replace(/-(\w)/gi, (s, letter) => letter.toUpperCase());
    };
    
    document.querySelectorAll('glider-defs > place').forEach(placeDefElem => {
      
      let definitionParameters = {};
      
      Array.from(placeDefElem.attributes).forEach(function(att) {
        definitionParameters[toCamelCase(att.name)] = placeDefElem.getAttribute(att.name);
      });
      
      placeDefinitions.push(definitionParameters);
    });

    // Remove glider-defs element
    // TODO: this is not elegant
  /*
    Array.from(document.getElementsByTagName('glider-defs')).forEach(gliderDef => {
      gliderDef.parentElement.removeChild(gliderDef);
    }); */
    
    return placeDefinitions;
  }


  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // P4V_Data CLASS
  // A mini "database" of Phases, Places, Parts, and Part-Views that
  //  are pulled from the Flightplan markup.
  // This is the object that gets returned from the parser
  //  to initialize Glider

  class P4V_Data {
    
    constructor() {
      
      this.parts = {};
      this.partViews = {};
      this.places = {};
      this.placeDefs = [];
      this.phases = {};
      
      this.rootPhaseId = null;
      
      this.phasesParts = {};
      this.partsPartViews  = {};
      this.placesPartviews = {};
      
      this.phaseChildren = {};
    }
    
    // Enter a new Phase definition in registry

    addPhase(elemData) {

      // Compile definition

      let options = {};

      options.delay = elemData.phase.delay;
      // options.duration = elemData.phase.duration;
      options.id = elemData.phase.id;

      // If duration is unspecified, then make it infinitely long
      
      if (elemData.phase.hasDuration) {
        options.duration = elemData.phase.duration;
      } else {
        options.duration = Number.POSITIVE_INFINITY;
      }
      
      // Set Phase type -- seq, par, or leaf

      let type,
          hasChildren = (elemData.domNode.children.length > 0),
          noPartDefined = ! elemData.part.type;

      if (elemData.phase.hasType) { // Phase type explicitly declared in markup
        type = elemData.phase.type;
      } else if (noPartDefined && hasChildren) { // HTML elements with children
        type = 'par';
      } else if (elemData.phase.hasNoPhaseDescendents) {
        type = 'leaf';
      } else { // Default -- this is the case for all DOM elements that have children
               //  whether they are explicit Phases or not
        type = 'par'; 
      }
      
      // Save this Phase in registry if it's new
      
      let optionsWithType = Object.assign({}, options, { type: type });
      
      if (this.phases[options.id] === undefined) {
        this.phases[options.id] = optionsWithType; 
      }

      return options;
    }
    
    setRootPhase(rootPhase) {
      this.rootPhaseId = rootPhase.id; 
    }
    
    createParentChildPhaseRelationship(parentPhase, childPhase) {
      if (this.phaseChildren[parentPhase.id] === undefined) {
        this.phaseChildren[parentPhase.id] = [];
      }
      
      this.phaseChildren[parentPhase.id].push(childPhase.id);
    }
    
    // Enter a new Part definition in registry

    addPart(elemData) {
      
      console.log("ADDING PART");
      console.log(elemData);
      
      // Compile definition
      
      let options = {
        id: elemData.part.id,
        type: elemData.part.type === undefined 
          ? PARSING_CONSTANTS.PART.DEFAULT_PART_NAME 
          : elemData.part.type,
        options: elemData.part.options,
        container: elemData.part.container
      };
      
      // TODO: Check this
      // If an HTML element, need to keep Place information
      // (maybe in the end we should create the PartView here as well -- think on this)
      
      // THIS SHOULD STORE THE PLACE ID
      
      //if (options.type === PARSING_CONSTANTS.PART.DEFAULT_PART_NAME) {
        
        if (elemData.place.hasRole || elemData.place.hasRegion) {
          options.place = this.makePlaceId(elemData.place.role, elemData.place.region);        
          console.log('Identity Part parsed: need to add Place info');
          console.log(options);
        }
        
      // }

      // Save this Part in registry if it's new
      
      if (this.parts[options.id] === undefined) {
        this.parts[options.id] = options; 
      }
      
      return options;
    }
    
    // Enter a new PartView definition in registry

    addPartView(p4vRegister) {

      console.log("ADDING PART VIEW");
      console.log(p4vRegister);
      
      let partViewName = (p4vRegister.partView.name === undefined)
        ? PARSING_CONSTANTS.PART.DEFAULT_PARTVIEW_NAME 
        : p4vRegister.partView.name;
      
      // Compile definition
      
      let options = {
        partId: p4vRegister.part.id,
        id: `pv-${p4vRegister.part.id}-${partViewName}`, // TODO: NO MAGIC VALUES!
        name: partViewName,
        container: p4vRegister.partView.container
      };
      
      // Save this PartView in registry if it's new
      
      if (this.partViews[options.id] === undefined) {
        this.partViews[options.id] = options; 
      }
      
      return options;
    }
    
    addDefaultPartViewToView(partId) {
      
      console.log("ADDING DEFAULT PART VIEW");
      
      // Compile definition

      let options = {
        partId: partId,
        id: `pv-${partId}-${PARSING_CONSTANTS.PART.DEFAULT_VIEW_NAME}`, // TODO: NO MAGIC VALUES!
        name: PARSING_CONSTANTS.PART.DEFAULT_VIEW_NAME,
        container: this.parts[partId].container
      };
      
      // Save this PartView in registry if it's new
      
      if (this.partViews[options.id] === undefined) {
        this.partViews[options.id] = options; 
      }
      
      return options;
    }
    


    // TODO: this should be in a place where all the other 
    //  IDs are minted -- maybe off of PARSING_CONSTANTS?
    
    makePlaceId(role, region) {
      
      if (region === undefined) {
        region = PARSING_CONSTANTS.PLACE.DEFAULT_REGION_NAME; 
      }
      
      return `pl-${role}-${region}`
    }
    
    // Enter a new Place definition in registry
    
    addPlace(elemData) {

      // Compile definition
      
      let placeRole = elemData.place.role,
          placeRegion = elemData.place.region === undefined 
            ? PARSING_CONSTANTS.PLACE.DEFAULT_REGION_NAME
            : elemData.place.region;
      
      let options = {
        id: this.makePlaceId(placeRole, placeRegion),
        // id: `pl-${placeRole}-${placeRegion}`, // TODO: this should be a function off of PARSING_CONSTANTS
        role: placeRole,
        region: placeRegion
      };
      
      // Save this Place in registry if it's new
      
      if (this.places[options.id] === undefined) {
        this.places[options.id] = options; 
      }
      
      return options;
    }
    
    associatePartWithPhase(p4vReg) {
      
      let phaseId = p4vReg.phase.id;
      
      if (this.phasesParts[phaseId] === undefined) {
        this.phasesParts[phaseId] = [];
      }
      
      this.phasesParts[phaseId].push(p4vReg.part.id);
      
      console.log(`Setting Part ${p4vReg.part.id} to Phase ${phaseId}`);
    }
    
    associatePartWithPartView(p4vReg) {
      
      let partId = p4vReg.part.id,
          partViewId = p4vReg.partView;
      
      if (this.partsPartViews[partId] === undefined) {
        this.partsPartViews[partId] = [];
      }
      
      this.partsPartViews[partId].push(partViewId);
      
      console.log(`Setting PartId ${partId} to PartViewId ${partViewId}`);
    }
    
    associatePartViewWithPlace(p4vReg) {
      
      let partId = p4vReg.part.id,
          partViewName = p4vReg.partView.name,
          placeId = p4vReg.place.id;
      
      if (this.placesPartviews[placeId] === undefined) {
        this.placesPartviews[placeId] = []; 
      }
      
      this.placesPartviews[placeId].push(`pv-${partId}-${partViewName}`);
      
      console.log(`Setting PartView ${partViewName} belonging to Part ${partId} to Place ${p4vReg.place.id}`);
    }
    
    addPlaceDefs(placeDefs) {
       this.placeDefs = this.placeDefs.concat(placeDefs);
    }
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // REGISTER CLASS
  // A data structure that represents the state of Phases/Places/Parts/PartViews
  //  for the current element being parsed. 
  // Can save its state to the P4V_Data data structure for export to the rest of Glider.

  class PPP_Register {

    constructor (options) {
      this.app = options.app;
      this.part = options.part;
      this.partView = options.partView;
      this.place = options.place;
      this.phase = options.phase;
      
      this.place.roleNotSet = (this.place.role === undefined);
    }

    get state() {
      return {
        app: this.app,
        part: this.part,
        place: this.place,
        partView: this.partView,
        partViewContainer: this.partViewContainer,
        phase: this.phase
      }
    }

    // Return a new register with updated options

    updateAndCopy(stateUpdate) {
      let newState = Object.assign(this.state, stateUpdate);
      return new PPP_Register(newState);
    }

    // Change some aspect of the register and return an 
    //  updated copy

    changePartTo(part) { 
      return this.updateAndCopy({ part: part });
    }

    changePartViewTo(partViewName, partViewDomElemContainer) {
      console.log(`CHANGING PART-VIEW FROM: ${this.partView.name} TO: ${partViewName}`);
      return this.updateAndCopy({ 
        partView: { name: partViewName, container: partViewDomElemContainer }
      });
    }
    
    changePlaceTo(place) { 
      console.log("CHANGING PLACE TO: ");
      console.log(place);
      return this.updateAndCopy({ place: place });
    }

    changePhaseTo(phase) { 
      return this.updateAndCopy({ phase: phase });
    }

    copy() {
      return this.updateAndCopy({});
    }

    // Save register to P4V_Data store

    save() {

      this.app.associatePartWithPhase(this);

      if (this.partView !== PARSING_CONSTANTS.PART.VIEW_UNDEF 
          && this.partView !== undefined) {
        this.app.addPartView(this);
        this.app.associatePartWithPartView(this);
        this.app.associatePartViewWithPlace(this);
      }
    }
  }


  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // PARSING FUNCTIONS

  // Find all FlightPlans on page and parse each with parseFlightPlan()
  //  Returns an array of App objects
  //  (This allows for separate Flights on a single page, which may or may not
  //    prove useful)

  function parseFlightPlans(domRoot) {

    let flightPlanDomRoots = Array.from(
      domRoot.querySelectorAll(PARSING_CONSTANTS.FLIGHT_PLAN_SELECTOR)
    );

    // If none found, assume the DOM element passed _is_ the FlightPlan root

    if (flightPlanDomRoots.length === 0) {

      console.log(`No flight plan root declared: using ${domRoot.id}`);

      // If body element, then create a child div and make that the
      //  Glider root (Vue can't use body)

      // TODO: THIS DOESN'T BELONG IN A PARSER -- THIS MARKUP MODIFICATION
      //  SHOULD BE DONE PRIOR TO PARSING

      let gliderRoot;

      if (domRoot === document.body) {
        gliderRoot = document.createElement('div');
        if (domRoot.attributes['phase-type']) {
          gliderRoot.setAttribute(
            'phase-type', 
            domRoot.getAttribute('phase-type')
          );
        }
        while (domRoot.firstChild) { 
          gliderRoot.appendChild(domRoot.firstChild);
        }
        document.body.appendChild(gliderRoot);
      } else {
        gliderRoot = domRoot;
      }

      gliderRoot.classList.add('glider-root'); // TODO: NO MAGIC
      gliderRoot.setAttribute('id', 'glider-root'); // TODO: how to handle if there's an existing @id ?
      // TODO: Vue uses #glider-root, this area uses .glider-root -- which is it?
      flightPlanDomRoots = [gliderRoot];
    }

    // Parse each FlightPlan and gather data in an array

    let p4vData_all = flightPlanDomRoots.map(
      flightPlanDomRoot => parseFlightPlan(flightPlanDomRoot)
    );

    return p4vData_all;
  }

  // Parse a FlightPlan root
  //  Create an App object, initialize a PPP Register
  //  Recurse into child DOM elements
  //  Return the App object

  function parseFlightPlan(domElem) { 

    let p4vData = new P4V_Data(),
        elemData = getDataFromDomElem(domElem),
        initPart, initPlace, initPhase;

    // Initialize p4vData with place information
    
    p4vData.addPlaceDefs(getPlaceDefinitions());
    
    // Create root Phase object (seq unless specified otherwise)

    // let newPhaseType = (elemData.phase.type === 'par') ? 'par' : 'seq'; 
    if (elemData.phase.type !== 'par') {
      elemData.phase.type = 'seq';
    }
    
    initPhase = p4vData.addPhase(elemData);

    // Create root Part object
    
    initPart = { id: 'rootPart' }; // TODO: KLUDGE

    // Create root Place object
    // TODO (Patrick): This should probably be an 'all' Place
    //  i.e. ROLE=undefined, and REGION=UNDEFINED

    initPlace = { id: 'rootPlace', role: "_undefined1", region: undefined }; // TODO: KLUDGE

    // Create initial PPPRegister

    let pppRegister_init = new PPP_Register({
      app: p4vData,
      part: initPart,
      partView: PARSING_CONSTANTS.PART.VIEW_UNDEF,
      place: initPlace,
      phase: initPhase
    });

    // Save this to to the P4V_Data store - and set root Phase

    pppRegister_init.save();
    p4vData.setRootPhase(initPhase);

    // Recurse to children by passing them to parseDomElem()

    let forceNewPhase = true;

    Array.from(domElem.children).forEach(
      childElem => parseDomElem(childElem,  pppRegister_init, forceNewPhase)
    );
    
    // Cleanup data
    
    // Add DefaultView IFF there is a Part with no associated View
    
    Object.keys(p4vData.parts)
      .filter(partId => p4vData.partsPartViews[partId] === undefined)
      .forEach(partWithNoViewId => p4vData.addDefaultPartViewToView(partWithNoViewId));
    
    // Add default place for Views that have none specified

    /*
    Object.keys(p4vStore.partViews)
      .filter(partViewId => p4vStore.partsPartViews[partViewId] === undefined)
      .forEach(partWithNoViewId => p4vStore.addDefaultPartViewToView(partWithNoViewId));
    */

    return p4vData;
  }

  // This is the main parsing function for non-root DOM elements.
  // Checks to see if there's a change in PPP

  function parseDomElem(domElem, pppRegister, forceNewPhase = false, isChildOfPart = false) { 

    if (domElem.tagName === 'GLIDER-DEFS') return; // Do not parse if the glider-defs element

    let elemData = getDataFromDomElem(domElem),
      pppRegister_new = pppRegister.copy(),
      registerChanged = false,
      tellChildrenTheyHaveAPartParent = false,
      forceChildrenToHaveNewPhase;

    console.log('DOM ELEMENT PARSED: ' + elemData.domNode.id);
    console.log(elemData.part);  
    
    // If a Part definition, create new and update register

    // If this is the direct child of a Part
    //   AND if it also defines a new PartView, 
    //     then set it to the PartView indicated in the markup
    //   OTHERWISE, set the register PartView to the default view -- DISABLED
    
    const partViewImplicitlyDeclared = isChildOfPart;

    if (partViewImplicitlyDeclared) {

      if (elemData.part.definesNewPartView) {
        let newPartViewName = elemData.part.view;
        pppRegister_new = pppRegister_new.changePartViewTo(newPartViewName, domElem);
      } // else { // DISABLED, FOR NOW
        // pppRegister_new = pppRegister_new.changePartViewTo(
        //  PARSING_CONSTANTS.PART.PART_DEFAULT_VIEW_NAME, domElem
        // )
        // }

      registerChanged = true;
    }

    // Conditions for defining a new Part:
    //  Either the markup explicitly declares a new Part OR
    //   it defines a new Phase which requires a Part to reference
    //   (which is always the case with Phase children of Container Phases)
    // Ignore Part definition if also defines a PartView
    //  (NOTE: this may be changed in the future)

    const newPartExplicitlyDeclared = (elemData.part.definesNewPart && ! isChildOfPart),
      newPartImplicityDeclared = (elemData.phase.definesNewPhase || forceNewPhase);

    if (newPartImplicityDeclared) { // NOTIFICATION MESSAGE
      console.log(`NEW PART IMPLICITLY DECLARED FOR ${elemData.domNode.id} because 
    elemData.phase.definesNewPhase = ${elemData.phase.definesNewPhase} OR 
    forceNewPhase = ${forceNewPhase}`);
    }
    
    if (! elemData.part.definesNewPartView && 
        (newPartExplicitlyDeclared || newPartImplicityDeclared) ) {
      
      let newPart = pppRegister.app.addPart(elemData);
      pppRegister_new = pppRegister_new.changePartTo(newPart);

      registerChanged = true;
      tellChildrenTheyHaveAPartParent = true;
    }

  /*
    if (elemData.part.definesNewPart || elemData.part.definesNewPartView) {
      let newPart = getNewPart(elemData, pppRegister.app);
      pppRegister_new = pppRegister_new.changePartTo(newPart)
        .changePartViewTo(newPart);
      registerChanged = true;
    } */

    // If a change of Place Role or Region, create new and update register
    //   Check if Role is defined in the DOM; update Role in PPPRegister, but
    //     only if it is currently undefined

    if (elemData.place.hasRole || elemData.place.hasRegion) {

      // If the role hasn't already been determined (in an ancestor)
      // AND the role is defined in the current element, then
      // use that new role

      let newPlaceRole;
      
      if (elemData.place.hasRole) {
        newPlaceRole = elemData.place.role;
      } else {
        newPlaceRole = pppRegister.place.role;
      }

      let newPlaceRegion = elemData.place.region,
          newPlaceElemData = Object.assign({}, elemData, { place: { role: newPlaceRole, region: newPlaceRegion }});
      
      // let newPlace = getNewPlace(elemData, pppRegister.app);

      // Add place to P4v data structure
      
      let newPlace = pppRegister.app.addPlace(newPlaceElemData); 

      pppRegister_new = pppRegister_new.changePlaceTo(newPlace);
      registerChanged = true;
    }
    
    // If a change of Phase (i.e. explicitly declared in markup)
    //   or forced to create a new Phase (because this is the child of a par or seq),
    //   or has child elements (which defaults to a PAR container)
    // then create new Phase and update register

    /*
    
    CHANGE: Can't have new Phase if also defines a PartView.
    Need to throw a warning if a Phase is being forced and there's a PartView definition
    (e.g. if the Parent part also has a SEQ/PAR definition on it)
    
    */
    
    if (elemData.part.definesNewPartView && forceNewPhase) {
      console.warn(`Element ${elemData.domNode.id}: 
                  Can't have a new Phase and PartView defined on the same element. New Phase ignored.`); 
    }
    
    let hasChildren = (elemData.domNode.children.length > 0);
    
    if (! elemData.part.definesNewPartView && 
        (elemData.phase.definesNewPhase || forceNewPhase || hasChildren)) {

      let parentPhase = pppRegister.phase,
        //newPhaseOptions = getPhaseConstructorOptionsFromElemData(elemData),
        //newPhase = Phase.createType(newPhaseOptions.type, newPhaseOptions);
        // newPhase = getNewPhase(elemData, pppRegister.app);
        newPhase = pppRegister.app.addPhase(elemData);

      console.log("CREATING NEW PHASE ID: " + newPhase.id);
      
      pppRegister.app.createParentChildPhaseRelationship(parentPhase, newPhase);
      // parentPhase.addChild(newPhase); // New Phase is child of parent
    
      pppRegister_new = pppRegister_new.changePhaseTo(newPhase);
      registerChanged = true;
    }

    // If register has changed, save this PPP coordinate

    if (registerChanged) {
      pppRegister_new.save();
    }

    // Force children to have new Phases if this is a container Phase
    //  OR if this element has children (defaults to PAR)
    
    forceChildrenToHaveNewPhase = (
      hasChildren ||
      (elemData.phase.definesNewPhase && elemData.phase.isContainer) 
    );
    
    // Parse child elements

    Array.from(domElem.children).forEach(
      child => parseDomElem(
        child, 
        pppRegister_new, 
        forceChildrenToHaveNewPhase, 
        tellChildrenTheyHaveAPartParent
      )
    );
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // DATA-FROM-DOM FUNCTIONS
  // These functions extract the information from the markup and
  //  return a data structure for further parsing.
  // The idea is that if it ain't in the markup, it's not dealt with
  //  here.

  function getDataFromDomElem(domElem) {

    let phaseData = getPhaseDataFromDomElem(domElem),
      partData = getPartDataFromDomElem(domElem),
      placeData = getPlaceDataFromDomElem(domElem);

    // tested to this point
    // console.log(`PlaceData is ${placeData.id}`);

    return {
      domNode: domElem,
      part: partData,
      place: placeData,
      phase: phaseData
    }
  }

  // DATA-FROM-DOM FUNCTIONS: Phase

  function getPhaseDataFromDomElem(domElem) {

    function getPhaseIdFromDomElem(domElem) {
      return domElem.getAttribute(PARSING_CONSTANTS.PHASE.ID_ATT_NAME);
    }

    function getPhaseTypeFromDomElem(domElem) {
      return domElem.getAttribute(PARSING_CONSTANTS.PHASE.TYPE_ATT_NAME);
    }

    function getDelayFromDomElem(domElem) {
      let delayAttValue = domElem.getAttribute(PARSING_CONSTANTS.PHASE.DELAY_ATT_NAME);
      return (delayAttValue !== null) ? normalizeTimeToMS(delayAttValue) : null;
    }

    function getDurationFromDomElem(domElem) {
      let durationAttValue = domElem.getAttribute(PARSING_CONSTANTS.PHASE.DURATION_ATT_NAME);
      return (durationAttValue !== null) ? normalizeTimeToMS(durationAttValue) : null;
    }

    // Given a duration as string, return a float normalized to milliseconds
    //  (currently only handles ms and s)

    function normalizeTimeToMS(timeString) {

      let msMatch = timeString.match(/^\s*([\d\.]+)\s*ms\s*$/i);
      if (msMatch !== null) 
        return parseFloat(msMatch[1]);

      let sMatch = timeString.match(/^\s*([\d\.]+)\s*s\s*$/i);
      if (sMatch !== null) 
        return parseFloat(sMatch[1]) * 1000;

      return parseFloat(timeString);
    }

    // Does this domElem have any ancestors that defined Phases?

    function elemHasNoPhaseDescendents(domElem) {
      let descendantPhases = domElem.querySelectorAll(
        PARSING_CONSTANTS.PHASE.PHASE_DESCENDANT_SELECTOR
      );
      
      return (descendantPhases.length === 0);
    }

    // Get Phase data from DOM

    let dur = getDurationFromDomElem(domElem),
        delay = getDelayFromDomElem(domElem),
        specifiedId = getPhaseIdFromDomElem(domElem),
        id = (specifiedId !== null) 
              ? specifiedId 
              : 'ph' + getIdFromDomPosition(domElem),
        phaseType = getPhaseTypeFromDomElem(domElem);

    // Compile data object

    let phaseData = { 
      id: id,
      hasId: (id !== null),
      duration: dur,
      hasDuration: (dur !== null),
      delay: delay,
      hasDelay: (delay !== null),
      hasNoPhaseDescendents: elemHasNoPhaseDescendents(domElem),
      type: phaseType,
      hasType: (phaseType !== null),
      isContainer: (phaseType === 'par' || phaseType === 'seq')
    };

    phaseData.definesNewPhase = (phaseData.hasDuration || phaseData.hasDelay || phaseData.hasType);

    return phaseData;
  }

  // DATA-FROM-DOM FUNCTIONS: Parts

  function getPartDataFromDomElem(domElem) {

    // Check the immediate children of domElem to
    //  see if they define View(s). 
    // Returns False if there are no Views defined; 
    //  True otherwise
    // DISABLED FOR NOW

    /*
    function checkIfHasChildViews(domElem) {
      return Array.from(domElem.children).some(childElem => {
        return (getPartTypeView(childElem).view !== undefined)
      });
    } */
    
    // Routines for extracting PartView names from DOM

    function getPartTypeViewFromString(identifierString) {

      let partTypeViewData = {};

      let parsedTypeViewData = identifierString
        .replace(RegExp(`^${PARSING_CONSTANTS.PART.SELECTOR_PREFIX}`), '')
        .split(PARSING_CONSTANTS.PART.TYPE_VIEW_DELIMITER);

      if (parsedTypeViewData[0] !== undefined) {
        partTypeViewData.type = parsedTypeViewData[0];
      }

      if (parsedTypeViewData[1] !== undefined) {
        partTypeViewData.view = parsedTypeViewData[1];
      }
      
      return partTypeViewData;
    }

    function getPartTypeViewFromPartAttribute(domElem) {
      let attString = domElem.getAttribute(PARSING_CONSTANTS.PART.PART_ATT_NAME);

      return (attString !== null)
        ? getPartTypeViewFromString(attString)
        : {};
    }

    function getPartTypeViewFromPartTypeViewAttributes(domElem) {

      let partTypeViewData = {},
        partTypeAtt = domElem.getAttribute(PARSING_CONSTANTS.PART.TYPE_ATT_NAME),
        partViewAtt = domElem.getAttribute(PARSING_CONSTANTS.PART.VIEW_ATT_NAME);

      if (partTypeAtt !== null) {
        partTypeViewData.type = partTypeAtt;
      }
      
      if (partViewAtt !== null) {
        partTypeViewData.view = partViewAtt;
      }

      return partTypeViewData;
    }

    function getPartTypeViewFromClassname(domElem) {

      let partClassname = Array.from(domElem.classList).find(
        className => className.startsWith(PARSING_CONSTANTS.PART.CLASSNAME_PREFIX)
      );

      let partTypeViewData;

      if (partClassname !== undefined) {
        partTypeViewData = getPartTypeViewFromString(
          partClassname.slice(PARSING_CONSTANTS.PART.CLASSNAME_PREFIX.length)
        );
      } else {
        partTypeViewData = {};
      }

      return partTypeViewData;
    }

    // Returns a data structure { part: <PART TYPE NAME>, view: <VIEW_NAME> }
    
    function getPartTypeView(domElem) {
      return Object.assign({},
        getPartTypeViewFromClassname(domElem),
        getPartTypeViewFromPartAttribute(domElem),
        getPartTypeViewFromPartTypeViewAttributes(domElem)
      );
    }

    function getPartIdFromDomElem(domElem) {

      let id,
        plainId = domElem.getAttribute(PARSING_CONSTANTS.PART.ID_ATT_NAME),
        partId = domElem.getAttribute(PARSING_CONSTANTS.PART.PART_ID_ATT_NAME),
        partRefId = domElem.getAttribute(PARSING_CONSTANTS.PART.PART_REF_ATT_NAME);
      
      if (partId != null) {
        id = partId;
      } else if (plainId != null) {
        id = plainId.replace(/^#/, '');
      } else if (partRefId != null) {
        id = partRefId;
      } else {
        id = undefined;
      }

      return id;
    }

    // TODO: This is an (insecure) kludge -- see 
    //  getPartOptionsFromDomElem_TODO for the proper solution

    function getPartOptionsFromDomElem(domElem) {

      const optionsString = domElem.getAttribute(PARSING_CONSTANTS.PART.OPTIONS_ATT_NAME);

      let optionsData;

      if (optionsString !== null && optionsString !== '') {

        const BRACES = /^\s*\{|\}\s*$/g;

        const evalString = "(function() { return {" 
          + optionsString.replace(BRACES, '')
          + "} })()";

        optionsData = eval(evalString);
        
      } else {
        optionsData = {};
      }

      return optionsData;
    }

    // Get Part data from DOM
    // note: Cannot create a Part and PartView in the same element

    let id = getPartIdFromDomElem(domElem),
      partTypeView = getPartTypeView(domElem),
      options = getPartOptionsFromDomElem(domElem),
      partContainer = domElem,
      definesNewPartView = (partTypeView.view !== undefined),
      definesNewPart = (partTypeView.type !== undefined && ! definesNewPartView);
      // hasChildViews = checkIfHasChildViews(domElem);

    return {
      type: partTypeView.type,
      view: partTypeView.view,
      id: id,
      hasId: (id !== undefined),
      options: options,
      container: partContainer,
      definesNewPart: definesNewPart,
      definesNewPartView: definesNewPartView,
      // hasChildViews: hasChildViews
    }
  }

  // DATA-FROM-DOM FUNCTIONS: Places temp from Joel. 
  // #ToDo Still need to figure out how this Place data gets to App.js
  // #ToDo does every phase need place defined? Probably, right?

  function getPlaceDataFromDomElem(domElem) {

    // Given a string (e.g. place-red-green) return a 
    //  data structure (e.g. { role: 'red', region: 'green' })

    function getRoleRegionFromString(identifierString) {

      let roleRegionData = {};

      let parsedRoleRegion = identifierString
        .replace(RegExp(`^${PARSING_CONSTANTS.PLACE.SELECTOR_PREFIX}`), '')
        .split(PARSING_CONSTANTS.PLACE.ROLE_REGION_DELIMITER);

      if (parsedRoleRegion[0] !== undefined)
        roleRegionData.role = parsedRoleRegion[0];
        
      if (parsedRoleRegion[1] !== undefined)
        roleRegionData.region = parsedRoleRegion[1];

      return roleRegionData;
    }

    function getPlaceFromPlaceAttribute(domElem) {

      let attString = domElem.getAttribute(PARSING_CONSTANTS.PLACE.PLACE_ATT_NAME);

      return (attString !== null) 
        ? getRoleRegionFromString(attString) 
        : {};
    }

    function getPlaceFromRoleRegionAttributes(domElem) {

      let roleRegionData = {},
        roleAtt = domElem.getAttribute(PARSING_CONSTANTS.PLACE.ROLE_ATT_NAME),
        regionAtt = domElem.getAttribute(PARSING_CONSTANTS.PLACE.REGION_ATT_NAME);

      if (roleAtt !== null) 
        roleRegionData.role = roleAtt;
      if (regionAtt !== null) 
        roleRegionData.region = regionAtt;

      return roleRegionData;
    }

    function getPlaceFromClassname(domElem) {

      let placeClassname = Array.from(domElem.classList).find(
        className => className.startsWith(PARSING_CONSTANTS.PLACE.CLASSNAME_PREFIX)
      );

      let roleRegionData = (placeClassname !== undefined)
        ? getRoleRegionFromString(placeClassname)
        : {};

      return roleRegionData;
    }

    // Collect the { role: <str>, region: <str> } data structures
    //  from attributes and/or classnames and merge them in order of 
    //  precedence (from lowest to highest)

    let placeData = Object.assign( {},
      getPlaceFromClassname(domElem),
      getPlaceFromPlaceAttribute(domElem),
      getPlaceFromRoleRegionAttributes(domElem)
    );

    placeData.hasRole = (placeData.role !== undefined);
    placeData.hasRegion = (placeData.region !== undefined);

    return placeData;
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // Main -- call parseFlightPlans on DOM load
  // Currently only deals with the first Flight on the page

  function main() {
    
    // Put ID's on all elements in body (for now)
    // These IDs map to P4V IDs, for easy cross-checking
    
    document.body.querySelectorAll('*').forEach(elem => {
      if (elem.getAttribute('id') === null) {
        elem.setAttribute('id', `g${getIdFromDomPosition(elem)}`);
      }
    });
    
    // Return the p4v data object (Class P4V_Data)
    
    let p4vDataArr = parseFlightPlans(document.body);

    if (p4vDataArr.length > 0) {
      return p4vDataArr[0];
    } else {
      return null; 
    }
  }

  function init(options) {
    firebase.initializeApp(options); 
  }

  // Given a Flight ID, delete all the remote state
  // NOTE: this is not good, as remove() is async
  // This should be done elsewhere

  // see https://stackoverflow.com/questions/45054550/firebase-database-how-to-perform-a-prefix-wildcard-query

  function deleteFlightEntries(flightInstanceId) {
    console.log(`REMOVING REMOTE FLIGHT INSTANCE VARIABLES FROM _${flightInstanceId}`);
    firebase.database().ref().orderByKey().startAt(`_${flightInstanceId}`)
    .once('value', function(snapshot) {
      // firebase.database().ref().child(snapshot.key).remove();
      console.log(`> REMOVING ${snapshot.key}`); 
    });
  }

  // Set up listener: if a value changes on the shared store, 
  //  then update the local

  // Also: set up the variable in FB if doesn't currently exist
  // TODO: should this be renamed initRemotePartVariables()?

  function listenForChanges(partVarId, localStoreUpdateCallback, initValue) { 

    const remoteVarEntry = firebase.database().ref().child(partVarId);
    
    // If var doesn't exist in FireBase, then initialize
    
    remoteVarEntry.once('value')
      .then(function(remoteVarEntryValue) {
      
        if (! remoteVarEntryValue.exists()) {
          console.log(`> INIT VAL: ${partVarId} = ${initValue}`);
          remoteVarEntry.set(initValue);
        }
      });
    
    // Assign listener for change
    
    remoteVarEntry.on('value', function(snapshot) {
      let remoteVarEntryValue = snapshot.val();
      console.log(`FIREBASE VARIABLE ${partVarId} CHANGED TO ${remoteVarEntryValue} --> updating local`);
      localStoreUpdateCallback(snapshot.val());
    }); 
  }
  // Get the values on the remote store for this flight instance

  function getFlightInstanceStore() {

    var ref = firebase.database().ref();
    /*
    ref.once('value')
      .then(function(snapshot) {
        console.log('REMOTE STORE DUMP');
        console.log(snapshot.exportVal());
      }); */
    
    return ref.once('value'); // Return a Promise
  }

  // Update the value on the remote store

  function setVal(partVarId, value) {
    console.log(`FIREBASE SET VALUE OF ${partVarId} TO ${value}`);
    if (firebase.database().ref().child(partVarId) !== value) {
      firebase.database().ref().child(partVarId).set(value);
    }
  }

  function getRemoteStore(initOptions) {
    
    init(initOptions);  
    
    /*
    return { // TEMP TURN OFF FB
      listenForChanges: function () {},
      set: function () {}
    } */
    
    return {
      listenForChanges: listenForChanges,
      set: setVal,
      getFlightState: getFlightInstanceStore(),
      deleteFlightEntries: deleteFlightEntries
    }
  }

  /**
   * lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright jQuery Foundation and other contributors <https://jquery.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */

  /** Used as the size to enable large array optimizations. */
  var LARGE_ARRAY_SIZE = 200;

  /** Used to stand-in for `undefined` hash values. */
  var HASH_UNDEFINED = '__lodash_hash_undefined__';

  /** Used to compose bitmasks for comparison styles. */
  var UNORDERED_COMPARE_FLAG = 1,
      PARTIAL_COMPARE_FLAG = 2;

  /** Used as references for various `Number` constants. */
  var MAX_SAFE_INTEGER = 9007199254740991;

  /** `Object#toString` result references. */
  var argsTag = '[object Arguments]',
      arrayTag = '[object Array]',
      boolTag = '[object Boolean]',
      dateTag = '[object Date]',
      errorTag = '[object Error]',
      funcTag = '[object Function]',
      genTag = '[object GeneratorFunction]',
      mapTag = '[object Map]',
      numberTag = '[object Number]',
      objectTag = '[object Object]',
      promiseTag = '[object Promise]',
      regexpTag = '[object RegExp]',
      setTag = '[object Set]',
      stringTag = '[object String]',
      symbolTag = '[object Symbol]',
      weakMapTag = '[object WeakMap]';

  var arrayBufferTag = '[object ArrayBuffer]',
      dataViewTag = '[object DataView]',
      float32Tag = '[object Float32Array]',
      float64Tag = '[object Float64Array]',
      int8Tag = '[object Int8Array]',
      int16Tag = '[object Int16Array]',
      int32Tag = '[object Int32Array]',
      uint8Tag = '[object Uint8Array]',
      uint8ClampedTag = '[object Uint8ClampedArray]',
      uint16Tag = '[object Uint16Array]',
      uint32Tag = '[object Uint32Array]';

  /**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */
  var reRegExpChar = /[\\^$.*+?()[\]{}|]/g;

  /** Used to detect host constructors (Safari). */
  var reIsHostCtor = /^\[object .+?Constructor\]$/;

  /** Used to detect unsigned integer values. */
  var reIsUint = /^(?:0|[1-9]\d*)$/;

  /** Used to identify `toStringTag` values of typed arrays. */
  var typedArrayTags = {};
  typedArrayTags[float32Tag] = typedArrayTags[float64Tag] =
  typedArrayTags[int8Tag] = typedArrayTags[int16Tag] =
  typedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =
  typedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =
  typedArrayTags[uint32Tag] = true;
  typedArrayTags[argsTag] = typedArrayTags[arrayTag] =
  typedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =
  typedArrayTags[dataViewTag] = typedArrayTags[dateTag] =
  typedArrayTags[errorTag] = typedArrayTags[funcTag] =
  typedArrayTags[mapTag] = typedArrayTags[numberTag] =
  typedArrayTags[objectTag] = typedArrayTags[regexpTag] =
  typedArrayTags[setTag] = typedArrayTags[stringTag] =
  typedArrayTags[weakMapTag] = false;

  /** Detect free variable `global` from Node.js. */
  var freeGlobal = typeof global == 'object' && global && global.Object === Object && global;

  /** Detect free variable `self`. */
  var freeSelf = typeof self == 'object' && self && self.Object === Object && self;

  /** Used as a reference to the global object. */
  var root = freeGlobal || freeSelf || Function('return this')();

  /** Detect free variable `exports`. */
  var freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;

  /** Detect free variable `module`. */
  var freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;

  /** Detect the popular CommonJS extension `module.exports`. */
  var moduleExports = freeModule && freeModule.exports === freeExports;

  /** Detect free variable `process` from Node.js. */
  var freeProcess = moduleExports && freeGlobal.process;

  /** Used to access faster Node.js helpers. */
  var nodeUtil = (function() {
    try {
      return freeProcess && freeProcess.binding('util');
    } catch (e) {}
  }());

  /* Node.js helper references. */
  var nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;

  /**
   * A specialized version of `_.some` for arrays without support for iteratee
   * shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {boolean} Returns `true` if any element passes the predicate check,
   *  else `false`.
   */
  function arraySome(array, predicate) {
    var index = -1,
        length = array ? array.length : 0;

    while (++index < length) {
      if (predicate(array[index], index, array)) {
        return true;
      }
    }
    return false;
  }

  /**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */
  function baseTimes(n, iteratee) {
    var index = -1,
        result = Array(n);

    while (++index < n) {
      result[index] = iteratee(index);
    }
    return result;
  }

  /**
   * The base implementation of `_.unary` without support for storing metadata.
   *
   * @private
   * @param {Function} func The function to cap arguments for.
   * @returns {Function} Returns the new capped function.
   */
  function baseUnary(func) {
    return function(value) {
      return func(value);
    };
  }

  /**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */
  function getValue(object, key) {
    return object == null ? undefined : object[key];
  }

  /**
   * Checks if `value` is a host object in IE < 9.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a host object, else `false`.
   */
  function isHostObject(value) {
    // Many host objects are `Object` objects that can coerce to strings
    // despite having improperly defined `toString` methods.
    var result = false;
    if (value != null && typeof value.toString != 'function') {
      try {
        result = !!(value + '');
      } catch (e) {}
    }
    return result;
  }

  /**
   * Converts `map` to its key-value pairs.
   *
   * @private
   * @param {Object} map The map to convert.
   * @returns {Array} Returns the key-value pairs.
   */
  function mapToArray(map) {
    var index = -1,
        result = Array(map.size);

    map.forEach(function(value, key) {
      result[++index] = [key, value];
    });
    return result;
  }

  /**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */
  function overArg(func, transform) {
    return function(arg) {
      return func(transform(arg));
    };
  }

  /**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */
  function setToArray(set) {
    var index = -1,
        result = Array(set.size);

    set.forEach(function(value) {
      result[++index] = value;
    });
    return result;
  }

  /** Used for built-in method references. */
  var arrayProto = Array.prototype,
      funcProto = Function.prototype,
      objectProto = Object.prototype;

  /** Used to detect overreaching core-js shims. */
  var coreJsData = root['__core-js_shared__'];

  /** Used to detect methods masquerading as native. */
  var maskSrcKey = (function() {
    var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');
    return uid ? ('Symbol(src)_1.' + uid) : '';
  }());

  /** Used to resolve the decompiled source of functions. */
  var funcToString = funcProto.toString;

  /** Used to check objects for own properties. */
  var hasOwnProperty = objectProto.hasOwnProperty;

  /**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */
  var objectToString = objectProto.toString;

  /** Used to detect if a method is native. */
  var reIsNative = RegExp('^' +
    funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\$&')
    .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
  );

  /** Built-in value references. */
  var Symbol = root.Symbol,
      Uint8Array = root.Uint8Array,
      propertyIsEnumerable = objectProto.propertyIsEnumerable,
      splice = arrayProto.splice;

  /* Built-in method references for those with the same name as other `lodash` methods. */
  var nativeKeys = overArg(Object.keys, Object);

  /* Built-in method references that are verified to be native. */
  var DataView = getNative(root, 'DataView'),
      Map = getNative(root, 'Map'),
      Promise = getNative(root, 'Promise'),
      Set$1 = getNative(root, 'Set'),
      WeakMap = getNative(root, 'WeakMap'),
      nativeCreate = getNative(Object, 'create');

  /** Used to detect maps, sets, and weakmaps. */
  var dataViewCtorString = toSource(DataView),
      mapCtorString = toSource(Map),
      promiseCtorString = toSource(Promise),
      setCtorString = toSource(Set$1),
      weakMapCtorString = toSource(WeakMap);

  /** Used to convert symbols to primitives and strings. */
  var symbolProto = Symbol ? Symbol.prototype : undefined,
      symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;

  /**
   * Creates a hash object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function Hash(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the hash.
   *
   * @private
   * @name clear
   * @memberOf Hash
   */
  function hashClear() {
    this.__data__ = nativeCreate ? nativeCreate(null) : {};
  }

  /**
   * Removes `key` and its value from the hash.
   *
   * @private
   * @name delete
   * @memberOf Hash
   * @param {Object} hash The hash to modify.
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function hashDelete(key) {
    return this.has(key) && delete this.__data__[key];
  }

  /**
   * Gets the hash value for `key`.
   *
   * @private
   * @name get
   * @memberOf Hash
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function hashGet(key) {
    var data = this.__data__;
    if (nativeCreate) {
      var result = data[key];
      return result === HASH_UNDEFINED ? undefined : result;
    }
    return hasOwnProperty.call(data, key) ? data[key] : undefined;
  }

  /**
   * Checks if a hash value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Hash
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function hashHas(key) {
    var data = this.__data__;
    return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);
  }

  /**
   * Sets the hash `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Hash
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the hash instance.
   */
  function hashSet(key, value) {
    var data = this.__data__;
    data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;
    return this;
  }

  // Add methods to `Hash`.
  Hash.prototype.clear = hashClear;
  Hash.prototype['delete'] = hashDelete;
  Hash.prototype.get = hashGet;
  Hash.prototype.has = hashHas;
  Hash.prototype.set = hashSet;

  /**
   * Creates an list cache object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function ListCache(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the list cache.
   *
   * @private
   * @name clear
   * @memberOf ListCache
   */
  function listCacheClear() {
    this.__data__ = [];
  }

  /**
   * Removes `key` and its value from the list cache.
   *
   * @private
   * @name delete
   * @memberOf ListCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function listCacheDelete(key) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    if (index < 0) {
      return false;
    }
    var lastIndex = data.length - 1;
    if (index == lastIndex) {
      data.pop();
    } else {
      splice.call(data, index, 1);
    }
    return true;
  }

  /**
   * Gets the list cache value for `key`.
   *
   * @private
   * @name get
   * @memberOf ListCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function listCacheGet(key) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    return index < 0 ? undefined : data[index][1];
  }

  /**
   * Checks if a list cache value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf ListCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function listCacheHas(key) {
    return assocIndexOf(this.__data__, key) > -1;
  }

  /**
   * Sets the list cache `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf ListCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the list cache instance.
   */
  function listCacheSet(key, value) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    if (index < 0) {
      data.push([key, value]);
    } else {
      data[index][1] = value;
    }
    return this;
  }

  // Add methods to `ListCache`.
  ListCache.prototype.clear = listCacheClear;
  ListCache.prototype['delete'] = listCacheDelete;
  ListCache.prototype.get = listCacheGet;
  ListCache.prototype.has = listCacheHas;
  ListCache.prototype.set = listCacheSet;

  /**
   * Creates a map cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function MapCache(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the map.
   *
   * @private
   * @name clear
   * @memberOf MapCache
   */
  function mapCacheClear() {
    this.__data__ = {
      'hash': new Hash,
      'map': new (Map || ListCache),
      'string': new Hash
    };
  }

  /**
   * Removes `key` and its value from the map.
   *
   * @private
   * @name delete
   * @memberOf MapCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function mapCacheDelete(key) {
    return getMapData(this, key)['delete'](key);
  }

  /**
   * Gets the map value for `key`.
   *
   * @private
   * @name get
   * @memberOf MapCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function mapCacheGet(key) {
    return getMapData(this, key).get(key);
  }

  /**
   * Checks if a map value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf MapCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function mapCacheHas(key) {
    return getMapData(this, key).has(key);
  }

  /**
   * Sets the map `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf MapCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the map cache instance.
   */
  function mapCacheSet(key, value) {
    getMapData(this, key).set(key, value);
    return this;
  }

  // Add methods to `MapCache`.
  MapCache.prototype.clear = mapCacheClear;
  MapCache.prototype['delete'] = mapCacheDelete;
  MapCache.prototype.get = mapCacheGet;
  MapCache.prototype.has = mapCacheHas;
  MapCache.prototype.set = mapCacheSet;

  /**
   *
   * Creates an array cache object to store unique values.
   *
   * @private
   * @constructor
   * @param {Array} [values] The values to cache.
   */
  function SetCache(values) {
    var index = -1,
        length = values ? values.length : 0;

    this.__data__ = new MapCache;
    while (++index < length) {
      this.add(values[index]);
    }
  }

  /**
   * Adds `value` to the array cache.
   *
   * @private
   * @name add
   * @memberOf SetCache
   * @alias push
   * @param {*} value The value to cache.
   * @returns {Object} Returns the cache instance.
   */
  function setCacheAdd(value) {
    this.__data__.set(value, HASH_UNDEFINED);
    return this;
  }

  /**
   * Checks if `value` is in the array cache.
   *
   * @private
   * @name has
   * @memberOf SetCache
   * @param {*} value The value to search for.
   * @returns {number} Returns `true` if `value` is found, else `false`.
   */
  function setCacheHas(value) {
    return this.__data__.has(value);
  }

  // Add methods to `SetCache`.
  SetCache.prototype.add = SetCache.prototype.push = setCacheAdd;
  SetCache.prototype.has = setCacheHas;

  /**
   * Creates a stack cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function Stack(entries) {
    this.__data__ = new ListCache(entries);
  }

  /**
   * Removes all key-value entries from the stack.
   *
   * @private
   * @name clear
   * @memberOf Stack
   */
  function stackClear() {
    this.__data__ = new ListCache;
  }

  /**
   * Removes `key` and its value from the stack.
   *
   * @private
   * @name delete
   * @memberOf Stack
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function stackDelete(key) {
    return this.__data__['delete'](key);
  }

  /**
   * Gets the stack value for `key`.
   *
   * @private
   * @name get
   * @memberOf Stack
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function stackGet(key) {
    return this.__data__.get(key);
  }

  /**
   * Checks if a stack value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Stack
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function stackHas(key) {
    return this.__data__.has(key);
  }

  /**
   * Sets the stack `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Stack
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the stack cache instance.
   */
  function stackSet(key, value) {
    var cache = this.__data__;
    if (cache instanceof ListCache) {
      var pairs = cache.__data__;
      if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {
        pairs.push([key, value]);
        return this;
      }
      cache = this.__data__ = new MapCache(pairs);
    }
    cache.set(key, value);
    return this;
  }

  // Add methods to `Stack`.
  Stack.prototype.clear = stackClear;
  Stack.prototype['delete'] = stackDelete;
  Stack.prototype.get = stackGet;
  Stack.prototype.has = stackHas;
  Stack.prototype.set = stackSet;

  /**
   * Creates an array of the enumerable property names of the array-like `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @param {boolean} inherited Specify returning inherited property names.
   * @returns {Array} Returns the array of property names.
   */
  function arrayLikeKeys(value, inherited) {
    // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
    // Safari 9 makes `arguments.length` enumerable in strict mode.
    var result = (isArray(value) || isArguments(value))
      ? baseTimes(value.length, String)
      : [];

    var length = result.length,
        skipIndexes = !!length;

    for (var key in value) {
      if ((inherited || hasOwnProperty.call(value, key)) &&
          !(skipIndexes && (key == 'length' || isIndex(key, length)))) {
        result.push(key);
      }
    }
    return result;
  }

  /**
   * Gets the index at which the `key` is found in `array` of key-value pairs.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} key The key to search for.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function assocIndexOf(array, key) {
    var length = array.length;
    while (length--) {
      if (eq(array[length][0], key)) {
        return length;
      }
    }
    return -1;
  }

  /**
   * The base implementation of `getTag`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */
  function baseGetTag(value) {
    return objectToString.call(value);
  }

  /**
   * The base implementation of `_.isEqual` which supports partial comparisons
   * and tracks traversed objects.
   *
   * @private
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @param {Function} [customizer] The function to customize comparisons.
   * @param {boolean} [bitmask] The bitmask of comparison flags.
   *  The bitmask may be composed of the following flags:
   *     1 - Unordered comparison
   *     2 - Partial comparison
   * @param {Object} [stack] Tracks traversed `value` and `other` objects.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   */
  function baseIsEqual(value, other, customizer, bitmask, stack) {
    if (value === other) {
      return true;
    }
    if (value == null || other == null || (!isObject(value) && !isObjectLike(other))) {
      return value !== value && other !== other;
    }
    return baseIsEqualDeep(value, other, baseIsEqual, customizer, bitmask, stack);
  }

  /**
   * A specialized version of `baseIsEqual` for arrays and objects which performs
   * deep comparisons and tracks traversed objects enabling objects with circular
   * references to be compared.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Function} [customizer] The function to customize comparisons.
   * @param {number} [bitmask] The bitmask of comparison flags. See `baseIsEqual`
   *  for more details.
   * @param {Object} [stack] Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */
  function baseIsEqualDeep(object, other, equalFunc, customizer, bitmask, stack) {
    var objIsArr = isArray(object),
        othIsArr = isArray(other),
        objTag = arrayTag,
        othTag = arrayTag;

    if (!objIsArr) {
      objTag = getTag(object);
      objTag = objTag == argsTag ? objectTag : objTag;
    }
    if (!othIsArr) {
      othTag = getTag(other);
      othTag = othTag == argsTag ? objectTag : othTag;
    }
    var objIsObj = objTag == objectTag && !isHostObject(object),
        othIsObj = othTag == objectTag && !isHostObject(other),
        isSameTag = objTag == othTag;

    if (isSameTag && !objIsObj) {
      stack || (stack = new Stack);
      return (objIsArr || isTypedArray(object))
        ? equalArrays(object, other, equalFunc, customizer, bitmask, stack)
        : equalByTag(object, other, objTag, equalFunc, customizer, bitmask, stack);
    }
    if (!(bitmask & PARTIAL_COMPARE_FLAG)) {
      var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),
          othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');

      if (objIsWrapped || othIsWrapped) {
        var objUnwrapped = objIsWrapped ? object.value() : object,
            othUnwrapped = othIsWrapped ? other.value() : other;

        stack || (stack = new Stack);
        return equalFunc(objUnwrapped, othUnwrapped, customizer, bitmask, stack);
      }
    }
    if (!isSameTag) {
      return false;
    }
    stack || (stack = new Stack);
    return equalObjects(object, other, equalFunc, customizer, bitmask, stack);
  }

  /**
   * The base implementation of `_.isNative` without bad shim checks.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a native function,
   *  else `false`.
   */
  function baseIsNative(value) {
    if (!isObject(value) || isMasked(value)) {
      return false;
    }
    var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;
    return pattern.test(toSource(value));
  }

  /**
   * The base implementation of `_.isTypedArray` without Node.js optimizations.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   */
  function baseIsTypedArray(value) {
    return isObjectLike(value) &&
      isLength(value.length) && !!typedArrayTags[objectToString.call(value)];
  }

  /**
   * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */
  function baseKeys(object) {
    if (!isPrototype(object)) {
      return nativeKeys(object);
    }
    var result = [];
    for (var key in Object(object)) {
      if (hasOwnProperty.call(object, key) && key != 'constructor') {
        result.push(key);
      }
    }
    return result;
  }

  /**
   * A specialized version of `baseIsEqualDeep` for arrays with support for
   * partial deep comparisons.
   *
   * @private
   * @param {Array} array The array to compare.
   * @param {Array} other The other array to compare.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Function} customizer The function to customize comparisons.
   * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`
   *  for more details.
   * @param {Object} stack Tracks traversed `array` and `other` objects.
   * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.
   */
  function equalArrays(array, other, equalFunc, customizer, bitmask, stack) {
    var isPartial = bitmask & PARTIAL_COMPARE_FLAG,
        arrLength = array.length,
        othLength = other.length;

    if (arrLength != othLength && !(isPartial && othLength > arrLength)) {
      return false;
    }
    // Assume cyclic values are equal.
    var stacked = stack.get(array);
    if (stacked && stack.get(other)) {
      return stacked == other;
    }
    var index = -1,
        result = true,
        seen = (bitmask & UNORDERED_COMPARE_FLAG) ? new SetCache : undefined;

    stack.set(array, other);
    stack.set(other, array);

    // Ignore non-index properties.
    while (++index < arrLength) {
      var arrValue = array[index],
          othValue = other[index];

      if (customizer) {
        var compared = isPartial
          ? customizer(othValue, arrValue, index, other, array, stack)
          : customizer(arrValue, othValue, index, array, other, stack);
      }
      if (compared !== undefined) {
        if (compared) {
          continue;
        }
        result = false;
        break;
      }
      // Recursively compare arrays (susceptible to call stack limits).
      if (seen) {
        if (!arraySome(other, function(othValue, othIndex) {
              if (!seen.has(othIndex) &&
                  (arrValue === othValue || equalFunc(arrValue, othValue, customizer, bitmask, stack))) {
                return seen.add(othIndex);
              }
            })) {
          result = false;
          break;
        }
      } else if (!(
            arrValue === othValue ||
              equalFunc(arrValue, othValue, customizer, bitmask, stack)
          )) {
        result = false;
        break;
      }
    }
    stack['delete'](array);
    stack['delete'](other);
    return result;
  }

  /**
   * A specialized version of `baseIsEqualDeep` for comparing objects of
   * the same `toStringTag`.
   *
   * **Note:** This function only supports comparing values with tags of
   * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {string} tag The `toStringTag` of the objects to compare.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Function} customizer The function to customize comparisons.
   * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`
   *  for more details.
   * @param {Object} stack Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */
  function equalByTag(object, other, tag, equalFunc, customizer, bitmask, stack) {
    switch (tag) {
      case dataViewTag:
        if ((object.byteLength != other.byteLength) ||
            (object.byteOffset != other.byteOffset)) {
          return false;
        }
        object = object.buffer;
        other = other.buffer;

      case arrayBufferTag:
        if ((object.byteLength != other.byteLength) ||
            !equalFunc(new Uint8Array(object), new Uint8Array(other))) {
          return false;
        }
        return true;

      case boolTag:
      case dateTag:
      case numberTag:
        // Coerce booleans to `1` or `0` and dates to milliseconds.
        // Invalid dates are coerced to `NaN`.
        return eq(+object, +other);

      case errorTag:
        return object.name == other.name && object.message == other.message;

      case regexpTag:
      case stringTag:
        // Coerce regexes to strings and treat strings, primitives and objects,
        // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring
        // for more details.
        return object == (other + '');

      case mapTag:
        var convert = mapToArray;

      case setTag:
        var isPartial = bitmask & PARTIAL_COMPARE_FLAG;
        convert || (convert = setToArray);

        if (object.size != other.size && !isPartial) {
          return false;
        }
        // Assume cyclic values are equal.
        var stacked = stack.get(object);
        if (stacked) {
          return stacked == other;
        }
        bitmask |= UNORDERED_COMPARE_FLAG;

        // Recursively compare objects (susceptible to call stack limits).
        stack.set(object, other);
        var result = equalArrays(convert(object), convert(other), equalFunc, customizer, bitmask, stack);
        stack['delete'](object);
        return result;

      case symbolTag:
        if (symbolValueOf) {
          return symbolValueOf.call(object) == symbolValueOf.call(other);
        }
    }
    return false;
  }

  /**
   * A specialized version of `baseIsEqualDeep` for objects with support for
   * partial deep comparisons.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Function} customizer The function to customize comparisons.
   * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`
   *  for more details.
   * @param {Object} stack Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */
  function equalObjects(object, other, equalFunc, customizer, bitmask, stack) {
    var isPartial = bitmask & PARTIAL_COMPARE_FLAG,
        objProps = keys(object),
        objLength = objProps.length,
        othProps = keys(other),
        othLength = othProps.length;

    if (objLength != othLength && !isPartial) {
      return false;
    }
    var index = objLength;
    while (index--) {
      var key = objProps[index];
      if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {
        return false;
      }
    }
    // Assume cyclic values are equal.
    var stacked = stack.get(object);
    if (stacked && stack.get(other)) {
      return stacked == other;
    }
    var result = true;
    stack.set(object, other);
    stack.set(other, object);

    var skipCtor = isPartial;
    while (++index < objLength) {
      key = objProps[index];
      var objValue = object[key],
          othValue = other[key];

      if (customizer) {
        var compared = isPartial
          ? customizer(othValue, objValue, key, other, object, stack)
          : customizer(objValue, othValue, key, object, other, stack);
      }
      // Recursively compare objects (susceptible to call stack limits).
      if (!(compared === undefined
            ? (objValue === othValue || equalFunc(objValue, othValue, customizer, bitmask, stack))
            : compared
          )) {
        result = false;
        break;
      }
      skipCtor || (skipCtor = key == 'constructor');
    }
    if (result && !skipCtor) {
      var objCtor = object.constructor,
          othCtor = other.constructor;

      // Non `Object` object instances with different constructors are not equal.
      if (objCtor != othCtor &&
          ('constructor' in object && 'constructor' in other) &&
          !(typeof objCtor == 'function' && objCtor instanceof objCtor &&
            typeof othCtor == 'function' && othCtor instanceof othCtor)) {
        result = false;
      }
    }
    stack['delete'](object);
    stack['delete'](other);
    return result;
  }

  /**
   * Gets the data for `map`.
   *
   * @private
   * @param {Object} map The map to query.
   * @param {string} key The reference key.
   * @returns {*} Returns the map data.
   */
  function getMapData(map, key) {
    var data = map.__data__;
    return isKeyable(key)
      ? data[typeof key == 'string' ? 'string' : 'hash']
      : data.map;
  }

  /**
   * Gets the native function at `key` of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the method to get.
   * @returns {*} Returns the function if it's native, else `undefined`.
   */
  function getNative(object, key) {
    var value = getValue(object, key);
    return baseIsNative(value) ? value : undefined;
  }

  /**
   * Gets the `toStringTag` of `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */
  var getTag = baseGetTag;

  // Fallback for data views, maps, sets, and weak maps in IE 11,
  // for data views in Edge < 14, and promises in Node.js.
  if ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||
      (Map && getTag(new Map) != mapTag) ||
      (Promise && getTag(Promise.resolve()) != promiseTag) ||
      (Set$1 && getTag(new Set$1) != setTag) ||
      (WeakMap && getTag(new WeakMap) != weakMapTag)) {
    getTag = function(value) {
      var result = objectToString.call(value),
          Ctor = result == objectTag ? value.constructor : undefined,
          ctorString = Ctor ? toSource(Ctor) : undefined;

      if (ctorString) {
        switch (ctorString) {
          case dataViewCtorString: return dataViewTag;
          case mapCtorString: return mapTag;
          case promiseCtorString: return promiseTag;
          case setCtorString: return setTag;
          case weakMapCtorString: return weakMapTag;
        }
      }
      return result;
    };
  }

  /**
   * Checks if `value` is a valid array-like index.
   *
   * @private
   * @param {*} value The value to check.
   * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
   * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
   */
  function isIndex(value, length) {
    length = length == null ? MAX_SAFE_INTEGER : length;
    return !!length &&
      (typeof value == 'number' || reIsUint.test(value)) &&
      (value > -1 && value % 1 == 0 && value < length);
  }

  /**
   * Checks if `value` is suitable for use as unique object key.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
   */
  function isKeyable(value) {
    var type = typeof value;
    return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')
      ? (value !== '__proto__')
      : (value === null);
  }

  /**
   * Checks if `func` has its source masked.
   *
   * @private
   * @param {Function} func The function to check.
   * @returns {boolean} Returns `true` if `func` is masked, else `false`.
   */
  function isMasked(func) {
    return !!maskSrcKey && (maskSrcKey in func);
  }

  /**
   * Checks if `value` is likely a prototype object.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
   */
  function isPrototype(value) {
    var Ctor = value && value.constructor,
        proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;

    return value === proto;
  }

  /**
   * Converts `func` to its source code.
   *
   * @private
   * @param {Function} func The function to process.
   * @returns {string} Returns the source code.
   */
  function toSource(func) {
    if (func != null) {
      try {
        return funcToString.call(func);
      } catch (e) {}
      try {
        return (func + '');
      } catch (e) {}
    }
    return '';
  }

  /**
   * Performs a
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * comparison between two values to determine if they are equivalent.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.eq(object, object);
   * // => true
   *
   * _.eq(object, other);
   * // => false
   *
   * _.eq('a', 'a');
   * // => true
   *
   * _.eq('a', Object('a'));
   * // => false
   *
   * _.eq(NaN, NaN);
   * // => true
   */
  function eq(value, other) {
    return value === other || (value !== value && other !== other);
  }

  /**
   * Checks if `value` is likely an `arguments` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   *  else `false`.
   * @example
   *
   * _.isArguments(function() { return arguments; }());
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */
  function isArguments(value) {
    // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
    return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&
      (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);
  }

  /**
   * Checks if `value` is classified as an `Array` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array, else `false`.
   * @example
   *
   * _.isArray([1, 2, 3]);
   * // => true
   *
   * _.isArray(document.body.children);
   * // => false
   *
   * _.isArray('abc');
   * // => false
   *
   * _.isArray(_.noop);
   * // => false
   */
  var isArray = Array.isArray;

  /**
   * Checks if `value` is array-like. A value is considered array-like if it's
   * not a function and has a `value.length` that's an integer greater than or
   * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
   * @example
   *
   * _.isArrayLike([1, 2, 3]);
   * // => true
   *
   * _.isArrayLike(document.body.children);
   * // => true
   *
   * _.isArrayLike('abc');
   * // => true
   *
   * _.isArrayLike(_.noop);
   * // => false
   */
  function isArrayLike(value) {
    return value != null && isLength(value.length) && !isFunction(value);
  }

  /**
   * This method is like `_.isArrayLike` except that it also checks if `value`
   * is an object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array-like object,
   *  else `false`.
   * @example
   *
   * _.isArrayLikeObject([1, 2, 3]);
   * // => true
   *
   * _.isArrayLikeObject(document.body.children);
   * // => true
   *
   * _.isArrayLikeObject('abc');
   * // => false
   *
   * _.isArrayLikeObject(_.noop);
   * // => false
   */
  function isArrayLikeObject(value) {
    return isObjectLike(value) && isArrayLike(value);
  }

  /**
   * Performs a deep comparison between two values to determine if they are
   * equivalent.
   *
   * **Note:** This method supports comparing arrays, array buffers, booleans,
   * date objects, error objects, maps, numbers, `Object` objects, regexes,
   * sets, strings, symbols, and typed arrays. `Object` objects are compared
   * by their own, not inherited, enumerable properties. Functions and DOM
   * nodes are **not** supported.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.isEqual(object, other);
   * // => true
   *
   * object === other;
   * // => false
   */
  function isEqual(value, other) {
    return baseIsEqual(value, other);
  }

  /**
   * Checks if `value` is classified as a `Function` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   *
   * _.isFunction(/abc/);
   * // => false
   */
  function isFunction(value) {
    // The use of `Object#toString` avoids issues with the `typeof` operator
    // in Safari 8-9 which returns 'object' for typed array and other constructors.
    var tag = isObject(value) ? objectToString.call(value) : '';
    return tag == funcTag || tag == genTag;
  }

  /**
   * Checks if `value` is a valid array-like length.
   *
   * **Note:** This method is loosely based on
   * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
   * @example
   *
   * _.isLength(3);
   * // => true
   *
   * _.isLength(Number.MIN_VALUE);
   * // => false
   *
   * _.isLength(Infinity);
   * // => false
   *
   * _.isLength('3');
   * // => false
   */
  function isLength(value) {
    return typeof value == 'number' &&
      value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
  }

  /**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */
  function isObject(value) {
    var type = typeof value;
    return !!value && (type == 'object' || type == 'function');
  }

  /**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */
  function isObjectLike(value) {
    return !!value && typeof value == 'object';
  }

  /**
   * Checks if `value` is classified as a typed array.
   *
   * @static
   * @memberOf _
   * @since 3.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   * @example
   *
   * _.isTypedArray(new Uint8Array);
   * // => true
   *
   * _.isTypedArray([]);
   * // => false
   */
  var isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;

  /**
   * Creates an array of the own enumerable property names of `object`.
   *
   * **Note:** Non-object values are coerced to objects. See the
   * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
   * for more details.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Object
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.keys(new Foo);
   * // => ['a', 'b'] (iteration order is not guaranteed)
   *
   * _.keys('hi');
   * // => ['0', '1']
   */

  function keys(object) {
    return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
  }

  // isEqual is from loDash exported as a module:
  //  https://github.com/lodash/lodash/tree/4.5.0-npm-packages/lodash.isequal

  const conxOptions = {
    apiKey: "AIzaSyDc_8MiQvWdCNpvZcvbJyyQYGeTaVGpBgo",
    authDomain: "glider-feb-2019.firebaseapp.com",
    databaseURL: "https://glider-feb-2019.firebaseio.com",
    projectId: "glider-feb-2019",
    storageBucket: "glider-feb-2019.appspot.com",
    messagingSenderId: "451231012490"
  };

  let remoteStore = getRemoteStore(conxOptions);
  // remoteStore.getFlightState;

  window.rs = remoteStore;

  // Deep compare -- uses lodash's isEqual()

  function isDifferent(a, b) {
    return ! isEqual(a, b); 
  }

  // Given an array of variable names, create an object to initialize
  //  the state of a store (in the Module definition)

  function getVuExStateFromPartVarList(sharedVariables, getPartVariableId) {
    
    /* DON'T THROW THIS OUT - MAY BE USEFUL
    remoteStore.getFlightState.then(s => {
      
      console.log('STATE ON REMOTE');
      let remoteValues = s.exportVal();
      
      for (let remoteVarName in remoteValues) {
        if (! remoteVarName.startsWith('_1234')) 
          delete remoteValues[remoteVarName];
      }
      
      console.log(remoteValues);
    }); */
    
    let partVars = Object.keys(sharedVariables);
    
    let stateObj = partVars.reduce((stateObjAcc, partVarName) => {
      const partVarId = getPartVariableId(partVarName);
      stateObjAcc[partVarId] = sharedVariables[partVarName];
      return stateObjAcc;
    }, {});
    
    return stateObj;   
  }

  // Module definition for Part store
  //   Define the getter, mutator, and state

  function getPartModuleDefinition(sharedVariables, getPartVariableId) {

    let partModuleState = getVuExStateFromPartVarList(sharedVariables, getPartVariableId);

    let varGetter = (partModuleState, getters, rootState) => partVarId => {
      
      console.log(`GETVAL: getting ${partVarId}`);
      console.log(`> partModuleState['${partVarId}'] is: ${partModuleState[partVarId]}`);
      console.log(`> and module state is:`);
      console.log(partModuleState);
      
      return partModuleState[partVarId];
    };
    
    let varSetter = function(partModuleState, [partVarName, partVarValue]) {

      let storePartVarId = getPartVariableId(partVarName);

      // Only update if there's a change in value

      if (isDifferent(partModuleState[storePartVarId], partVarValue)) {
        
        console.log('UPDATING LOCAL STORE:');
        console.log(`> partModuleState['${storePartVarId}'] = ${partVarValue};`);
        console.log('> Module state is now:');
        console.log(partModuleState);
        
        partModuleState[storePartVarId] = partVarValue;
        remoteStore.set(storePartVarId, partVarValue);
      }
    };

    return {    
      state: partModuleState,
      namespaced: true,
      getters: { getVal: varGetter },
      mutations: { 
        setValTo: varSetter
      }
    }
  }

  // This is called when registering the Part Type component (no instances yet)
  // It returns setters and getters for each shared var in the Part type
  // These setters and getters are defined at the component level, but executed
  //  at the instance level

  function getPartTypeSettersGetters({ sharedVariables, flightInstanceId }) {
    
    let sharedVariablesGettersSetters = {},
        localStore = this;
    
    Object.entries(sharedVariables).forEach(([varName, varInitVal]) => {
      
      let getFullVarId = (varName, partInstanceId) => `_${flightInstanceId}-${partInstanceId}-${varName}`;
      
      sharedVariablesGettersSetters[varName] = {
        
        get: function () {
          
          let fullVarId = getFullVarId(varName, this.id),
              namespacedGetVal = `${this.id}/getVal`;
          
          console.log(`PART GETTER NEW: localStore.getters['${namespacedGetVal}']('${fullVarId}')`);
          console.log(localStore);
          console.log('RESULT: ' + localStore.getters[namespacedGetVal](fullVarId));
          return localStore.getters[namespacedGetVal](fullVarId);
        },
        
        set: function (newValue) {
          
          let fullVarId = getFullVarId(varName, this.id),
              namespacedSetValTo = `${this.id}/setValTo`;
          
          console.log(`PART SETTER NEW: localStore.commit(${namespacedSetValTo}, [${varName}, ${newValue}])`);
          localStore.commit(namespacedSetValTo, [varName, newValue]);
        }
      };
    });
    
    return sharedVariablesGettersSetters;
  }

  // Note that this will be a method off of the main root VuEx store
  // This registers a Part INSTANCE -- it creates a store module

  function registerPart({ sharedVariables, partId, flightInstanceId }) {
      
    console.log(`REGISTERING PART ${partId} IN STORE`);
    
    let localStore = this,
        partModuleId = partId,
        variableNames = Object.keys(sharedVariables);
    
    // Given a Part varId, return the full store ID
    //  (namespaced for the FlightInstanceId and the PartId)
    
    let getPartVariableId = partVarId => `_${flightInstanceId}-${partId}-${partVarId}`;
    
    // Get Part instance's VuEx module definition & add to store
    // TODO: Also (to be coded) initialize shared variables to whatever's in sharedVariables 
    //   UNLESS there's a value in remote store
    
    let partModule = getPartModuleDefinition(sharedVariables, getPartVariableId);
    localStore.registerModule(partModuleId, partModule);
    
    // Add a remoteStore listener for each Part variable
    // If a remotestore entry changes, then --> update the localStore
    
    // MOVE TO addRemoteStoreListener() ABOVE
    
    let namespacedGetVal = `${partModuleId}/getVal`,
        namespacedSetValTo = `${partModuleId}/setValTo`;
    
    variableNames.forEach(partVarName => {

      // Define callback for when a value changes on the remote store
      // (callback updates local store with remote value)
      
      const partVarId = getPartVariableId(partVarName);
      
      let onRemoteChange = remoteVarValue => {
        let localVarValue = localStore.getters[namespacedGetVal](partVarId);
        if (isDifferent(remoteVarValue, localVarValue)) {
          console.log(`CHANGE ON REMOTE STORE: localStore.commit('${namespacedSetValTo}', ['${partVarName}', ${remoteVarValue}]);`);
          localStore.commit(namespacedSetValTo, [partVarName, remoteVarValue]);
        }
      };

      // Apply that callback
      
      remoteStore.listenForChanges(
        getPartVariableId(partVarName),
        onRemoteChange,
        sharedVariables[partVarName]
      );
    });
    
    return true; // TODO: What's a useful return value??
  }

  // Initialize flag indicates whether to first clean out the remote DB

  function getLocalStore(flightInstanceId, p4vData, initialize) {

    if (initialize) {
      remoteStore.deleteFlightEntries(flightInstanceId);
    }
    
    // Create getters and setters for PartViews
    // Generate a hash between PartViews ID and their containing Part ID
    
    const partViewsToParts = Object.values(p4vData.partViews).reduce((acc, partView) => { 
      acc[partView.id] = partView.partId;
      return acc;
     }, {});
    
    let getPartViewSharedVariable = function(state) {
      return function(partViewId, varName) {
        let partId = state.partViewsToParts[partViewId],
            varId = `_${state.flightInstanceId}-${partId}-${varName}`; // TODO: FIX THIS

        return state[partId][varId];
      }
    };
    
    // Parts to PartView registry
    // TODO: Can this be done straight off of p4vData?
    
    let partsToPartViews = Object.keys(partViewsToParts).reduce((acc, partViewId) => { 
      let partId = partViewsToParts[partViewId];
      if (acc[partId] === undefined) acc[partId] = [];
      acc[partId].push(partViewId);
      return acc;
    }, {});
    
    // Methods by which Phases can notify Parts
    
    let phasesParts = p4vData.phasesParts,
        partInstanceRegistry = {}; // Keeps track of components by ID
    
    function addPartInstanceToRegistry(part) {
      partInstanceRegistry[part.id] = part;
      console.log(`ADDING ${part.id} TO PART REGISTRY`);
      console.log(part);
    }
    
    function phaseActive(phase) {
      
      console.log(`ACTIVATING PHASE ${phase.id}`);
      
      phasesParts[phase.id].forEach(partId => {
        
        console.log(`> ACTIVATING PART ${partId}`);
        
        // Activate Part
        
        let part = partInstanceRegistry[partId];
        
        if (part) { part.makeActive(); }
        
        // Activate associated PartView(s)
        
        if (partsToPartViews[partId] !== undefined) {
          partsToPartViews[partId].forEach(
            partViewId => partInstanceRegistry[partViewId].makeActive()
          );
        }
      });
    }
    
    function phaseInactive(phase) {
      // phasesParts[phaseId].forEach(part => part.deactivate()); // TODO -- need to resolve PartId to Part component
      console.log(`DEACTIVATING PHASE ${phase.id}`);
      phasesParts[phase.id].forEach(partId => { 
        console.log(`> DEACTIVATING PART ${partId}`); 
        let part = partInstanceRegistry[partId];
        if (part) { part.makeInactive(); }
        if (partsToPartViews[partId] !== undefined) {
          partsToPartViews[partId].forEach(
            partViewId => partInstanceRegistry[partViewId].makeInactive()
          );
        }
      });
    }
    
    /*
    let setPartViewSharedVariable = function(state, [partViewId, varName, newValue]) {
      let partId = state.partViewsToParts[partViewId],
          varId = `_${state.flightInstanceId}-${partId}-${varName}`; // TODO: FIX THIS

      state[partId][varId] = newValue;
      // state.commit("${partId}/setValTo", ['count', 1000]); // MAKE THIS WORK
    }; */
    
    // TODO: add a sync'ed module for application-level state, e.g. currentPhase
    //  (there are other values that are NOT sync'ed)
    
    let elEstor = new Vuex.Store({
      state: {
        flightInstanceId: flightInstanceId,
        partViewsToParts: partViewsToParts
      },
      mutations: {
        // setPartViewSharedVariable: setPartViewSharedVariable
      },
      modules: {},
      getters: {
        getPartViewSharedVariable: getPartViewSharedVariable
      }
    });

    elEstor.registerPart = registerPart;
    
    elEstor.getPartTypeSettersGetters = getPartTypeSettersGetters;
    elEstor.setPartViewSharedVariable = function(partViewId, varName, newValue) {
      let partId = this.state.partViewsToParts[partViewId];

      console.log(`SETTING ${varName} IN ${partId} TO ${newValue} in STORE!`);
      
      this.commit(`${partId}/setValTo`, [varName, newValue]);
    };
    
    elEstor.addPartInstanceToRegistry = addPartInstanceToRegistry;
    
    elEstor.phaseActive   = phaseActive;
    elEstor.phaseInactive = phaseInactive;
    
    elEstor.placesPartviews = p4vData.placesPartviews;
    elEstor.addPartViewToPlace = function (partViewId, placeId) {
      
      // TODO: not sure this is necessary
      
      if (this.placesPartviews[placeId] === undefined) {
        this.placesPartviews[placeId] = [];
      }
      
      this.placesPartviews[placeId].push(partViewId);
      
      console.log(this.placesPartviews[placeId]);
    };
    
    return elEstor; 
  }

  /* 

    CONTENTS

    - Class definitions:
      - Phase
      - Phase_noChildren
      - Phase_withChildren
        - Phase_par
        - Phase_seq
    - Phase_manager (TODO -- will handle next/pause/play/etc)

    STILL LEFT TODO:

    - RepeatCount implementation
    - Goto/next/prev implementation
    - Play/Pause

    PHASE CONSTRUCTOR OPTIONS OBJECT PROPERTIES:

    - id
    - app
    - delay
    - duration
    - ... more to come? RepeatCount, etc. ...


    */

    // Classes


  /* 
    Phase.states = { 
      idle: 1,      // Unactivated and waiting (possible due to a delayed start)
      running: 2,   // Active and running
      complete: 3   // Completed being active
    }; */

  class Phase {

    constructor(options) {

      const MILLISECONDS_PER_SECOND = 1000;
      
      this.id       = (options.id === undefined) ? this.generateId() : options.id;
      this.app      = options.app;
      this.delay    = (typeof options.delay === 'number') ? options.delay  * MILLISECONDS_PER_SECOND : 0;
      this.duration = (typeof options.duration === 'number') ? options.duration * MILLISECONDS_PER_SECOND : Infinity;

      this.currentState = 'idle';
      this.timer = null;
      
      this.xxxComplete = function () {}; // TODO: trying this out
    }

    generateId() {
      return '_rand_' + Math.floor(Math.random() * 1000);
    }

    // Given state s, if the Phase isn't already 
    //  in that state, change state to s
    //  (note: does not check for allowed/disallowed transitions)

    set state(s) {
      if (this.currentState !== s) this.currentState = s;
    }

    get isComplete() {
      return (this.currentState === 'complete')
    }
    
    get isRunning() {
      return (this.currentState === 'running') 
    }

    // Change state to complete and notify App

    complete(onComplete) {
      this.state = 'complete';
      this.notifyInactive();
      this.clearTimer();
      
      // TODO: revisit this -- should onComplete be part of 
      //  object state?
      
      if (typeof onComplete === 'function') {
        onComplete();
      } else {
        this.xxxComplete(); 
      }
    }

    // Change state to running and notify App

    startRunning() {
      this.state = 'running';
      this.notifyActive();
    }

    // Notifications to App
    // Note that active/inactive are messages to App,
    //  but are not the same as the Phase states
    //  of idle/running/complete

    notifyActive() {
      this.app.phaseActive(this);
    }

    notifyInactive() {
      this.app.phaseInactive(this);
    }

    // Schedule a full run -- 
    //  delay, then afterDelay(), then duration, then afterDuration()

    scheduleRun(stuffToDo) {

      stuffToDo = Object.assign({
        afterDelay: () => {},
        afterDuration: () => {} 
      }, stuffToDo);

      const thisPhase = this;

      // TODO: No change of state?
      
      const afterDuration = function() {
        thisPhase.forceComplete();
        if (stuffToDo.afterDuration !== undefined) {
          stuffToDo.afterDuration();
        }
      };

      // After the delay: do stuff; schedule what to do after the duration
      // TODO: no change of state?
      
      const afterDelay = function () {
        stuffToDo.afterDelay();
        if (thisPhase.duration < Number.POSITIVE_INFINITY) {
          thisPhase.waitAndCall(thisPhase.duration, afterDuration);
        }
      };

      this.state = 'idle';
      this.waitAndCall(this.delay, afterDelay);
    }

    // Schedule a future function call

    waitAndCall(timeInMillieconds, aFunction) {
      this.timer = window.setTimeout(aFunction, timeInMillieconds);
    }

    // Clears currently running timer

    clearTimer() {
      if (this.timer !== null) {
        clearTimeout(this.timer);
        this.timer = null;
      }
    }

    // TEMP - this is for diagnostics only

    get json() {
      return {
        id: this.id,
        type: this.constructor.name,
        delay: this.delay,
        duration: this.duration,
        children: this.childPhases !== undefined ? this.childPhases.map(child => child.json) : null
      }
    }
  }

  // This is the "leaf" object -- does not contain
  //  any children (it may not be necessary)

  class Phase_noChildren extends Phase {

    constructor(options) {
      super(options);
    }

    forceComplete() {
      this.complete();
    }

    get isContainer() { return false }

    // Main run routine
    // Schedule to run after delay and call
    //  onComplete after duration

    run(onComplete) {

      let thisPhase = this;

      // KLUDGE
      
      this.xxxComplete = onComplete;
      
      let callAfterDelay = function () {
        thisPhase.startRunning();
      };

      this.scheduleRun({
        afterDelay: callAfterDelay,
        afterDuration: onComplete
      });
    }
  }

  // TimeContainer abstract class

  class Phase_withChildren extends Phase {

    constructor(options) {
      super(options);
      this.childPhases = [];
    }

    get isContainer() { return true }

    addChild(childPhase) {
      childPhase.parentPhase = this;
      childPhase.app = this.app;
      this.childPhases.push(childPhase);
    }

    forceChildrenToComplete() {
      this.childPhases.forEach(childPhase => childPhase.forceComplete());
    }

    forceComplete() {
      this.forceChildrenToComplete();
      this.complete();
    }
  }

  // Parallel TimeContainer

  class Phase_par extends Phase_withChildren {

    constructor(options) {      
      super(options);
    }

    // Check if all the child phases have completed (boolean)
    // TODO: this may not be necessary

    get allChildrenComplete() {
      return this.childPhases.every(childPhase => childPhase.isComplete)
    }

    // Start all child phases running

    runAllChildren(onChildComplete) {
      this.childPhases.forEach(childPhase => childPhase.run(onChildComplete));
    }

    // Generate a function that is called every time a child completes.
    // If all children are complete, transition this phase to complete

    getOnChildCompleteCallback(onThisPhaseComplete) {

      let thisPhase = this;

      let onChildCompleteCallback = function() {
        if (thisPhase.allChildrenComplete) ;
      };
      
      return onChildCompleteCallback;
    }

    // Main run routine

    run(onComplete) { 

      let thisPhase = this;

      // KLUDGE
      
      this.xxxComplete = onComplete;
      
      // Schedule to start running after delay

      let onChildComplete = this.getOnChildCompleteCallback(onComplete);

      let callAfterDelay = function () {
        thisPhase.startRunning();
        thisPhase.runAllChildren(onChildComplete); // Run children
      };

      this.scheduleRun({
        afterDelay: callAfterDelay,
        afterDuration: onComplete
      });
    }
  }

  // Sequence TimeContainer

  class Phase_seq extends Phase_withChildren {

    constructor(options) { 
      super(options);
      this.currChildIndex = -1;
      this.onAllChildrenComplete_KLUDGE = function() {};
    }
    
    // Force advance to the next child
    // TODO: this is a kludge
    
    forceNext() {
      
      console.log('NEXT!!');
      console.log(this.isRunning);

      let nextChild = this.currChildIndex + 1;
      if (nextChild < this.childPhases.length && this.isRunning) {
        console.log(this.currChildIndex);
        this.childPhases[this.currChildIndex].forceComplete();
      }
    }

    // Start all child phases running
    // (recurse through children)

    runAllChildren(onLastChildComplete) {
      let firstChildIndex = 0;
      this.runChild(firstChildIndex, onLastChildComplete);
    }

    // notifyParentCallback is provided by parentPhase to let it 
    //  know when sequence is complete

    runChild(currChildPhaseIndex, onLastChildComplete) {

      let thisPhase = this,
        isLastChild = (this.childPhases.length === currChildPhaseIndex + 1),
        currentChild = this.childPhases[currChildPhaseIndex],
        onChildComplete;

      this.currChildIndex = currChildPhaseIndex;
      
      // If this is the last child Phase, 
      //  complete this Phase when the child is complete

      if (isLastChild) {
        onChildComplete = function () { 
          
          this.currChildIndex = -1;
          
          // COMMENTED OUT -- when children are complete is NOT when the phase completes
          //  (maybe - need to check SMIL)
          // thisPhase.complete();
          // onLastChildComplete();
        };
      } else { 

        // If this is not the last child Phase, 
        //  run the next child when this child Phase is complete

        onChildComplete = function () {
          // thisPhase.currChildIndex = currChildPhaseIndex + 1;
          thisPhase.runChild(currChildPhaseIndex + 1, onLastChildComplete);
        };
      }

      currentChild.run(onChildComplete);
    }

    // Main run routine

    run(onComplete) {

      let thisPhase = this;

      // KLUDGE
      
      this.xxxComplete = onComplete;
      
      // Schedule to start running after delay

      let callAfterDelay = function () {
        thisPhase.startRunning();
        thisPhase.runAllChildren(onComplete); // Run children
      };

      this.scheduleRun({
        afterDelay: callAfterDelay,
        afterDuration: onComplete
      });
    }
  }

  // Map @phase-type values to Classes

  Phase.types = {
    par: Phase_par,
    parallel: Phase_par,
    seq: Phase_seq,
    sequence: Phase_seq,
    leaf: Phase_noChildren
  };

  // Phase factory

  function phaseFactory(options) {
    if (Phase.types[options.type] !== undefined) {
      return new Phase.types[options.type](options);
    } else {
      console.warning(`Unrecognised Phase type ${options.type}!`);
    }
  }

  // Given a Part definition, set up shared data entries in store

  function initPartTypeSharedData(partTypeName, partDef, p4vData, localStore, flightInstanceId) {
    
    let sharedData = partDef.part.sharedData ? partDef.part.sharedData() : undefined;

    // TEMP KLUDGE - it should not be here ...
    // sharedData = Object.assign({ _isActive: false }, sharedData);
    
    let sharedDataExists = (sharedData !== undefined && Object.keys(sharedData).length > 0);
    
    if (sharedDataExists) {

      // Get the setters/getters for shared variables
      
      let partTypeSettersGetters = localStore.getPartTypeSettersGetters({ 
        sharedVariables: sharedData,
        flightInstanceId: flightInstanceId
      });

      // Create a Part module in store for each instance of this Part Type
      //  (this instance ID list is pulled from P4Vdata)
      
      const partInstanceIDs = Object.keys(p4vData.parts)
        .filter(partKey => p4vData.parts[partKey].type === partTypeName)
        .map(partKey => p4vData.parts[partKey].id);
      
      // Register each instance of this Part Type with the store

      partInstanceIDs.forEach(partId => {
        localStore.registerPart({
          sharedVariables: sharedData,
          partId: partId,
          flightInstanceId: flightInstanceId
        });
      });

      // Add shared variable setters and getters to 
      //  the component's .computed
      // TODO: Currently overwrites .computed -- should this be moved to a mixin?

      partDef.part.computed = partTypeSettersGetters; 

      delete partDef.part.sharedData;
    }
    
    return partDef;
  }

  var PartUtils = /*#__PURE__*/Object.freeze({
    initPartTypeSharedData: initPartTypeSharedData
  });

  // The default Part is an HTML pass-through
  /*
  let part = {
    render(h) { 
      return h(
        this.$vnode.data.tag,
        this.$slots.default
      ) 
    },
    data() {
      return {
        blue: "This is from the HTML Part"
      }
    }
  }; */

  let part = {
    data() {
      return {
        blue: "This is from the HTML Part"
      }
    }
  };

  let views = [{
    partviewName: 'defaultView',
    render(h) { 
      return h(
        this.$vnode.data.tag,
        { attrs: { id: this.id }},
        this.$slots.default
      ) 
    }
  }];

  var _default = /*#__PURE__*/Object.freeze({
    part: part,
    views: views
  });

  // _SUPER PART
  // This is the base functionality that all parts share

  /* TODO: NOT SURE if the Part needs to know its ID / PartID */

  let part$1 = {
    
    data: function () {
      return {
        _isActive: false
      }
    },
    
    props: ['id'],
    
    created: function() {
      // this.$root.parts[this.id] = this; // TODO: this may not be necessary
      this.$root.app.addPartInstanceToRegistry(this);
      this.makeInactive();
    },
    
    methods: {
      makeActive: function() { 
        console.log(`PART ${this.id} IS TURNING ON`);
        this._isActive = true;
      },
      makeInactive: function() { 
        console.log(`PART ${this.id} IS TURNING OFF`);
        this._isActive = false;
      }
    }
  };

  // _SUPER PART VIEW

  let partView = {

    data() {
      return {
        _isActive: false,
        // id: undefined, // Needs to know ID for PartView-Part lookup
        red: 'This is from _Super PV edition'
      }
    },
    
    props: ['id', 'is_also', 'part_id'],
    
    // Create the Part if there is @isAlso
    // (if PartView and Part are on the same element)
    
    mounted: function() {
      
      let isAlso = this.is_also;
      
      this.$root.partviews[this.id] = this;
      
      this.$root.app.addPartInstanceToRegistry(this);
      this.makeInactive();
      
      if (isAlso) {

        console.log('PART AND PART VIEW ON SAME ELEMENT:');
        console.log(`Is also value: ${isAlso}`);
        console.log('AND APP IS');
        console.log(this.$root.app);
        
        let otherComponentName = isAlso;
        let PartComponentClass = Vue.extend(window.wtf.components[otherComponentName]);
        let partId = this.part_id;
        
        // TODO: add association between PartView and (new) Part
        
        let propsData = this.$props;
        
        let partPropKeys = Object.keys(this.$props)
          .filter(
            attributeName => !['id','is_also', 'part_id'].includes(attributeName)
          );
        
        let propsData2 = partPropKeys.reduce((acc, key) => {
          let newPropsData = acc;
          newPropsData[key] = this.$props[key];
          return newPropsData;
        }, {});
        
        console.log(`PROPS DATA FOR ${this.id}`);
        console.log(propsData2);
        
        let partComponent = new PartComponentClass({
          propsData: { id: partId }
        });
        
        partComponent.$mount(); // manually start the mounting of an unmounted Vue instance.
        partComponent.makeInactive();
        
        console.log(`And the new Part is:`);
        console.log(partComponent);
        
        //this.$root.parts[partId] = partComponent;
        this.$root.app.addPartInstanceToRegistry(partComponent);
      }
    },
    
    methods: {
      makeActive: function() { 
        console.log(`PART VIEW ${this.id} IS TURNING ON`);
        this._isActive = true;
        this.$el.classList.add('part-active');
        this.$el.classList.remove('part-inactive');
      },
      makeInactive: function() { 
        console.log(`PART VIEW ${this.id} IS TURNING OFF`);
        this._isActive = false;
        this.$el.classList.remove('part-active');
        this.$el.classList.add('part-inactive');
      }
    }
  };

  // WRAP IT ALL UP AND EXPORT

  let views$1 = [partView];

  var _super = /*#__PURE__*/Object.freeze({
    part: part$1,
    views: views$1
  });

  // A simple demonstration poll

  // PART

  let part$2 = {
    template: `<div><slot></slot></div>`,
    sharedData: function() {
      return {
        count: 0,
        count2: 0,
        count3: 0
      }
    }
  };

  // PART VIEWS

  let partView_counterButton = {
    partviewName: 'controller',
    template: `
    <div style="color: black">
      <h1>I know how to code:</h1>
      <button type="button" class="btn btn-light btn-block" v-on:click="inc">HTML</button>
      <button type="button" class="btn btn-light btn-block" v-on:click="inc2">CSS</button>
      <button type="button" class="btn btn-light btn-block" v-on:click="inc3">Javascript</button>
    </div>
  `,
    
    methods: {
      inc: function() { 
        console.log('INCREMENT 1!');
        this.count++;
      },
      inc2: function() { this.count2++; },
      inc3: function() { this.count3++; }
    }
  };

  let partView_countDisplay = {
    partviewName: 'display',
    template: `
    <div>
      <p style="color: red">{{ ''.repeat(count) }} HTML</p>
      <p style="color: yellow">{{ ''.repeat(count2) }} CSS</p>
      <p style="color: blue">{{ ''.repeat(count3) }} Javascript</p>
    </div>`
  };

  // WRAP IT ALL UP AND EXPORT

  let views$2 = [partView_counterButton, partView_countDisplay];

  var poll = /*#__PURE__*/Object.freeze({
    part: part$2,
    views: views$2
  });

  /*

    This Part presents a play/advance button that starts the presentation 
    and advances the seq Phase specified in @phaseId.

  */

  let part$3 = {
    template: `<div><slot></slot></div>`,
    // props: ['phase_id'],
    sharedData: function() {
      return {
        currSlide: -1
      }
    },
    data: function() {
      return {
        playing: false 
      }
    }
  };

  // PART VIEWS

  let partView_button = {
    partviewName: 'defaultView',
    props: ['phase_id'],
    template: `
    <button v-on:click="advance">
      next 
    </button>`,
    methods: {
      
      // THIS WILL ONLY BE RUN BY INITIALIZOR
      // WHEN HITTING THE 'RUN' BUTTON
      
      makeGliderRun: function() {
        this.currSlide = -1;
        window.setTimeout(function() { 
          // alert('yes: ' + thisPartView.currSlide);
          // thisPartView.currSlide = 0 
        }, 1000);
      },
      
      advance: function() { 
        console.log('HIT');
        this.currSlide++;
      }
    },
    watch: {
      currSlide: function (newVal, oldVal) {
        
        console.log(`currSlide changed from ${oldVal} to ${newVal}`);

        if (newVal !== -1) {
          
          console.log('RUN **********************');
          
          // Some information for debugging
          
          if (! this.$root.app.isInitializingInstance) {
            if (window.glider.isRunning) { 
              console.log('not initiator - already running');
            } else {
              console.log('not initiator - not running');
            }
          } else {
            if (window.glider.isRunning) { 
              console.log('initiator - already running');
            } else {
              console.log('initiator - not running');
            }
          }
          
          if (window.glider.isRunning) {
            console.log('ADVANCING -- BLAH BLAH BLAH');
            window.glider.phases[this.phase_id].forceNext();
          }
        }
        
        
        /*
        if (newVal === -1 && this.$root.app.isInitializingInstance) {
          console.log('GO');
        } else {
          console.log('MAKE ME GO');
          this.currSlide++;
          // this.currSlide = -1; 
        } */
        
        /*
        if (newVal === -1) {
          alert('STARTING');
          this.currSlide = -1;
        } else {
          //alert('ADVANCING TO ' + newVal);
          window.glider.phases[this.phase_id].forceNext();
        } */
      }
    }
  };

  // WRAP IT ALL UP AND EXPORT

  let views$3 = [partView_button];

  var nextButton = /*#__PURE__*/Object.freeze({
    part: part$3,
    views: views$3
  });

  // A simple demonstration color picker.
  // The controller can choose a color, which is reflected on the display

  // PART

  let part$4 = {
    sharedData: function() {
      return {
        color: 'black'
      }
    }
  };

  // PART VIEWS

  let partView_colorPicker = {
    partviewName: 'controller',
    template: `
    <div style="color: white; text-align: center">
      <h1>Choose</h1>
      <div style="font-size: 300%; padding: 10px; border: 1px solid white">
        <span v-on:click="setRed" style="color: red">
          
        </span>
        <span v-on:click="setBlue" style="color: blue">
          
        </span>
        <span v-on:click="setGreen" style="color: green">
          
        </span>
        <span v-on:click="setOrange" style="color: orange">
          
        </span>
      </div>
    </div>
  `,
    
    methods: {
      setRed: function() { 
        this.color = 'red';
      },
      setBlue: function() { 
        this.color = 'blue';
      },
      setGreen: function() { 
        this.color = 'green';
      },
      setOrange: function() { 
        this.color = 'orange';
      }
    }
  };

  let partView_colorDisplay = {
    partviewName: 'display',
    template: `
    <h1 class="display-1">
      {{ color }}
    </h1>`,
    watch: {
      color: function (color) {
        document.body.style.backgroundColor = color;
      }
    }
  };

  // WRAP IT ALL UP AND EXPORT

  let views$4 = [partView_colorPicker, partView_colorDisplay];

  var colorPickerDemo = /*#__PURE__*/Object.freeze({
    part: part$4,
    views: views$4
  });



  var partTypeRegistry = /*#__PURE__*/Object.freeze({
    _super: _super,
    identity: _default,
    poll: poll,
    nextButton: nextButton,
    colorPickerDemo: colorPickerDemo
  });

  /*

    For now, there are 2 hard-coded Place definitions: DSL-wall and DSL-table
    
    (Eventually, these should be user-defined rather than hard-coded)

    The Place registry is what's exported -- with the P4V data, these Places can be used to create Regions

  */


  // Place base class
  // The machanism for hiding / unhiding would go here

  class Place {
    
    constructor (options) {
      this.id = options.id || (new Date()) + Math.floor(Math.random() * 10000);
      this.isHere = undefined;
    }
    
    // Get the ID for this Place -- e.g. "place-dslwall"
    
    getCssPlaceId() {
      return `place-${this.id}`; // TODO: No magic!
    }
    
    // UTILITY: Add a CSS stylesheet reference to the head as a <link>
    //  IFF it hasn't already been added, and the client is "here"
    //   (no point in loading it if it isn't here!)
    
    addCssStylesheet(options) {
      
      // options = { id, url, integrity, crossorigin }
      
      let elementId = options.id,
          styleSheetUrl = options.url,
          integrity = options.integrity,
          crossOrigin = options.crossorigin;
      
      if (document.getElementById(elementId) === null && this.isHere) {
        
        let styleElement = document.createElement('link');
        
        styleElement.setAttribute('id', elementId);
        styleElement.setAttribute('rel', 'stylesheet');
        styleElement.setAttribute('href', styleSheetUrl);
        
        if (integrity !== undefined) {
          styleElement.setAttribute('integrity', integrity);  
        }
        
        if (crossOrigin !== undefined) {
          styleElement.setAttribute('crossorigin', crossOrigin);
        }
        
        document.head.appendChild(styleElement);
      }
    }
    
    // UTILITY: Add CSS code to the head as a <style>
    // Give the style element an ID
    
    addCss(options) {
      // Check if style w that ID already exists
      if (document.getElementById(options.id) === null) {
        let styleElement = document.createElement('style');
        styleElement.setAttribute('id', options.id);
        styleElement.appendChild(document.createTextNode(options.css));
        document.head.appendChild(styleElement);
      }
    }
    
    set clientPlace(clientPlace) {
      this.isHere = (this.id === clientPlace);
    }
    
    assignPartViewToRegion(selector, partView) {
      partView.container.classList.add(this.isHere ? 'place-here' : 'place-not-here');
      this.assignPartViewToRegion2(selector, partView);
    }
  }

  // FixedGridPlace

  /*

    Global CSS is only loaded when a Region is created

  */

  class FixedGridPlace extends Place {
    
    constructor(options) {
      
      super(options);
      
      this.options = {
        rows: parseInt(options.rows) || 1,
        columns: parseInt(options.columns) || 1, 
        rowHeight: parseInt(options.rowHeight) || 1080, 
        columnWidth: parseInt(options.columnWidth) || 1920
      };
      
      this.loadGlobalCSS();
    }
    
    loadGlobalCSS() {
      
      let defaultRegionSelector = 'defaultRegion'; // TODO: NO MAGIC - This should be from the settings

      super.addCss({
        id: 'place-fixedgrid-global',
        css: `
        .placetype-fixedgrid, .placetype-fixedgrid-${defaultRegionSelector} {
          width: ${this.options.columnWidth * this.options.columns}px;
          height: ${this.options.rowHeight * this.options.rows}px;
        }`
      });
    }
    
    loadCSS(regionCSS) {
      this.loadGlobalCSS();
      super.loadCSS(regionCSS);
    }
    
    assignPartViewToRegion2(selector, partView) {
      console.log(`FixedGridPlace region ${selector} being assigned to Part`);
      return new FixedGridPlaceRegion(selector, partView, this);
    }
  }

  class FixedGridPlaceRegion { // Q: Is there any reason to make this a subclass of Place?
    
    constructor(selector, partView, parentPlace) {
      
      // super();
      
      this.parentPlace = parentPlace;
      
      if (selector !== undefined) {

        // Extract Region properties out of rcwh selector
        // TODO: this should extract rcwh, crwh, rc, etc.

        const parseSelectorRegEx = /^c(\d+)r(\d+)w(\d+)h(\d+)$/i;
        let parsedSelector = {};

        let matches = selector.match(parseSelectorRegEx);
        
        if (matches !== null) {
          
          [parsedSelector.column, parsedSelector.row, parsedSelector.width, parsedSelector.height] 
            = matches.slice(1,6).map(x => parseInt(x));

          // Add CSS as style tag in head

          parentPlace.addCss({
            id: `place-fixedgrid-${selector}`,
            css: `
            .place-fixedgrid-${selector} {
              position: absolute;
              width: ${parentPlace.options.columnWidth * parsedSelector.width}px;
              height: ${parentPlace.options.rowHeight * parsedSelector.height}px;
              left: ${parentPlace.options.columnWidth * (parsedSelector.column - 1)}px;
              top: ${parentPlace.options.rowHeight * (parsedSelector.row - 1)}px;
            }
          `
          });
        }
      } else {
        console.log('REGION UNDEFINED');
        // What happens if region is undefined? 
      }
      
      // Get the element associated with a Part
      //  and assign the Place class to it (both generic and specific)
      
      partView.container.classList.add(`place-fixedgrid-${selector}`);
      partView.container.classList.add(`placetype-fixedgrid`); // TODO: this should be default behavior for all Places
      partView.container.classList.add(`place-${parentPlace.id}`);
      
      // TODO: let Part know that it's in a Place, in case it needs to do something with 
      //  that information (maybe via VuEx)
      
      // TODO: let Part know if it's inRole or not (maybe via VuEx)
    }
  }

  // Bootstrap Place

  class BootstrapPlace extends Place {
    
    constructor (options) {
      super(options);
    }
    
    loadBootstrap() {
      
      this.addCssStylesheet({
        id: 'place-bootstrap-global',
        url: 'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css',
        integrity: 'sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u',
        crossorigin: 'anonymous'
      });
      
      this.addCss({
        id: `place-bootstrap`,
        css: `
        body {
          padding: 5% 15%;
        }
      `
      });
    }
    
    assignPartViewToRegion2(selector, partView) {
      
      console.log(`Bootstrap region ${selector} being assigned to PartView`);
      console.log(partView);
      
      return new BootstrapPlaceRegion(selector, partView, this);    
      
      // TODO: Notify PartView that it's in a place 
      // (this probably will be via the VuEx store)
    }
  }

  class BootstrapPlaceRegion {
    
    constructor(selector, partView, parentPlace) {
      partView.container.classList.add(`placetype-bootstrap-${selector}`);
      // TODO: There must be a standard bootstrap class name??
      partView.container.classList.add(`place-${parentPlace.id}`);
      parentPlace.loadBootstrap();
    }
  }

  // This keeps track of all the place type constructors
  // The keys are are lower case versions of the @type value
  //  in the markup

  const placeTypeConstructor = {
    bootstrapplace: BootstrapPlace,
    fixedgridplace: FixedGridPlace
  };


  function getPlaceRegistry(p4vData) {
    
    let placeRegistry = {};
    
    p4vData.placeDefs.forEach(placeDef => {
      placeRegistry[placeDef.id] = new placeTypeConstructor[placeDef.type.toLowerCase()](placeDef);
    });
    
    return placeRegistry;
  }

  /*

    IDEAS:
    
    - This is a good place to optimize:
      - Any Parts type=default that have no Phases or Places associated can be ignored
        (would this take care of the nested HTML problem?)
    - Make implicit types explicit, e.g. state default Part types, Phase types, etc.
      Maybe on @data-part-type-implicit or @phase-type-implicit

  */

  // These functions take the P4v Store and create
  //  the Places, Phases, and Parts/Part Views

  function createParts(p4vStore, p4vData, partRegistry, PartUtils, Vue, flightInstanceId) {
    
    // Get unique list of Part types in markup

    let partTypeList = Array.from(new Set(
      Object.values(p4vData.parts).map(part => part.type)
    ));
    
    // Register each PartType as a Vue component,
    //  along with its PartViews
    
    partTypeList.forEach(partTypeName => {
      console.log('PPPPPPPPP ' + partTypeName);
      if (partRegistry[partTypeName] !== undefined) {
        
        console.log(`REGISTERING VUE COMPONENT FOR ${partTypeName}. Definition:`);
        console.log(partRegistry[partTypeName].part);
        
        let partTypeDef = partRegistry[partTypeName];
        
        // All Parts extend the base _super.part component
        
        partTypeDef.part.extends = partRegistry['_super'].part;
        
        // Initialize this Part Type's shared data
        // TODO: turn this into a function w return value (it's a black box)
        
        PartUtils.initPartTypeSharedData(partTypeName, partTypeDef, p4vData, p4vStore, flightInstanceId);
        
        // If no rendering defined, just do a pass-through
        // TODO: is this the best option?
        
        if (partTypeDef.part.template === undefined && partTypeDef.part.render === undefined) {
          partTypeDef.part.template = '<div><slot></slot></div>';
        }
        
        // If there are shared variables in this Part, then create getters/setters
        //  for use in the Part View
        
        let partSharedVarAccessors = Object.keys(partTypeDef.part.computed || {})
          .reduce((gettersSetters, sharedVarName) => {
            
            let getter = function() {
              return p4vStore.getters.getPartViewSharedVariable(this.id, sharedVarName);
            };
            
            let setter = function(value) {
              console.log(`SETTING ${sharedVarName} TO ${value} in VUE!`);
              // p4vStore.commit('setPartViewSharedVariable', [this.id, sharedVarName, value]);
              p4vStore.setPartViewSharedVariable(this.id, sharedVarName, value);
            };
            
            gettersSetters[sharedVarName] = { get: getter, set: setter };
            return gettersSetters;
            
          }, {});
        
        // Register Part component
        
        Vue.component(partTypeName, partTypeDef.part);
        
        // Register this Part's Views as components
        //   (which also extend from _super.part)
        
        if (partTypeDef.views) {
          
          partTypeDef.views.forEach(partView => {
            
              let partViewVueName = PARSING_CONSTANTS.PART.GET_VUE_COMPONENT_NAME(partTypeName, partView.partviewName);
            
              partView.extends = partRegistry['_super'].views[0];
              partView.computed = Object.assign(partSharedVarAccessors, partView.computed);
            
              console.log(`REGISTERING VUE COMPONENT FOR ${partViewVueName}. Definition:`);
              console.log(partView);
            
              Vue.component(partViewVueName, partView);
            }
          );
        }
      } else {
        console.error(`Unknown Part Type ${partTypeName}! (not registered)`);
      }
    });
    
    // For each Part and PartView in the p4vData,
    //  add an @is attribute to the element to
    //  signal to Vue that it is a component
    // Also, add a @ref and set it to ID
    // Also, add a suitable class name to @class
    
    // Parts - add @is and @ref, and add classname
    
    for (let partId in p4vData.parts) {
      let partDef = p4vData.parts[partId];
      partDef.container.setAttribute('is', partDef.type);
      partDef.container.classList.add(
        PARSING_CONSTANTS.PART.GET_CSS_CLASS(partDef.type)
      );
      partDef.container.setAttribute('ref', partId);
    }
    
    // Part Views - add @is and @ref and add classname

    for (let partViewId in p4vData.partViews) {
      
      let partViewDef = p4vData.partViews[partViewId],
          parentPartId = partViewDef.partId,
          parentPartType = p4vData.parts[parentPartId].type;
      
      console.log(`SETTING PARTVIEW @IS TO ${parentPartType}-${partViewDef.name}`);
      
      // KLUDGE: Copy over id in data structure to DOM node
      
      partViewDef.container.setAttribute('id', partViewId);
      
      // If also a Part, then move that over to @isAlso
      //  and register this partView in a Place 
      //  (not sure that this is the place to do that ...)
      
      if (partViewDef.container.getAttribute('is') !== null) {
        partViewDef.container.setAttribute(
          'is_also',
          partViewDef.container.getAttribute('is')
        );
        
        partViewDef.container.setAttribute('part_id', parentPartId);

        if (p4vData.parts[parentPartId].place) {
          // console.log('8888888888888');
          // console.log(p4vData.parts[parentPartId]);
          // console.log(`${partViewId} is in ${p4vData.parts[parentPartId].place}`);
          p4vStore.addPartViewToPlace(partViewId, p4vData.parts[parentPartId].place);      }
      }
      
      partViewDef.container.setAttribute('is', `${parentPartType}-${partViewDef.name}`);
      partViewDef.container.classList.add(
        PARSING_CONSTANTS.PART.GET_CSS_CLASS(parentPartType, partViewDef.name)
      );
      partViewDef.container.setAttribute('ref', partViewId);
    }
    
    // Now release Vue on it!
    // (What if Phases/Places want to adjust the markup before Vue-ifying? Should this step be deferred?)
    // Maybe this should be merged into a general "make it so" step that includes kickstarting the Phases
  /*
    new Vue({
      el: '#glider-root'
    });
    */
    
  }

  // Go through each Place in p4vData and create a Place object
  //   (Remember that Parts don't have Places -- only Part Views do)

  function createPlaces(p4vStore, p4vData, placeRegistry, clientPlace) {
      
    let places = {},
        placeId;
    

    /*  c// onsole.log('YYYYYYYYYYYY');
    c// onsole.log(p4vStore.placesPartviews);
    c// onsole.log(p4vData.placesPartviews);
    
  */
      for (placeId in p4vData.places) {
      
      let placeData = p4vData.places[placeId],
          placeObject = placeRegistry[placeData.role];

     
      // console.log(`Is ${placeId} here? ${placeObject.isHere}`);
      
      // Assuming the Place is found in the registry ...
      // (TODO: this should be fixed to allow for new entries)
      
      if (placeObject === undefined) {
        console.error(`Place '${placeData.role}' not found in registry`);
        // TODO: Should default to something
      } else {
         console.log(`PLACE OBJECT ${placeData.role}`);
   //     console.log(placeObject);
        console.log(p4vData.placesPartviews[placeId]);

        console.log(p4vStore.placesPartviews[placeId]);      

        placeObject.clientPlace = clientPlace; // TODO: is this the time to do this?

        // Go through each PV assigned to this Place
        //  and assign it to a PlaceRegion (default if unspecified)
        
        if (p4vStore.placesPartviews[placeId] !== undefined) {
          p4vStore.placesPartviews[placeId].forEach(
            partViewId => placeObject.assignPartViewToRegion(
              placeData.region, p4vData.partViews[partViewId]
            )
          ); 
        }
      }
    }
    
    // Have the Place watch a VuEx registry
    // that maps a place-ID with an array of PartView-IDs
    
    // Associated with that registry -- a trigger that
    // IF a View is added, then throw the View at it
    // AND if a View is removed, then undo it (not a priority)
    
    return places;
  }

  // Go through each Phase object in p4vData.phases
  //  and create a corresponding object, then use the
  //  parent/child information in p4vData.phaseChildren
  //  to associate those Phase objects
  // Return hash of phases by ID

  function createPhases(gliderApp, p4vData, phaseFactory) {
    
    let phases = {};
    
    // Create Phase objects
    
    for (let phaseId in p4vData.phases) {
      // let phaseData = p4vData.phases[phaseId];
      let phaseData = Object.assign({ app: gliderApp }, p4vData.phases[phaseId]);

      console.log("PHASE DATA");
      console.log(phaseData);
      phases[phaseId] = phaseFactory(phaseData);
    }
    
    // Associate child Phases with parents
    
    for (let parentPhaseId in p4vData.phaseChildren) {
      
      let parentPhase = phases[parentPhaseId],
        phaseChildren = p4vData.phaseChildren[parentPhaseId].map(id => phases[id]);
      
      phaseChildren.forEach(childPhase => parentPhase.addChild(childPhase));
    }
    
    console.log("CREATING PHASES IN FACTORY");
    console.log(phases);
    
    return phases;
  }

  //import Glider from './glider.js'; 


  // window.location.hash = `#/${prompt("Flight ID", "Letters and digits only")}/dslWall`;
  // (maybe prompt for flightID, incorporate into URL, which allows user to hit refresh?)
  // #/FLIGHT_ID/ROLE/JUMPHASH
  // If jumphash = 'main' then this is the initializing instance

  // window.location.hash = `#/2345/phone/main`; // TEMP -- manually seeding flight instance ID and Place
  // window.location.hash = `#/2345/phone`; // TEMP -- manually seeding flight instance ID and Place

  let { flightInstanceId, herePlace, nowPhase, initialize } = getGliderOptions();

  console.log(`PARSED URL ${flightInstanceId}; ${herePlace}`);
  console.log(flightInstanceId, herePlace, nowPhase, initialize);

  Vue.use(Vuex);

  // Global glider object for export

  let glider = {};

  // Main Glider bootup sequence

  function gliderBootOnDomLoad() {

    // Add default stylesheet unless overridden
    
    if (! document.querySelector('#glider-style')) {
      const gliderStylesheetLink = document.createElement('link');
      gliderStylesheetLink.setAttribute('id', 'glider-style'); // TODO: NO MAGIC
      gliderStylesheetLink.rel = 'stylesheet';
      gliderStylesheetLink.href = 'https://glider.glitch.me/glider/style.css'; // TODO: NO MAGIC
      document.head.appendChild(gliderStylesheetLink);
    }
    
    // Add classname to body tag for this place
    
    document.body.classList.add(`place-here-${herePlace}`);  // TODO: NO MAGIC
    
    // Parse the flight markup and get the data structure

    let parsedP4v = main();
    
    console.log('-------------------------------------------------------');
    console.log("DATA RETURNED FROM PARSER");
    console.log(parsedP4v);
    
    // Add start button (TEMP, until we do async loading)
    
    let startButton = document.createElement('section');
    startButton.setAttribute('id', 'glider-start');
    startButton.setAttribute('class', 'not-ready2');
    startButton.innerHTML = '<p><br />Start</p>';
    startButton.onclick = function() {
      window.glider.run(); 
      this.parentNode.removeChild(this);
    };

    document.body.appendChild(startButton);

    // Take that data structure and initialize the p4v store
    // TODO: This can be done immediately (no need for the DOM to load)
    
    let gliderApp = getLocalStore(flightInstanceId, parsedP4v, initialize);
    
    gliderApp.here = herePlace;
    gliderApp.isInitializingInstance = initialize;
    window.gApp = gliderApp;
    

    
    // Create the parts/part views, places, and phases
    // TODO: flightInstanceId should live as part of the store (or something)
    //  so that it's globally accessible -- shouldn't be passed as a parameter

    console.log('-------------------------------------------------------');
    console.log("CREATING PARTS");
    createParts(gliderApp, parsedP4v, partTypeRegistry, PartUtils, Vue, flightInstanceId);
    
    console.log('-------------------------------------------------------');
    console.log('CREATING PLACES');
    console.log(parsedP4v.places);
    
    const placeRegistry = getPlaceRegistry(parsedP4v);
    let places = createPlaces(gliderApp, parsedP4v, placeRegistry, herePlace);
    
    console.log('-------------------------------------------------------');
    console.log('CREATING PHASES');
    let phases = createPhases(gliderApp, parsedP4v, phaseFactory);
    console.log(phases);
    
    // Initialize global glider API
    /*
    glider = new Glider(gliderApp);
    glider.store = gliderApp;
    glider.places = places;
    glider.phases = phases;
    glider.registerPlace = placeRegistry;
    
    window.glider = glider;
    */
    
    // Start Glider! (should this be in a module?)

    window.glider = {};
    window.herePlace = herePlace;
    window.glider.phases = phases;
    window.glider.phases2Parts = parsedP4v.phasesParts;
    
    {
      console.log('-------------------------------------------------------');
      console.log('RENDERING VUE');
      console.log('BEFORE');
      console.log(Vue.options);
      window.wtf = Vue.options;
      
      let rootVue = new Vue({ 
        el: '#glider-root', // TODO: NO MAGIC!
        data: {
          abc: 'def', // TEST
          store: gliderApp,
          app: gliderApp,
          parts: {},
          partviews: {}
        }
      });
      
      window.glider.parts = rootVue.$refs;
      
      // window.glider.isRunning = false;
      
      window.glider.run = function () { 
        this.isRunning = true;
        // this.parts['pv-nextBut-defaultView'].makeGliderRun();
        this.phases['glider-root'].run(); 
      };
      // window.vv = rootVue;
      console.log('AFTER');
      console.log(Vue.options);
    }

    // phases.run();
  }
  document.addEventListener('DOMContentLoaded', gliderBootOnDomLoad);

  exports.glider = glider;

  return exports;

}({}));
var glider = (function (exports) {
  'use strict';

  // This gets the Glider options from the URL and from parameters passed
  // Specifically, it gets the flight instanceId, herePlace and the Phase target

  function getGliderOptions() {
    
    let hash = window.location.hash,
        initialize, jumpTarget;
    
    let [flightInstanceId, clientPlace, target] = hash.slice(2).split('/');

    if (target === 'main') {
      initialize = true;
      jumpTarget = null;
    } else {
      initialize = false;
      jumpTarget = target;
    }
    
    return {
      flightInstanceId: flightInstanceId || '0000', // NO MAGIC
      herePlace: clientPlace,
      nowPhase: jumpTarget,
      initialize: initialize
    }
  }

  let PARSING_CONSTANTS = {

    FLIGHT_PLAN_SELECTOR: '.glider-root',

    PART: {
      ID_ATT_NAME: 'id',
      PART_ID_ATT_NAME: 'part-id',
      PART_REF_ATT_NAME: 'part-ref',
      PART_ATT_NAME: 'part',
      TYPE_ATT_NAME: 'part-type',
      VIEW_ATT_NAME: 'part-view',
      OPTIONS_ATT_NAME: 'part-options',
      SELECTOR_PREFIX: 'part-',
      CLASSNAME_PREFIX: 'part-',
      TYPE_VIEW_DELIMITER: '-',
      TYPE_CSS_CLASS_PATTERN: /^part-([^\-\s]+)$/,
      VIEW_CSS_CLASS_PATTERN: /^part-[^\-\s]+-([^\-\s]+)$/,
      DEFAULT_PART_NAME: 'identity',
      DEFAULT_VIEW_NAME: 'defaultView',
      VIEW_UNDEF: 'no-view-defined'
    },

    PHASE: {
      ID_ATT_NAME: 'id',
      TYPE_ATT_NAME: 'phase-type',
      TYPES: { PAR: 'par', SEQ: 'seq', LEAF: 'leaf' },
      DELAY_ATT_NAME: 'phase-begin',
      DURATION_ATT_NAME: 'phase-duration',
      PHASE_DESCENDANT_SELECTOR: '*[phase-type],*[phase-duration],*[phase-begin]'
    },

    PLACE: {
      ID_ATT_NAME: 'place',
      PLACE_ATT_NAME: 'place',
      ROLE_ATT_NAME: 'place-role',
      REGION_ATT_NAME: 'place-region',
      SELECTOR_PREFIX: 'place-',
      CLASSNAME_PREFIX: 'place-',
      ROLE_REGION_DELIMITER: '-', // We define this but don't use it!
      DEFAULT_REGION_NAME: 'defaultRegion'
    }
  };

  // ID and Classname generators

  PARSING_CONSTANTS.PART.GET_CSS_CLASS = (partName, partViewName) => {
    return `${PARSING_CONSTANTS.PART.CLASSNAME_PREFIX}${partName}` 
      + (partViewName 
         ? `${PARSING_CONSTANTS.PART.TYPE_VIEW_DELIMITER}${partViewName}` 
         : '');
  };

  PARSING_CONSTANTS.PART.GET_VUE_COMPONENT_NAME = (partName, partViewName) => {
    return `${partName}-${partViewName}`;
  };

  /*

  OUTLINE

  - Constants used by the parser

  - Utility functions
    - getHash()
    - getIdFromDomPosition()
    
  - Misc parsing functions
    - getPlaceDefinitions()

  - P4V_Data class
    (The data structure that will initialize the PPPPv objects)

  - Register class
    (This object keeps track of "current" Parts, Places, Phases
    as the DOM is parsed)

  - High-level parsing functions 
    (they don't access the DOM directly, but do the high-level
    analysis and recursion)
    - parseFlightPlans()
    - parseFlightPlan()
    - parseDomElem()

  - Data from DOM functions
    (Routines that look at the DOM and pull out the data as
    it relates to PPP definitions. This data is passed back to 
    the high-level parsing functions)
    - getDataFromDomElem(), which calls:
      - getPhaseDataFromDomElem()
      - getPartDataFromDomElem()
      - getPlaceDataFromDomElem()

  - main()
    This is what is exported from the module

  */


  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

  // Utilities

  // Simple hash function adapted from 
  //  https://stackoverflow.com/questions/6122571/simple-non-secure-hash-function-for-javascript
  // NOTE: Can return negative numbers; e.g. hash for 'strign' is -891986113

  function getHash(string) {
    
    let hash = 0;
    
    string.split('').forEach((char) => {
      hash = ((hash << 5) - hash) + char.charCodeAt();
      hash = hash & hash; // Convert to 32bit integer
    });
    
    return Math.abs(hash);
  }

  // Get a unique identifier based on the position of the element in the DOM tree.
  // Good for auto-generating IDs for elements that will be the same across Clients
  // (Currently not used)

  function getIdFromDomPosition(domElement) {
    
    function makeId(domElement) {

      if (domElement === document.body) return ''; // boundary condition

      let previousSiblingCount = 0,
          currSibling = domElement;

      while (currSibling = currSibling.previousSibling) 
        previousSiblingCount++;

      return previousSiblingCount + '.' + makeId(domElement.parentNode);
    }
    
    return getHash(makeId(domElement));
  }


  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // Misc Parsing functions


  function getPlaceDefinitions() {
    
    let placeDefinitions = [];
    
    const toCamelCase = function(dashTerm) { 
      return dashTerm.replace(/-(\w)/gi, (s, letter) => letter.toUpperCase());
    };
    
    document.querySelectorAll('glider-defs > place').forEach(placeDefElem => {
      
      let definitionParameters = {};
      
      Array.from(placeDefElem.attributes).forEach(function(att) {
        definitionParameters[toCamelCase(att.name)] = placeDefElem.getAttribute(att.name);
      });
      
      placeDefinitions.push(definitionParameters);
    });
    
    return placeDefinitions;
  }


  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // P4V_Data CLASS
  // A mini "database" of Phases, Places, Parts, and Part-Views that
  //  are pulled from the Flightplan markup.
  // This is the object that gets returned from the parser
  //  to initialize Glider

  class P4V_Data {
    
    constructor() {
      
      this.parts = {};
      this.partViews = {};
      this.places = {};
      this.placeDefs = [];
      this.phases = {};
      
      this.rootPhaseId = null;
      
      this.phasesParts = {};
      this.partsPartViews  = {};
      this.placesPartviews = {};
      
      this.phaseChildren = {};
    }
    
    // Enter a new Phase definition in registry

    addPhase(elemData) {

      // Compile definition

      let options = {};

      options.delay = elemData.phase.delay;
      // options.duration = elemData.phase.duration;
      options.id = elemData.phase.id;

      // If duration is unspecified, then make it infinitely long
      
      if (elemData.phase.hasDuration) {
        options.duration = elemData.phase.duration;
      } else {
        options.duration = Number.POSITIVE_INFINITY;
      }
      
      // Set Phase type -- seq, par, or leaf

      let type,
          hasChildren = (elemData.domNode.children.length > 0),
          noPartDefined = ! elemData.part.type;

      if (elemData.phase.hasType) { // Phase type explicitly declared in markup
        type = elemData.phase.type;
      } else if (noPartDefined && hasChildren) { // HTML elements with children
        type = 'par';
      } else if (elemData.phase.hasNoPhaseDescendents) {
        type = 'leaf';
      } else { // Default -- this is the case for all DOM elements that have children
               //  whether they are explicit Phases or not
        type = 'par'; 
      }
      
      // Save this Phase in registry if it's new
      
      let optionsWithType = Object.assign({}, options, { type: type });
      
      if (this.phases[options.id] === undefined) {
        this.phases[options.id] = optionsWithType; 
      }

      return options;
    }
    
    setRootPhase(rootPhase) {
      this.rootPhaseId = rootPhase.id; 
    }
    
    createParentChildPhaseRelationship(parentPhase, childPhase) {
      if (this.phaseChildren[parentPhase.id] === undefined) {
        this.phaseChildren[parentPhase.id] = [];
      }
      
      this.phaseChildren[parentPhase.id].push(childPhase.id);
    }
    
    // Enter a new Part definition in registry

    addPart(elemData) {
      
      console.log("ADDING PART");
      console.log(elemData);
      
      // Compile definition
      
      let options = {
        id: elemData.part.id,
        type: elemData.part.type === undefined 
          ? PARSING_CONSTANTS.PART.DEFAULT_PART_NAME 
          : elemData.part.type,
        options: elemData.part.options,
        container: elemData.part.container
      };
      
      // TODO: Check this
      // If an HTML element, need to keep Place information
      // (maybe in the end we should create the PartView here as well -- think on this)
      
      // THIS SHOULD STORE THE PLACE ID
      
      //if (options.type === PARSING_CONSTANTS.PART.DEFAULT_PART_NAME) {
        
        if (elemData.place.hasRole || elemData.place.hasRegion) {
          options.place = this.makePlaceId(elemData.place.role, elemData.place.region);        
          console.log('Identity Part parsed: need to add Place info');
          console.log(options);
        }
        
      // }

      // Save this Part in registry if it's new
      
      if (this.parts[options.id] === undefined) {
        this.parts[options.id] = options; 
      }
      
      return options;
    }
    
    // Enter a new PartView definition in registry

    addPartView(p4vRegister) {

      console.log("ADDING PART VIEW");
      console.log(p4vRegister);
      
      let partViewName = (p4vRegister.partView.name === undefined)
        ? PARSING_CONSTANTS.PART.DEFAULT_PARTVIEW_NAME 
        : p4vRegister.partView.name;
      
      // Compile definition
      
      let options = {
        partId: p4vRegister.part.id,
        id: `pv-${p4vRegister.part.id}-${partViewName}`, // TODO: NO MAGIC VALUES!
        name: partViewName,
        container: p4vRegister.partView.container
      };
      
      // Save this PartView in registry if it's new
      
      if (this.partViews[options.id] === undefined) {
        this.partViews[options.id] = options; 
      }
      
      return options;
    }
    
    addDefaultPartViewToView(partId) {
      
      console.log("ADDING DEFAULT PART VIEW");
      
      // Compile definition

      let options = {
        partId: partId,
        id: `pv-${partId}-${PARSING_CONSTANTS.PART.DEFAULT_VIEW_NAME}`, // TODO: NO MAGIC VALUES!
        name: PARSING_CONSTANTS.PART.DEFAULT_VIEW_NAME,
        container: this.parts[partId].container
      };
      
      // Save this PartView in registry if it's new
      
      if (this.partViews[options.id] === undefined) {
        this.partViews[options.id] = options; 
      }
      
      return options;
    }
    


    // TODO: this should be in a place where all the other 
    //  IDs are minted -- maybe off of PARSING_CONSTANTS?
    
    makePlaceId(role, region) {
      
      if (region === undefined) {
        region = PARSING_CONSTANTS.PLACE.DEFAULT_REGION_NAME; 
      }
      
      return `pl-${role}-${region}`
    }
    
    // Enter a new Place definition in registry
    
    addPlace(elemData) {

      // Compile definition
      
      let placeRole = elemData.place.role,
          placeRegion = elemData.place.region === undefined 
            ? PARSING_CONSTANTS.PLACE.DEFAULT_REGION_NAME
            : elemData.place.region;
      
      let options = {
        id: this.makePlaceId(placeRole, placeRegion),
        // id: `pl-${placeRole}-${placeRegion}`, // TODO: this should be a function off of PARSING_CONSTANTS
        role: placeRole,
        region: placeRegion
      };
      
      // Save this Place in registry if it's new
      
      if (this.places[options.id] === undefined) {
        this.places[options.id] = options; 
      }
      
      return options;
    }
    
    associatePartWithPhase(p4vReg) {
      
      let phaseId = p4vReg.phase.id;
      
      if (this.phasesParts[phaseId] === undefined) {
        this.phasesParts[phaseId] = [];
      }
      
      this.phasesParts[phaseId].push(p4vReg.part.id);
      
      console.log(`Setting Part ${p4vReg.part.id} to Phase ${phaseId}`);
    }
    
    associatePartWithPartView(p4vReg) {
      
      let partId = p4vReg.part.id,
          partViewId = p4vReg.partView;
      
      if (this.partsPartViews[partId] === undefined) {
        this.partsPartViews[partId] = [];
      }
      
      this.partsPartViews[partId].push(partViewId);
      
      console.log(`Setting PartId ${partId} to PartViewId ${partViewId}`);
    }
    
    associatePartViewWithPlace(p4vReg) {
      
      let partId = p4vReg.part.id,
          partViewName = p4vReg.partView.name,
          placeId = p4vReg.place.id;
      
      if (this.placesPartviews[placeId] === undefined) {
        this.placesPartviews[placeId] = []; 
      }
      
      this.placesPartviews[placeId].push(`pv-${partId}-${partViewName}`);
      
      console.log(`Setting PartView ${partViewName} belonging to Part ${partId} to Place ${p4vReg.place.id}`);
    }
    
    addPlaceDefs(placeDefs) {
       this.placeDefs = this.placeDefs.concat(placeDefs);
    }
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // REGISTER CLASS
  // A data structure that represents the state of Phases/Places/Parts/PartViews
  //  for the current element being parsed. 
  // Can save its state to the P4V_Data data structure for export to the rest of Glider.

  class PPP_Register {

    constructor (options) {
      this.app = options.app;
      this.part = options.part;
      this.partView = options.partView;
      this.place = options.place;
      this.phase = options.phase;
      
      this.place.roleNotSet = (this.place.role === undefined);
    }

    get state() {
      return {
        app: this.app,
        part: this.part,
        place: this.place,
        partView: this.partView,
        partViewContainer: this.partViewContainer,
        phase: this.phase
      }
    }

    // Return a new register with updated options

    updateAndCopy(stateUpdate) {
      let newState = Object.assign(this.state, stateUpdate);
      return new PPP_Register(newState);
    }

    // Change some aspect of the register and return an 
    //  updated copy

    changePartTo(part) { 
      return this.updateAndCopy({ part: part });
    }

    changePartViewTo(partViewName, partViewDomElemContainer) {
      console.log(`CHANGING PART-VIEW FROM: ${this.partView.name} TO: ${partViewName}`);
      return this.updateAndCopy({ 
        partView: { name: partViewName, container: partViewDomElemContainer }
      });
    }
    
    changePlaceTo(place) { 
      console.log("CHANGING PLACE TO: ");
      console.log(place);
      return this.updateAndCopy({ place: place });
    }

    changePhaseTo(phase) { 
      return this.updateAndCopy({ phase: phase });
    }

    copy() {
      return this.updateAndCopy({});
    }

    // Save register to P4V_Data store

    save() {

      this.app.associatePartWithPhase(this);

      if (this.partView !== PARSING_CONSTANTS.PART.VIEW_UNDEF 
          && this.partView !== undefined) {
        this.app.addPartView(this);
        this.app.associatePartWithPartView(this);
        this.app.associatePartViewWithPlace(this);
      }
    }
  }


  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // PARSING FUNCTIONS

  // Find all FlightPlans on page and parse each with parseFlightPlan()
  //  Returns an array of App objects
  //  (This allows for separate Flights on a single page, which may or may not
  //    prove useful)

  function parseFlightPlans(domRoot) {

    let flightPlanDomRoots = Array.from(
      domRoot.querySelectorAll(PARSING_CONSTANTS.FLIGHT_PLAN_SELECTOR)
    );

    // If none found, assume the DOM element passed _is_ the FlightPlan root

    if (flightPlanDomRoots.length === 0) {

      console.log(`No flight plan root declared: using ${domRoot.id}`);

      // If body element, then create a child div and make that the
      //  Glider root (Vue can't use body)

      // TODO: THIS DOESN'T BELONG IN A PARSER -- THIS MARKUP MODIFICATION
      //  SHOULD BE DONE PRIOR TO PARSING

      let gliderRoot;

      if (domRoot === document.body) {
        gliderRoot = document.createElement('div');
        if (domRoot.attributes['phase-type']) {
          gliderRoot.setAttribute(
            'phase-type', 
            domRoot.getAttribute('phase-type')
          );
        }
        while (domRoot.firstChild) { 
          gliderRoot.appendChild(domRoot.firstChild);
        }
        document.body.appendChild(gliderRoot);

        // If glider-defs is inside of GliderRoot, then move it just before

        gliderRoot.parentElement.insertBefore(
          gliderRoot.querySelector('glider-defs'),
          gliderRoot
        );

      } else {
        gliderRoot = domRoot;
      }

      gliderRoot.classList.add('glider-root'); // TODO: NO MAGIC
      gliderRoot.setAttribute('id', 'glider-root'); // TODO: how to handle if there's an existing @id ?
      // TODO: Vue uses #glider-root, this area uses .glider-root -- which is it?
      flightPlanDomRoots = [gliderRoot];

    }

    // Parse each FlightPlan and gather data in an array

    let p4vData_all = flightPlanDomRoots.map(
      flightPlanDomRoot => parseFlightPlan(flightPlanDomRoot)
    );

    return p4vData_all;
  }

  // Parse a FlightPlan root
  //  Create an App object, initialize a PPP Register
  //  Recurse into child DOM elements
  //  Return the App object

  function parseFlightPlan(domElem) { 

    let p4vData = new P4V_Data(),
        elemData = getDataFromDomElem(domElem),
        initPart, initPlace, initPhase;

    // Initialize p4vData with place information
    
    p4vData.addPlaceDefs(getPlaceDefinitions());
    
    // Create root Phase object (seq unless specified otherwise)

    // let newPhaseType = (elemData.phase.type === 'par') ? 'par' : 'seq'; 
    if (elemData.phase.type !== 'par') {
      elemData.phase.type = 'seq';
    }
    
    initPhase = p4vData.addPhase(elemData);

    // Create root Part object
    
    initPart = { id: 'rootPart' }; // TODO: KLUDGE

    // Create root Place object
    // TODO (Patrick): This should probably be an 'all' Place
    //  i.e. ROLE=undefined, and REGION=UNDEFINED

    initPlace = { id: 'rootPlace', role: "_undefined1", region: undefined }; // TODO: KLUDGE

    // Create initial PPPRegister

    let pppRegister_init = new PPP_Register({
      app: p4vData,
      part: initPart,
      partView: PARSING_CONSTANTS.PART.VIEW_UNDEF,
      place: initPlace,
      phase: initPhase
    });

    // Save this to to the P4V_Data store - and set root Phase

    pppRegister_init.save();
    p4vData.setRootPhase(initPhase);

    // Recurse to children by passing them to parseDomElem()

    let forceNewPhase = true;

    Array.from(domElem.children).forEach(
      childElem => parseDomElem(childElem,  pppRegister_init, forceNewPhase)
    );
    
    // Cleanup data
    
    // Add DefaultView IFF there is a Part with no associated View
    
    Object.keys(p4vData.parts)
      .filter(partId => p4vData.partsPartViews[partId] === undefined)
      .forEach(partWithNoViewId => p4vData.addDefaultPartViewToView(partWithNoViewId));
    
    // Add default place for Views that have none specified

    /*
    Object.keys(p4vStore.partViews)
      .filter(partViewId => p4vStore.partsPartViews[partViewId] === undefined)
      .forEach(partWithNoViewId => p4vStore.addDefaultPartViewToView(partWithNoViewId));
    */

    return p4vData;
  }

  // This is the main parsing function for non-root DOM elements.
  // Checks to see if there's a change in PPP

  function parseDomElem(domElem, pppRegister, forceNewPhase = false, isChildOfPart = false) { 

    if (domElem.tagName === 'GLIDER-DEFS') return; // Do not parse if the glider-defs element

    let elemData = getDataFromDomElem(domElem),
      pppRegister_new = pppRegister.copy(),
      registerChanged = false,
      tellChildrenTheyHaveAPartParent = false,
      forceChildrenToHaveNewPhase;

    console.log('DOM ELEMENT PARSED: ' + elemData.domNode.id);
    console.log(elemData.part);  
    
    // If a Part definition, create new and update register

    // If this is the direct child of a Part
    //   AND if it also defines a new PartView, 
    //     then set it to the PartView indicated in the markup
    //   OTHERWISE, set the register PartView to the default view -- DISABLED
    
    const partViewImplicitlyDeclared = isChildOfPart;

    if (partViewImplicitlyDeclared) {

      if (elemData.part.definesNewPartView) {
        let newPartViewName = elemData.part.view;
        pppRegister_new = pppRegister_new.changePartViewTo(newPartViewName, domElem);
      } // else { // DISABLED, FOR NOW
        // pppRegister_new = pppRegister_new.changePartViewTo(
        //  PARSING_CONSTANTS.PART.PART_DEFAULT_VIEW_NAME, domElem
        // )
        // }

      registerChanged = true;
    }

    // Conditions for defining a new Part:
    //  Either the markup explicitly declares a new Part OR
    //   it defines a new Phase which requires a Part to reference
    //   (which is always the case with Phase children of Container Phases)
    // Ignore Part definition if also defines a PartView
    //  (NOTE: this may be changed in the future)

    const newPartExplicitlyDeclared = (elemData.part.definesNewPart && ! isChildOfPart),
      newPartImplicityDeclared = (elemData.phase.definesNewPhase || forceNewPhase);

    if (newPartImplicityDeclared) { // NOTIFICATION MESSAGE
      console.log(`NEW PART IMPLICITLY DECLARED FOR ${elemData.domNode.id} because 
    elemData.phase.definesNewPhase = ${elemData.phase.definesNewPhase} OR 
    forceNewPhase = ${forceNewPhase}`);
    }
    
    if (! elemData.part.definesNewPartView && 
        (newPartExplicitlyDeclared || newPartImplicityDeclared) ) {
      
      let newPart = pppRegister.app.addPart(elemData);
      pppRegister_new = pppRegister_new.changePartTo(newPart);

      registerChanged = true;
      tellChildrenTheyHaveAPartParent = true;
    }

  /*
    if (elemData.part.definesNewPart || elemData.part.definesNewPartView) {
      let newPart = getNewPart(elemData, pppRegister.app);
      pppRegister_new = pppRegister_new.changePartTo(newPart)
        .changePartViewTo(newPart);
      registerChanged = true;
    } */

    // If a change of Place Role or Region, create new and update register
    //   Check if Role is defined in the DOM; update Role in PPPRegister, but
    //     only if it is currently undefined

    if (elemData.place.hasRole || elemData.place.hasRegion) {

      // If the role hasn't already been determined (in an ancestor)
      // AND the role is defined in the current element, then
      // use that new role

      let newPlaceRole;
      
      if (elemData.place.hasRole) {
        newPlaceRole = elemData.place.role;
      } else {
        newPlaceRole = pppRegister.place.role;
      }

      let newPlaceRegion = elemData.place.region,
          newPlaceElemData = Object.assign({}, elemData, { place: { role: newPlaceRole, region: newPlaceRegion }});
      
      // let newPlace = getNewPlace(elemData, pppRegister.app);

      // Add place to P4v data structure
      
      let newPlace = pppRegister.app.addPlace(newPlaceElemData); 

      pppRegister_new = pppRegister_new.changePlaceTo(newPlace);
      registerChanged = true;
    }
    
    // If a change of Phase (i.e. explicitly declared in markup)
    //   or forced to create a new Phase (because this is the child of a par or seq),
    //   or has child elements (which defaults to a PAR container)
    // then create new Phase and update register

    /*
    
    CHANGE: Can't have new Phase if also defines a PartView.
    Need to throw a warning if a Phase is being forced and there's a PartView definition
    (e.g. if the Parent part also has a SEQ/PAR definition on it)
    
    */
    
    if (elemData.part.definesNewPartView && forceNewPhase) {
      console.warn(`Element ${elemData.domNode.id}: 
                  Can't have a new Phase and PartView defined on the same element. New Phase ignored.`); 
    }
    
    let hasChildren = (elemData.domNode.children.length > 0);
    
    if (! elemData.part.definesNewPartView && 
        (elemData.phase.definesNewPhase || forceNewPhase || hasChildren)) {

      let parentPhase = pppRegister.phase,
        //newPhaseOptions = getPhaseConstructorOptionsFromElemData(elemData),
        //newPhase = Phase.createType(newPhaseOptions.type, newPhaseOptions);
        // newPhase = getNewPhase(elemData, pppRegister.app);
        newPhase = pppRegister.app.addPhase(elemData);

      console.log("CREATING NEW PHASE ID: " + newPhase.id);
      
      pppRegister.app.createParentChildPhaseRelationship(parentPhase, newPhase);
      // parentPhase.addChild(newPhase); // New Phase is child of parent
    
      pppRegister_new = pppRegister_new.changePhaseTo(newPhase);
      registerChanged = true;
    }

    // If register has changed, save this PPP coordinate

    if (registerChanged) {
      pppRegister_new.save();
    }

    // Force children to have new Phases if this is a container Phase
    //  OR if this element has children (defaults to PAR)
    
    forceChildrenToHaveNewPhase = (
      hasChildren ||
      (elemData.phase.definesNewPhase && elemData.phase.isContainer) 
    );
    
    // Parse child elements

    Array.from(domElem.children).forEach(
      child => parseDomElem(
        child, 
        pppRegister_new, 
        forceChildrenToHaveNewPhase, 
        tellChildrenTheyHaveAPartParent
      )
    );
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // DATA-FROM-DOM FUNCTIONS
  // These functions extract the information from the markup and
  //  return a data structure for further parsing.
  // The idea is that if it ain't in the markup, it's not dealt with
  //  here.

  function getDataFromDomElem(domElem) {

    let phaseData = getPhaseDataFromDomElem(domElem),
      partData = getPartDataFromDomElem(domElem),
      placeData = getPlaceDataFromDomElem(domElem);

    // tested to this point
    // console.log(`PlaceData is ${placeData.id}`);

    return {
      domNode: domElem,
      part: partData,
      place: placeData,
      phase: phaseData
    }
  }

  // DATA-FROM-DOM FUNCTIONS: Phase

  function getPhaseDataFromDomElem(domElem) {

    function getPhaseIdFromDomElem(domElem) {
      return domElem.getAttribute(PARSING_CONSTANTS.PHASE.ID_ATT_NAME);
    }

    function getPhaseTypeFromDomElem(domElem) {
      return domElem.getAttribute(PARSING_CONSTANTS.PHASE.TYPE_ATT_NAME);
    }

    function getDelayFromDomElem(domElem) {
      let delayAttValue = domElem.getAttribute(PARSING_CONSTANTS.PHASE.DELAY_ATT_NAME);
      return (delayAttValue !== null) ? normalizeTimeToMS(delayAttValue) : null;
    }

    function getDurationFromDomElem(domElem) {
      let durationAttValue = domElem.getAttribute(PARSING_CONSTANTS.PHASE.DURATION_ATT_NAME);
      return (durationAttValue !== null) ? normalizeTimeToMS(durationAttValue) : null;
    }

    // Given a duration as string, return a float normalized to milliseconds
    //  (currently only handles ms and s)

    function normalizeTimeToMS(timeString) {

      let msMatch = timeString.match(/^\s*([\d\.]+)\s*ms\s*$/i);
      if (msMatch !== null) 
        return parseFloat(msMatch[1]);

      let sMatch = timeString.match(/^\s*([\d\.]+)\s*s\s*$/i);
      if (sMatch !== null) 
        return parseFloat(sMatch[1]) * 1000;

      return parseFloat(timeString);
    }

    // Does this domElem have any ancestors that defined Phases?

    function elemHasNoPhaseDescendents(domElem) {
      let descendantPhases = domElem.querySelectorAll(
        PARSING_CONSTANTS.PHASE.PHASE_DESCENDANT_SELECTOR
      );
      
      return (descendantPhases.length === 0);
    }

    // Get Phase data from DOM

    let dur = getDurationFromDomElem(domElem),
        delay = getDelayFromDomElem(domElem),
        specifiedId = getPhaseIdFromDomElem(domElem),
        id = (specifiedId !== null) 
              ? specifiedId 
              : 'ph' + getIdFromDomPosition(domElem),
        phaseType = getPhaseTypeFromDomElem(domElem);

    // Compile data object

    let phaseData = { 
      id: id,
      hasId: (id !== null),
      duration: dur,
      hasDuration: (dur !== null),
      delay: delay,
      hasDelay: (delay !== null),
      hasNoPhaseDescendents: elemHasNoPhaseDescendents(domElem),
      type: phaseType,
      hasType: (phaseType !== null),
      isContainer: (phaseType === 'par' || phaseType === 'seq')
    };

    phaseData.definesNewPhase = (phaseData.hasDuration || phaseData.hasDelay || phaseData.hasType);

    return phaseData;
  }

  // DATA-FROM-DOM FUNCTIONS: Parts

  function getPartDataFromDomElem(domElem) {

    // Check the immediate children of domElem to
    //  see if they define View(s). 
    // Returns False if there are no Views defined; 
    //  True otherwise
    // DISABLED FOR NOW

    /*
    function checkIfHasChildViews(domElem) {
      return Array.from(domElem.children).some(childElem => {
        return (getPartTypeView(childElem).view !== undefined)
      });
    } */
    
    // Routines for extracting PartView names from DOM

    function getPartTypeViewFromString(identifierString) {

      let partTypeViewData = {};

      let parsedTypeViewData = identifierString
        .replace(RegExp(`^${PARSING_CONSTANTS.PART.SELECTOR_PREFIX}`), '')
        .split(PARSING_CONSTANTS.PART.TYPE_VIEW_DELIMITER);

      if (parsedTypeViewData[0] !== undefined) {
        partTypeViewData.type = parsedTypeViewData[0];
      }

      if (parsedTypeViewData[1] !== undefined) {
        partTypeViewData.view = parsedTypeViewData[1];
      }
      
      return partTypeViewData;
    }

    function getPartTypeViewFromPartAttribute(domElem) {
      let attString = domElem.getAttribute(PARSING_CONSTANTS.PART.PART_ATT_NAME);

      return (attString !== null)
        ? getPartTypeViewFromString(attString)
        : {};
    }

    function getPartTypeViewFromPartTypeViewAttributes(domElem) {

      let partTypeViewData = {},
        partTypeAtt = domElem.getAttribute(PARSING_CONSTANTS.PART.TYPE_ATT_NAME),
        partViewAtt = domElem.getAttribute(PARSING_CONSTANTS.PART.VIEW_ATT_NAME);

      if (partTypeAtt !== null) {
        partTypeViewData.type = partTypeAtt;
      }
      
      if (partViewAtt !== null) {
        partTypeViewData.view = partViewAtt;
      }

      return partTypeViewData;
    }

    function getPartTypeViewFromClassname(domElem) {

      let partClassname = Array.from(domElem.classList).find(
        className => className.startsWith(PARSING_CONSTANTS.PART.CLASSNAME_PREFIX)
      );

      let partTypeViewData;

      if (partClassname !== undefined) {
        partTypeViewData = getPartTypeViewFromString(
          partClassname.slice(PARSING_CONSTANTS.PART.CLASSNAME_PREFIX.length)
        );
      } else {
        partTypeViewData = {};
      }

      return partTypeViewData;
    }

    // Returns a data structure { part: <PART TYPE NAME>, view: <VIEW_NAME> }
    
    function getPartTypeView(domElem) {
      return Object.assign({},
        getPartTypeViewFromClassname(domElem),
        getPartTypeViewFromPartAttribute(domElem),
        getPartTypeViewFromPartTypeViewAttributes(domElem)
      );
    }

    function getPartIdFromDomElem(domElem) {

      let id,
        plainId = domElem.getAttribute(PARSING_CONSTANTS.PART.ID_ATT_NAME),
        partId = domElem.getAttribute(PARSING_CONSTANTS.PART.PART_ID_ATT_NAME),
        partRefId = domElem.getAttribute(PARSING_CONSTANTS.PART.PART_REF_ATT_NAME);
      
      if (partId != null) {
        id = partId;
      } else if (plainId != null) {
        id = plainId.replace(/^#/, '');
      } else if (partRefId != null) {
        id = partRefId;
      } else {
        id = undefined;
      }

      return id;
    }

    // TODO: This is an (insecure) kludge -- see 
    //  getPartOptionsFromDomElem_TODO for the proper solution

    function getPartOptionsFromDomElem(domElem) {

      const optionsString = domElem.getAttribute(PARSING_CONSTANTS.PART.OPTIONS_ATT_NAME);

      let optionsData;

      if (optionsString !== null && optionsString !== '') {

        const BRACES = /^\s*\{|\}\s*$/g;

        const evalString = "(function() { return {" 
          + optionsString.replace(BRACES, '')
          + "} })()";

        optionsData = eval(evalString);
        
      } else {
        optionsData = {};
      }

      return optionsData;
    }

    // Get Part data from DOM
    // note: Cannot create a Part and PartView in the same element

    let id = getPartIdFromDomElem(domElem),
      partTypeView = getPartTypeView(domElem),
      options = getPartOptionsFromDomElem(domElem),
      partContainer = domElem,
      definesNewPartView = (partTypeView.view !== undefined),
      definesNewPart = (partTypeView.type !== undefined && ! definesNewPartView);
      // hasChildViews = checkIfHasChildViews(domElem);

    return {
      type: partTypeView.type,
      view: partTypeView.view,
      id: id,
      hasId: (id !== undefined),
      options: options,
      container: partContainer,
      definesNewPart: definesNewPart,
      definesNewPartView: definesNewPartView,
      // hasChildViews: hasChildViews
    }
  }

  // DATA-FROM-DOM FUNCTIONS: Places temp from Joel. 
  // #ToDo Still need to figure out how this Place data gets to App.js
  // #ToDo does every phase need place defined? Probably, right?

  function getPlaceDataFromDomElem(domElem) {

    // Given a string (e.g. place-red-green) return a 
    //  data structure (e.g. { role: 'red', region: 'green' })

    function getRoleRegionFromString(identifierString) {

      let roleRegionData = {};

      let parsedRoleRegion = identifierString
        .replace(RegExp(`^${PARSING_CONSTANTS.PLACE.SELECTOR_PREFIX}`), '')
        .split(PARSING_CONSTANTS.PLACE.ROLE_REGION_DELIMITER);

      if (parsedRoleRegion[0] !== undefined)
        roleRegionData.role = parsedRoleRegion[0];
        
      if (parsedRoleRegion[1] !== undefined)
        roleRegionData.region = parsedRoleRegion[1];

      return roleRegionData;
    }

    function getPlaceFromPlaceAttribute(domElem) {

      let attString = domElem.getAttribute(PARSING_CONSTANTS.PLACE.PLACE_ATT_NAME);

      return (attString !== null) 
        ? getRoleRegionFromString(attString) 
        : {};
    }

    function getPlaceFromRoleRegionAttributes(domElem) {

      let roleRegionData = {},
        roleAtt = domElem.getAttribute(PARSING_CONSTANTS.PLACE.ROLE_ATT_NAME),
        regionAtt = domElem.getAttribute(PARSING_CONSTANTS.PLACE.REGION_ATT_NAME);

      if (roleAtt !== null) 
        roleRegionData.role = roleAtt;
      if (regionAtt !== null) 
        roleRegionData.region = regionAtt;

      return roleRegionData;
    }

    function getPlaceFromClassname(domElem) {

      let placeClassname = Array.from(domElem.classList).find(
        className => className.startsWith(PARSING_CONSTANTS.PLACE.CLASSNAME_PREFIX)
      );

      let roleRegionData = (placeClassname !== undefined)
        ? getRoleRegionFromString(placeClassname)
        : {};

      return roleRegionData;
    }

    // Collect the { role: <str>, region: <str> } data structures
    //  from attributes and/or classnames and merge them in order of 
    //  precedence (from lowest to highest)

    let placeData = Object.assign( {},
      getPlaceFromClassname(domElem),
      getPlaceFromPlaceAttribute(domElem),
      getPlaceFromRoleRegionAttributes(domElem)
    );

    placeData.hasRole = (placeData.role !== undefined);
    placeData.hasRegion = (placeData.region !== undefined);

    return placeData;
  }

  // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
  // Main -- call parseFlightPlans on DOM load
  // Currently only deals with the first Flight on the page

  function main() {
    
    // Put ID's on all elements in body (for now)
    // These IDs map to P4V IDs, for easy cross-checking
    
    document.body.querySelectorAll('*').forEach(elem => {
      if (elem.getAttribute('id') === null) {
        elem.setAttribute('id', `g${getIdFromDomPosition(elem)}`);
      }
    });
    
    // Return the p4v data object (Class P4V_Data)
    
    let p4vDataArr = parseFlightPlans(document.body);

    if (p4vDataArr.length > 0) {
      return p4vDataArr[0];
    } else {
      return null; 
    }
  }

  function init(options) {
    firebase.initializeApp(options); 
  }

  // Given a Flight ID, delete all the remote state
  // NOTE: this is not good, as remove() is async
  // This should be done elsewhere

  // see https://stackoverflow.com/questions/45054550/firebase-database-how-to-perform-a-prefix-wildcard-query

  function deleteFlightEntries(flightInstanceId) {
    console.log(`REMOVING REMOTE FLIGHT INSTANCE VARIABLES FROM _${flightInstanceId}`);
    firebase.database().ref().orderByKey().startAt(`_${flightInstanceId}`)
    .once('value', function(snapshot) {
      // firebase.database().ref().child(snapshot.key).remove();
      console.log(`> REMOVING ${snapshot.key}`); 
    });
  }

  // Set up listener: if a value changes on the shared store, 
  //  then update the local

  // Also: set up the variable in FB if doesn't currently exist
  // TODO: should this be renamed initRemotePartVariables()?

  function listenForChanges(partVarId, localStoreUpdateCallback, initValue) { 

    const remoteVarEntry = firebase.database().ref().child(partVarId);
    
    // If var doesn't exist in FireBase, then initialize
    
    remoteVarEntry.once('value')
      .then(function(remoteVarEntryValue) {
      
        if (! remoteVarEntryValue.exists()) {
          console.log(`> INIT VAL: ${partVarId} = ${initValue}`);
          remoteVarEntry.set(initValue);
        }
      });
    
    // Assign listener for change
    
    remoteVarEntry.on('value', function(snapshot) {
      let remoteVarEntryValue = snapshot.val();
      console.log(`FIREBASE VARIABLE ${partVarId} CHANGED TO ${remoteVarEntryValue} --> updating local`);
      localStoreUpdateCallback(snapshot.val());
    }); 
  }
  // Get the values on the remote store for this flight instance

  function getFlightInstanceStore() {

    var ref = firebase.database().ref();
    /*
    ref.once('value')
      .then(function(snapshot) {
        console.log('REMOTE STORE DUMP');
        console.log(snapshot.exportVal());
      }); */
    
    return ref.once('value'); // Return a Promise
  }

  // Update the value on the remote store

  function setVal(partVarId, value) {
    console.log(`FIREBASE SET VALUE OF ${partVarId} TO ${value}`);
    if (firebase.database().ref().child(partVarId) !== value) {
      firebase.database().ref().child(partVarId).set(value);
    }
  }

  function getRemoteStore(initOptions) {
    
    init(initOptions);  
    
    /*
    return { // TEMP TURN OFF FB
      listenForChanges: function () {},
      set: function () {}
    } */
    
    return {
      listenForChanges: listenForChanges,
      set: setVal,
      getFlightState: getFlightInstanceStore(),
      deleteFlightEntries: deleteFlightEntries
    }
  }

  /**
   * lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="npm" -o ./`
   * Copyright jQuery Foundation and other contributors <https://jquery.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   */

  /** Used as the size to enable large array optimizations. */
  var LARGE_ARRAY_SIZE = 200;

  /** Used to stand-in for `undefined` hash values. */
  var HASH_UNDEFINED = '__lodash_hash_undefined__';

  /** Used to compose bitmasks for comparison styles. */
  var UNORDERED_COMPARE_FLAG = 1,
      PARTIAL_COMPARE_FLAG = 2;

  /** Used as references for various `Number` constants. */
  var MAX_SAFE_INTEGER = 9007199254740991;

  /** `Object#toString` result references. */
  var argsTag = '[object Arguments]',
      arrayTag = '[object Array]',
      boolTag = '[object Boolean]',
      dateTag = '[object Date]',
      errorTag = '[object Error]',
      funcTag = '[object Function]',
      genTag = '[object GeneratorFunction]',
      mapTag = '[object Map]',
      numberTag = '[object Number]',
      objectTag = '[object Object]',
      promiseTag = '[object Promise]',
      regexpTag = '[object RegExp]',
      setTag = '[object Set]',
      stringTag = '[object String]',
      symbolTag = '[object Symbol]',
      weakMapTag = '[object WeakMap]';

  var arrayBufferTag = '[object ArrayBuffer]',
      dataViewTag = '[object DataView]',
      float32Tag = '[object Float32Array]',
      float64Tag = '[object Float64Array]',
      int8Tag = '[object Int8Array]',
      int16Tag = '[object Int16Array]',
      int32Tag = '[object Int32Array]',
      uint8Tag = '[object Uint8Array]',
      uint8ClampedTag = '[object Uint8ClampedArray]',
      uint16Tag = '[object Uint16Array]',
      uint32Tag = '[object Uint32Array]';

  /**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */
  var reRegExpChar = /[\\^$.*+?()[\]{}|]/g;

  /** Used to detect host constructors (Safari). */
  var reIsHostCtor = /^\[object .+?Constructor\]$/;

  /** Used to detect unsigned integer values. */
  var reIsUint = /^(?:0|[1-9]\d*)$/;

  /** Used to identify `toStringTag` values of typed arrays. */
  var typedArrayTags = {};
  typedArrayTags[float32Tag] = typedArrayTags[float64Tag] =
  typedArrayTags[int8Tag] = typedArrayTags[int16Tag] =
  typedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =
  typedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =
  typedArrayTags[uint32Tag] = true;
  typedArrayTags[argsTag] = typedArrayTags[arrayTag] =
  typedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =
  typedArrayTags[dataViewTag] = typedArrayTags[dateTag] =
  typedArrayTags[errorTag] = typedArrayTags[funcTag] =
  typedArrayTags[mapTag] = typedArrayTags[numberTag] =
  typedArrayTags[objectTag] = typedArrayTags[regexpTag] =
  typedArrayTags[setTag] = typedArrayTags[stringTag] =
  typedArrayTags[weakMapTag] = false;

  /** Detect free variable `global` from Node.js. */
  var freeGlobal = typeof global == 'object' && global && global.Object === Object && global;

  /** Detect free variable `self`. */
  var freeSelf = typeof self == 'object' && self && self.Object === Object && self;

  /** Used as a reference to the global object. */
  var root = freeGlobal || freeSelf || Function('return this')();

  /** Detect free variable `exports`. */
  var freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;

  /** Detect free variable `module`. */
  var freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;

  /** Detect the popular CommonJS extension `module.exports`. */
  var moduleExports = freeModule && freeModule.exports === freeExports;

  /** Detect free variable `process` from Node.js. */
  var freeProcess = moduleExports && freeGlobal.process;

  /** Used to access faster Node.js helpers. */
  var nodeUtil = (function() {
    try {
      return freeProcess && freeProcess.binding('util');
    } catch (e) {}
  }());

  /* Node.js helper references. */
  var nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;

  /**
   * A specialized version of `_.some` for arrays without support for iteratee
   * shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {boolean} Returns `true` if any element passes the predicate check,
   *  else `false`.
   */
  function arraySome(array, predicate) {
    var index = -1,
        length = array ? array.length : 0;

    while (++index < length) {
      if (predicate(array[index], index, array)) {
        return true;
      }
    }
    return false;
  }

  /**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */
  function baseTimes(n, iteratee) {
    var index = -1,
        result = Array(n);

    while (++index < n) {
      result[index] = iteratee(index);
    }
    return result;
  }

  /**
   * The base implementation of `_.unary` without support for storing metadata.
   *
   * @private
   * @param {Function} func The function to cap arguments for.
   * @returns {Function} Returns the new capped function.
   */
  function baseUnary(func) {
    return function(value) {
      return func(value);
    };
  }

  /**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */
  function getValue(object, key) {
    return object == null ? undefined : object[key];
  }

  /**
   * Checks if `value` is a host object in IE < 9.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a host object, else `false`.
   */
  function isHostObject(value) {
    // Many host objects are `Object` objects that can coerce to strings
    // despite having improperly defined `toString` methods.
    var result = false;
    if (value != null && typeof value.toString != 'function') {
      try {
        result = !!(value + '');
      } catch (e) {}
    }
    return result;
  }

  /**
   * Converts `map` to its key-value pairs.
   *
   * @private
   * @param {Object} map The map to convert.
   * @returns {Array} Returns the key-value pairs.
   */
  function mapToArray(map) {
    var index = -1,
        result = Array(map.size);

    map.forEach(function(value, key) {
      result[++index] = [key, value];
    });
    return result;
  }

  /**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */
  function overArg(func, transform) {
    return function(arg) {
      return func(transform(arg));
    };
  }

  /**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */
  function setToArray(set) {
    var index = -1,
        result = Array(set.size);

    set.forEach(function(value) {
      result[++index] = value;
    });
    return result;
  }

  /** Used for built-in method references. */
  var arrayProto = Array.prototype,
      funcProto = Function.prototype,
      objectProto = Object.prototype;

  /** Used to detect overreaching core-js shims. */
  var coreJsData = root['__core-js_shared__'];

  /** Used to detect methods masquerading as native. */
  var maskSrcKey = (function() {
    var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');
    return uid ? ('Symbol(src)_1.' + uid) : '';
  }());

  /** Used to resolve the decompiled source of functions. */
  var funcToString = funcProto.toString;

  /** Used to check objects for own properties. */
  var hasOwnProperty = objectProto.hasOwnProperty;

  /**
   * Used to resolve the
   * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
   * of values.
   */
  var objectToString = objectProto.toString;

  /** Used to detect if a method is native. */
  var reIsNative = RegExp('^' +
    funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\$&')
    .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
  );

  /** Built-in value references. */
  var Symbol = root.Symbol,
      Uint8Array = root.Uint8Array,
      propertyIsEnumerable = objectProto.propertyIsEnumerable,
      splice = arrayProto.splice;

  /* Built-in method references for those with the same name as other `lodash` methods. */
  var nativeKeys = overArg(Object.keys, Object);

  /* Built-in method references that are verified to be native. */
  var DataView = getNative(root, 'DataView'),
      Map = getNative(root, 'Map'),
      Promise = getNative(root, 'Promise'),
      Set$1 = getNative(root, 'Set'),
      WeakMap = getNative(root, 'WeakMap'),
      nativeCreate = getNative(Object, 'create');

  /** Used to detect maps, sets, and weakmaps. */
  var dataViewCtorString = toSource(DataView),
      mapCtorString = toSource(Map),
      promiseCtorString = toSource(Promise),
      setCtorString = toSource(Set$1),
      weakMapCtorString = toSource(WeakMap);

  /** Used to convert symbols to primitives and strings. */
  var symbolProto = Symbol ? Symbol.prototype : undefined,
      symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;

  /**
   * Creates a hash object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function Hash(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the hash.
   *
   * @private
   * @name clear
   * @memberOf Hash
   */
  function hashClear() {
    this.__data__ = nativeCreate ? nativeCreate(null) : {};
  }

  /**
   * Removes `key` and its value from the hash.
   *
   * @private
   * @name delete
   * @memberOf Hash
   * @param {Object} hash The hash to modify.
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function hashDelete(key) {
    return this.has(key) && delete this.__data__[key];
  }

  /**
   * Gets the hash value for `key`.
   *
   * @private
   * @name get
   * @memberOf Hash
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function hashGet(key) {
    var data = this.__data__;
    if (nativeCreate) {
      var result = data[key];
      return result === HASH_UNDEFINED ? undefined : result;
    }
    return hasOwnProperty.call(data, key) ? data[key] : undefined;
  }

  /**
   * Checks if a hash value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Hash
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function hashHas(key) {
    var data = this.__data__;
    return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);
  }

  /**
   * Sets the hash `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Hash
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the hash instance.
   */
  function hashSet(key, value) {
    var data = this.__data__;
    data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;
    return this;
  }

  // Add methods to `Hash`.
  Hash.prototype.clear = hashClear;
  Hash.prototype['delete'] = hashDelete;
  Hash.prototype.get = hashGet;
  Hash.prototype.has = hashHas;
  Hash.prototype.set = hashSet;

  /**
   * Creates an list cache object.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function ListCache(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the list cache.
   *
   * @private
   * @name clear
   * @memberOf ListCache
   */
  function listCacheClear() {
    this.__data__ = [];
  }

  /**
   * Removes `key` and its value from the list cache.
   *
   * @private
   * @name delete
   * @memberOf ListCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function listCacheDelete(key) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    if (index < 0) {
      return false;
    }
    var lastIndex = data.length - 1;
    if (index == lastIndex) {
      data.pop();
    } else {
      splice.call(data, index, 1);
    }
    return true;
  }

  /**
   * Gets the list cache value for `key`.
   *
   * @private
   * @name get
   * @memberOf ListCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function listCacheGet(key) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    return index < 0 ? undefined : data[index][1];
  }

  /**
   * Checks if a list cache value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf ListCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function listCacheHas(key) {
    return assocIndexOf(this.__data__, key) > -1;
  }

  /**
   * Sets the list cache `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf ListCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the list cache instance.
   */
  function listCacheSet(key, value) {
    var data = this.__data__,
        index = assocIndexOf(data, key);

    if (index < 0) {
      data.push([key, value]);
    } else {
      data[index][1] = value;
    }
    return this;
  }

  // Add methods to `ListCache`.
  ListCache.prototype.clear = listCacheClear;
  ListCache.prototype['delete'] = listCacheDelete;
  ListCache.prototype.get = listCacheGet;
  ListCache.prototype.has = listCacheHas;
  ListCache.prototype.set = listCacheSet;

  /**
   * Creates a map cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function MapCache(entries) {
    var index = -1,
        length = entries ? entries.length : 0;

    this.clear();
    while (++index < length) {
      var entry = entries[index];
      this.set(entry[0], entry[1]);
    }
  }

  /**
   * Removes all key-value entries from the map.
   *
   * @private
   * @name clear
   * @memberOf MapCache
   */
  function mapCacheClear() {
    this.__data__ = {
      'hash': new Hash,
      'map': new (Map || ListCache),
      'string': new Hash
    };
  }

  /**
   * Removes `key` and its value from the map.
   *
   * @private
   * @name delete
   * @memberOf MapCache
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function mapCacheDelete(key) {
    return getMapData(this, key)['delete'](key);
  }

  /**
   * Gets the map value for `key`.
   *
   * @private
   * @name get
   * @memberOf MapCache
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function mapCacheGet(key) {
    return getMapData(this, key).get(key);
  }

  /**
   * Checks if a map value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf MapCache
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function mapCacheHas(key) {
    return getMapData(this, key).has(key);
  }

  /**
   * Sets the map `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf MapCache
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the map cache instance.
   */
  function mapCacheSet(key, value) {
    getMapData(this, key).set(key, value);
    return this;
  }

  // Add methods to `MapCache`.
  MapCache.prototype.clear = mapCacheClear;
  MapCache.prototype['delete'] = mapCacheDelete;
  MapCache.prototype.get = mapCacheGet;
  MapCache.prototype.has = mapCacheHas;
  MapCache.prototype.set = mapCacheSet;

  /**
   *
   * Creates an array cache object to store unique values.
   *
   * @private
   * @constructor
   * @param {Array} [values] The values to cache.
   */
  function SetCache(values) {
    var index = -1,
        length = values ? values.length : 0;

    this.__data__ = new MapCache;
    while (++index < length) {
      this.add(values[index]);
    }
  }

  /**
   * Adds `value` to the array cache.
   *
   * @private
   * @name add
   * @memberOf SetCache
   * @alias push
   * @param {*} value The value to cache.
   * @returns {Object} Returns the cache instance.
   */
  function setCacheAdd(value) {
    this.__data__.set(value, HASH_UNDEFINED);
    return this;
  }

  /**
   * Checks if `value` is in the array cache.
   *
   * @private
   * @name has
   * @memberOf SetCache
   * @param {*} value The value to search for.
   * @returns {number} Returns `true` if `value` is found, else `false`.
   */
  function setCacheHas(value) {
    return this.__data__.has(value);
  }

  // Add methods to `SetCache`.
  SetCache.prototype.add = SetCache.prototype.push = setCacheAdd;
  SetCache.prototype.has = setCacheHas;

  /**
   * Creates a stack cache object to store key-value pairs.
   *
   * @private
   * @constructor
   * @param {Array} [entries] The key-value pairs to cache.
   */
  function Stack(entries) {
    this.__data__ = new ListCache(entries);
  }

  /**
   * Removes all key-value entries from the stack.
   *
   * @private
   * @name clear
   * @memberOf Stack
   */
  function stackClear() {
    this.__data__ = new ListCache;
  }

  /**
   * Removes `key` and its value from the stack.
   *
   * @private
   * @name delete
   * @memberOf Stack
   * @param {string} key The key of the value to remove.
   * @returns {boolean} Returns `true` if the entry was removed, else `false`.
   */
  function stackDelete(key) {
    return this.__data__['delete'](key);
  }

  /**
   * Gets the stack value for `key`.
   *
   * @private
   * @name get
   * @memberOf Stack
   * @param {string} key The key of the value to get.
   * @returns {*} Returns the entry value.
   */
  function stackGet(key) {
    return this.__data__.get(key);
  }

  /**
   * Checks if a stack value for `key` exists.
   *
   * @private
   * @name has
   * @memberOf Stack
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function stackHas(key) {
    return this.__data__.has(key);
  }

  /**
   * Sets the stack `key` to `value`.
   *
   * @private
   * @name set
   * @memberOf Stack
   * @param {string} key The key of the value to set.
   * @param {*} value The value to set.
   * @returns {Object} Returns the stack cache instance.
   */
  function stackSet(key, value) {
    var cache = this.__data__;
    if (cache instanceof ListCache) {
      var pairs = cache.__data__;
      if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {
        pairs.push([key, value]);
        return this;
      }
      cache = this.__data__ = new MapCache(pairs);
    }
    cache.set(key, value);
    return this;
  }

  // Add methods to `Stack`.
  Stack.prototype.clear = stackClear;
  Stack.prototype['delete'] = stackDelete;
  Stack.prototype.get = stackGet;
  Stack.prototype.has = stackHas;
  Stack.prototype.set = stackSet;

  /**
   * Creates an array of the enumerable property names of the array-like `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @param {boolean} inherited Specify returning inherited property names.
   * @returns {Array} Returns the array of property names.
   */
  function arrayLikeKeys(value, inherited) {
    // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
    // Safari 9 makes `arguments.length` enumerable in strict mode.
    var result = (isArray(value) || isArguments(value))
      ? baseTimes(value.length, String)
      : [];

    var length = result.length,
        skipIndexes = !!length;

    for (var key in value) {
      if ((inherited || hasOwnProperty.call(value, key)) &&
          !(skipIndexes && (key == 'length' || isIndex(key, length)))) {
        result.push(key);
      }
    }
    return result;
  }

  /**
   * Gets the index at which the `key` is found in `array` of key-value pairs.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} key The key to search for.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function assocIndexOf(array, key) {
    var length = array.length;
    while (length--) {
      if (eq(array[length][0], key)) {
        return length;
      }
    }
    return -1;
  }

  /**
   * The base implementation of `getTag`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */
  function baseGetTag(value) {
    return objectToString.call(value);
  }

  /**
   * The base implementation of `_.isEqual` which supports partial comparisons
   * and tracks traversed objects.
   *
   * @private
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @param {Function} [customizer] The function to customize comparisons.
   * @param {boolean} [bitmask] The bitmask of comparison flags.
   *  The bitmask may be composed of the following flags:
   *     1 - Unordered comparison
   *     2 - Partial comparison
   * @param {Object} [stack] Tracks traversed `value` and `other` objects.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   */
  function baseIsEqual(value, other, customizer, bitmask, stack) {
    if (value === other) {
      return true;
    }
    if (value == null || other == null || (!isObject(value) && !isObjectLike(other))) {
      return value !== value && other !== other;
    }
    return baseIsEqualDeep(value, other, baseIsEqual, customizer, bitmask, stack);
  }

  /**
   * A specialized version of `baseIsEqual` for arrays and objects which performs
   * deep comparisons and tracks traversed objects enabling objects with circular
   * references to be compared.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Function} [customizer] The function to customize comparisons.
   * @param {number} [bitmask] The bitmask of comparison flags. See `baseIsEqual`
   *  for more details.
   * @param {Object} [stack] Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */
  function baseIsEqualDeep(object, other, equalFunc, customizer, bitmask, stack) {
    var objIsArr = isArray(object),
        othIsArr = isArray(other),
        objTag = arrayTag,
        othTag = arrayTag;

    if (!objIsArr) {
      objTag = getTag(object);
      objTag = objTag == argsTag ? objectTag : objTag;
    }
    if (!othIsArr) {
      othTag = getTag(other);
      othTag = othTag == argsTag ? objectTag : othTag;
    }
    var objIsObj = objTag == objectTag && !isHostObject(object),
        othIsObj = othTag == objectTag && !isHostObject(other),
        isSameTag = objTag == othTag;

    if (isSameTag && !objIsObj) {
      stack || (stack = new Stack);
      return (objIsArr || isTypedArray(object))
        ? equalArrays(object, other, equalFunc, customizer, bitmask, stack)
        : equalByTag(object, other, objTag, equalFunc, customizer, bitmask, stack);
    }
    if (!(bitmask & PARTIAL_COMPARE_FLAG)) {
      var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),
          othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');

      if (objIsWrapped || othIsWrapped) {
        var objUnwrapped = objIsWrapped ? object.value() : object,
            othUnwrapped = othIsWrapped ? other.value() : other;

        stack || (stack = new Stack);
        return equalFunc(objUnwrapped, othUnwrapped, customizer, bitmask, stack);
      }
    }
    if (!isSameTag) {
      return false;
    }
    stack || (stack = new Stack);
    return equalObjects(object, other, equalFunc, customizer, bitmask, stack);
  }

  /**
   * The base implementation of `_.isNative` without bad shim checks.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a native function,
   *  else `false`.
   */
  function baseIsNative(value) {
    if (!isObject(value) || isMasked(value)) {
      return false;
    }
    var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;
    return pattern.test(toSource(value));
  }

  /**
   * The base implementation of `_.isTypedArray` without Node.js optimizations.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   */
  function baseIsTypedArray(value) {
    return isObjectLike(value) &&
      isLength(value.length) && !!typedArrayTags[objectToString.call(value)];
  }

  /**
   * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   */
  function baseKeys(object) {
    if (!isPrototype(object)) {
      return nativeKeys(object);
    }
    var result = [];
    for (var key in Object(object)) {
      if (hasOwnProperty.call(object, key) && key != 'constructor') {
        result.push(key);
      }
    }
    return result;
  }

  /**
   * A specialized version of `baseIsEqualDeep` for arrays with support for
   * partial deep comparisons.
   *
   * @private
   * @param {Array} array The array to compare.
   * @param {Array} other The other array to compare.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Function} customizer The function to customize comparisons.
   * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`
   *  for more details.
   * @param {Object} stack Tracks traversed `array` and `other` objects.
   * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.
   */
  function equalArrays(array, other, equalFunc, customizer, bitmask, stack) {
    var isPartial = bitmask & PARTIAL_COMPARE_FLAG,
        arrLength = array.length,
        othLength = other.length;

    if (arrLength != othLength && !(isPartial && othLength > arrLength)) {
      return false;
    }
    // Assume cyclic values are equal.
    var stacked = stack.get(array);
    if (stacked && stack.get(other)) {
      return stacked == other;
    }
    var index = -1,
        result = true,
        seen = (bitmask & UNORDERED_COMPARE_FLAG) ? new SetCache : undefined;

    stack.set(array, other);
    stack.set(other, array);

    // Ignore non-index properties.
    while (++index < arrLength) {
      var arrValue = array[index],
          othValue = other[index];

      if (customizer) {
        var compared = isPartial
          ? customizer(othValue, arrValue, index, other, array, stack)
          : customizer(arrValue, othValue, index, array, other, stack);
      }
      if (compared !== undefined) {
        if (compared) {
          continue;
        }
        result = false;
        break;
      }
      // Recursively compare arrays (susceptible to call stack limits).
      if (seen) {
        if (!arraySome(other, function(othValue, othIndex) {
              if (!seen.has(othIndex) &&
                  (arrValue === othValue || equalFunc(arrValue, othValue, customizer, bitmask, stack))) {
                return seen.add(othIndex);
              }
            })) {
          result = false;
          break;
        }
      } else if (!(
            arrValue === othValue ||
              equalFunc(arrValue, othValue, customizer, bitmask, stack)
          )) {
        result = false;
        break;
      }
    }
    stack['delete'](array);
    stack['delete'](other);
    return result;
  }

  /**
   * A specialized version of `baseIsEqualDeep` for comparing objects of
   * the same `toStringTag`.
   *
   * **Note:** This function only supports comparing values with tags of
   * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {string} tag The `toStringTag` of the objects to compare.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Function} customizer The function to customize comparisons.
   * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`
   *  for more details.
   * @param {Object} stack Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */
  function equalByTag(object, other, tag, equalFunc, customizer, bitmask, stack) {
    switch (tag) {
      case dataViewTag:
        if ((object.byteLength != other.byteLength) ||
            (object.byteOffset != other.byteOffset)) {
          return false;
        }
        object = object.buffer;
        other = other.buffer;

      case arrayBufferTag:
        if ((object.byteLength != other.byteLength) ||
            !equalFunc(new Uint8Array(object), new Uint8Array(other))) {
          return false;
        }
        return true;

      case boolTag:
      case dateTag:
      case numberTag:
        // Coerce booleans to `1` or `0` and dates to milliseconds.
        // Invalid dates are coerced to `NaN`.
        return eq(+object, +other);

      case errorTag:
        return object.name == other.name && object.message == other.message;

      case regexpTag:
      case stringTag:
        // Coerce regexes to strings and treat strings, primitives and objects,
        // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring
        // for more details.
        return object == (other + '');

      case mapTag:
        var convert = mapToArray;

      case setTag:
        var isPartial = bitmask & PARTIAL_COMPARE_FLAG;
        convert || (convert = setToArray);

        if (object.size != other.size && !isPartial) {
          return false;
        }
        // Assume cyclic values are equal.
        var stacked = stack.get(object);
        if (stacked) {
          return stacked == other;
        }
        bitmask |= UNORDERED_COMPARE_FLAG;

        // Recursively compare objects (susceptible to call stack limits).
        stack.set(object, other);
        var result = equalArrays(convert(object), convert(other), equalFunc, customizer, bitmask, stack);
        stack['delete'](object);
        return result;

      case symbolTag:
        if (symbolValueOf) {
          return symbolValueOf.call(object) == symbolValueOf.call(other);
        }
    }
    return false;
  }

  /**
   * A specialized version of `baseIsEqualDeep` for objects with support for
   * partial deep comparisons.
   *
   * @private
   * @param {Object} object The object to compare.
   * @param {Object} other The other object to compare.
   * @param {Function} equalFunc The function to determine equivalents of values.
   * @param {Function} customizer The function to customize comparisons.
   * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`
   *  for more details.
   * @param {Object} stack Tracks traversed `object` and `other` objects.
   * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
   */
  function equalObjects(object, other, equalFunc, customizer, bitmask, stack) {
    var isPartial = bitmask & PARTIAL_COMPARE_FLAG,
        objProps = keys(object),
        objLength = objProps.length,
        othProps = keys(other),
        othLength = othProps.length;

    if (objLength != othLength && !isPartial) {
      return false;
    }
    var index = objLength;
    while (index--) {
      var key = objProps[index];
      if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {
        return false;
      }
    }
    // Assume cyclic values are equal.
    var stacked = stack.get(object);
    if (stacked && stack.get(other)) {
      return stacked == other;
    }
    var result = true;
    stack.set(object, other);
    stack.set(other, object);

    var skipCtor = isPartial;
    while (++index < objLength) {
      key = objProps[index];
      var objValue = object[key],
          othValue = other[key];

      if (customizer) {
        var compared = isPartial
          ? customizer(othValue, objValue, key, other, object, stack)
          : customizer(objValue, othValue, key, object, other, stack);
      }
      // Recursively compare objects (susceptible to call stack limits).
      if (!(compared === undefined
            ? (objValue === othValue || equalFunc(objValue, othValue, customizer, bitmask, stack))
            : compared
          )) {
        result = false;
        break;
      }
      skipCtor || (skipCtor = key == 'constructor');
    }
    if (result && !skipCtor) {
      var objCtor = object.constructor,
          othCtor = other.constructor;

      // Non `Object` object instances with different constructors are not equal.
      if (objCtor != othCtor &&
          ('constructor' in object && 'constructor' in other) &&
          !(typeof objCtor == 'function' && objCtor instanceof objCtor &&
            typeof othCtor == 'function' && othCtor instanceof othCtor)) {
        result = false;
      }
    }
    stack['delete'](object);
    stack['delete'](other);
    return result;
  }

  /**
   * Gets the data for `map`.
   *
   * @private
   * @param {Object} map The map to query.
   * @param {string} key The reference key.
   * @returns {*} Returns the map data.
   */
  function getMapData(map, key) {
    var data = map.__data__;
    return isKeyable(key)
      ? data[typeof key == 'string' ? 'string' : 'hash']
      : data.map;
  }

  /**
   * Gets the native function at `key` of `object`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {string} key The key of the method to get.
   * @returns {*} Returns the function if it's native, else `undefined`.
   */
  function getNative(object, key) {
    var value = getValue(object, key);
    return baseIsNative(value) ? value : undefined;
  }

  /**
   * Gets the `toStringTag` of `value`.
   *
   * @private
   * @param {*} value The value to query.
   * @returns {string} Returns the `toStringTag`.
   */
  var getTag = baseGetTag;

  // Fallback for data views, maps, sets, and weak maps in IE 11,
  // for data views in Edge < 14, and promises in Node.js.
  if ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||
      (Map && getTag(new Map) != mapTag) ||
      (Promise && getTag(Promise.resolve()) != promiseTag) ||
      (Set$1 && getTag(new Set$1) != setTag) ||
      (WeakMap && getTag(new WeakMap) != weakMapTag)) {
    getTag = function(value) {
      var result = objectToString.call(value),
          Ctor = result == objectTag ? value.constructor : undefined,
          ctorString = Ctor ? toSource(Ctor) : undefined;

      if (ctorString) {
        switch (ctorString) {
          case dataViewCtorString: return dataViewTag;
          case mapCtorString: return mapTag;
          case promiseCtorString: return promiseTag;
          case setCtorString: return setTag;
          case weakMapCtorString: return weakMapTag;
        }
      }
      return result;
    };
  }

  /**
   * Checks if `value` is a valid array-like index.
   *
   * @private
   * @param {*} value The value to check.
   * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
   * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
   */
  function isIndex(value, length) {
    length = length == null ? MAX_SAFE_INTEGER : length;
    return !!length &&
      (typeof value == 'number' || reIsUint.test(value)) &&
      (value > -1 && value % 1 == 0 && value < length);
  }

  /**
   * Checks if `value` is suitable for use as unique object key.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
   */
  function isKeyable(value) {
    var type = typeof value;
    return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')
      ? (value !== '__proto__')
      : (value === null);
  }

  /**
   * Checks if `func` has its source masked.
   *
   * @private
   * @param {Function} func The function to check.
   * @returns {boolean} Returns `true` if `func` is masked, else `false`.
   */
  function isMasked(func) {
    return !!maskSrcKey && (maskSrcKey in func);
  }

  /**
   * Checks if `value` is likely a prototype object.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
   */
  function isPrototype(value) {
    var Ctor = value && value.constructor,
        proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;

    return value === proto;
  }

  /**
   * Converts `func` to its source code.
   *
   * @private
   * @param {Function} func The function to process.
   * @returns {string} Returns the source code.
   */
  function toSource(func) {
    if (func != null) {
      try {
        return funcToString.call(func);
      } catch (e) {}
      try {
        return (func + '');
      } catch (e) {}
    }
    return '';
  }

  /**
   * Performs a
   * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
   * comparison between two values to determine if they are equivalent.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.eq(object, object);
   * // => true
   *
   * _.eq(object, other);
   * // => false
   *
   * _.eq('a', 'a');
   * // => true
   *
   * _.eq('a', Object('a'));
   * // => false
   *
   * _.eq(NaN, NaN);
   * // => true
   */
  function eq(value, other) {
    return value === other || (value !== value && other !== other);
  }

  /**
   * Checks if `value` is likely an `arguments` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an `arguments` object,
   *  else `false`.
   * @example
   *
   * _.isArguments(function() { return arguments; }());
   * // => true
   *
   * _.isArguments([1, 2, 3]);
   * // => false
   */
  function isArguments(value) {
    // Safari 8.1 makes `arguments.callee` enumerable in strict mode.
    return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&
      (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);
  }

  /**
   * Checks if `value` is classified as an `Array` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array, else `false`.
   * @example
   *
   * _.isArray([1, 2, 3]);
   * // => true
   *
   * _.isArray(document.body.children);
   * // => false
   *
   * _.isArray('abc');
   * // => false
   *
   * _.isArray(_.noop);
   * // => false
   */
  var isArray = Array.isArray;

  /**
   * Checks if `value` is array-like. A value is considered array-like if it's
   * not a function and has a `value.length` that's an integer greater than or
   * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
   * @example
   *
   * _.isArrayLike([1, 2, 3]);
   * // => true
   *
   * _.isArrayLike(document.body.children);
   * // => true
   *
   * _.isArrayLike('abc');
   * // => true
   *
   * _.isArrayLike(_.noop);
   * // => false
   */
  function isArrayLike(value) {
    return value != null && isLength(value.length) && !isFunction(value);
  }

  /**
   * This method is like `_.isArrayLike` except that it also checks if `value`
   * is an object.
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an array-like object,
   *  else `false`.
   * @example
   *
   * _.isArrayLikeObject([1, 2, 3]);
   * // => true
   *
   * _.isArrayLikeObject(document.body.children);
   * // => true
   *
   * _.isArrayLikeObject('abc');
   * // => false
   *
   * _.isArrayLikeObject(_.noop);
   * // => false
   */
  function isArrayLikeObject(value) {
    return isObjectLike(value) && isArrayLike(value);
  }

  /**
   * Performs a deep comparison between two values to determine if they are
   * equivalent.
   *
   * **Note:** This method supports comparing arrays, array buffers, booleans,
   * date objects, error objects, maps, numbers, `Object` objects, regexes,
   * sets, strings, symbols, and typed arrays. `Object` objects are compared
   * by their own, not inherited, enumerable properties. Functions and DOM
   * nodes are **not** supported.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to compare.
   * @param {*} other The other value to compare.
   * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
   * @example
   *
   * var object = { 'a': 1 };
   * var other = { 'a': 1 };
   *
   * _.isEqual(object, other);
   * // => true
   *
   * object === other;
   * // => false
   */
  function isEqual(value, other) {
    return baseIsEqual(value, other);
  }

  /**
   * Checks if `value` is classified as a `Function` object.
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a function, else `false`.
   * @example
   *
   * _.isFunction(_);
   * // => true
   *
   * _.isFunction(/abc/);
   * // => false
   */
  function isFunction(value) {
    // The use of `Object#toString` avoids issues with the `typeof` operator
    // in Safari 8-9 which returns 'object' for typed array and other constructors.
    var tag = isObject(value) ? objectToString.call(value) : '';
    return tag == funcTag || tag == genTag;
  }

  /**
   * Checks if `value` is a valid array-like length.
   *
   * **Note:** This method is loosely based on
   * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
   * @example
   *
   * _.isLength(3);
   * // => true
   *
   * _.isLength(Number.MIN_VALUE);
   * // => false
   *
   * _.isLength(Infinity);
   * // => false
   *
   * _.isLength('3');
   * // => false
   */
  function isLength(value) {
    return typeof value == 'number' &&
      value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
  }

  /**
   * Checks if `value` is the
   * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
   * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
   *
   * @static
   * @memberOf _
   * @since 0.1.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is an object, else `false`.
   * @example
   *
   * _.isObject({});
   * // => true
   *
   * _.isObject([1, 2, 3]);
   * // => true
   *
   * _.isObject(_.noop);
   * // => true
   *
   * _.isObject(null);
   * // => false
   */
  function isObject(value) {
    var type = typeof value;
    return !!value && (type == 'object' || type == 'function');
  }

  /**
   * Checks if `value` is object-like. A value is object-like if it's not `null`
   * and has a `typeof` result of "object".
   *
   * @static
   * @memberOf _
   * @since 4.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
   * @example
   *
   * _.isObjectLike({});
   * // => true
   *
   * _.isObjectLike([1, 2, 3]);
   * // => true
   *
   * _.isObjectLike(_.noop);
   * // => false
   *
   * _.isObjectLike(null);
   * // => false
   */
  function isObjectLike(value) {
    return !!value && typeof value == 'object';
  }

  /**
   * Checks if `value` is classified as a typed array.
   *
   * @static
   * @memberOf _
   * @since 3.0.0
   * @category Lang
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
   * @example
   *
   * _.isTypedArray(new Uint8Array);
   * // => true
   *
   * _.isTypedArray([]);
   * // => false
   */
  var isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;

  /**
   * Creates an array of the own enumerable property names of `object`.
   *
   * **Note:** Non-object values are coerced to objects. See the
   * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
   * for more details.
   *
   * @static
   * @since 0.1.0
   * @memberOf _
   * @category Object
   * @param {Object} object The object to query.
   * @returns {Array} Returns the array of property names.
   * @example
   *
   * function Foo() {
   *   this.a = 1;
   *   this.b = 2;
   * }
   *
   * Foo.prototype.c = 3;
   *
   * _.keys(new Foo);
   * // => ['a', 'b'] (iteration order is not guaranteed)
   *
   * _.keys('hi');
   * // => ['0', '1']
   */

  function keys(object) {
    return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
  }

  // isEqual is from loDash exported as a module:
  //  https://github.com/lodash/lodash/tree/4.5.0-npm-packages/lodash.isequal

  const conxOptions = {
    apiKey: "AIzaSyDc_8MiQvWdCNpvZcvbJyyQYGeTaVGpBgo",
    authDomain: "glider-feb-2019.firebaseapp.com",
    databaseURL: "https://glider-feb-2019.firebaseio.com",
    projectId: "glider-feb-2019",
    storageBucket: "glider-feb-2019.appspot.com",
    messagingSenderId: "451231012490"
  };

  let remoteStore = getRemoteStore(conxOptions);
  // remoteStore.getFlightState;

  window.rs = remoteStore;

  // Deep compare -- uses lodash's isEqual()

  function isDifferent(a, b) {
    return ! isEqual(a, b); 
  }

  // Given an array of variable names, create an object to initialize
  //  the state of a store (in the Module definition)

  function getVuExStateFromPartVarList(sharedVariables, getPartVariableId) {
    
    /* DON'T THROW THIS OUT - MAY BE USEFUL
    remoteStore.getFlightState.then(s => {
      
      console.log('STATE ON REMOTE');
      let remoteValues = s.exportVal();
      
      for (let remoteVarName in remoteValues) {
        if (! remoteVarName.startsWith('_1234')) 
          delete remoteValues[remoteVarName];
      }
      
      console.log(remoteValues);
    }); */
    
    let partVars = Object.keys(sharedVariables);
    
    let stateObj = partVars.reduce((stateObjAcc, partVarName) => {
      const partVarId = getPartVariableId(partVarName);
      stateObjAcc[partVarId] = sharedVariables[partVarName];
      return stateObjAcc;
    }, {});
    
    return stateObj;   
  }

  // Module definition for Part store
  //   Define the getter, mutator, and state

  function getPartModuleDefinition(sharedVariables, getPartVariableId) {

    let partModuleState = getVuExStateFromPartVarList(sharedVariables, getPartVariableId);

    let varGetter = (partModuleState, getters, rootState) => partVarId => {
      
      console.log(`GETVAL: getting ${partVarId}`);
      console.log(`> partModuleState['${partVarId}'] is: ${partModuleState[partVarId]}`);
      console.log(`> and module state is:`);
      console.log(partModuleState);
      
      return partModuleState[partVarId];
    };
    
    let varSetter = function(partModuleState, [partVarName, partVarValue]) {

      let storePartVarId = getPartVariableId(partVarName);

      // Only update if there's a change in value

      if (isDifferent(partModuleState[storePartVarId], partVarValue)) {
        
        console.log('UPDATING LOCAL STORE:');
        console.log(`> partModuleState['${storePartVarId}'] = ${partVarValue};`);
        console.log('> Module state is now:');
        console.log(partModuleState);
        
        partModuleState[storePartVarId] = partVarValue;
        remoteStore.set(storePartVarId, partVarValue);
      }
    };

    return {    
      state: partModuleState,
      namespaced: true,
      getters: { getVal: varGetter },
      mutations: { 
        setValTo: varSetter
      }
    }
  }

  // This is called when registering the Part Type component (no instances yet)
  // It returns setters and getters for each shared var in the Part type
  // These setters and getters are defined at the component level, but executed
  //  at the instance level

  function getPartTypeSettersGetters({ sharedVariables, flightInstanceId }) {
    
    let sharedVariablesGettersSetters = {},
        localStore = this;
    
    Object.entries(sharedVariables).forEach(([varName, varInitVal]) => {
      
      let getFullVarId = (varName, partInstanceId) => `_${flightInstanceId}-${partInstanceId}-${varName}`;
      
      sharedVariablesGettersSetters[varName] = {
        
        get: function () {
          
          let fullVarId = getFullVarId(varName, this.id),
              namespacedGetVal = `${this.id}/getVal`;
          
          console.log(`PART GETTER NEW: localStore.getters['${namespacedGetVal}']('${fullVarId}')`);
          console.log(localStore);
          console.log('RESULT: ' + localStore.getters[namespacedGetVal](fullVarId));
          return localStore.getters[namespacedGetVal](fullVarId);
        },
        
        set: function (newValue) {
          
          let fullVarId = getFullVarId(varName, this.id),
              namespacedSetValTo = `${this.id}/setValTo`;
          
          console.log(`PART SETTER NEW: localStore.commit(${namespacedSetValTo}, [${varName}, ${newValue}])`);
          localStore.commit(namespacedSetValTo, [varName, newValue]);
        }
      };
    });
    
    return sharedVariablesGettersSetters;
  }

  // Note that this will be a method off of the main root VuEx store
  // This registers a Part INSTANCE -- it creates a store module

  function registerPart({ sharedVariables, partId, flightInstanceId }) {
      
    console.log(`REGISTERING PART ${partId} IN STORE`);
    
    let localStore = this,
        partModuleId = partId,
        variableNames = Object.keys(sharedVariables);
    
    // Given a Part varId, return the full store ID
    //  (namespaced for the FlightInstanceId and the PartId)
    
    let getPartVariableId = partVarId => `_${flightInstanceId}-${partId}-${partVarId}`;
    
    // Get Part instance's VuEx module definition & add to store
    // TODO: Also (to be coded) initialize shared variables to whatever's in sharedVariables 
    //   UNLESS there's a value in remote store
    
    let partModule = getPartModuleDefinition(sharedVariables, getPartVariableId);
    localStore.registerModule(partModuleId, partModule);
    
    // Add a remoteStore listener for each Part variable
    // If a remotestore entry changes, then --> update the localStore
    
    // MOVE TO addRemoteStoreListener() ABOVE
    
    let namespacedGetVal = `${partModuleId}/getVal`,
        namespacedSetValTo = `${partModuleId}/setValTo`;
    
    variableNames.forEach(partVarName => {

      // Define callback for when a value changes on the remote store
      // (callback updates local store with remote value)
      
      const partVarId = getPartVariableId(partVarName);
      
      let onRemoteChange = remoteVarValue => {
        let localVarValue = localStore.getters[namespacedGetVal](partVarId);
        if (isDifferent(remoteVarValue, localVarValue)) {
          console.log(`CHANGE ON REMOTE STORE: localStore.commit('${namespacedSetValTo}', ['${partVarName}', ${remoteVarValue}]);`);
          localStore.commit(namespacedSetValTo, [partVarName, remoteVarValue]);
        }
      };

      // Apply that callback
      
      remoteStore.listenForChanges(
        getPartVariableId(partVarName),
        onRemoteChange,
        sharedVariables[partVarName]
      );
    });
    
    return true; // TODO: What's a useful return value??
  }

  // Initialize flag indicates whether to first clean out the remote DB

  function getLocalStore(flightInstanceId, p4vData, initialize) {

    if (initialize) {
      remoteStore.deleteFlightEntries(flightInstanceId);
    }
    
    // Create getters and setters for PartViews
    // Generate a hash between PartViews ID and their containing Part ID
    
    const partViewsToParts = Object.values(p4vData.partViews).reduce((acc, partView) => { 
      acc[partView.id] = partView.partId;
      return acc;
     }, {});
    
    let getPartViewSharedVariable = function(state) {
      return function(partViewId, varName) {
        let partId = state.partViewsToParts[partViewId],
            varId = `_${state.flightInstanceId}-${partId}-${varName}`; // TODO: FIX THIS

        return state[partId][varId];
      }
    };
    
    // Parts to PartView registry
    // TODO: Can this be done straight off of p4vData?
    
    let partsToPartViews = Object.keys(partViewsToParts).reduce((acc, partViewId) => { 
      let partId = partViewsToParts[partViewId];
      if (acc[partId] === undefined) acc[partId] = [];
      acc[partId].push(partViewId);
      return acc;
    }, {});
    
    // Methods by which Phases can notify Parts
    
    let phasesParts = p4vData.phasesParts,
        partInstanceRegistry = {}; // Keeps track of components by ID
    
    function addPartInstanceToRegistry(part) {
      partInstanceRegistry[part.id] = part;
      console.log(`ADDING ${part.id} TO PART REGISTRY`);
      console.log(part);
    }
    
    function phaseActive(phase) {
      
      console.log(`ACTIVATING PHASE ${phase.id}`);
      
      phasesParts[phase.id].forEach(partId => {
        
        console.log(`> ACTIVATING PART ${partId}`);
        
        // Activate Part
        
        let part = partInstanceRegistry[partId];
        
        if (part) { part.makeActive(); }
        
        // Activate associated PartView(s)
        
        if (partsToPartViews[partId] !== undefined) {
          partsToPartViews[partId].forEach(
            partViewId => partInstanceRegistry[partViewId].makeActive()
          );
        }
      });
    }
    
    function phaseInactive(phase) {
      // phasesParts[phaseId].forEach(part => part.deactivate()); // TODO -- need to resolve PartId to Part component
      console.log(`DEACTIVATING PHASE ${phase.id}`);
      phasesParts[phase.id].forEach(partId => { 
        console.log(`> DEACTIVATING PART ${partId}`); 
        let part = partInstanceRegistry[partId];
        if (part) { part.makeInactive(); }
        if (partsToPartViews[partId] !== undefined) {
          partsToPartViews[partId].forEach(
            partViewId => partInstanceRegistry[partViewId].makeInactive()
          );
        }
      });
    }
    
    /*
    let setPartViewSharedVariable = function(state, [partViewId, varName, newValue]) {
      let partId = state.partViewsToParts[partViewId],
          varId = `_${state.flightInstanceId}-${partId}-${varName}`; // TODO: FIX THIS

      state[partId][varId] = newValue;
      // state.commit("${partId}/setValTo", ['count', 1000]); // MAKE THIS WORK
    }; */
    
    // TODO: add a sync'ed module for application-level state, e.g. currentPhase
    //  (there are other values that are NOT sync'ed)
    
    let elEstor = new Vuex.Store({
      state: {
        flightInstanceId: flightInstanceId,
        partViewsToParts: partViewsToParts
      },
      mutations: {
        // setPartViewSharedVariable: setPartViewSharedVariable
      },
      modules: {},
      getters: {
        getPartViewSharedVariable: getPartViewSharedVariable
      }
    });

    elEstor.registerPart = registerPart;
    
    elEstor.getPartTypeSettersGetters = getPartTypeSettersGetters;
    elEstor.setPartViewSharedVariable = function(partViewId, varName, newValue) {
      let partId = this.state.partViewsToParts[partViewId];

      console.log(`SETTING ${varName} IN ${partId} TO ${newValue} in STORE!`);
      
      this.commit(`${partId}/setValTo`, [varName, newValue]);
    };
    
    elEstor.addPartInstanceToRegistry = addPartInstanceToRegistry;
    
    elEstor.phaseActive   = phaseActive;
    elEstor.phaseInactive = phaseInactive;
    
    elEstor.placesPartviews = p4vData.placesPartviews;
    elEstor.addPartViewToPlace = function (partViewId, placeId) {
      
      // TODO: not sure this is necessary
      
      if (this.placesPartviews[placeId] === undefined) {
        this.placesPartviews[placeId] = [];
      }
      
      this.placesPartviews[placeId].push(partViewId);
      
      console.log(this.placesPartviews[placeId]);
    };
    
    return elEstor; 
  }

  /* 

    CONTENTS

    - Class definitions:
      - Phase
      - Phase_noChildren
      - Phase_withChildren
        - Phase_par
        - Phase_seq
    - Phase_manager (TODO -- will handle next/pause/play/etc)

    STILL LEFT TODO:

    - RepeatCount implementation
    - Goto/next/prev implementation
    - Play/Pause

    PHASE CONSTRUCTOR OPTIONS OBJECT PROPERTIES:

    - id
    - app
    - delay
    - duration
    - ... more to come? RepeatCount, etc. ...


    */

    // Classes


  /* 
    Phase.states = { 
      idle: 1,      // Unactivated and waiting (possible due to a delayed start)
      running: 2,   // Active and running
      complete: 3   // Completed being active
    }; */

  class Phase {

    constructor(options) {

      const MILLISECONDS_PER_SECOND = 1000;
      
      this.id       = (options.id === undefined) ? this.generateId() : options.id;
      this.app      = options.app;
      this.delay    = (typeof options.delay === 'number') ? options.delay  * MILLISECONDS_PER_SECOND : 0;
      this.duration = (typeof options.duration === 'number') ? options.duration * MILLISECONDS_PER_SECOND : Infinity;

      this.currentState = 'idle';
      this.timer = null;
      
      this.xxxComplete = function () {}; // TODO: trying this out
    }

    generateId() {
      return '_rand_' + Math.floor(Math.random() * 1000);
    }

    // Given state s, if the Phase isn't already 
    //  in that state, change state to s
    //  (note: does not check for allowed/disallowed transitions)

    set state(s) {
      if (this.currentState !== s) this.currentState = s;
    }

    get isComplete() {
      return (this.currentState === 'complete')
    }
    
    get isRunning() {
      return (this.currentState === 'running') 
    }

    // Change state to complete and notify App

    complete(onComplete) {
      this.state = 'complete';
      this.notifyInactive();
      this.clearTimer();
      
      // TODO: revisit this -- should onComplete be part of 
      //  object state?
      
      if (typeof onComplete === 'function') {
        onComplete();
      } else {
        this.xxxComplete(); 
      }
    }

    // Change state to running and notify App

    startRunning() {
      this.state = 'running';
      this.notifyActive();
    }

    // Notifications to App
    // Note that active/inactive are messages to App,
    //  but are not the same as the Phase states
    //  of idle/running/complete

    notifyActive() {
      this.app.phaseActive(this);
    }

    notifyInactive() {
      this.app.phaseInactive(this);
    }

    // Schedule a full run -- 
    //  delay, then afterDelay(), then duration, then afterDuration()

    scheduleRun(stuffToDo) {

      stuffToDo = Object.assign({
        afterDelay: () => {},
        afterDuration: () => {} 
      }, stuffToDo);

      const thisPhase = this;

      // TODO: No change of state?
      
      const afterDuration = function() {
        thisPhase.forceComplete();
        if (stuffToDo.afterDuration !== undefined) {
          stuffToDo.afterDuration();
        }
      };

      // After the delay: do stuff; schedule what to do after the duration
      // TODO: no change of state?
      
      const afterDelay = function () {
        stuffToDo.afterDelay();
        if (thisPhase.duration < Number.POSITIVE_INFINITY) {
          thisPhase.waitAndCall(thisPhase.duration, afterDuration);
        }
      };

      this.state = 'idle';
      this.waitAndCall(this.delay, afterDelay);
    }

    // Schedule a future function call

    waitAndCall(timeInMillieconds, aFunction) {
      this.timer = window.setTimeout(aFunction, timeInMillieconds);
    }

    // Clears currently running timer

    clearTimer() {
      if (this.timer !== null) {
        clearTimeout(this.timer);
        this.timer = null;
      }
    }

    // TEMP - this is for diagnostics only

    get json() {
      return {
        id: this.id,
        type: this.constructor.name,
        delay: this.delay,
        duration: this.duration,
        children: this.childPhases !== undefined ? this.childPhases.map(child => child.json) : null
      }
    }
  }

  // This is the "leaf" object -- does not contain
  //  any children (it may not be necessary)

  class Phase_noChildren extends Phase {

    constructor(options) {
      super(options);
    }

    forceComplete() {
      this.complete();
    }

    get isContainer() { return false }

    // Main run routine
    // Schedule to run after delay and call
    //  onComplete after duration

    run(onComplete) {

      let thisPhase = this;

      // KLUDGE
      
      this.xxxComplete = onComplete;
      
      let callAfterDelay = function () {
        thisPhase.startRunning();
      };

      this.scheduleRun({
        afterDelay: callAfterDelay,
        afterDuration: onComplete
      });
    }
  }

  // TimeContainer abstract class

  class Phase_withChildren extends Phase {

    constructor(options) {
      super(options);
      this.childPhases = [];
    }

    get isContainer() { return true }

    addChild(childPhase) {
      childPhase.parentPhase = this;
      childPhase.app = this.app;
      this.childPhases.push(childPhase);
    }

    forceChildrenToComplete() {
      this.childPhases.forEach(childPhase => childPhase.forceComplete());
    }

    forceComplete() {
      this.forceChildrenToComplete();
      this.complete();
    }
  }

  // Parallel TimeContainer

  class Phase_par extends Phase_withChildren {

    constructor(options) {      
      super(options);
    }

    // Check if all the child phases have completed (boolean)
    // TODO: this may not be necessary

    get allChildrenComplete() {
      return this.childPhases.every(childPhase => childPhase.isComplete)
    }

    // Start all child phases running

    runAllChildren(onChildComplete) {
      this.childPhases.forEach(childPhase => childPhase.run(onChildComplete));
    }

    // Generate a function that is called every time a child completes.
    // If all children are complete, transition this phase to complete

    getOnChildCompleteCallback(onThisPhaseComplete) {

      let thisPhase = this;

      let onChildCompleteCallback = function() {
        if (thisPhase.allChildrenComplete) ;
      };
      
      return onChildCompleteCallback;
    }

    // Main run routine

    run(onComplete) { 

      let thisPhase = this;

      // KLUDGE
      
      this.xxxComplete = onComplete;
      
      // Schedule to start running after delay

      let onChildComplete = this.getOnChildCompleteCallback(onComplete);

      let callAfterDelay = function () {
        thisPhase.startRunning();
        thisPhase.runAllChildren(onChildComplete); // Run children
      };

      this.scheduleRun({
        afterDelay: callAfterDelay,
        afterDuration: onComplete
      });
    }
  }

  // Sequence TimeContainer

  class Phase_seq extends Phase_withChildren {

    constructor(options) { 
      super(options);
      this.currChildIndex = -1;
      this.onAllChildrenComplete_KLUDGE = function() {};
    }
    
    // Force advance to the next child
    // TODO: this is a kludge
    
    forceNext() {
      
      console.log('NEXT!!');
      console.log(this.isRunning);

      let nextChild = this.currChildIndex + 1;
      if (nextChild < this.childPhases.length && this.isRunning) {
        console.log(this.currChildIndex);
        this.childPhases[this.currChildIndex].forceComplete();
      }
    }

    // Start all child phases running
    // (recurse through children)

    runAllChildren(onLastChildComplete) {
      let firstChildIndex = 0;
      this.runChild(firstChildIndex, onLastChildComplete);
    }

    // notifyParentCallback is provided by parentPhase to let it 
    //  know when sequence is complete

    runChild(currChildPhaseIndex, onLastChildComplete) {

      let thisPhase = this,
        isLastChild = (this.childPhases.length === currChildPhaseIndex + 1),
        currentChild = this.childPhases[currChildPhaseIndex],
        onChildComplete;

      this.currChildIndex = currChildPhaseIndex;
      
      // If this is the last child Phase, 
      //  complete this Phase when the child is complete

      if (isLastChild) {
        onChildComplete = function () { 
          
          this.currChildIndex = -1;
          
          // COMMENTED OUT -- when children are complete is NOT when the phase completes
          //  (maybe - need to check SMIL)
          // thisPhase.complete();
          // onLastChildComplete();
        };
      } else { 

        // If this is not the last child Phase, 
        //  run the next child when this child Phase is complete

        onChildComplete = function () {
          // thisPhase.currChildIndex = currChildPhaseIndex + 1;
          thisPhase.runChild(currChildPhaseIndex + 1, onLastChildComplete);
        };
      }

      currentChild.run(onChildComplete);
    }

    // Main run routine

    run(onComplete) {

      let thisPhase = this;

      // KLUDGE
      
      this.xxxComplete = onComplete;
      
      // Schedule to start running after delay

      let callAfterDelay = function () {
        thisPhase.startRunning();
        thisPhase.runAllChildren(onComplete); // Run children
      };

      this.scheduleRun({
        afterDelay: callAfterDelay,
        afterDuration: onComplete
      });
    }
  }

  // Map @phase-type values to Classes

  Phase.types = {
    par: Phase_par,
    parallel: Phase_par,
    seq: Phase_seq,
    sequence: Phase_seq,
    leaf: Phase_noChildren
  };

  // Phase factory

  function phaseFactory(options) {
    if (Phase.types[options.type] !== undefined) {
      return new Phase.types[options.type](options);
    } else {
      console.warning(`Unrecognised Phase type ${options.type}!`);
    }
  }

  // Given a Part definition, set up shared data entries in store

  function initPartTypeSharedData(partTypeName, partDef, p4vData, localStore, flightInstanceId) {
    
    let sharedData = partDef.part.sharedData ? partDef.part.sharedData() : undefined;

    // TEMP KLUDGE - it should not be here ...
    // sharedData = Object.assign({ _isActive: false }, sharedData);
    
    let sharedDataExists = (sharedData !== undefined && Object.keys(sharedData).length > 0);
    
    if (sharedDataExists) {

      // Get the setters/getters for shared variables
      
      let partTypeSettersGetters = localStore.getPartTypeSettersGetters({ 
        sharedVariables: sharedData,
        flightInstanceId: flightInstanceId
      });

      // Create a Part module in store for each instance of this Part Type
      //  (this instance ID list is pulled from P4Vdata)
      
      const partInstanceIDs = Object.keys(p4vData.parts)
        .filter(partKey => p4vData.parts[partKey].type === partTypeName)
        .map(partKey => p4vData.parts[partKey].id);
      
      // Register each instance of this Part Type with the store

      partInstanceIDs.forEach(partId => {
        localStore.registerPart({
          sharedVariables: sharedData,
          partId: partId,
          flightInstanceId: flightInstanceId
        });
      });

      // Add shared variable setters and getters to 
      //  the component's .computed
      // TODO: Currently overwrites .computed -- should this be moved to a mixin?

      partDef.part.computed = partTypeSettersGetters; 

      delete partDef.part.sharedData;
    }
    
    return partDef;
  }

  var PartUtils = /*#__PURE__*/Object.freeze({
    initPartTypeSharedData: initPartTypeSharedData
  });

  // The default Part is an HTML pass-through
  /*
  let part = {
    render(h) { 
      return h(
        this.$vnode.data.tag,
        this.$slots.default
      ) 
    },
    data() {
      return {
        blue: "This is from the HTML Part"
      }
    }
  }; */

  let part = {
    data() {
      return {
        blue: "This is from the HTML Part"
      }
    }
  };

  let views = [{
    partviewName: 'defaultView',
    render(h) { 
      return h(
        this.$vnode.data.tag,
        { attrs: { id: this.id }},
        this.$slots.default
      ) 
    }
  }];

  var _default = /*#__PURE__*/Object.freeze({
    part: part,
    views: views
  });

  // _SUPER PART
  // This is the base functionality that all parts share

  /* TODO: NOT SURE if the Part needs to know its ID / PartID */

  let part$1 = {
    
    data: function () {
      return {
        _isActive: false
      }
    },
    
    props: ['id'],
    
    created: function() {
      // this.$root.parts[this.id] = this; // TODO: this may not be necessary
      this.$root.app.addPartInstanceToRegistry(this);
      this.makeInactive();
    },
    
    methods: {
      makeActive: function() { 
        console.log(`PART ${this.id} IS TURNING ON`);
        this._isActive = true;
      },
      makeInactive: function() { 
        console.log(`PART ${this.id} IS TURNING OFF`);
        this._isActive = false;
      }
    }
  };

  // _SUPER PART VIEW

  let partView = {

    data() {
      return {
        _isActive: false,
        // id: undefined, // Needs to know ID for PartView-Part lookup
        red: 'This is from _Super PV edition'
      }
    },
    
    props: ['id', 'is_also', 'part_id'],
    
    // Create the Part if there is @isAlso
    // (if PartView and Part are on the same element)
    
    mounted: function() {
      
      let isAlso = this.is_also;
      
      this.$root.partviews[this.id] = this;
      
      this.$root.app.addPartInstanceToRegistry(this);
      this.makeInactive();
      
      if (isAlso) {

        console.log('PART AND PART VIEW ON SAME ELEMENT:');
        console.log(`Is also value: ${isAlso}`);
        console.log('AND APP IS');
        console.log(this.$root.app);
        
        let otherComponentName = isAlso;
        let PartComponentClass = Vue.extend(window.wtf.components[otherComponentName]);
        let partId = this.part_id;
        
        // TODO: add association between PartView and (new) Part
        
        let propsData = this.$props;
        
        let partPropKeys = Object.keys(this.$props)
          .filter(
            attributeName => !['id','is_also', 'part_id'].includes(attributeName)
          );
        
        let propsData2 = partPropKeys.reduce((acc, key) => {
          let newPropsData = acc;
          newPropsData[key] = this.$props[key];
          return newPropsData;
        }, {});
        
        console.log(`PROPS DATA FOR ${this.id}`);
        console.log(propsData2);
        
        let partComponent = new PartComponentClass({
          propsData: { id: partId }
        });
        
        partComponent.$mount(); // manually start the mounting of an unmounted Vue instance.
        partComponent.makeInactive();
        
        console.log(`And the new Part is:`);
        console.log(partComponent);
        
        //this.$root.parts[partId] = partComponent;
        this.$root.app.addPartInstanceToRegistry(partComponent);
      }
    },
    
    methods: {
      makeActive: function() { 
        console.log(`PART VIEW ${this.id} IS TURNING ON`);
        this._isActive = true;
        this.$el.classList.add('part-active');
        this.$el.classList.remove('part-inactive');
      },
      makeInactive: function() { 
        console.log(`PART VIEW ${this.id} IS TURNING OFF`);
        this._isActive = false;
        this.$el.classList.remove('part-active');
        this.$el.classList.add('part-inactive');
      }
    }
  };

  // WRAP IT ALL UP AND EXPORT

  let views$1 = [partView];

  var _super = /*#__PURE__*/Object.freeze({
    part: part$1,
    views: views$1
  });

  // A simple demonstration poll

  // PART

  let part$2 = {
    template: `<div><slot></slot></div>`,
    sharedData: function() {
      return {
        count: 0,
        count2: 0,
        count3: 0
      }
    }
  };

  // PART VIEWS

  let partView_counterButton = {
    partviewName: 'controller',
    template: `
    <div style="color: black">
      <h1>I know how to code:</h1>
      <button type="button" class="btn btn-light btn-block" v-on:click="inc">HTML</button>
      <button type="button" class="btn btn-light btn-block" v-on:click="inc2">CSS</button>
      <button type="button" class="btn btn-light btn-block" v-on:click="inc3">Javascript</button>
    </div>
  `,
    
    methods: {
      inc: function() { 
        console.log('INCREMENT 1!');
        this.count++;
      },
      inc2: function() { this.count2++; },
      inc3: function() { this.count3++; }
    }
  };

  let partView_countDisplay = {
    partviewName: 'display',
    template: `
    <div>
      <p style="color: red">{{ ''.repeat(count) }} HTML</p>
      <p style="color: yellow">{{ ''.repeat(count2) }} CSS</p>
      <p style="color: blue">{{ ''.repeat(count3) }} Javascript</p>
    </div>`
  };

  // WRAP IT ALL UP AND EXPORT

  let views$2 = [partView_counterButton, partView_countDisplay];

  var poll = /*#__PURE__*/Object.freeze({
    part: part$2,
    views: views$2
  });

  /*

    This Part presents a play/advance button that starts the presentation 
    and advances the seq Phase specified in @phaseId.

  */

  let part$3 = {
    template: `<div><slot></slot></div>`,
    // props: ['phase_id'],
    sharedData: function() {
      return {
        currSlide: -1
      }
    },
    data: function() {
      return {
        playing: false 
      }
    }
  };

  // PART VIEWS

  let partView_button = {
    partviewName: 'defaultView',
    props: ['phase_id'],
    template: `
    <button v-on:click="advance">
      next 
    </button>`,
    methods: {
      
      // THIS WILL ONLY BE RUN BY INITIALIZOR
      // WHEN HITTING THE 'RUN' BUTTON
      
      makeGliderRun: function() {
        this.currSlide = -1;
        window.setTimeout(function() { 
          // alert('yes: ' + thisPartView.currSlide);
          // thisPartView.currSlide = 0 
        }, 1000);
      },
      
      advance: function() { 
        console.log('HIT');
        this.currSlide++;
      }
    },
    watch: {
      currSlide: function (newVal, oldVal) {
        
        console.log(`currSlide changed from ${oldVal} to ${newVal}`);

        if (newVal !== -1) {
          
          console.log('RUN **********************');
          
          // Some information for debugging
          
          if (! this.$root.app.isInitializingInstance) {
            if (window.glider.isRunning) { 
              console.log('not initiator - already running');
            } else {
              console.log('not initiator - not running');
            }
          } else {
            if (window.glider.isRunning) { 
              console.log('initiator - already running');
            } else {
              console.log('initiator - not running');
            }
          }
          
          if (window.glider.isRunning) {
            console.log('ADVANCING -- BLAH BLAH BLAH');
            window.glider.phases[this.phase_id].forceNext();
          }
        }
        
        
        /*
        if (newVal === -1 && this.$root.app.isInitializingInstance) {
          console.log('GO');
        } else {
          console.log('MAKE ME GO');
          this.currSlide++;
          // this.currSlide = -1; 
        } */
        
        /*
        if (newVal === -1) {
          alert('STARTING');
          this.currSlide = -1;
        } else {
          //alert('ADVANCING TO ' + newVal);
          window.glider.phases[this.phase_id].forceNext();
        } */
      }
    }
  };

  // WRAP IT ALL UP AND EXPORT

  let views$3 = [partView_button];

  var nextButton = /*#__PURE__*/Object.freeze({
    part: part$3,
    views: views$3
  });

  // A simple demonstration color picker.
  // The controller can choose a color, which is reflected on the display

  // PART

  let part$4 = {
    sharedData: function() {
      return {
        color: 'black'
      }
    }
  };

  // PART VIEWS

  let partView_colorPicker = {
    partviewName: 'controller',
    template: `
    <div style="color: white; text-align: center">
      <h1>Choose</h1>
      <div style="font-size: 300%; padding: 10px; border: 1px solid white">
        <span v-on:click="setRed" style="color: red">
          
        </span>
        <span v-on:click="setBlue" style="color: blue">
          
        </span>
        <span v-on:click="setGreen" style="color: green">
          
        </span>
        <span v-on:click="setOrange" style="color: orange">
          
        </span>
      </div>
    </div>
  `,
    
    methods: {
      setRed: function() { 
        this.color = 'red';
      },
      setBlue: function() { 
        this.color = 'blue';
      },
      setGreen: function() { 
        this.color = 'green';
      },
      setOrange: function() { 
        this.color = 'orange';
      }
    }
  };

  let partView_colorDisplay = {
    partviewName: 'display',
    template: `
    <h1 class="display-1">
      {{ color }}
    </h1>`,
    watch: {
      color: function (color) {
        document.body.style.backgroundColor = color;
      }
    }
  };

  // WRAP IT ALL UP AND EXPORT

  let views$4 = [partView_colorPicker, partView_colorDisplay];

  var colorPickerDemo = /*#__PURE__*/Object.freeze({
    part: part$4,
    views: views$4
  });



  var partTypeRegistry = /*#__PURE__*/Object.freeze({
    _super: _super,
    identity: _default,
    poll: poll,
    nextButton: nextButton,
    colorPickerDemo: colorPickerDemo
  });

  /*

    For now, there are 2 hard-coded Place definitions: DSL-wall and DSL-table
    
    (Eventually, these should be user-defined rather than hard-coded)

    The Place registry is what's exported -- with the P4V data, these Places can be used to create Regions

  */


  // Place base class
  // The machanism for hiding / unhiding would go here

  class Place {
    
    constructor (options) {
      this.id = options.id || (new Date()) + Math.floor(Math.random() * 10000);
      this.isHere = undefined;
    }
    
    // Get the ID for this Place -- e.g. "place-dslwall"
    
    getCssPlaceId() {
      return `place-${this.id}`; // TODO: No magic!
    }
    
    // UTILITY: Add a CSS stylesheet reference to the head as a <link>
    //  IFF it hasn't already been added, and the client is "here"
    //   (no point in loading it if it isn't here!)
    
    addCssStylesheet(options) {
      
      // options = { id, url, integrity, crossorigin }
      
      let elementId = options.id,
          styleSheetUrl = options.url,
          integrity = options.integrity,
          crossOrigin = options.crossorigin;
      
      if (document.getElementById(elementId) === null && this.isHere) {
        
        let styleElement = document.createElement('link');
        
        styleElement.setAttribute('id', elementId);
        styleElement.setAttribute('rel', 'stylesheet');
        styleElement.setAttribute('href', styleSheetUrl);
        
        if (integrity !== undefined) {
          styleElement.setAttribute('integrity', integrity);  
        }
        
        if (crossOrigin !== undefined) {
          styleElement.setAttribute('crossorigin', crossOrigin);
        }
        
        document.head.appendChild(styleElement);
      }
    }
    
    // UTILITY: Add CSS code to the head as a <style>
    // Give the style element an ID
    
    addCss(options) {
      // Check if style w that ID already exists
      if (document.getElementById(options.id) === null) {
        let styleElement = document.createElement('style');
        styleElement.setAttribute('id', options.id);
        styleElement.appendChild(document.createTextNode(options.css));
        document.head.appendChild(styleElement);
      }
    }
    
    set clientPlace(clientPlace) {
      this.isHere = (this.id === clientPlace);
    }
    
    assignPartViewToRegion(selector, partView) {
      partView.container.classList.add(this.isHere ? 'place-here' : 'place-not-here');
      this.assignPartViewToRegion2(selector, partView);
    }
  }

  // FixedGridPlace

  /*

    Global CSS is only loaded when a Region is created

  */

  class FixedGridPlace extends Place {
    
    constructor(options) {
      
      super(options);
      
      this.options = {
        rows: parseInt(options.rows) || 1,
        columns: parseInt(options.columns) || 1, 
        rowHeight: parseInt(options.rowHeight) || 1080, 
        columnWidth: parseInt(options.columnWidth) || 1920
      };
      
      this.loadGlobalCSS();
    }
    
    loadGlobalCSS() {
      
      let defaultRegionSelector = 'defaultRegion'; // TODO: NO MAGIC - This should be from the settings

      super.addCss({
        id: 'place-fixedgrid-global',
        css: `
        .placetype-fixedgrid, .placetype-fixedgrid-${defaultRegionSelector} {
          width: ${this.options.columnWidth * this.options.columns}px;
          height: ${this.options.rowHeight * this.options.rows}px;
        }`
      });
    }
    
    loadCSS(regionCSS) {
      this.loadGlobalCSS();
      super.loadCSS(regionCSS);
    }
    
    assignPartViewToRegion2(selector, partView) {
      console.log(`FixedGridPlace region ${selector} being assigned to Part`);
      return new FixedGridPlaceRegion(selector, partView, this);
    }
  }

  class FixedGridPlaceRegion { // Q: Is there any reason to make this a subclass of Place?
    
    constructor(selector, partView, parentPlace) {
      
      // super();
      
      this.parentPlace = parentPlace;
      
      if (selector !== undefined) {

        // Extract Region properties out of rcwh selector
        // TODO: this should extract rcwh, crwh, rc, etc.

        const parseSelectorRegEx = /^c(\d+)r(\d+)w(\d+)h(\d+)$/i;
        let parsedSelector = {};

        let matches = selector.match(parseSelectorRegEx);
        
        if (matches !== null) {
          
          [parsedSelector.column, parsedSelector.row, parsedSelector.width, parsedSelector.height] 
            = matches.slice(1,6).map(x => parseInt(x));

          // Add CSS as style tag in head

          parentPlace.addCss({
            id: `place-fixedgrid-${selector}`,
            css: `
            .place-fixedgrid-${selector} {
              position: absolute;
              width: ${parentPlace.options.columnWidth * parsedSelector.width}px;
              height: ${parentPlace.options.rowHeight * parsedSelector.height}px;
              left: ${parentPlace.options.columnWidth * (parsedSelector.column - 1)}px;
              top: ${parentPlace.options.rowHeight * (parsedSelector.row - 1)}px;
            }
          `
          });
        }
      } else {
        console.log('REGION UNDEFINED');
        // What happens if region is undefined? 
      }
      
      // Get the element associated with a Part
      //  and assign the Place class to it (both generic and specific)
      
      partView.container.classList.add(`place-fixedgrid-${selector}`);
      partView.container.classList.add(`placetype-fixedgrid`); // TODO: this should be default behavior for all Places
      partView.container.classList.add(`place-${parentPlace.id}`);
      
      // TODO: let Part know that it's in a Place, in case it needs to do something with 
      //  that information (maybe via VuEx)
      
      // TODO: let Part know if it's inRole or not (maybe via VuEx)
    }
  }

  // Bootstrap Place

  class BootstrapPlace extends Place {
    
    constructor (options) {
      super(options);
    }
    
    loadBootstrap() {
      
      this.addCssStylesheet({
        id: 'place-bootstrap-global',
        url: 'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css',
        integrity: 'sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u',
        crossorigin: 'anonymous'
      });
      
      this.addCss({
        id: `place-bootstrap`,
        css: `
        body {
          padding: 5% 15%;
        }
      `
      });
    }
    
    assignPartViewToRegion2(selector, partView) {
      
      console.log(`Bootstrap region ${selector} being assigned to PartView`);
      console.log(partView);
      
      return new BootstrapPlaceRegion(selector, partView, this);    
      
      // TODO: Notify PartView that it's in a place 
      // (this probably will be via the VuEx store)
    }
  }

  class BootstrapPlaceRegion {
    
    constructor(selector, partView, parentPlace) {
      partView.container.classList.add(`placetype-bootstrap-${selector}`);
      // TODO: There must be a standard bootstrap class name??
      partView.container.classList.add(`place-${parentPlace.id}`);
      parentPlace.loadBootstrap();
    }
  }

  // This keeps track of all the place type constructors
  // The keys are are lower case versions of the @type value
  //  in the markup

  const placeTypeConstructor = {
    bootstrapplace: BootstrapPlace,
    fixedgridplace: FixedGridPlace
  };


  function getPlaceRegistry(p4vData) {
    
    let placeRegistry = {};
    
    p4vData.placeDefs.forEach(placeDef => {
      placeRegistry[placeDef.id] = new placeTypeConstructor[placeDef.type.toLowerCase()](placeDef);
    });
    
    return placeRegistry;
  }

  /*

    IDEAS:
    
    - This is a good place to optimize:
      - Any Parts type=default that have no Phases or Places associated can be ignored
        (would this take care of the nested HTML problem?)
    - Make implicit types explicit, e.g. state default Part types, Phase types, etc.
      Maybe on @data-part-type-implicit or @phase-type-implicit

  */

  // These functions take the P4v Store and create
  //  the Places, Phases, and Parts/Part Views

  function createParts(p4vStore, p4vData, partRegistry, PartUtils, Vue, flightInstanceId) {
    
    // Get unique list of Part types in markup

    let partTypeList = Array.from(new Set(
      Object.values(p4vData.parts).map(part => part.type)
    ));
    
    // Register each PartType as a Vue component,
    //  along with its PartViews
    
    partTypeList.forEach(partTypeName => {

      if (partRegistry[partTypeName] !== undefined) {
        
        console.log(`REGISTERING VUE COMPONENT FOR ${partTypeName}. Definition:`);
        console.log(partRegistry[partTypeName].part);
        
        let partTypeDef = partRegistry[partTypeName];
        
        // All Parts extend the base _super.part component
        
        partTypeDef.part.extends = partRegistry['_super'].part;
        
        // Initialize this Part Type's shared data
        // TODO: turn this into a function w return value (it's a black box)
        
        PartUtils.initPartTypeSharedData(partTypeName, partTypeDef, p4vData, p4vStore, flightInstanceId);
        
        // If no rendering defined, just do a pass-through
        // TODO: is this the best option?
        
        if (partTypeDef.part.template === undefined && partTypeDef.part.render === undefined) {
          partTypeDef.part.template = '<div><slot></slot></div>';
        }
        
        // If there are shared variables in this Part, then create getters/setters
        //  for use in the Part View
        
        let partSharedVarAccessors = Object.keys(partTypeDef.part.computed || {})
          .reduce((gettersSetters, sharedVarName) => {
            
            let getter = function() {
              return p4vStore.getters.getPartViewSharedVariable(this.id, sharedVarName);
            };
            
            let setter = function(value) {
              console.log(`SETTING ${sharedVarName} TO ${value} in VUE!`);
              // p4vStore.commit('setPartViewSharedVariable', [this.id, sharedVarName, value]);
              p4vStore.setPartViewSharedVariable(this.id, sharedVarName, value);
            };
            
            gettersSetters[sharedVarName] = { get: getter, set: setter };
            return gettersSetters;
            
          }, {});
        
        // Register Part component
        
        Vue.component(partTypeName, partTypeDef.part);
        
        // Register this Part's Views as components
        //   (which also extend from _super.part)
        
        if (partTypeDef.views) {
          
          partTypeDef.views.forEach(partView => {
            
              let partViewVueName = PARSING_CONSTANTS.PART.GET_VUE_COMPONENT_NAME(partTypeName, partView.partviewName);
            
              partView.extends = partRegistry['_super'].views[0];
              partView.computed = Object.assign(partSharedVarAccessors, partView.computed);
            
              console.log(`REGISTERING VUE COMPONENT FOR ${partViewVueName}. Definition:`);
              console.log(partView);
            
              Vue.component(partViewVueName, partView);
            }
          );
        }
      } else {
        console.error(`Unknown Part Type ${partTypeName}! (not registered)`);
      }
    });
    
    // For each Part and PartView in the p4vData,
    //  add an @is attribute to the element to
    //  signal to Vue that it is a component
    // Also, add a @ref and set it to ID
    // Also, add a suitable class name to @class
    
    // Parts - add @is and @ref, and add classname
    
    for (let partId in p4vData.parts) {
      let partDef = p4vData.parts[partId];
      partDef.container.setAttribute('is', partDef.type);
      partDef.container.classList.add(
        PARSING_CONSTANTS.PART.GET_CSS_CLASS(partDef.type)
      );
      partDef.container.setAttribute('ref', partId);
    }
    
    // Part Views - add @is and @ref and add classname

    for (let partViewId in p4vData.partViews) {
      
      let partViewDef = p4vData.partViews[partViewId],
          parentPartId = partViewDef.partId,
          parentPartType = p4vData.parts[parentPartId].type;
      
      console.log(`SETTING PARTVIEW @IS TO ${parentPartType}-${partViewDef.name}`);
      
      // KLUDGE: Copy over id in data structure to DOM node
      
      partViewDef.container.setAttribute('id', partViewId);
      
      // If also a Part, then move that over to @isAlso
      //  and register this partView in a Place 
      //  (not sure that this is the place to do that ...)
      
      if (partViewDef.container.getAttribute('is') !== null) {
        partViewDef.container.setAttribute(
          'is_also',
          partViewDef.container.getAttribute('is')
        );
        
        partViewDef.container.setAttribute('part_id', parentPartId);

        if (p4vData.parts[parentPartId].place) {
          // console.log('8888888888888');
          // console.log(p4vData.parts[parentPartId]);
          // console.log(`${partViewId} is in ${p4vData.parts[parentPartId].place}`);
          p4vStore.addPartViewToPlace(partViewId, p4vData.parts[parentPartId].place);      }
      }
      
      partViewDef.container.setAttribute('is', `${parentPartType}-${partViewDef.name}`);
      partViewDef.container.classList.add(
        PARSING_CONSTANTS.PART.GET_CSS_CLASS(parentPartType, partViewDef.name)
      );
      partViewDef.container.setAttribute('ref', partViewId);
    }
    
    // Now release Vue on it!
    // (What if Phases/Places want to adjust the markup before Vue-ifying? Should this step be deferred?)
    // Maybe this should be merged into a general "make it so" step that includes kickstarting the Phases
  /*
    new Vue({
      el: '#glider-root'
    });
    */
    
  }

  // Go through each Place in p4vData and create a Place object
  //   (Remember that Parts don't have Places -- only Part Views do)

  function createPlaces(p4vStore, p4vData, placeRegistry, clientPlace) {
      
    let places = {},
        placeId;
    

    /*  c// onsole.log('YYYYYYYYYYYY');
    c// onsole.log(p4vStore.placesPartviews);
    c// onsole.log(p4vData.placesPartviews);
    
  */
      for (placeId in p4vData.places) {
      
      let placeData = p4vData.places[placeId],
          placeObject = placeRegistry[placeData.role];

     
      // console.log(`Is ${placeId} here? ${placeObject.isHere}`);
      
      // Assuming the Place is found in the registry ...
      // (TODO: this should be fixed to allow for new entries)
      
      if (placeObject === undefined) {
        console.error(`Place '${placeData.role}' not found in registry`);
        // TODO: Should default to something
      } else {
         console.log(`PLACE OBJECT ${placeData.role}`);
   //     console.log(placeObject);
        console.log(p4vData.placesPartviews[placeId]);

        console.log(p4vStore.placesPartviews[placeId]);      

        placeObject.clientPlace = clientPlace; // TODO: is this the time to do this?

        // Go through each PV assigned to this Place
        //  and assign it to a PlaceRegion (default if unspecified)
        
        if (p4vStore.placesPartviews[placeId] !== undefined) {
          p4vStore.placesPartviews[placeId].forEach(
            partViewId => placeObject.assignPartViewToRegion(
              placeData.region, p4vData.partViews[partViewId]
            )
          ); 
        }
      }
    }
    
    // Have the Place watch a VuEx registry
    // that maps a place-ID with an array of PartView-IDs
    
    // Associated with that registry -- a trigger that
    // IF a View is added, then throw the View at it
    // AND if a View is removed, then undo it (not a priority)
    
    return places;
  }

  // Go through each Phase object in p4vData.phases
  //  and create a corresponding object, then use the
  //  parent/child information in p4vData.phaseChildren
  //  to associate those Phase objects
  // Return hash of phases by ID

  function createPhases(gliderApp, p4vData, phaseFactory) {
    
    let phases = {};
    
    // Create Phase objects
    
    for (let phaseId in p4vData.phases) {
      // let phaseData = p4vData.phases[phaseId];
      let phaseData = Object.assign({ app: gliderApp }, p4vData.phases[phaseId]);

      console.log("PHASE DATA");
      console.log(phaseData);
      phases[phaseId] = phaseFactory(phaseData);
    }
    
    // Associate child Phases with parents
    
    for (let parentPhaseId in p4vData.phaseChildren) {
      
      let parentPhase = phases[parentPhaseId],
        phaseChildren = p4vData.phaseChildren[parentPhaseId].map(id => phases[id]);
      
      phaseChildren.forEach(childPhase => parentPhase.addChild(childPhase));
    }
    
    console.log("CREATING PHASES IN FACTORY");
    console.log(phases);
    
    return phases;
  }

  //import Glider from './glider.js'; 


  // window.location.hash = `#/${prompt("Flight ID", "Letters and digits only")}/dslWall`;
  // (maybe prompt for flightID, incorporate into URL, which allows user to hit refresh?)
  // #/FLIGHT_ID/ROLE/JUMPHASH
  // If jumphash = 'main' then this is the initializing instance

  // window.location.hash = `#/2345/phone/main`; // TEMP -- manually seeding flight instance ID and Place
  // window.location.hash = `#/2345/phone`; // TEMP -- manually seeding flight instance ID and Place

  let { flightInstanceId, herePlace, nowPhase, initialize } = getGliderOptions();

  console.log(`PARSED URL ${flightInstanceId}; ${herePlace}`);
  console.log(flightInstanceId, herePlace, nowPhase, initialize);

  Vue.use(Vuex);

  // Global glider object for export

  let glider = {};

  // Main Glider bootup sequence

  function gliderBootOnDomLoad() {

    // Add default stylesheet unless overridden
    
    if (! document.querySelector('#glider-style')) {
      const gliderStylesheetLink = document.createElement('link');
      gliderStylesheetLink.setAttribute('id', 'glider-style'); // TODO: NO MAGIC
      gliderStylesheetLink.rel = 'stylesheet';
      gliderStylesheetLink.href = 'https://glider.glitch.me/glider/style.css'; // TODO: NO MAGIC
      document.head.appendChild(gliderStylesheetLink);
    }
    
    // Add classname to body tag for this place
    
    document.body.classList.add(`place-here-${herePlace}`);  // TODO: NO MAGIC
    
    // Parse the flight markup and get the data structure

    let parsedP4v = main();
    
    console.log('-------------------------------------------------------');
    console.log("DATA RETURNED FROM PARSER");
    console.log(parsedP4v);
    
    // Add start button (TEMP, until we do async loading)
    
    let startButton = document.createElement('section');
    startButton.setAttribute('id', 'glider-start');
    startButton.setAttribute('class', 'not-ready2');
    startButton.innerHTML = '<p><br />Start</p>';
    startButton.onclick = function() {
      window.glider.run(); 
      this.parentNode.removeChild(this);
    };

    document.body.appendChild(startButton);

    // Take that data structure and initialize the p4v store
    // TODO: This can be done immediately (no need for the DOM to load)
    
    let gliderApp = getLocalStore(flightInstanceId, parsedP4v, initialize);
    
    gliderApp.here = herePlace;
    gliderApp.isInitializingInstance = initialize;
    window.gApp = gliderApp;
    

    
    // Create the parts/part views, places, and phases
    // TODO: flightInstanceId should live as part of the store (or something)
    //  so that it's globally accessible -- shouldn't be passed as a parameter

    console.log('-------------------------------------------------------');
    console.log("CREATING PARTS");
    createParts(gliderApp, parsedP4v, partTypeRegistry, PartUtils, Vue, flightInstanceId);
    
    console.log('-------------------------------------------------------');
    console.log('CREATING PLACES');
    console.log(parsedP4v.places);
    
    const placeRegistry = getPlaceRegistry(parsedP4v);
    let places = createPlaces(gliderApp, parsedP4v, placeRegistry, herePlace);
    
    console.log('-------------------------------------------------------');
    console.log('CREATING PHASES');
    let phases = createPhases(gliderApp, parsedP4v, phaseFactory);
    console.log(phases);
    
    // Initialize global glider API
    /*
    glider = new Glider(gliderApp);
    glider.store = gliderApp;
    glider.places = places;
    glider.phases = phases;
    glider.registerPlace = placeRegistry;
    
    window.glider = glider;
    */
    
    // Start Glider! (should this be in a module?)

    window.glider = {};
    window.herePlace = herePlace;
    window.glider.phases = phases;
    window.glider.phases2Parts = parsedP4v.phasesParts;
    
    {
      console.log('-------------------------------------------------------');
      console.log('RENDERING VUE');
      console.log('BEFORE');
      console.log(Vue.options);
      window.wtf = Vue.options;
      
      let rootVue = new Vue({ 
        el: '#glider-root', // TODO: NO MAGIC!
        data: {
          abc: 'def', // TEST
          store: gliderApp,
          app: gliderApp,
          parts: {},
          partviews: {}
        }
      });
      
      window.glider.parts = rootVue.$refs;
      
      // window.glider.isRunning = false;
      
      window.glider.run = function () { 
        this.isRunning = true;
        // this.parts['pv-nextBut-defaultView'].makeGliderRun();
        this.phases['glider-root'].run(); 
      };
      // window.vv = rootVue;
      console.log('AFTER');
      console.log(Vue.options);
    }

    // phases.run();
  }
  document.addEventListener('DOMContentLoaded', gliderBootOnDomLoad);

  exports.glider = glider;

  return exports;

}({}));
